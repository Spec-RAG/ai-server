{"id": "sha256:a158606d9b87140cc6500c01ab31b7086f5fcf1499918d50d828901254c3614f", "content": "[[deps-without-boot]]\n\nWe recommend a Spring Boot first approach when using Spring for Apache Pulsar.\nHowever, if you do not use Spring Boot, the preferred way to get the dependencies is to use the provided BOM to ensure a consistent version of modules is used throughout your entire project.\nThe following example shows how to do so for both Maven and Gradle:\n\n[tabs]\n======\nMaven::\n+\n.pom.xml\n[source,xml,indent=0,subs=\"verbatim,attributes\",role=\"primary\"]\n----\n<dependencyManagement>\n\t<dependencies>\n <!-- ... other dependency elements ... -->\n <dependency>\n <groupId>org.springframework.pulsar</groupId>\n <artifactId>spring-pulsar-bom</artifactId>\n <version>{spring-pulsar-version}</version>\n <type>pom</type>\n <scope>import</scope>\n </dependency>\n\t</dependencies>\n</dependencyManagement>\n----\n\nGradle::\n+\n.build.gradle\n[source,groovy,indent=0,subs=\"verbatim,attributes\",role=\"secondary\"]\n----\nplugins {\n\tid \"io.spring.dependency-management\" version \"1.1.4\"\n}\n\ndependencyManagement {\n\timports {\n mavenBom 'org.springframework.pulsar:spring-pulsar-bom:{spring-pulsar-version}'\n\t}\n}\n----\n======\n\nA minimal Spring for Apache Pulsar set of dependencies typically looks like the following:\n\n[tabs]\n======\nMaven::\n+\n.pom.xml\n[source,xml,indent=0,subs=\"verbatim,attributes\",role=\"primary\"]\n----\n<dependencies>\n\t<!-- ... other dependency elements ... -->\n\t<dependency>\n <groupId>org.springframework.pulsar</groupId>\n <artifactId>spring-pulsar</artifactId>\n\t</dependency>\n</dependencies>\n----\n\nGradle::\n+\n.build.gradle\n[source,groovy,indent=0,subs=\"verbatim,attributes\",role=\"secondary\"]\n----\ndependencies {\n\timplementation \"org.springframework.pulsar:spring-pulsar\"\n}\n----\n======\n\nIf you use additional features you need to also include the appropriate dependencies.\n\nSpring for Apache Pulsar builds against Spring Framework {spring-framework-version} but should generally work with any newer version of Spring Framework 6.x.\nMany users are likely to run afoul of the fact that Spring for Apache Pulsar's transitive dependencies resolve Spring Framework {spring-framework-version}, which can cause strange classpath problems.\nThe easiest way to resolve this is to use the `spring-framework-bom` within your `dependencyManagement` section as follows:\n\n[tabs]\n======\nMaven::\n+\n.pom.xml\n[source,xml,indent=0,subs=\"verbatim,attributes\",role=\"primary\"]\n----\n<dependencyManagement>\n\t<dependencies>\n <!-- ... other dependency elements ... -->\n <dependency>\n <groupId>org.springframework</groupId>\n <artifactId>spring-framework-bom</artifactId>\n <version>{spring-framework-version}</version>\n <type>pom</type>\n <scope>import</scope>\n </dependency>\n\t</dependencies>\n</dependencyManagement>\n----\n\nGradle::\n+\n.build.gradle\n[source,groovy,indent=0,subs=\"verbatim,attributes\",role=\"secondary\"]\n----\nplugins {\n\tid \"io.spring.dependency-management\" version \"1.1.4\"\n}\n\ndependencyManagement {\n\timports {\n mavenBom 'org.springframework:spring-framework-bom:{spring-framework-version}'\n\t}\n}\n----\n======\n\nThe preceding example ensures that all the transitive dependencies of Spring for Apache Pulsar use the Spring {spring-framework-version} modules.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/appendix/getting-dependencies-without-boot.adoc", "title": "getting-dependencies-without-boot", "heading": "getting-dependencies-without-boot", "heading_level": 1, "file_order": 0, "section_index": 0, "content_hash": "a158606d9b87140cc6500c01ab31b7086f5fcf1499918d50d828901254c3614f", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/appendix/getting-dependencies-without-boot.adoc"}}
{"id": "sha256:09394acbc1bca75005897cdfd51bf6f5377971764546ab7199a986f6a420ff88", "content": "[[native-images]]\n\n:toc: left\n:toclevels: 6\n:numbered:\n:icons: font\n:hide-uri-scheme:\n:sectnums:\n:sectnumlevels: 3\n\ninclude::attributes-variables.adoc[]\n\nhttps://www.graalvm.org/native-image/[GraalVM Native Images] are standalone executables that can be generated by processing compiled Java applications ahead-of-time. Native Images generally have a smaller memory footprint and start faster than their JVM counterparts.\n\n.Support\nThe required https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#core.aot.hints[AOT Runtime Hints] are built-in to Spring for Apache Pulsar so that it can seamlessly be used in native image based Spring applications.\n\n[NOTE]\n====\nThe native image support in Spring for Apache Pulsar has been tested in basic scenarios, and we expect it to \"just work\". However, it is possible that more advanced use cases could surface the need to add additional runtime hints to your own application. If this occurs please file a {github}/issues[Github issue] with some details.\n====\n\n.Next Steps\nIf you are interested in adding native image support to your own application then an excellent place to start is the https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#native-image[Spring Boot GraalVM Support] section of the Spring Boot reference docs.\n\nAlthough there is no reference to Spring for Apache Pulsar in the aforementioned guide, you can find specific examples at the following coordinates:\n\n* https://github.com/spring-projects/spring-aot-smoke-tests/tree/main/integration/spring-pulsar[Spring for Apache Pulsar]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/appendix/native-image.adoc", "title": "native-image", "heading": "native-image", "heading_level": 1, "file_order": 1, "section_index": 0, "content_hash": "09394acbc1bca75005897cdfd51bf6f5377971764546ab7199a986f6a420ff88", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/appendix/native-image.adoc"}}
{"id": "sha256:ee4a0203e097f3541e57582d9116df1b7f32de925fe007e81913c07ffdf81ea5", "content": "[[non-ga-versions]]\n\n:toc: left\n:toclevels: 6\n:numbered:\n:icons: font\n:hide-uri-scheme:\n:sectnums:\n:sectnumlevels: 3\n\ninclude::attributes-variables.adoc[]\n\nYou can find snapshot or milestone versions of the dependencies in the following repositories:\n\n[tabs]\n======\nMaven::\n+\n[source,xml,indent=0,subs=\"verbatim,attributes\",role=\"primary\"]\n----\n<repositories>\n <repository>\n <id>spring-milestones</id>\n <name>Spring Milestones</name>\n <url>https://repo.spring.io/milestone</url>\n <snapshots>\n <enabled>false</enabled>\n </snapshots>\n </repository>\n <repository>\n <id>spring-snapshots</id>\n <name>Spring Snapshots</name>\n <url>https://repo.spring.io/snapshot</url>\n <releases>\n <enabled>false</enabled>\n </releases>\n </repository>\n <repository>\n <id>apache-snapshots</id>\n <name>Apache Snapshots</name>\n <url>https://repository.apache.org/content/repositories/snapshots</url>\n <releases>\n <enabled>false</enabled>\n </releases>\n </repository>\n</repositories>\n----\n\nGradle::\n+\n[source,groovy,indent=0,subs=\"verbatim,attributes\",role=\"secondary\"]\n----\nrepositories {\n maven {\n name = 'spring-milestones'\n url = 'https://repo.spring.io/milestone'\n }\n maven {\n name = 'spring-snapshots'\n url = 'https://repo.spring.io/snapshot'\n }\n maven {\n name = 'apache-snapshot'\n url = 'https://repository.apache.org/content/repositories/snapshots'\n }\n}\n----\n======", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/appendix/non-ga-versions.adoc", "title": "non-ga-versions", "heading": "non-ga-versions", "heading_level": 1, "file_order": 2, "section_index": 0, "content_hash": "ee4a0203e097f3541e57582d9116df1b7f32de925fe007e81913c07ffdf81ea5", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/appendix/non-ga-versions.adoc"}}
{"id": "sha256:a8256a1f488e958099b9fd5617f7599d75cc48292c3b6285b2dbeb5c4a0fe459", "content": "[[override-boot-deps]]\n\nWhen using Spring for Apache Pulsar in a Spring Boot application, the Apache Pulsar dependency versions are determined by Spring Boot's dependency management.\nIf you wish to use a different version of `pulsar-client-all` you need to override their version used by Spring Boot dependency management; set the `pulsar.version` property.\n\nOr, to use a different Spring for Apache Pulsar version with a supported Spring Boot version, set the `spring-pulsar.version` property.\n\nIn the following example, snapshot version of the Pulsar clients and Spring for Apache Pulsar are being used.\n\n[source, groovy, subs=\"+attributes\", role=\"secondary\"]\n.Gradle\n----\next['pulsar.version'] = '4.4.2-SNAPSHOT'\next['spring-pulsar.version'] = '2.0.1-SNAPSHOT'\n\ndependencies {\n implementation 'org.springframework.boot:spring-boot-starter-pulsar'\n}\n----\n\n[tabs]\n======\nMaven::\n+\n[source, xml, subs=\"+attributes\", role=\"primary\"]\n----\n<properties>\n <pulsar.version>4.4.2-SNAPSHOT</pulsar.version>\n <spring-pulsar.version>2.0.1-SNAPSHOT</spring-pulsar.version>\n</properties>\n\n<dependency>\n <groupId>org.springframework.boot</groupId>\n <artifactId>spring-boot-starter-pulsar</artifactId>\n</dependency>\n----\n======", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/appendix/override-boot-dependencies.adoc", "title": "override-boot-dependencies", "heading": "override-boot-dependencies", "heading_level": 1, "file_order": 3, "section_index": 0, "content_hash": "a8256a1f488e958099b9fd5617f7599d75cc48292c3b6285b2dbeb5c4a0fe459", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/appendix/override-boot-dependencies.adoc"}}
{"id": "sha256:e2e26b184be0871d555751a2b78d6dac725e48a34759eed7934d255f290e7b45", "content": "[[version-compatibility]]\n\n:toc: left\n:toclevels: 6\n:numbered:\n:icons: font\n:hide-uri-scheme:\n:sectnums:\n:sectnumlevels: 3\n\ninclude::attributes-variables.adoc[]\n\nThe following is the compatibility matrix:\n|===\n| Spring for Apache Pulsar | Pulsar Client | Spring Boot | Java\n\n| 2.0.x\n| 4.1.x / 4.0.x / 3.3.x\n| 4.0.x\n| 17+\n\n| 1.2.x\n| 3.3.x / 4.0.x^**(*)**^\n| 3.4.x / 3.5.x\n| 17+\n\n| 1.1.x\n| 3.2.x\n| 3.3.x\n| 17+\n\n| 1.0.x\n| 3.0.x / 3.1.x\n| 3.2.x\n| 17+\n\n|===\n\n[NOTE]\n====\n^**(*)**^ The `3.3.x` Pulsar client is the default version specified by Spring for Apache Pulsar `1.2.x` and Spring Boot `3.4.x`.\nHowever, the `4.0.x` Pulsar client is compatible.\n\nYou can follow xref:appendix/override-boot-dependencies.adoc#override-boot-deps[these steps] to override the Pulsar client version.\n====\n\n[NOTE]\n====\nIf you are currently using Pulsar `2.11.x` you may notice that it is not present in the above matrix.\nWe do not currently test nor officially support running against Pulsar `2.11.x`.\nHowever, Pulsar is currently compatible across versions and it is likely to work for you.\n====", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/appendix/version-compatibility.adoc", "title": "version-compatibility", "heading": "version-compatibility", "heading_level": 1, "file_order": 4, "section_index": 0, "content_hash": "e2e26b184be0871d555751a2b78d6dac725e48a34759eed7934d255f290e7b45", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/appendix/version-compatibility.adoc"}}
{"id": "sha256:ed27ca4896241dc5b5f7cd359be81b3809e59ac1687352e3b0fde337d65cdbc6", "content": ":spring-boot-version: current\n:spring-framework-version: current\n:spring-cloud-stream-version: current\n:spring-pulsar-version: current\n:pulsar-client-version: current\n:pulsar-client-version-family: current\n:is-snapshot-version:  false\n\n:github: https://github.com/spring-projects/spring-pulsar\n:javadocs: https://docs.spring.io/spring-pulsar/docs/{spring-pulsar-version}/api\n:spring-framework-docs: https://spring.io/projects/spring-framework#learn\n:spring-boot-docs: https://docs.spring.io/spring-boot/{spring-boot-version}\n:spring-boot-pulsar-config-props: {spring-boot-docs}/appendix/application-properties/index.html#appendix.application-properties.integration\n:spring-cloud-stream-docs: https://docs.spring.io/spring-cloud-stream/docs/{spring-cloud-stream-version}/reference/html/\n:spring-cloud-function: https://spring.io/projects/spring-cloud-function\n\n:apache-pulsar-docs: https://pulsar.apache.org/docs/{pulsar-client-version-family}\n:apache-pulsar-cient-docs: {apache-pulsar-docs}/client-libraries-java\n:apache-pulsar-io-docs: {apache-pulsar-docs}/io-connectors\n:apache-pulsar-function-docs: {apache-pulsar-docs}/functions-overview", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/attributes/attributes.adoc", "title": "attributes", "heading": "attributes", "heading_level": 1, "file_order": 6, "section_index": 0, "content_hash": "ed27ca4896241dc5b5f7cd359be81b3809e59ac1687352e3b0fde337d65cdbc6", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/attributes/attributes.adoc"}}
{"id": "sha256:63e7b0bc3797fa7d59841e42ac1ea286625ae328498d33eb8b7ec5ab0d350b98", "content": "[[building-project]]\n\n:spring-boot-version: current\n:spring-framework-version: current\n:spring-cloud-stream-version: current\n:spring-pulsar-version: current\n:pulsar-client-version: current\n:pulsar-client-version-family: current\n:is-snapshot-version:  false\n\n:github: https://github.com/spring-projects/spring-pulsar\n:javadocs: https://docs.spring.io/spring-pulsar/docs/{spring-pulsar-version}/api\n:spring-framework-docs: https://spring.io/projects/spring-framework#learn\n:spring-boot-docs: https://docs.spring.io/spring-boot/{spring-boot-version}\n:spring-boot-pulsar-config-props: {spring-boot-docs}/appendix/application-properties/index.html#appendix.application-properties.integration\n:spring-cloud-stream-docs: https://docs.spring.io/spring-cloud-stream/docs/{spring-cloud-stream-version}/reference/html/\n:spring-cloud-function: https://spring.io/projects/spring-cloud-function\n\n:apache-pulsar-docs: https://pulsar.apache.org/docs/{pulsar-client-version-family}\n:apache-pulsar-cient-docs: {apache-pulsar-docs}/client-libraries-java\n:apache-pulsar-io-docs: {apache-pulsar-docs}/io-connectors\n:apache-pulsar-function-docs: {apache-pulsar-docs}/functions-overview\n\nIf you have cloned the project locally, follow these steps to build the project from the source code.\n\nNOTE: Gradle `8.x (8.3 or above)` is required to build.\n\nRun the following command to do a full build of the project:\n[indent=0]\n----\n./gradlew clean build\n----\nYou can build without running tests by using the following command:\n[indent=0]\n----\n./gradlew clean build -x test\n----\n\nYou can build the reference documentation using this command:\n----\n./gradlew :spring-pulsar-docs:antora\n----\nYou can view the generated HTML in `_docs/build/site_` directory.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/intro/building.adoc", "title": "building", "heading": "building", "heading_level": 1, "file_order": 7, "section_index": 0, "content_hash": "63e7b0bc3797fa7d59841e42ac1ea286625ae328498d33eb8b7ec5ab0d350b98", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/intro/building.adoc"}}
{"id": "sha256:49e5a0a8933164c55c090da9bdddd81aa414cde53969d4168dec06d3d7cea7fb", "content": "[[getting-help]]\n\n:spring-boot-version: current\n:spring-framework-version: current\n:spring-cloud-stream-version: current\n:spring-pulsar-version: current\n:pulsar-client-version: current\n:pulsar-client-version-family: current\n:is-snapshot-version:  false\n\n:github: https://github.com/spring-projects/spring-pulsar\n:javadocs: https://docs.spring.io/spring-pulsar/docs/{spring-pulsar-version}/api\n:spring-framework-docs: https://spring.io/projects/spring-framework#learn\n:spring-boot-docs: https://docs.spring.io/spring-boot/{spring-boot-version}\n:spring-boot-pulsar-config-props: {spring-boot-docs}/appendix/application-properties/index.html#appendix.application-properties.integration\n:spring-cloud-stream-docs: https://docs.spring.io/spring-cloud-stream/docs/{spring-cloud-stream-version}/reference/html/\n:spring-cloud-function: https://spring.io/projects/spring-cloud-function\n\n:apache-pulsar-docs: https://pulsar.apache.org/docs/{pulsar-client-version-family}\n:apache-pulsar-cient-docs: {apache-pulsar-docs}/client-libraries-java\n:apache-pulsar-io-docs: {apache-pulsar-docs}/io-connectors\n:apache-pulsar-function-docs: {apache-pulsar-docs}/functions-overview\n\nIf you have trouble with Spring for Apache Pulsar, we would like to help.\n\n* Learn the Spring basics.\nSpring for Apache Pulsar builds on several other Spring projects.\nCheck the https://spring.io[spring.io] web-site for a wealth of reference documentation.\nIf you are starting out with Spring, try one of the https://spring.io/guides[guides].\n* Ask a question.\nWe monitor https://stackoverflow.com[stackoverflow.com] for questions tagged with https://stackoverflow.com/tags/spring-pulsar[`spring-pulsar`].\n* Report bugs at {github}/issues.\n\nNOTE: All of Spring for Apache Pulsar is open source, including the documentation.\nIf you find problems with the docs or if you want to improve them, please get involved.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/intro/getting-help.adoc", "title": "getting-help", "heading": "getting-help", "heading_level": 1, "file_order": 8, "section_index": 0, "content_hash": "49e5a0a8933164c55c090da9bdddd81aa414cde53969d4168dec06d3d7cea7fb", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/intro/getting-help.adoc"}}
{"id": "sha256:f348a04d8cda496010d0f0a1331c7c6966360474d61f21bef73c5b28e4285151", "content": "[[system-requirements]]\n\n:spring-boot-version: current\n:spring-framework-version: current\n:spring-cloud-stream-version: current\n:spring-pulsar-version: current\n:pulsar-client-version: current\n:pulsar-client-version-family: current\n:is-snapshot-version:  false\n\n:github: https://github.com/spring-projects/spring-pulsar\n:javadocs: https://docs.spring.io/spring-pulsar/docs/{spring-pulsar-version}/api\n:spring-framework-docs: https://spring.io/projects/spring-framework#learn\n:spring-boot-docs: https://docs.spring.io/spring-boot/{spring-boot-version}\n:spring-boot-pulsar-config-props: {spring-boot-docs}/appendix/application-properties/index.html#appendix.application-properties.integration\n:spring-cloud-stream-docs: https://docs.spring.io/spring-cloud-stream/docs/{spring-cloud-stream-version}/reference/html/\n:spring-cloud-function: https://spring.io/projects/spring-cloud-function\n\n:apache-pulsar-docs: https://pulsar.apache.org/docs/{pulsar-client-version-family}\n:apache-pulsar-cient-docs: {apache-pulsar-docs}/client-libraries-java\n:apache-pulsar-io-docs: {apache-pulsar-docs}/io-connectors\n:apache-pulsar-function-docs: {apache-pulsar-docs}/functions-overview\n\nSpring for Apache Pulsar `{spring-pulsar-version}` requires the following:\n\n- https://www.java.com[Java 17] and is compatible up to and including Java 20\n- {spring-framework-docs}[Spring Framework `{spring-framework-version}`] or above\n- {apache-pulsar-cient-docs}/[Apache Pulsar Java Client `{pulsar-client-version}`] or above\n\nThe version compatibility matrix (including Spring Boot) can be found in the xref:appendix/version-compatibility.adoc#version-compatibility[appendix].", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/intro/system-requirements.adoc", "title": "system-requirements", "heading": "system-requirements", "heading_level": 1, "file_order": 9, "section_index": 0, "content_hash": "f348a04d8cda496010d0f0a1331c7c6966360474d61f21bef73c5b28e4285151", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/intro/system-requirements.adoc"}}
{"id": "sha256:fdd6f6295bc4445fa3b5a1c7b2c3c44f57b9c80fece111d5c0f1c501be2ca685", "content": "Soby Chacko; Chris Bono; Alexander Preu√ü; Jay Bryant; Christophe Bornet; Jonas Geiregat", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/overview/authors.adoc", "title": "authors", "heading": "authors", "heading_level": 1, "file_order": 10, "section_index": 0, "content_hash": "fdd6f6295bc4445fa3b5a1c7b2c3c44f57b9c80fece111d5c0f1c501be2ca685", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/overview/authors.adoc"}}
{"id": "sha256:279297d95192ed61e10cf9ac672e8a9aa9655981809492e7adf8123e84bed4be", "content": ":toc: left\n:toclevels: 6\n:numbered:\n:icons: font\n:hide-uri-scheme:\n:sectnums:\n:sectnumlevels: 3\n\ninclude::attributes-variables.adoc[]\n\nTo connect to a Pulsar cluster that requires authentication, you need to specify which authentication plugin to use and any parameters required by the specified plugin.\nWhen **using Spring Boot** auto-configuration, you can set the plugin and the plugin parameters via configuration properties (in most cases).\n\n[NOTE]\n====\nYou need to ensure that names defined under `+spring.pulsar.client.authentication.param.*+` exactly match those expected by your auth plugin (which is typically camel cased).\nSpring Boot will not attempt any kind of relaxed binding for these entries.\n\nFor example, if you want to configure the issuer url for the `AuthenticationOAuth2` auth plugin you must use `+spring.pulsar.client.authentication.param.issuerUrl+`.\nIf you use other forms, such as `issuerurl` or `issuer-url`, the setting will not be applied to the plugin.\n====\n\n[[client-authentication-env-vars]]\n[TIP]\n====\nUsing environment variables for auth parameters is typically problematic because the case sensitivity is lost during translation.\nFor example, consider the following `issuerUrl` auth parameter set via an environment variable:\n[source,properties]\n----\nSPRING_PULSAR_CLIENT_AUTHENTICATION_PARAM_ISSUERURL=https://some.server.com\n----\nWhen Spring Boot loads this property it will use `issuerurl` (lower-cased) rather than the expected `issuerUrl` (camel-cased).\nYou can get around this limitation by using the value of the env var as the value of the related auth property in your application.yml.\nContinuing the example above:\n[source,yaml]\n----\nspring:\n pulsar:\n client:\n authentication:\n param:\n issuerUrl: ${SPRING_PULSAR_CLIENT_AUTHENTICATION_PARAM_ISSUERURL}\n----\n====\n\nWhen **not using Spring Boot** auto-configuration, you can use the `org.apache.pulsar.client.api.AuthenticationFactory` to create the authentication and then set it directly on the Pulsar client builder in a client customizer that you provide to the client factory.\n\nThe following listings show how to configure each of the supported authentication mechanisms.\n\n[[Athenz]]\n.[.underline]#Click ##here## for **Athenz**#\n[%collapsible]\n[source, yaml]\n====\n----\nspring:\n pulsar:\n client:\n authentication:\n plugin-class-name: org.apache.pulsar.client.impl.auth.AuthenticationAthenz\n param:\n tenantDomain: ...\n tenantService: ...\n providerDomain: ...\n privateKey: ...\n keyId: ...\n----\nNOTE: This also requires xref:reference/pulsar/pulsar-client.adoc#tls-encryption[TLS encryption].\n====\n\n[[Token]]\n.[.underline]#Click ##here## for **Token**#\n[%collapsible]\n[source, yaml]\n====\n----\nspring:\n pulsar:\n client:\n authentication:\n plugin-class-name: org.apache.pulsar.client.impl.auth.AuthenticationToken\n param:\n token: some-token-goes-here\n----\n====\n\n[[Basic]]\n.[.underline]#Click ##here## for **Basic**#\n[%collapsible]\n[source, yaml]\n====\n----\nspring:\n pulsar:\n client:\n authentication:\n plugin-class-name: org.apache.pulsar.client.impl.auth.AuthenticationBasic\n param:\n userId: ...\n password: ...\n----\n====\n\n[[OAuth2]]\n.[.underline]#Click ##here## for **OAuth2**#\n[%collapsible]\n[source, yaml]\n====\n----\nspring:\n pulsar:\n client:\n authentication:\n plugin-class-name: org.apache.pulsar.client.impl.auth.oauth2.AuthenticationOAuth2\n param:\n issuerUrl: ...\n privateKey: ...\n audience: ...\n scope: ...\n----\n====\n\n[[Sasl]]\n.[.underline]#Click ##here## for **Sasl**#\n[%collapsible]\n[source, yaml]\n====\n----\nspring:\n pulsar:\n client:\n authentication:\n plugin-class-name: org.apache.pulsar.client.impl.auth.AuthenticationSasl\n param:\n saslJaasClientSectionName: ...\n serverType: ...\n----\n====\n\n[[mTlS-pem]]\n.[.underline]#Click ##here## for **mTLS (PEM)**#\n[%collapsible]\n====\nNOTE: Because this option requires TLS encryption, which already requires you to xref:reference/pulsar/pulsar-client.adoc#tls-encryption[provide a client builder customizer], it is recommended to simply add the authentication directly on the client builder in your provided TLS customizer.\nYou can use the `org.apache.pulsar.client.api.AuthenticationFactory` to help create the authentication object as follows:\n[source,java]\n----\nAuthentication auth = AuthenticationFactory.TLS(\"/path/to/my-role.cert.pem\", \"/path/to/my-role.key-pk8.pem\");\n----\nSee the official Pulsar documentation on {apache-pulsar-docs}/security-tls-authentication/#configure-mtls-authentication-in-pulsar-clients[mTLS (PEM)].\n====\n\n[[mTLS-jks]]\n.[.underline]#Click ##here## for **mTLS (JKS)**#\n[%collapsible]\n====\nNOTE: Because this option requires TLS encryption, which already requires you to xref:reference/pulsar/pulsar-client.adoc#tls-encryption[provide a client builder customizer], it is recommended to simply add the authentication directly on the client builder in your provided TLS customizer.\nYou can use the `org.apache.pulsar.client.api.AuthenticationFactory` to help create the authentication object as follows:\n[source,java]\n----\nAuthentication auth = AuthenticationFactory.create(\n \"org.apache.pulsar.client.impl.auth.AuthenticationKeyStoreTls\",\n Map.of(\"keyStoreType\", \"JKS\", \"keyStorePath\", \"/path/to/my/keystore.jks\", \"keyStorePassword\", \"clientpw\"));\n----\nSee the official Pulsar documentation on {apache-pulsar-docs}/security-tls-authentication/#configure-clients[mTLS (JKS)].\n====\n\nYou can find more information on each of the support plugins and their required properties in the official {apache-pulsar-docs}/security-overview#authentication-providers[Pulsar security] documentation.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/authentication.adoc", "title": "authentication", "heading": "authentication", "heading_level": 1, "file_order": 11, "section_index": 0, "content_hash": "279297d95192ed61e10cf9ac672e8a9aa9655981809492e7adf8123e84bed4be", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/authentication.adoc"}}
{"id": "sha256:29ed8eb08983710d7a9d3a57ce141dd8a934841bb63f033b9353c1f5786b7e22", "content": "[[message-consumption]]\n:toc: left\n:toclevels: 6\n:numbered:\n:icons: font\n:hide-uri-scheme:\n:sectnums:\n:sectnumlevels: 3\n\ninclude::attributes-variables.adoc[]\n\n[[pulsar-listener]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc", "title": "message-consumption", "heading": "message-consumption", "heading_level": 1, "file_order": 12, "section_index": 0, "content_hash": "29ed8eb08983710d7a9d3a57ce141dd8a934841bb63f033b9353c1f5786b7e22", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc"}}
{"id": "sha256:bcaee0ef329748d0180e95b721a33098dc9edde4a16b87f0c09b35b9ae017c12", "content": "When it comes to Pulsar consumers, we recommend that end-user applications use the `PulsarListener` annotation.\nTo use `PulsarListener`, you need to use the `@EnablePulsar` annotation.\nWhen you use Spring Boot support, it automatically enables this annotation and configures all the components necessary for `PulsarListener`, such as the message listener infrastructure (which is responsible for creating the Pulsar consumer).\n`PulsarMessageListenerContainer` uses a `PulsarConsumerFactory` to create and manage the Pulsar consumer the underlying Pulsar consumer that it uses to consume messages.\n\nSpring Boot provides this consumer factory which you can further configure by specifying the {spring-boot-pulsar-config-props}[`spring.pulsar.consumer.*`] application properties.\n\nLet us revisit the `PulsarListener` code snippet we saw in the quick-tour section:\n\n[source, java]\n----\n@PulsarListener(subscriptionName = \"hello-pulsar-subscription\", topics = \"hello-pulsar\")\npublic void listen(String message) {\n System.out.println(\"Message Received: \" + message);\n}\n----\n\nYou can further simplify this method:\n\n[source, java]\n----\n@PulsarListener\npublic void listen(String message) {\n System.out.println(\"Message Received: \" + message);\n}\n----\n\nIn this most basic form, when the `subscriptionName` is not provided on the `@PulsarListener` annotation an auto-generated subscription name will be used.\nLikewise, when the `topics` are not directly provided, a xref:reference/topic-resolution.adoc#topic-resolution-process[topic resolution process] is used to determine the destination topic.\n\nIn the `PulsarListener` method shown earlier, we receive the data as `String`, but we do not specify any schema types.\nInternally, the framework relies on Pulsar's schema mechanism to convert the data to the required type.\nThe framework detects that you expect the `String` type and then infers the schema type based on that information and provides that schema to the consumer.\nThe framework does this inference for all primitive types.\nFor all non-primitive types the default schema is assumed to be JSON.\nIf a complex type is using anything besides JSON (such as AVRO or KEY_VALUE) you must provide the schema type on the annotation using the `schemaType` property.\n\nThe following example shows another `PulsarListener` method, which takes an `Integer`:\n\n[source, java]\n----\n@PulsarListener(subscriptionName = \"my-subscription-1\", topics = \"my-topic-1\")\npublic void listen(Integer message) {\n System.out.println(message);\n}\n----\n\nThe following `PulsarListener` method shows how we can consume complex types from a topic:\n\n[source, java]\n----\n@PulsarListener(subscriptionName = \"my-subscription-2\", topics = \"my-topic-2\", schemaType = SchemaType.JSON)\npublic void listen(Foo message) {\n System.out.println(message);\n}\n----\n\nLet us look at a few more ways.\n\nYou can consume the Pulsar message directly:\n\n[source, java]\n----\n@PulsarListener(subscriptionName = \"my-subscription\", topics = \"my-topic\")\npublic void listen(org.apache.pulsar.client.api.Message<String> message) {\n System.out.println(message.getValue());\n}\n----\n\nThe following example consumes the record by using the Spring messaging envelope:\n\n[source, java]\n----\n@PulsarListener(subscriptionName = \"my-subscription\", topics = \"my-topic\")\npublic void listen(org.springframework.messaging.Message<String> message) {\n System.out.println(message.getPayload());\n}\n----\n\nNow let us see how we can consume records in batches.\nThe following example uses `PulsarListener` to consume records in batches as POJOs:\n\n[source, java]\n----\n@PulsarListener(subscriptionName = \"hello-batch-subscription\", topics = \"hello-batch\", schemaType = SchemaType.JSON, batch = true)\npublic void listen(List<Foo> messages) {\n System.out.println(\"records received :\" + messages.size());\n messages.forEach((message) -> System.out.println(\"record : \" + message));\n}\n----\n\nNote that, in this example, we receive the records as a collection (`List`) of objects.\nIn addition, to enable batch consumption at the `PulsarListener` level, you need to set the `batch` property on the annotation to `true`.\n\nBased on the actual type that the `List` holds, the framework tries to infer the schema to use.\nIf the `List` contains a complex type besides JSON, you still need to provide the `schemaType` on `PulsarListener`.\n\nThe following uses the `Message` envelope provided by the Pulsar Java client:\n\n[source, java]\n----\n@PulsarListener(subscriptionName = \"hello-batch-subscription\", topics = \"hello-batch\", schemaType = SchemaType.JSON, batch = true)\npublic void listen(List<Message<Foo>> messages) {\n System.out.println(\"records received :\" + messages.size());\n messages.forEach((message) -> System.out.println(\"record : \" + message.getValue()));\n}\n----\n\nThe following example consumes batch records with an envelope of the Spring messaging `Message` type:\n\n[source, java]\n----\n@PulsarListener(subscriptionName = \"hello-batch-subscription\", topics = \"hello-batch\", schemaType = SchemaType.JSON, batch = true)\npublic void listen(List<org.springframework.messaging.Message<Foo>> messages) {\n System.out.println(\"records received :\" + messages.size());\n messages.forEach((message) -> System.out.println(\"record : \" + message.getPayload()));\n}\n----\n\nFinally, you can also use the `Messages` holder object from Pulsar for the batch listener:\n\n[source, java]\n----\n@PulsarListener(subscriptionName = \"hello-batch-subscription\", topics = \"hello-batch\", schemaType = SchemaType.JSON, batch = true)\npublic void listen(org.apache.pulsar.client.api.Messages<Foo>> messages) {\n System.out.println(\"records received :\" + messages.size());\n messages.forEach((message) -> System.out.println(\"record : \" + message.getValue()));\n}\n----\n\nWhen you use `PulsarListener`, you can provide Pulsar consumer properties directly on the annotation itself.\nThis is convenient if you do not want to use the Boot configuration properties mentioned earlier or have multiple `PulsarListener` methods.\n\nThe following example uses Pulsar consumer properties directly on `PulsarListener`:\n\n[source, java]\n----\n@PulsarListener(properties = { \"subscriptionName=subscription-1\", \"topicNames=foo-1\", \"receiverQueueSize=5000\" })\nvoid listen(String message) {\n}\n----\n\nTIP: The properties used are direct Pulsar consumer properties, not the `spring.pulsar.consumer` application configuration properties\n\n[[listener-auto-consume]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc", "title": "message-consumption", "heading": "Pulsar Listener", "heading_level": 2, "file_order": 12, "section_index": 1, "content_hash": "bcaee0ef329748d0180e95b721a33098dc9edde4a16b87f0c09b35b9ae017c12", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc"}}
{"id": "sha256:95c0dcb570b31d63ac626cbad35e5efb5246bd99fc60dfdf789ffcb5d6f4eb7c", "content": "If there is no chance to know the type of schema of a Pulsar topic in advance, you can use the `AUTO_CONSUME` schema type to consume generic records.\nIn this case, the topic deserializes messages into `GenericRecord` objects using the schema info associated with the topic.\n\nTo consume generic records set the `schemaType = SchemaType.AUTO_CONSUME` on your `@PulsarListener` and use a Pulsar message of type `GenericRecord` as the message parameter as shown below.\n\n[source, java]\n----\n@PulsarListener(topics = \"my-generic-topic\", schemaType = SchemaType.AUTO_CONSUME)\nvoid listen(org.apache.pulsar.client.api.Message<GenericRecord> message) {\n GenericRecord record = message.getValue();\n record.getFields().forEach((f) ->\n System.out.printf(\"%s = %s%n\", f.getName(), record.getField(f)));\n}\n----\n\nTIP: The `GenericRecord` API allows access to the fields and their associated values", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc", "title": "message-consumption", "heading": "Generic records with AUTO_CONSUME", "heading_level": 3, "file_order": 12, "section_index": 2, "content_hash": "95c0dcb570b31d63ac626cbad35e5efb5246bd99fc60dfdf789ffcb5d6f4eb7c", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc"}}
{"id": "sha256:528b78fcdc0dc47f7c6d3d1305abb3a5beb07f084f1c3ee3d3f402f0f96cc790", "content": "You can customize any fields available through `ConsumerBuilder` using a `PulsarListenerConsumerBuilderCustomizer` by providing a `@Bean` of type `PulsarListenerConsumerBuilderCustomizer` and then making it available to the `PulsarListener` as shown below.\n\n[source, java]\n----\n@PulsarListener(topics = \"hello-topic\", consumerCustomizer = \"myCustomizer\")\npublic void listen(String message) {\n System.out.println(\"Message Received: \" + message);\n}\n\n@Bean\nPulsarListenerConsumerBuilderCustomizer<String> myCustomizer() {\n return (builder) -> builder.consumerName(\"myConsumer\");\n}\n----\n\nTIP: If your application only has a single `@PulsarListener` and a single `PulsarListenerConsumerBuilderCustomizer` bean registered then the customizer will be automatically applied.\n\n[[schema-info-listener-imperative]]\n== Specifying Schema Information\nAs indicated earlier, for Java primitives, the Spring for Apache Pulsar framework can infer the proper Schema to use on the `{listener-class}`.\nFor non-primitive types, if the Schema is not explicitly specified on the annotation, the Spring for Apache Pulsar framework will try to build a `Schema.JSON` from the type.\n\nIMPORTANT: Complex Schema types that are currently supported are JSON, AVRO, PROTOBUF, AUTO_CONSUME, KEY_VALUE w/ INLINE encoding.\n\n=== Custom Schema Mapping\nAs an alternative to specifying the schema on the `{listener-class}` for complex types, the schema resolver can be configured with mappings for the types.\nThis removes the need to set the schema on the listener as the framework consults the resolver using the incoming message type.\n\ninclude::custom-schema-mapping.adoc[]\n\n[[listener-default-schema-annotation]]\ninclude::custom-schema-mapping-annotation.adoc[leveloffset=+2]\n\nWith this configuration in place, there is no need to set the schema on the listener, for example:\n\ninclude::{listener-class}/listener-snippet.adoc[]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc", "title": "message-consumption", "heading": "Customizing the ConsumerBuilder", "heading_level": 3, "file_order": 12, "section_index": 3, "content_hash": "528b78fcdc0dc47f7c6d3d1305abb3a5beb07f084f1c3ee3d3f402f0f96cc790", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc"}}
{"id": "sha256:e8468dc1c45f3c934991e4804b49f1150033f6135689781084d651cb226b77fa", "content": "Sometimes, you need direct access to the Pulsar Consumer object.\nThe following example shows how to get it:\n\n[source, java]\n----\n@PulsarListener(subscriptionName = \"hello-pulsar-subscription\", topics = \"hello-pulsar\")\npublic void listen(String message, org.apache.pulsar.client.api.Consumer<String> consumer) {\n System.out.println(\"Message Received: \" + message);\n ConsumerStats stats = consumer.getStats();\n ...\n}\n----\n\nCAUTION: When accessing the `Consumer` object this way, do NOT invoke any operations that would change the Consumer's cursor position by invoking any receive methods.\nAll such operations must be done by the container.\n\n[[pulsar-message-listener-container]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc", "title": "message-consumption", "heading": "Accessing the Pulsar Consumer Object", "heading_level": 2, "file_order": 12, "section_index": 4, "content_hash": "e8468dc1c45f3c934991e4804b49f1150033f6135689781084d651cb226b77fa", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc"}}
{"id": "sha256:d8c72353e0fd9e5255f0b923a98b567a9d3686a7ecb716114f1cff1ef3ddf151", "content": "Now that we saw the basic interactions on the consumer side through `PulsarListener`. Let us now dive into the inner workings of how `PulsarListener` interacts with the underlying Pulsar consumer.\nKeep in mind that, for end-user applications, in most scenarios, we recommend using the `PulsarListener` annotation directly for consuming from a Pulsar topic when using Spring for Apache Pulsar, as that model covers a broad set of application use cases.\nHowever, it is important to understand how `PulsarListener` works internally. This section goes through those details.\n\nAs briefly mentioned earlier, the message listener container is at the heart of message consumption when you use Spring for Apache Pulsar.\n`PulsarListener` uses the message listener container infrastructure behind the scenes to create and manage the Pulsar consumer.\nSpring for Apache Pulsar provides the contract for this message listener container through `PulsarMessageListenerContainer`.\nThe default implementation for this message listener container is provided through `DefaultPulsarMessageListenerContainer`.\nAs its name indicates, `PulsarMessageListenerContainer` contains the message listener.\nThe container creates the Pulsar consumer and then runs a separate thread to receive and handle the data.\nThe data is handled by the provided message listener implementation.\n\nThe message listener container consumes the data in batch by using the consumer's `batchReceive` method.\nOnce data is received, it is handed over to the selected message listener implementation.\n\nThe following message listener types are available when you use Spring for Apache Pulsar.\n\n* link:{github}/blob/8e33ac0b122bc0e75df299919c956cacabcc9809/spring-pulsar/src/main/java/org/springframework/pulsar/listener/PulsarRecordMessageListener.java#L29[PulsarRecordMessageListener]\n\n* link:{github}/blob/ade2c74482d8ac1407ffe4840fa058475c07bcfc/spring-pulsar/src/main/java/org/springframework/pulsar/listener/PulsarAcknowledgingMessageListener.java#L28[PulsarAcknowledgingMessageListener]\n\n* link:{github}/blob/ade2c74482d8ac1407ffe4840fa058475c07bcfc/spring-pulsar/src/main/java/org/springframework/pulsar/listener/PulsarBatchMessageListener.java#L36[PulsarBatchMessageListener]\n\n* link:{github}/blob/ade2c74482d8ac1407ffe4840fa058475c07bcfc/spring-pulsar/src/main/java/org/springframework/pulsar/listener/PulsarBatchAcknowledgingMessageListener.java#L28[PulsarBatchAcknowledgingMessageListener]\n\nWe see the details about these various message listeners in the following sections.\n\nBefore doing so, however, let us take a closer look at the container itself.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc", "title": "message-consumption", "heading": "Pulsar Message Listener Container", "heading_level": 2, "file_order": 12, "section_index": 5, "content_hash": "d8c72353e0fd9e5255f0b923a98b567a9d3686a7ecb716114f1cff1ef3ddf151", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc"}}
{"id": "sha256:0f1821a9bdaedd845ce9da27439fe941737dcfafd91d67a637ce3304c8616374", "content": "This is a single consumer-based message listener container.\nThe following listing shows its constructor:\n\n[source, java]\n----\npublic DefaultPulsarMessageListenerContainer(PulsarConsumerFactory<? super T> pulsarConsumerFactory,\n PulsarContainerProperties pulsarContainerProperties)\n}\n----\n\nIt receives a `PulsarConsumerFactory` (which it uses to create the consumer) and a `PulsarContainerProperties` object (which contains information about the container properties).\n`PulsarContainerProperties` has the following constructors:\n\n[source, java]\n----\npublic PulsarContainerProperties(String... topics)\n\npublic PulsarContainerProperties(Pattern topicPattern)\n----\n\nYou can provide the topic information through `PulsarContainerProperties` or as a consumer property that is provided to the consumer factory.\nThe following example uses the `DefaultPulsarMessageListenerContainer`:\n\n[source, java]\n----\nMap<String, Object> config = new HashMap<>();\nconfig.put(\"topics\", \"my-topic\");\nPulsarConsumerFactory<String> pulsarConsumerFactorY = DefaultPulsarConsumerFactory<>(pulsarClient, config);\n\nPulsarContainerProperties pulsarContainerProperties = new PulsarContainerProperties();\n\npulsarContainerProperties.setMessageListener((PulsarRecordMessageListener<?>) (consumer, msg) -> {\n });\n\nDefaultPulsarMessageListenerContainer<String> pulsarListenerContainer = new DefaultPulsarMessageListenerContainer(pulsarConsumerFacotyr,\n pulsarContainerProperties);\n\nreturn pulsarListenerContainer;\n----\n\nNOTE: If topic information is not specified when using the listener containers directly, the same\nxref:reference/topic-resolution.adoc#topic-resolution-process[topic resolution process] used by the `PulsarListener` is used with the one exception that the \"Message type default\" step is **omitted**.\n\n`DefaultPulsarMessageListenerContainer` creates only a single consumer.\nIf you want to have multiple consumers managed through multiple threads, you need to use `ConcurrentPulsarMessageListenerContainer`.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc", "title": "message-consumption", "heading": "DefaultPulsarMessageListenerContainer", "heading_level": 3, "file_order": 12, "section_index": 6, "content_hash": "0f1821a9bdaedd845ce9da27439fe941737dcfafd91d67a637ce3304c8616374", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc"}}
{"id": "sha256:ab61aa240ecb2926182be9c226d108541717e0dbcb1de6cd1c3b236cf2f4027b", "content": "`ConcurrentPulsarMessageListenerContainer` has the following constructor:\n\n[source, java]\n----\npublic ConcurrentPulsarMessageListenerContainer(PulsarConsumerFactory<? super T> pulsarConsumerFactory,\n PulsarContainerProperties pulsarContainerProperties)\n----\n\n`ConcurrentPulsarMessageListenerContainer` lets you specify a `concurrency` property through a setter.\nConcurrency of more than `1` is allowed only on non-exclusive subscriptions (`failover`, `shared`, and `key-shared`).\nYou can only have the default `1` for concurrency when you have an exclusive subscription mode.\n\nThe following example enables `concurrency` through the `PulsarListener` annotation for a `failover` subscription.\n\n[source, java]\n----\n@PulsarListener(topics = \"my-topic\", subscriptionName = \"subscription-1\",\n subscriptionType = SubscriptionType.Failover, concurrency = \"3\")\nvoid listen(String message, Consumer<String> consumer) {\n ...\n System.out.println(\"Current Thread: \" + Thread.currentThread().getName());\n System.out.println(\"Current Consumer: \" + consumer.getConsumerName());\n}\n----\n\nIn the preceding listener, it is assumed that the topic `my-topic` has three partitions.\nIf it is a non-partitioned topic, having concurrency set to `3` does nothing. You get two idle consumers in addition to the main active one.\nIf the topic has more than three partitions, messages are load-balanced across the consumers that the container creates.\nIf you run this `PulsarListener`, you see that messages from different partitions are consumed through different consumers, as implied by the thread name and consumer names printouts in the preceding example.\n\nNOTE: When you use the `Failover` subscription this way on partitioned topics, Pulsar guarantees message ordering.\n\nThe following listing shows another example of `PulsarListener`, but with `Shared` subscription and `concurrency` enabled.\n\n[source, java]\n----\n@PulsarListener(topics = \"my-topic\", subscriptionName = \"subscription-1\",\n subscriptionType = SubscriptionType.Shared, concurrency = \"5\")\nvoid listen(String message) {\n ...\n}\n----\n\nIn the preceding example, the `PulsarListener` creates five different consumers (this time, we assume that the topic has five partitions).\n\nNOTE: In this version, there is no message ordering, as `Shared` subscriptions do not guarantee any message ordering in Pulsar.\n\nIf you need message ordering and still want a shared subscription types, you need to use the `Key_Shared` subscription type.\n\n[[consuming-records]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc", "title": "message-consumption", "heading": "ConcurrentPulsarMessageListenerContainer", "heading_level": 3, "file_order": 12, "section_index": 7, "content_hash": "ab61aa240ecb2926182be9c226d108541717e0dbcb1de6cd1c3b236cf2f4027b", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc"}}
{"id": "sha256:d501defa19c82f08149bb9e889886d98f973bcf42f0d3b605589a2490b6fb05d", "content": "Let us take a look at how the message listener container enables both single-record and batch-based message consumption.\n\n[discrete]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc", "title": "message-consumption", "heading": "Consuming Records", "heading_level": 3, "file_order": 12, "section_index": 8, "content_hash": "d501defa19c82f08149bb9e889886d98f973bcf42f0d3b605589a2490b6fb05d", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc"}}
{"id": "sha256:ed07153ffa44d25aa4f58c19f45c7a40e5e0b43664b8b8a3eb37edf8ea738b68", "content": "Let us revisit our basic `PulsarListener` for the sake of this discussion:\n\n[source, java]\n----\n@PulsarListener(subscriptionName = \"hello-pulsar-subscription\", topics = \"hello-pulsar\")\npublic void listen(String message) {\n System.out.println(\"Message Received: \" + message);\n}\n----\n\nWith this `PulsarListener` method, we essential ask Spring for Apache Pulsar to invoke the listener method with a single record each time.\nWe mentioned that the message listener container consumes the data in batches using the `batchReceive` method on the consumer.\nThe framework detects that the `PulsarListener`, in this case, receives a single record. This means that, on each invocation of the method, it needs a singe record.\nAlthough the records are consumed by the message listener container in batches, it iterates through the received batch and invokes the listener method through an adapter for `PulsarRecordMessageListener`.\nAs you can see in the previous section, `PulsarRecordMessageListener` extends from the `MessageListener` provided by the Pulsar Java client, and it supports the basic `received` method.\n\n[discrete]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc", "title": "message-consumption", "heading": "Single Record Consumption", "heading_level": 3, "file_order": 12, "section_index": 9, "content_hash": "ed07153ffa44d25aa4f58c19f45c7a40e5e0b43664b8b8a3eb37edf8ea738b68", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc"}}
{"id": "sha256:1bbcee91298015c94a065eeb646c8f0587515ea63ba5955d41ec36ec6c0096c7", "content": "The following example shows the `PulsarListener` consuming records in batches:\n\n[source, java]\n----\n@PulsarListener(subscriptionName = \"hello-batch-subscription\", topics = \"hello-batch\", schemaType = SchemaType.JSON, batch = true)\npublic void listen4(List<Foo> messages) {\n System.out.println(\"records received :\" + messages.size());\n messages.forEach((message) -> System.out.println(\"record : \" + message));\n}\n----\n\nWhen you use this type of `PulsarListener`, the framework detects that you are in batch mode.\nSince it already received the data in batches by using the Consumer's `batchReceive` method, it hands off the entire batch to the listener method through an adapter for `PulsarBatchMessageListener`.\n\ninclude::../attributes/attributes-variables.adoc[]\n\n[[pulsar-headers]]\n== Pulsar Headers\nPulsar does not have a first-class \"`header`\" concept but instead provides a map for custom user properties as well as methods to access the message metadata typically stored in a message header (eg. `id` and `event-time`).\nAs such, the terms \"`Pulsar message header`\" and \"`Pulsar message metadata`\" are used interchangeably.\nThe list of available message metadata (headers) can be found in {github}/blob/main/spring-pulsar/src/main/java/org/springframework/pulsar/support/PulsarHeaders.java[PulsarHeaders.java].\n\n=== Spring Headers\nSpring Messaging provides first-class \"`header`\" support via its `MessageHeaders` abstraction.\n\nThe Pulsar message metadata can be consumed as Spring message headers.\nThe list of available headers can be found in {github}/blob/main/spring-pulsar/src/main/java/org/springframework/pulsar/support/PulsarHeaders.java[PulsarHeaders.java].\n\n=== Accessing in Single Record based Consumer\n\nThe following example shows how you can access the various Pulsar Headers in an application that uses the single record mode of consuming:\n\n[source,java]\n----\n@PulsarListener(topics = \"simpleListenerWithHeaders\")\nvoid simpleListenerWithHeaders(String data, @Header(PulsarHeaders.MESSAGE_ID) MessageId messageId,\n                @Header(PulsarHeaders.RAW_DATA) byte[] rawData,\n                @Header(\"foo\") String foo) {\n\n}\n----\n\nIn the preceding example, we access the values for the `messageId` and `rawData` message metadata as well as a custom message property named `foo`.\nThe Spring `@Header` annotation is used for each header field.\n\nYou can also use Pulsar's `Message` as the envelope to carry the payload.\nWhen doing so, the user can directly call the corresponding methods on the Pulsar message for retrieving the metadata.\nHowever, as a convenience, you can also retrieve it by using the `Header` annotation.\nNote that you can also use the Spring messaging `Message` envelope to carry the payload and then retrieve the Pulsar headers by using `@Header`.\n\n=== Accessing in Batch Record based Consumer\n\nIn this section, we see how to access the various Pulsar Headers in an application that uses a batch consumer:\n\n[source,java]\n----\n@PulsarListener(topics = \"simpleBatchListenerWithHeaders\", batch = true)\nvoid simpleBatchListenerWithHeaders(List<String> data,\n\t\t\t\t\t@Header(PulsarHeaders.MESSAGE_ID) List<MessageId> messageIds,\n\t\t\t\t\t@Header(PulsarHeaders.TOPIC_NAME) List<String> topicNames, @Header(\"foo\") List<String> fooValues) {\n\n}\n----\n\nIn the preceding example, we consume the data as a `List<String>`.\nWhen extracting the various headers, we do so as a `List<>` as well.\nSpring for Apache Pulsar ensures that the headers list corresponds to the data list.\n\nYou can also extract headers in the same manner when you use the batch listener and receive payloads as `List<org.apache.pulsar.client.api.Message<?>`, `org.apache.pulsar.client.api.Messages<?>`, or `org.springframework.messaging.Messsge<?>`.\n\n=== Message Header Mapping\nThe `PulsarHeaderMapper` strategy is provided to map headers to and from Pulsar user properties and Spring `MessageHeaders`.\n\nIts interface definition is as follows:\n[source, java]\n----\npublic interface PulsarHeaderMapper {\n\n\tMap<String, String> toPulsarHeaders(MessageHeaders springHeaders);\n\n\tMessageHeaders toSpringHeaders(Message<?> pulsarMessage);\n}\n----\n\nThe framework provides a couple of mapper implementations.\n\n- The `JsonPulsarHeaderMapper` maps headers as JSON in order to support rich header types and is the default when the Jackson JSON library is on the classpath.\n\n- The `ToStringPulsarHeaderMapper` maps headers as strings using the `toString()` method on the header values and is the fallback mapper.\n\n==== JSON Header Mapper\nThe `JsonPulsarHeaderMapper` uses a \"`special`\" header (with a key of `spring_json_header_types`) that contains a JSON map of `<key>:<type>`.\nThis header is used on the inbound side (Pulsar -> Spring) to provide appropriate conversion of each header value to the original type.\n\n===== Trusted Packages\nBy default, the JSON mapper deserializes classes in all packages.\nHowever, if you receive messages from untrusted sources, you may wish to add only those packages you trust via the `trustedPackages` property on a custom configured `JsonPulsarHeaderMapper` bean you provide.\n\n===== ToString Classes\nCertain types are not suitable for JSON serialization, and a simple `toString()` serialization might be preferred for these types.\nThe `JsonPulsarHeaderMapper` has a property called `addToStringClasses()` that lets you supply the names of classes that should be treated this way for outbound mapping.\nDuring inbound mapping, they are mapped as `String`.\nBy default, only `org.springframework.util.MimeType` and `org.springframework.http.MediaType` are mapped this way.\n\n===== Custom ObjectMapper\nThe JSON mapper uses a reasonable configured Jackson 2 `ObjectMapper` to handle serialization of header values.\nHowever, to provide a custom object mapper one must simply provide an `ObjectMapper` bean with the name `pulsarHeaderObjectMapper`.\nFor example:\n[source, java]\n----\n@Configuration(proxyBeanMethods = false)\nstatic class PulsarHeadersCustomObjectMapperTestConfig {\n\n    @Bean(name = \"pulsarHeaderObjectMapper\")\n    ObjectMapper customObjectMapper() {\n        var objectMapper = new ObjectMapper();\n\t\t// do things with your special header object mapper here\n        return objectMapper;\n    }\n}\n----\n\nIMPORTANT: The object mapper in the example above should be an instance of `com.fasterxml.jackson.databind.ObjectMapper`, **not** the shaded `org.apache.pulsar.shade.com.fasterxml.jackson.databind.ObjectMapper`.\n\nIMPORTANT: The xref:reference/custom-object-mapper.adoc#jackson2vs3[same limitations] regarding Jackson 2 vs. Jackson 3 apply here }\n\n=== Inbound/Outbound Patterns\nOn  the inbound side, by default, all Pulsar headers (message metadata plus user properties) are mapped to `MessageHeaders`.\nOn the outbound side, by default, all `MessageHeaders` are mapped, except `id`, `timestamp`, and the headers that represent the Pulsar message metadata (i.e. the headers that are prefixed with `pulsar_message_`).\nYou can specify which headers are mapped for inbound and outbound messages by configuring the `inboundPatterns` and `outboundPatterns` on a mapper bean you provide.\nYou can include Pulsar message metadata headers on the outbound messages by adding the exact header name to the `outboundPatterns` as patterns are not supported for metadata headers.\nPatterns are rather simple and can contain a leading wildcard (`\\*`), a trailing wildcard, or both (for example, `*.cat.*`).\nYou can negate patterns with a leading `!`.\nThe first pattern that matches   a header name (whether positive or negative) wins.\n\nIMPORTANT: When you provide your own patterns, we recommend including `!id` and `!timestamp`, since these headers are read-only on the inbound side.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc", "title": "message-consumption", "heading": "Batch Consumption", "heading_level": 3, "file_order": 12, "section_index": 10, "content_hash": "1bbcee91298015c94a065eeb646c8f0587515ea63ba5955d41ec36ec6c0096c7", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc"}}
{"id": "sha256:1973ccbc2e18d52098fb1e2f535c70c33cd0ae5d19b7bea2f0486c857c28a14a", "content": "When you use Spring for Apache Pulsar, the message acknowledgment is handled by the framework, unless opted out by the application.\nIn this section, we go through the details of how the framework takes care of message acknowledgment.\n\n[[message-ack-modes]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc", "title": "message-consumption", "heading": "Message Acknowledgment", "heading_level": 2, "file_order": 12, "section_index": 11, "content_hash": "1973ccbc2e18d52098fb1e2f535c70c33cd0ae5d19b7bea2f0486c857c28a14a", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc"}}
{"id": "sha256:08e3fde2a9d3e943724f31ca82b589302183b1bc8ca87ee36892cdb100558e80", "content": "Spring for Apache Pulsar provides the following modes for acknowledging messages:\n\n* `BATCH`\n* `RECORD`\n* `MANUAL`\n\n`BATCH` acknowledgment mode is the default, but you can change it on the message listener container.\nIn the following sections, we see how acknowledgment works when you use both single and batch versions of `PulsarListener` and how they translate to the backing message listener container (and, ultimately, to the Pulsar consumer).", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc", "title": "message-consumption", "heading": "Message ACK modes", "heading_level": 3, "file_order": 12, "section_index": 12, "content_hash": "08e3fde2a9d3e943724f31ca82b589302183b1bc8ca87ee36892cdb100558e80", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc"}}
{"id": "sha256:07a8b6cb4a441bd9048f9550a3bbb5de7acbca81068f7a07a5bab196b4fc087f", "content": "Let us revisit our basic single message based `PulsarListener`:\n\n[source, java]\n----\n@PulsarListener(subscriptionName = \"hello-pulsar-subscription\", topics = \"hello-pulsar\")\npublic void listen(String message) {\n System.out.println(\"Message Received: \" + message);\n}\n----\n\nIt is natural to wonder, how acknowledgment works when you use `PulsarListener`, especially if you are familiar with using Pulsar consumer directly.\nThe answer comes down to the message listener container, as that is the central place in Spring for Apache Pulsar that coordinates all the consumer related activities.\n\nAssuming you are not overriding the default behavior, this is what happens behind the scenes when you use the preceding `PulsarListener`:\n\n. First, the listener container receives messages as batches from the Pulsar consumer.\n. The received messages are handed down to `PulsarListener` one message at a time.\n. When all the records are handed down to the listener method and successfully processed, the container acknowledges all the messages from the original batch.\n\nThis is the normal flow. If any records from the original batch throw an exception, Spring for Apache Pulsar track those records separately.\nWhen all the records from the batch are processed, Spring for Apache Pulsar acknowledges all the successful messages and negatively acknowledges (nack) all the failed messages.\nIn other words, when consuming single records by using `PulsarRecordMessageListener` and the default ack mode of `BATCH` is used, the framework waits for all the records received from the `batchReceive` call to process successfully and then calls the `acknowledge` method on the Pulsar consumer.\nIf any particular record throws an exception when invoking the handler method, Spring for Apache Pulsar tracks those records and separately calls `negativeAcknowledge` on those records after the entire batch is processed.\n\nIf the application wants the acknowledgment or negative acknowledgment to occur per record, the `RECORD` ack mode can be enabled.\nIn that case, after handling each record, the message is acknowledged if no error and negatively acknowledged if there was an error.\nThe following example enables `RECORD` ack mode on the Pulsar listener:\n\n[source, java]\n----\n@PulsarListener(subscriptionName = \"hello-pulsar-subscription\", topics = \"hello-pulsar\", ackMode = AckMode.RECORD)\npublic void listen(String message) {\n System.out.println(\"Message Received: \" + message);\n}\n----", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc", "title": "message-consumption", "heading": "Automatic Message Ack in Single Record Mode", "heading_level": 3, "file_order": 12, "section_index": 13, "content_hash": "07a8b6cb4a441bd9048f9550a3bbb5de7acbca81068f7a07a5bab196b4fc087f", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc"}}
{"id": "sha256:12bf1b7cbcf6f79bedb952acd23af6bd9d9f26c81f192b2e9d341160e32fc422", "content": "You might not always want the framework to send acknowledgments but, rather, do that directly from the application itself.\nSpring for Apache Pulsar provides a couple of ways to enable manual message acknowledgments. The following example shows one of them:\n\n[source, java]\n----\n@PulsarListener(subscriptionName = \"hello-pulsar-subscription\", topics = \"hello-pulsar\", ackMode = AckMode.MANUAL)\npublic void listen(Message<String> message, Acknowledgment acknowledgment) {\n System.out.println(\"Message Received: \" + message.getValue());\n\tacknowledgment.acknowledge();\n}\n----\n\nA few things merit explanation here. First, we enablE manual ack mode by setting `ackMode` on `PulsarListener`.\nWhen enabling manual ack mode, Spring for Apache Pulsar lets the application inject an `Acknowledgment` object.\nThe framework achieves this by selecting a compatible message listener container: `PulsarAcknowledgingMessageListener` for single record based consumption, which gives you access to an `Acknowledgment` object.\n\nThe `Acknowledgment` object provides the following API methods:\n\n[source, java]\n----\nvoid acknowledge();\n\nvoid acknowledge(MessageId messageId);\n\nvoid acknowledge(List<MessageId> messageIds);\n\nvoid nack();\n\nvoid nack(MessageId messageId);\n----\n\nYou can inject this `Acknowledgment` object into your `PulsarListener` while using `MANUAL` ack mode and then call one of the corresponding methods.\n\nIn the preceding `PulsarListener` example, we call a parameter-less `acknowledge` method.\nThis is because the framework knows which `Message` it is currently operating under.\nWhen calling `acknowledge()`, you need not receive the payload with the `Message` enveloper` but, rather, use the target type -- `String`, in this example.\nYou can also call a different variant of `acknowledge` by providing the message ID: `acknowledge.acknowledge(message.getMessageId());`\nWhen you use `acknowledge(messageId)`, you must receive the payload by using the `Message<?>` envelope.\n\nSimilar to what is possible for acknowledging, the `Acknowledgment` API also provides options for negatively acknowledging.\nSee the nack methods shown earlier.\n\nYou can also call `acknowledge` directly on the Pulsar consumer:\n\n[source, java]\n----\n@PulsarListener(subscriptionName = \"hello-pulsar-subscription\", topics = \"hello-pulsar\", ackMode = AckMode.MANUAL)\npublic void listen(Message<String> message, Consumer<String> consumer) {\n System.out.println(\"Message Received: \" + message.getValue());\n\ttry {\n consumer.acknowledge(message);\n\t}\n\tcatch (Exception e) {\n ....\n\t}\n}\n----\n\nWhen calling `acknowledge` directly on the underlying consumer, you need to do error handling by yourself.\nUsing the `Acknowledgment` does not require that, as the framework can do that for you.\nTherefore, you should use the `Acknowledgment` object approach when using manual acknowledgment.\n\nIMPORTANT: When using manual acknowledgment, it is important to understand that the framework completely stays from any acknowledgment at all.\nHence, it is extremely important to think through the right acknowledgment strategies when designing applications.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc", "title": "message-consumption", "heading": "Manual Message Ack in Single Record Mode", "heading_level": 3, "file_order": 12, "section_index": 14, "content_hash": "12bf1b7cbcf6f79bedb952acd23af6bd9d9f26c81f192b2e9d341160e32fc422", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc"}}
{"id": "sha256:2e92ac60e32a4234e1f6d6f38b2e53ca33c187f9c0f823c76ab357ca9c796628", "content": "When you consume records in batches (see \"`<<message-ack-modes>>`\") and you use the default ack mode of `BATCH` is used, when the entire batch is processed successfully, the entire batch is acknowledged.\nIf any records throw an exception, the entire batch is negatively acknowledged.\nNote that this may not be the same batch that was batched on the producer side. Rather, this is the batch that returned from calling `batchReceive` on the consumer\n\nConsider the following batch listener:\n\n[source, java]\n----\n@PulsarListener(subscriptionName = \"hello-pulsar-subscription\", topics = \"hello-pulsar\", batch = true)\npublic void batchListen(List<Foo> messages) {\n for (Foo foo : messages) {\n ...\n }\n}\n----\n\nWhen all the messages in the incoming collection (`messages` in this example) are processed, the framework acknowledges all of them.\n\nWhen consuming in batch mode, `RECORD` is not an allowed ack mode.\nThis might cause an issue, as an application may not want the entire batch to be re-delivered again.\nIn such situations, you need to use the `MANUAL` acknowledgement mode.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc", "title": "message-consumption", "heading": "Automatic Message Ack in Batch Consumption", "heading_level": 3, "file_order": 12, "section_index": 15, "content_hash": "2e92ac60e32a4234e1f6d6f38b2e53ca33c187f9c0f823c76ab357ca9c796628", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc"}}
{"id": "sha256:2de0df74cde9ec95c632efdded407bc3a6c122dcbd0eaa59a6ac820ce85fdbc0", "content": "As seen in the previous section, when `MANUAL` ack mode is set on the message listener container, the framework does not do any acknowledgment, positive or negative.\nIt is entirely up to the application to take care of such concerns.\nWhen `MANUAL` ack mode is set, Spring for Apache Pulsar selects a compatible message listener container: `PulsarBatchAcknowledgingMessageListener` for batch consumption, which gives you access to an `Acknowledgment` object.\nThe following are the methods available in the `Acknowledgment` API:\n\n[source, java]\n----\nvoid acknowledge();\n\nvoid acknowledge(MessageId messageId);\n\nvoid acknowledge(List<MessageId> messageIds);\n\nvoid nack();\n\nvoid nack(MessageId messageId);\n----\n\nYou can inject this `Acknowledgment` object into your `PulsarListener` while using `MANUAL` ack mode.\nThe following listing shows a basic example for a batch based listener:\n\n[source, java]\n----\n@PulsarListener(subscriptionName = \"hello-pulsar-subscription\", topics = \"hello-pulsar\")\npublic void listen(List<Message<String>> messgaes, Acknowlegement acknowledgment) {\n for (Message<String> message : messages) {\n try {\n ...\n acknowledgment.acknowledge(message.getMessageId());\n }\n catch (Exception e) {\n acknowledgment.nack(message.getMessageId());\n }\n }\n}\n----\n\nWhen you use a batch listener, the message listener container cannot know which record it is currently operating upon.\nTherefore, to manually acknowledge, you need to use one of the overloaded `acknowledge` method that takes a `MessageId` or a `List<MessageId>`.\nYou can also negatively acknowledge with the `MessageId` for the batch listener.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc", "title": "message-consumption", "heading": "Manual Message Ack in Batch Consumption", "heading_level": 3, "file_order": 12, "section_index": 16, "content_hash": "2de0df74cde9ec95c632efdded407bc3a6c122dcbd0eaa59a6ac820ce85fdbc0", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc"}}
{"id": "sha256:db446dec02c44cb50c77195099d1a69fc2be3702c8b940288f7a83444207f4fd", "content": "Now that we have seen both `PulsarListener` and the message listener container infrastructure and its various functions, let us now try to understand message redelivery and error handling.\nApache Pulsar provides various native strategies for message redelivery and error handling. We take a look at them and see how we can use them through Spring for Apache Pulsar.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc", "title": "message-consumption", "heading": "Message Redelivery and Error Handling", "heading_level": 2, "file_order": 12, "section_index": 17, "content_hash": "db446dec02c44cb50c77195099d1a69fc2be3702c8b940288f7a83444207f4fd", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc"}}
{"id": "sha256:aa5d6727ba63a0e0dfe140117f17547543bbddeb4cf5d87b81b770add385cb44", "content": "By default, Pulsar consumers do not redeliver messages unless the consumer crashes, but you can change this behavior by setting an ack timeout on the Pulsar consumer.\nIf the ack timeout property has a value above zero and if the Pulsar consumer does not acknowledge a message within that timeout period, the message is redelivered.\n\nWhen you use Spring for Apache Pulsar, you can set this property via a <<_consumer_customization_on_pulsarlistener,consumer customizer>> or with the native Pulsar `ackTimeoutMillis` property in the `properties` attribute of `@PulsarListener`:\n\n[source, java]\n----\n@PulsarListener(subscriptionName = \"subscription-1\", topics = \"topic-1\"\n properties = {\"ackTimeoutMillis=60000\"})\npublic void listen(String s) {\n ...\n}\n----\n\nWhen you specify the ack timeout, if the consumer does not send an acknowledgement within 60 seconds, the message is redelivered by Pulsar to the consumer.\n\nIf you want to specify some advanced backoff options for ack timeout with different delays, you can do the following:\n\n[source, java]\n----\n@EnablePulsar\n@Configuration\nclass AckTimeoutRedeliveryConfig {\n\n @PulsarListener(subscriptionName = \"withAckTimeoutRedeliveryBackoffSubscription\",\n topics = \"withAckTimeoutRedeliveryBackoff-test-topic\",\n ackTimeoutRedeliveryBackoff = \"ackTimeoutRedeliveryBackoff\",\n properties = { \"ackTimeoutMillis=60000\" })\n void listen(String msg) {\n // some long-running process that may cause an ack timeout\n }\n\n @Bean\n RedeliveryBackoff ackTimeoutRedeliveryBackoff() {\n return MultiplierRedeliveryBackoff.builder().minDelayMs(1000).maxDelayMs(10 * 1000).multiplier(2)\n .build();\n }\n\n}\n----\n\nIn the preceding example, we specify a bean for Pulsar's `RedeliveryBackoff` with a minimum delay of 1 second, a maximum delay of 10 seconds, and a backoff multiplier of 2.\nAfter the initial ack timeout occurs, the message redeliveries are controlled through this backoff bean.\nWe provide the backoff bean to the `PulsarListener` annotation by setting the `ackTimeoutRedeliveryBackoff` property to the actual bean name -- `ackTimeoutRedeliveryBackoff`, in this case.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc", "title": "message-consumption", "heading": "Specifying Acknowledgment Timeout for Message Redelivery", "heading_level": 3, "file_order": 12, "section_index": 18, "content_hash": "aa5d6727ba63a0e0dfe140117f17547543bbddeb4cf5d87b81b770add385cb44", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc"}}
{"id": "sha256:72fedaf7fd14531513a476ecf861bb20fbc1472541ac5753305e353bdb854ce8", "content": "When acknowledging negatively, Pulsar consumer lets you specify how the application wants the message to be re-delivered.\nThe default is to redeliver the message in one minute, but you can change it via a <<_consumer_customization_on_pulsarlistener,consumer customizer>> or with the native Pulsar `negativeAckRedeliveryDelay` property in the `properties` attribute of `@PulsarListener`:\n\n[source, java]\n----\n@PulsarListener(subscriptionName = \"subscription-1\", topics = \"topic-1\"\n properties = {\"negativeAckRedeliveryDelay=10ms\"})\npublic void listen(String s) {\n ...\n}\n----\n\nYou can also specify different delays and backoff mechanisms with a multiplier by providing a `RedeliveryBackoff` bean and providing the bean name as the `negativeAckRedeliveryBackoff` property on the PulsarProducer, as follows:\n\n[source, java]\n----\n@EnablePulsar\n@Configuration\nclass NegativeAckRedeliveryConfig {\n\n @PulsarListener(subscriptionName = \"withNegRedeliveryBackoffSubscription\",\n topics = \"withNegRedeliveryBackoff-test-topic\", negativeAckRedeliveryBackoff = \"redeliveryBackoff\",\n subscriptionType = SubscriptionType.Shared)\n void listen(String msg) {\n throw new RuntimeException(\"fail \" + msg);\n }\n\n @Bean\n RedeliveryBackoff redeliveryBackoff() {\n return MultiplierRedeliveryBackoff.builder().minDelayMs(1000).maxDelayMs(10 * 1000).multiplier(2)\n .build();\n }\n\n}\n----", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc", "title": "message-consumption", "heading": "Specifying Negative Acknowledgment Redelivery", "heading_level": 3, "file_order": 12, "section_index": 19, "content_hash": "72fedaf7fd14531513a476ecf861bb20fbc1472541ac5753305e353bdb854ce8", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc"}}
{"id": "sha256:c84363d96d0e049956e142b561632f76954e60aa7d8658895a3c141900976751", "content": "Apache Pulsar lets applications use a dead letter topic on consumers with a `Shared` subscription type.\nFor the `Exclusive` and `Failover` subscription types, this feature is not available.\nThe basic idea is that, if a message is retried a certain number of times (maybe due to an ack timeout or nack redelivery), once the number of retries are exhausted, the message can be sent to a special topic called the dead letter queue (DLQ).\nLet us see some details around this feature in action by inspecting some code snippets:\n\n[source, java]\n----\n@EnablePulsar\n@Configuration\nclass DeadLetterPolicyConfig {\n\n @PulsarListener(id = \"deadLetterPolicyListener\", subscriptionName = \"deadLetterPolicySubscription\",\n topics = \"topic-with-dlp\", deadLetterPolicy = \"deadLetterPolicy\",\n subscriptionType = SubscriptionType.Shared, properties = { \"ackTimeoutMillis=1000\" })\n void listen(String msg) {\n throw new RuntimeException(\"fail \" + msg);\n }\n\n @PulsarListener(id = \"dlqListener\", topics = \"my-dlq-topic\")\n void listenDlq(String msg) {\n System.out.println(\"From DLQ: \" + msg);\n }\n\n @Bean\n DeadLetterPolicy deadLetterPolicy() {\n return DeadLetterPolicy.builder().maxRedeliverCount(10).deadLetterTopic(\"my-dlq-topic\").build();\n }\n\n}\n----\n\nFirst, we have a special bean for `DeadLetterPolicy`, and it is named as `deadLetterPolicy` (it can be any name as you wish).\nThis bean specifies a number of things, such as the max delivery (10, in this case) and the name of the dead letter topic -- `my-dlq-topic`, in this case.\nIf you do not specify a DLQ topic name, it defaults to `<topicname>-<subscriptionname>-DLQ` in Pulsar.\nNext, we provide this bean name to `PulsarListener` by setting the `deadLetterPolicy` property.\nNote that the `PulsarListener` has a subscription type of `Shared`, as the DLQ feature only works with shared subscriptions.\nThis code is primarily for demonstration purposes, so we provide an `ackTimeoutMillis` value of 1000.\nThe idea is that the code throws the exception and, if Pulsar does not receive an ack within 1 second, it does a retry.\nIf that cycle continues ten times (as that is our max redelivery count in the `DeadLetterPolicy`), the Pulsar consumer publishes the messages to the DLQ topic.\nWe have another `PulsarListener` that listens on the DLQ topic to receive data as it is published to the DLQ topic.\n\n.Special note on DLQ topics when using partitioned topics\n****\nIf the main topic is partitioned, behind the scenes, each partition is treated as a separate topic by Pulsar.\nPulsar appends `partition-<n>`, where `n` stands for the partition number to the main topic name.\nThe problem is that, if you do not specify a DLQ topic (as opposed to what we did above), Pulsar publishes to a default topic name that has this ``partition-<n>` info in it -- for example: `topic-with-dlp-partition-0-deadLetterPolicySubscription-DLQ`.\nThe easy way to solve this is to provide a DLQ topic name always.\n****", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc", "title": "message-consumption", "heading": "Using Dead Letter Topic from Apache Pulsar for Message Redelivery and Error Handling", "heading_level": 3, "file_order": 12, "section_index": 20, "content_hash": "c84363d96d0e049956e142b561632f76954e60aa7d8658895a3c141900976751", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc"}}
{"id": "sha256:b0cdf7e562e0097c41f5794a6bd7c7ed5990888f6f3dd8b458d532b7a9587826", "content": "As we noted earlier, the DLQ feature in Apache Pulsar works only for shared subscriptions.\nWhat does an application do if it needs to use some similar feature for non-shared subscriptions?\nThe main reason Pulsar does not support DLQ on exclusive and failover subscriptions is because those subscription types are order-guaranteed.\nAllowing redeliveries, DLQ, and so on effectively receives messages out of order.\nHowever, what if an application are okay with that but, more importantly, needs this DLQ feature for non-shared subscriptions?\nFor that, Spring for Apache Pulsar provides a `PulsarConsumerErrorHandler`, which you can use across any subscription types in Pulsar: `Exclusive`, `Failover`, `Shared`, or `Key_Shared`.\n\nWhen you use `PulsarConsumerErrorHandler` from Spring for Apache Pulsar, make sure not to set the ack timeout properties on the listener.\n\nLet us see some details by examining a few code snippets:\n\n[source, java]\n----\n@EnablePulsar\n@Configuration\nclass PulsarConsumerErrorHandlerConfig {\n\n @Bean\n PulsarConsumerErrorHandler<String> pulsarConsumerErrorHandler(\n PulsarTemplate<String> pulsarTemplate) {\n return new DefaultPulsarConsumerErrorHandler<>(\n new PulsarDeadLetterPublishingRecoverer<>(pulsarTemplate, (c, m) -> \"my-foo-dlt\"), new FixedBackOff(100, 10));\n }\n\n @PulsarListener(id = \"pulsarConsumerErrorHandler-id\", subscriptionName = \"pulsatConsumerErrorHandler-subscription\",\n topics = \"pulsarConsumerErrorHandler-topic\",\n pulsarConsumerErrorHandler = \"pulsarConsumerErrorHandler\")\n void listen(String msg) {\n throw new RuntimeException(\"fail \" + msg);\n }\n\n @PulsarListener(id = \"pceh-dltListener\", topics = \"my-foo-dlt\")\n void listenDlt(String msg) {\n System.out.println(\"From DLT: \" + msg);\n }\n\n}\n----\n\nConsider the `pulsarConsumerErrorHandler` bean.\nThis creates a bean of type `PulsarConsumerErrorHandler` and uses the default implementation provided out of the box by Spring for Apache Pulsar: `DefaultPulsarConsumerErrorHandler`.\n`DefaultPulsarConsumerErrorHandler` has a constructor that takes a `PulsarMessageRecovererFactory` and a `org.springframework.util.backoff.Backoff`.\n`PulsarMessageRecovererFactory` is a functional interface with the following API:\n\n[source, java]\n----\n@FunctionalInterface\npublic interface PulsarMessageRecovererFactory<T> {\n\n\t/**\n * Provides a message recoverer {@link PulsarMessageRecoverer}.\n * @param consumer Pulsar consumer\n * @return {@link PulsarMessageRecoverer}.\n */\n\tPulsarMessageRecoverer<T> recovererForConsumer(Consumer<T> consumer);\n\n}\n\n----\n\nThe `recovererForConsumer` method takes a Pulsar consumer and returns a `PulsarMessageRecoverer`, which is another functional interface.\nHere is the API of `PulsarMessageRecoverer`:\n\n[source, java]\n----\npublic interface PulsarMessageRecoverer<T> {\n\n\t/**\n * Recover a failed message, for e.g. send the message to a DLT.\n * @param message Pulsar message\n * @param exception exception from failed message\n */\n\tvoid recoverMessage(Message<T> message, Exception exception);\n\n}\n----\n\nSpring for Apache Pulsar provides an implementation for `PulsarMessageRecovererFactory` called `PulsarDeadLetterPublishingRecoverer` that provides a default implementation that can recover the message by sending it to a Dead Letter Topic (DLT).\nWe provide this implementation to the constructor for the preceding `DefaultPulsarConsumerErrorHandler`.\nAs the second argument, we provide a `FixedBackOff`.\nYou can also provide the `ExponentialBackoff` from Spring for advanced backoff features.\nThen we provide this bean name for the `PulsarConsumerErrorHandler` as a property to the `PulsarListener`.\nThe property is called `pulsarConsumerErrorHandler`.\nEach time the `PulsarListener` method fails for a message, it gets retried.\nThe number of retries are controlled by the `Backoff` provided implementation values. In our example, we do 10 retries (11 total tries -- the first one and then the 10 retries).\nOnce all the retries are exhausted, the message is sent to the DLT topic.\n\nThe `PulsarDeadLetterPublishingRecoverer` implementation we provide uses a `PulsarTemplate` that is used for publishing the message to the DLT.\nIn most cases, the same auto-configured `PulsarTemplate` from Spring Boot is sufficient with the caveat for partitioned topics.\nWhen using partitioned topics and using custom message routing for the main topic, you must use a different `PulsarTemplate` that does not take the auto-configured `PulsarProducerFactory` that is populated with a value of `custompartition` for `message-routing-mode`.\nYou can use a `PulsarConsumerErrorHandler` with the following blueprint:\n\n[source, java]\n----\n@Bean\nPulsarConsumerErrorHandler<Integer> pulsarConsumerErrorHandler(PulsarClient pulsarClient) {\n PulsarProducerFactory<Integer> pulsarProducerFactory = new DefaultPulsarProducerFactory<>(pulsarClient, Map.of());\n PulsarTemplate<Integer> pulsarTemplate = new PulsarTemplate<>(pulsarProducerFactory);\n\n BiFunction<Consumer<?>, Message<?>, String> destinationResolver =\n (c, m) -> \"my-foo-dlt\";\n\n PulsarDeadLetterPublishingRecoverer<Integer> pulsarDeadLetterPublishingRecoverer =\n new PulsarDeadLetterPublishingRecoverer<>(pulsarTemplate, destinationResolver);\n\n return new DefaultPulsarConsumerErrorHandler<>(pulsarDeadLetterPublishingRecoverer,\n new FixedBackOff(100, 5));\n}\n----\n\nNote that we are provide a destination resolver to the `PulsarDeadLetterPublishingRecoverer` as the second constructor argument.\nIf not provided, `PulsarDeadLetterPublishingRecoverer` uses `<subscription-name>-<topic-name>-DLT>` as the DLT topic name.\nWhen using this feature, you should use a proper destination name by setting the destination resolver rather than using the default.\n\nWhen using a single record message listener, as we did with `PulsarConsumerErrorHnadler`, and if you use manual acknowledgement, make sure to not negatively acknowledge the message when an exception is thrown.\nRather, re-throw the exception back to the container. Otherwise, the container thinks the message is handled separately, and the error handling is not triggered.\n\nFinally, we have a second `PulsarListener` that receives messages from the DLT topic.\n\nIn the examples provided in this section so far, we only saw how to use `PulsarConsumerErrorHandler` with a single record message listener.\nNext, we look at how you can use this on batch listeners.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc", "title": "message-consumption", "heading": "Native Error Handling in Spring for Apache Pulsar", "heading_level": 3, "file_order": 12, "section_index": 21, "content_hash": "b0cdf7e562e0097c41f5794a6bd7c7ed5990888f6f3dd8b458d532b7a9587826", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc"}}
{"id": "sha256:cbec7a6b2cbbfbb5ed1d00cb7d6f47b727fae8d4790214009d45c5d854aff48e", "content": "First, let us look at a batch `PulsarListener` method:\n\n[source, java]\n----\n@PulsarListener(subscriptionName = \"batch-demo-5-sub\", topics = \"batch-demo-4\", batch = true, concurrency = \"3\",\n subscriptionType = SubscriptionType.Failover,\n pulsarConsumerErrorHandler = \"pulsarConsumerErrorHandler\", ackMode = AckMode.MANUAL)\nvoid listen(List<Message<Integer>> data, Consumer<Integer> consumer, Acknowledgment acknowledgment) {\n for (Message<Integer> datum : data) {\n if (datum.getValue() == 5) {\n throw new PulsarBatchListenerFailedException(\"failed\", datum);\n }\n acknowledgement.acknowledge(datum.getMessageId());\n }\n}\n\n@Bean\nPulsarConsumerErrorHandler<String> pulsarConsumerErrorHandler(\n PulsarTemplate<String> pulsarTemplate) {\n return new DefaultPulsarConsumerErrorHandler<>(\n new PulsarDeadLetterPublishingRecoverer<>(pulsarTemplate, (c, m) -> \"my-foo-dlt\"), new FixedBackOff(100, 10));\n}\n\n@PulsarListener(subscriptionName = \"my-dlt-subscription\", topics = \"my-foo-dlt\")\nvoid dltReceiver(Message<Integer> message) {\n System.out.println(\"DLT - RECEIVED: \" + message.getValue());\n}\n\n----\n\nOnce again, we provide the `pulsarConsumerErrorHandler` property with the `PulsarConsumerErrorHandler` bean name.\nWhen you use a batch listener (as shown in the preceding example) and want to use the `PulsarConsumerErrorHandler` from Spring for Apache Pulsar, you need to use manual acknowledgment.\nThis way, you can acknowledge all the successful individual messages.\nFor the ones that fail, you must throw a `PulsarBatchListenerFailedException` with the message on which it fails.\nWithout this exception, the framework does not know what to do with the failure.\nOn retry, the container sends a new batch of messages, starting with the failed message to the listener.\nIf it fails again, it is retried, until the retries are exhausted, at which point the message is sent to the DLT.\nAt that point, the message is acknowledged by the container, and the listener is handed over with the subsequent messages in the original batch.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc", "title": "message-consumption", "heading": "Batch listener with PulsarConsumerErrorHandler", "heading_level": 3, "file_order": 12, "section_index": 22, "content_hash": "cbec7a6b2cbbfbb5ed1d00cb7d6f47b727fae8d4790214009d45c5d854aff48e", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc"}}
{"id": "sha256:f6087a97b14ff665011f32257f8b3755c14144f0e514d86e6831b5a24d7f167b", "content": "Spring for Apache Pulsar provides a convenient way to customize the consumer created by the container used by the `PulsarListener`.\nApplications can provide a bean for `PulsarListenerConsumerBuilderCustomizer`.\nHere is an example.\n[source, java]\n----\n@Bean\npublic PulsarListenerConsumerBuilderCustomizer<String> myCustomizer() {\n return cb -> {\n cb.subscriptionName(\"modified-subscription-name\");\n };\n}\n----\n\nThen this customizer bean name can be provided as an attribute on the `PuslarListener` annotation as shown below.\n\n[source, java]\n----\n@PulsarListener(subscriptionName = \"my-subscription\",\n topics = \"my-topic\", consumerCustomizer = \"myCustomizer\")\nvoid listen(String message) {\n\n}\n----\n\nThe framework detects the provided bean through the `PulsarListener` and applies this customizer on the Consumer builder before creating the Pulsar Consumer.\n\nIf you have multiple `PulsarListener` methods, and each of them have different customization rules, you should create multiple customizer beans and attach the proper customizers on each `PulsarListener`.\n\n[[message-listener-lifecycle]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc", "title": "message-consumption", "heading": "Consumer Customization on PulsarListener", "heading_level": 2, "file_order": 12, "section_index": 23, "content_hash": "f6087a97b14ff665011f32257f8b3755c14144f0e514d86e6831b5a24d7f167b", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc"}}
{"id": "sha256:8bbd77d07bb080878048ba24f9fc5575606a0e9c9fcbafdbb1865509e8a1fe68", "content": "[[message-listener-pause-resume]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc", "title": "message-consumption", "heading": "Message Listener Container Lifecycle", "heading_level": 2, "file_order": 12, "section_index": 24, "content_hash": "8bbd77d07bb080878048ba24f9fc5575606a0e9c9fcbafdbb1865509e8a1fe68", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc"}}
{"id": "sha256:3f885b72fdd548c4f5daf9aee9d621e0cb64572e26812423e5b530621076c3e0", "content": "There are situations in which an application might want to pause message consumption temporarily and then resume later.\nSpring for Apache Pulsar provides the ability to pause and resume the underlying message listener containers.\nWhen the Pulsar message listener container is paused, any polling done by the container to receive data from the Pulsar consumer will be paused.\nSimilarly, when the container is resumed, the next poll starts returning data if the topic has any new records added while paused.\n\nTo pause or resume a listener container, first obtain the container instance via the `PulsarListenerEndpointRegistry` bean and then invoke the pause/resume API on the container instance - as shown in the snippet below:\n[source, java]\n----\n@Autowired\nprivate PulsarListenerEndpointRegistry registry;\n\nvoid someMethod() {\n PulsarMessageListenerContainer container = registry.getListenerContainer(\"my-listener-id\");\n container.pause();\n}\n----\n\nTIP: The id parameter passed to `getListenerContainer` is the container id - which will be the value of the `@PulsarListener` id attribute when pausing/resuming a `@PulsarListener`.\n\n[[message-listener-startup-failure]]\n= Handling Startup Failures\ninclude::../attributes/attributes-variables.adoc[]\n\nMessage listener containers are started when the application context is refreshed.\nBy default, any failures encountered during startup are re-thrown and the application will fail to start.\nYou can adjust this behavior with the `StartupFailurePolicy` on the corresponding container properties.\n\nThe available options are:\n\n- `Stop` (default) - log and re-throw the exception, effectively stopping the application\n- `Continue` - log the exception, leave the container in a non-running state, but do not stop the application\n- `Retry` - log the exception, retry to start the container asynchronously, but do not stop the application.\n\nThe default retry behavior is to retry 3 times with a 10-second delay between\neach attempt.\nHowever, a custom retry template can be specified on the corresponding container properties.\nIf the container fails to restart after the retries are exhausted, it is left in a non-running state.\n\n== Configuration\n\n[discrete]\n=== With Spring Boot\nWhen using Spring Boot you can register a `PulsarContainerFactoryCustomizer<{container-class}<?>>` bean that sets the container startup properties.\n\n[discrete]\n=== Without Spring Boot\nHowever, if you are instead manually configuring the components, you will have to update the container startup properties accordingly when constructing the message listener container factory.\n\n[[imperative-pulsar-reader]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc", "title": "message-consumption", "heading": "Pausing and Resuming", "heading_level": 3, "file_order": 12, "section_index": 25, "content_hash": "3f885b72fdd548c4f5daf9aee9d621e0cb64572e26812423e5b530621076c3e0", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc"}}
{"id": "sha256:1ce83d1a80a6a8e47ed0a1720cf92b8616effe2b059f3a5829fb512eb4f385f5", "content": "The framework provides support for using {apache-pulsar-docs}/concepts-clients/#reader-interface[Pulsar Reader] via the `PulsarReaderFactory`.\n\nSpring Boot provides this reader factory which you can further configure by specifying any of the {spring-boot-pulsar-config-props}[`spring.pulsar.reader.*`] application properties.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc", "title": "message-consumption", "heading": "Pulsar Reader Support", "heading_level": 2, "file_order": 12, "section_index": 26, "content_hash": "1ce83d1a80a6a8e47ed0a1720cf92b8616effe2b059f3a5829fb512eb4f385f5", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc"}}
{"id": "sha256:e913ff89eee89d6e353a8e5e16d36aab16307ddb1dd412f13d18949dc8a721d9", "content": "While it is possible to use `PulsarReaderFactory` directly, Spring for Apache Pulsar provides the `PulsarReader` annotation that you can use to quickly read from a topic without setting up any reader factories yourselves.\nThis is similar to the same ideas behind `PulsarListener.`\nHere is a quick example.\n\n[source, java]\n----\n@PulsarReader(id = \"reader-demo-id\", topics = \"reader-demo-topic\", startMessageId = \"earliest\")\nvoid read(String message) {\n //...\n}\n----\nThe `id` attribute is optional, but it is a best practice to provide a value that is meaningful to your application.\nWhen not specified an auto-generated id will be used.\nOn the other hand, the `topics` and `startMessageId` attributes are mandatory.\nThe `topics` attribute can be a single topic or a comma-separated list of topics.\nThe `startMessageId` attribute instructs the reader to start from a particular message in the topic.\nThe valid values for `startMessageId` are `earliest` or `latest.`\nSuppose you want the reader to start reading messages arbitrarily from a topic other than the earliest or latest available messages. In that case, you need to use a `ReaderBuilderCustomizer` to customize the `ReaderBuilder` so it knows the right `MessageId` to start from.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc", "title": "message-consumption", "heading": "PulsarReader Annotation", "heading_level": 3, "file_order": 12, "section_index": 27, "content_hash": "e913ff89eee89d6e353a8e5e16d36aab16307ddb1dd412f13d18949dc8a721d9", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc"}}
{"id": "sha256:89f30dfb77e9b29c9fd6b022547bf58e4774791cd7814d0041db99a6c08a0343", "content": "You can customize any fields available through `ReaderBuilder` using a `PulsarReaderReaderBuilderCustomizer` in Spring for Apache Pulsar.\nYou can provide a `@Bean` of type `PulsarReaderReaderBuilderCustomizer` and then make it available to the `PulsarReader` as below.\n\n[source, java]\n----\n@PulsarReader(id = \"reader-customizer-demo-id\", topics = \"reader-customizer-demo-topic\",\n readerCustomizer = \"myCustomizer\")\nvoid read(String message) {\n //...\n}\n\n@Bean\npublic PulsarReaderReaderBuilderCustomizer<String> myCustomizer() {\n return readerBuilder -> {\n readerBuilder.startMessageId(messageId); // the first message read is after this message id.\n // Any other customizations on the readerBuilder\n };\n}\n----\n\nTIP: If your application only has a single `@PulsarReader` and a single `PulsarReaderReaderBuilderCustomizer` bean registered then the customizer will be automatically applied.\n\n[[message-reader-startup-failure]]\n= Handling Startup Failures\ninclude::../attributes/attributes-variables.adoc[]\n\nMessage listener containers are started when the application context is refreshed.\nBy default, any failures encountered during startup are re-thrown and the application will fail to start.\nYou can adjust this behavior with the `StartupFailurePolicy` on the corresponding container properties.\n\nThe available options are:\n\n- `Stop` (default) - log and re-throw the exception, effectively stopping the application\n- `Continue` - log the exception, leave the container in a non-running state, but do not stop the application\n- `Retry` - log the exception, retry to start the container asynchronously, but do not stop the application.\n\nThe default retry behavior is to retry 3 times with a 10-second delay between\neach attempt.\nHowever, a custom retry template can be specified on the corresponding container properties.\nIf the container fails to restart after the retries are exhausted, it is left in a non-running state.\n\n== Configuration\n\n[discrete]\n=== With Spring Boot\nWhen using Spring Boot you can register a `PulsarContainerFactoryCustomizer<{container-class}<?>>` bean that sets the container startup properties.\n\n[discrete]\n=== Without Spring Boot\nHowever, if you are instead manually configuring the components, you will have to update the container startup properties accordingly when constructing the message listener container factory.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc", "title": "message-consumption", "heading": "Customizing the ReaderBuilder", "heading_level": 3, "file_order": 12, "section_index": 28, "content_hash": "89f30dfb77e9b29c9fd6b022547bf58e4774791cd7814d0041db99a6c08a0343", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-consumption.adoc"}}
{"id": "sha256:c2b0bfc38777c603ac84759a72e102021d8878fa8bc0ce101a4faa458627eba4", "content": "[[message-production]]\n:toc: left\n:toclevels: 6\n:numbered:\n:icons: font\n:hide-uri-scheme:\n:sectnums:\n:sectnumlevels: 3\n\ninclude::attributes-variables.adoc[]\n\n[[pulsar-producer]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-production.adoc", "title": "message-production", "heading": "message-production", "heading_level": 1, "file_order": 13, "section_index": 0, "content_hash": "c2b0bfc38777c603ac84759a72e102021d8878fa8bc0ce101a4faa458627eba4", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-production.adoc"}}
{"id": "sha256:d04712d1b46b870f7945b439a6a24e4bfa56bd34b700a7e75143e7c752396d51", "content": "On the Pulsar producer side, Spring Boot auto-configuration provides a `PulsarTemplate` for publishing records. The template implements an interface called `PulsarOperations` and provides methods to publish records through its contract.\n\nThere are two categories of these send API methods: `send` and `sendAsync`.\nThe `send` methods block calls by using the synchronous sending capabilities on the Pulsar producer.\nThey return the `MessageId` of the message that was published once the message is persisted on the broker.\nThe `sendAsync` method calls are asynchronous calls that are non-blocking.\nThey return a `CompletableFuture`, which you can use to asynchronously receive the message ID once the messages are published.\n\nNOTE: For the API variants that do not include a topic parameter, a xref:reference/topic-resolution.adoc#topic-resolution-process[topic resolution process] is used to determine the destination topic.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-production.adoc", "title": "message-production", "heading": "Pulsar Template", "heading_level": 2, "file_order": 13, "section_index": 1, "content_hash": "d04712d1b46b870f7945b439a6a24e4bfa56bd34b700a7e75143e7c752396d51", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-production.adoc"}}
{"id": "sha256:af87ecf57f15531cb379c80ac83832d5b89fa3ec86587fbed7d0acba08b1e8f6", "content": "The template provides a handful of methods ({javadocs}/org/springframework/pulsar/core/PulsarOperations.html[prefixed with _'send'_]) for simple send requests. For more complicated send requests, a fluent API lets you configure more options.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-production.adoc", "title": "message-production", "heading": "Simple API", "heading_level": 3, "file_order": 13, "section_index": 2, "content_hash": "af87ecf57f15531cb379c80ac83832d5b89fa3ec86587fbed7d0acba08b1e8f6", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-production.adoc"}}
{"id": "sha256:bdc70a10de9fb0f9a586e7659902e3e04389f47d98c6925dd0f24ca29ece5e06", "content": "The template provides a {javadocs}/org/springframework/pulsar/core/PulsarOperations.html#newMessage(T)[fluent builder] to handle more complicated send requests.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-production.adoc", "title": "message-production", "heading": "Fluent API", "heading_level": 3, "file_order": 13, "section_index": 3, "content_hash": "bdc70a10de9fb0f9a586e7659902e3e04389f47d98c6925dd0f24ca29ece5e06", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-production.adoc"}}
{"id": "sha256:22cb58a39aa1fa0ba1ce85ea68c7a195d04fe530677ee3547b251e5b029daf81", "content": "You can specify a `TypedMessageBuilderCustomizer` to configure the outgoing message. For example, the following code shows how to send a keyed message:\n[source, java]\n----\ntemplate.newMessage(msg)\n .withMessageCustomizer((mb) -> mb.key(\"foo-msg-key\"))\n .send();\n----\n\n[[single-producer-customize]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-production.adoc", "title": "message-production", "heading": "Message customization", "heading_level": 3, "file_order": 13, "section_index": 4, "content_hash": "22cb58a39aa1fa0ba1ce85ea68c7a195d04fe530677ee3547b251e5b029daf81", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-production.adoc"}}
{"id": "sha256:a5feb88b972604110a7962a5a0257f0423dd62241b7c905e4510642fbe37a50f", "content": "You can specify a `ProducerBuilderCustomizer` to configure the underlying Pulsar producer builder that ultimately constructs the producer used to send the outgoing message.\n\nWARNING: Use with caution as this gives full access to the producer builder and invoking some of its methods (such as `create`) may have unintended side effects.\n\nFor example, the following code shows how to disable batching and enable chunking:\n[source, java]\n----\ntemplate.newMessage(msg)\n .withProducerCustomizer((pb) -> pb.enableChunking(true).enableBatching(false))\n .send();\n----\n\nThis other example shows how to use custom routing when publishing records to partitioned topics.\nSpecify your custom `MessageRouter` implementation on the `Producer` builder such as:\n[source, java]\n----\ntemplate.newMessage(msg)\n .withProducerCustomizer((pb) -> pb.messageRouter(messageRouter))\n .send();\n----\n\nTIP: Note that, when using a `MessageRouter`, the only valid setting for `spring.pulsar.producer.message-routing-mode` is `custom`.\n\nThis other example shows how to add a `ProducerInterceptor` that will intercept and mutate messages received by the producer before being published to the brokers:\n[source, java]\n----\ntemplate.newMessage(msg)\n .withProducerCustomizer((pb) -> pb.intercept(interceptor))\n .send();\n----\n\nThe customizer will only apply to the producer used for the send operation.\nIf you want to apply a customizer to all producers, you must provide them to the producer factory as described in <<global-producer-customize>>.\n\nCAUTION: The rules described in \"`<<producer-caching-lambdas>>`\" must be followed when using Lambda customizers.\n\n[[schema-info-template-imperative]]\n\ninclude::../../attributes/attributes-variables.adoc[]\n\n== Specifying Schema Information\nIf you use Java primitive types, the framework auto-detects the schema for you, and you need not specify any schema types for publishing the data.\nFor non-primitive types, if the Schema is not explicitly specified when invoking send operations on the `{template-class}`, the Spring for Apache Pulsar framework will try to build a `Schema.JSON` from the type.\n\nIMPORTANT: Complex Schema types that are currently supported are JSON, AVRO, PROTOBUF, AUTO_PRODUCE_BYTES, and KEY_VALUE w/ INLINE encoding.\n\n=== Custom Schema Mapping\nAs an alternative to specifying the schema when invoking send operations on the `{template-class}` for complex types, the schema resolver can be configured with mappings for the types.\nThis removes the need to specify the schema as the framework consults the resolver using the outgoing message type.\n\ninclude::custom-schema-mapping.adoc[]\n\n[[template-default-schema-annotation]]\ninclude::custom-schema-mapping-annotation.adoc[leveloffset=+2]\n\nWith this configuration in place, there is no need to set specify the schema on send operations.\n\n[[template-auto-produce]]\n=== Producing with AUTO_SCHEMA\nIf there is no chance to know the type of schema of a Pulsar topic in advance, you can use an {apache-pulsar-docs}/schema-get-started/#auto_produce[AUTO_PRODUCE] schema to publish a raw JSON or Avro payload as a `byte[]` safely.\n\nIn this case, the producer validates whether the outbound bytes are compatible with the schema of the destination topic.\n\nSimply specify a schema of `Schema.AUTO_PRODUCE_BYTES()` on your template send operations as shown in the example below:\n\ninclude::{template-class}/template-snippet.adoc[]\n\nNOTE: This is only supported with Avro and JSON schema types.\n\n[[pulsar-producer-factory]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-production.adoc", "title": "message-production", "heading": "Producer customization", "heading_level": 3, "file_order": 13, "section_index": 5, "content_hash": "a5feb88b972604110a7962a5a0257f0423dd62241b7c905e4510642fbe37a50f", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-production.adoc"}}
{"id": "sha256:7f54165cf3ac994791134525edee8b1b4883d8e930c94a232376db74399d1a2c", "content": "The `PulsarTemplate` relies on a `PulsarProducerFactory` to actually create the underlying producer.\nSpring Boot auto-configuration also provides this producer factory which you can further configure by specifying any of the {spring-boot-pulsar-config-props}[`spring.pulsar.producer.*`] application properties.\n\nNOTE: If topic information is not specified when using the producer factory APIs directly, the same xref:reference/topic-resolution.adoc#topic-resolution-process[topic resolution process] used by the `PulsarTemplate` is used with the one exception that the \"Message type default\" step is **omitted**.\n\n[[global-producer-customize]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-production.adoc", "title": "message-production", "heading": "Pulsar Producer Factory", "heading_level": 2, "file_order": 13, "section_index": 6, "content_hash": "7f54165cf3ac994791134525edee8b1b4883d8e930c94a232376db74399d1a2c", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-production.adoc"}}
{"id": "sha256:98f5c112d76215346ec148936dcf15a766dfffb3618b646ae16b25e808b1140a", "content": "The framework provides the `ProducerBuilderCustomizer` contract which allows you to configure the underlying builder which is used to construct each producer.\nTo customize all producers, you can pass a list of customizers into the `PulsarProducerFactory` constructor.\nWhen using multiple customizers, they are applied in the order in which they appear in the list.\n\nTIP: If you use Spring Boot auto-configuration, you can specify the customizers as beans and they will be passed automatically to the `PulsarProducerFactory`, ordered according to their `@Order` annotation.\n\nIf you want to apply a customizer to just a single producer, you can use the Fluent API and <<single-producer-customize,specify the customizer at send time>>.\n\n[[producer-caching]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-production.adoc", "title": "message-production", "heading": "Global producer customization", "heading_level": 3, "file_order": 13, "section_index": 7, "content_hash": "98f5c112d76215346ec148936dcf15a766dfffb3618b646ae16b25e808b1140a", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-production.adoc"}}
{"id": "sha256:475ef86d8b00063b8d77f2836658a1b935a5befcc448cd9da594537b90b7801b", "content": "Each underlying Pulsar producer consumes resources.\nTo improve performance and avoid continual creation of producers, the producer factory caches the producers that it creates.\nThey are cached in an LRU fashion and evicted when they have not been used within a configured time period.\nThe link:{github}/blob/8e33ac0b122bc0e75df299919c956cacabcc9809/spring-pulsar/src/main/java/org/springframework/pulsar/core/CachingPulsarProducerFactory.java#L159[cache key] is composed of just enough information to ensure that callers are returned the same producer on subsequent creation requests.\n\nAdditionally, you can configure the cache settings by specifying any of the {spring-boot-pulsar-config-props}[`spring.pulsar.producer.cache.*`] application properties.\n\n[[producer-caching-lambdas]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-production.adoc", "title": "message-production", "heading": "Pulsar Producer Caching", "heading_level": 2, "file_order": 13, "section_index": 8, "content_hash": "475ef86d8b00063b8d77f2836658a1b935a5befcc448cd9da594537b90b7801b", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-production.adoc"}}
{"id": "sha256:3a66e7b2ef66e73a9b42f9a265b285e5287f2b1032a0961e65d13158e0de1f6f", "content": "Any user-provided producer customizers are also included in the cache key.\nBecause the cache key relies on a valid implementation of `equals/hashCode`, one must take caution when using Lambda customizers.\n\nIMPORTANT: *RULE:* Two customizers implemented as Lambdas will match on `equals/hashCode` *if and only if* they use the same Lambda instance and do not require any variable defined outside its closure.\n\nTo clarify the above rule we will look at a few examples.\nIn the following example, the customizer is defined as an inline Lambda which means that each call to `sendUser` uses the same Lambda instance. Additionally, it requires no variable outside its closure. Therefore, it *will* match as a cache key.\n\n[source, java]\n----\nvoid sendUser() {\n var user = randomUser();\n template.newMessage(user)\n .withTopic(\"user-topic\")\n .withProducerCustomizer((b) -> b.producerName(\"user\"))\n .send();\n}\n----\n\nIn this next case, the customizer is defined as an inline Lambda which means that each call to `sendUser` uses the same Lambda instance. However, it requires a variable outside its closure. Therefore, it *will not* match as a cache key.\n\n[source, java]\n----\nvoid sendUser() {\n var user = randomUser();\n var name = randomName();\n template.newMessage(user)\n .withTopic(\"user-topic\")\n .withProducerCustomizer((b) -> b.producerName(name))\n .send();\n}\n----\n\nIn this final example, the customizer is defined as an inline Lambda which means that each call to `sendUser` uses the same Lambda instance. While it does use a variable name, it does not originate outside its closure and therefore *will* match as a cache key.\nThis illustrates that variables can be used *within* the Lambda closure and can even make calls to static methods.\n\n[source, java]\n----\nvoid sendUser() {\n var user = randomUser();\n template.newMessage(user)\n .withTopic(\"user-topic\")\n .withProducerCustomizer((b) -> {\n var name = SomeHelper.someStaticMethod();\n b.producerName(name);\n })\n .send();\n}\n----\n\nIMPORTANT: *RULE:* If your Lambda customizer is not defined *once and only once* (the same instance is used on subsequent calls) *OR* it requires variable(s) defined outside its closure then you must provide a customizer implementation with a valid `equals/hashCode` implementation.\n\nWARNING: If these rules are not followed then the producer cache will always miss and your application performance will be negatively affected.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-production.adoc", "title": "message-production", "heading": "Caution on Lambda customizers", "heading_level": 3, "file_order": 13, "section_index": 9, "content_hash": "3a66e7b2ef66e73a9b42f9a265b285e5287f2b1032a0961e65d13158e0de1f6f", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-production.adoc"}}
{"id": "sha256:dfa66c070a6a74730938fdfbb0f43a18aedf38e971cd62d52368a5e25bfef6e8", "content": "Adding a `ProducerInterceptor` lets you intercept and mutate messages received by the producer before they are published to the brokers.\nTo do so, you can pass a list of interceptors into the `PulsarTemplate` constructor.\nWhen using multiple interceptors, the order they are applied in is the order in which they appear in the list.\n\nIf you use Spring Boot auto-configuration, you can specify the interceptors as Beans.\nThey are passed automatically to the `PulsarTemplate`.\nOrdering of the interceptors is achieved by using the `@Order` annotation as follows:\n\n[source, java]\n----\n@Bean\n@Order(100)\nProducerInterceptor firstInterceptor() {\n ...\n}\n\n@Bean\n@Order(200)\nProducerInterceptor secondInterceptor() {\n ...\n}\n----\n\nNOTE: If you are not using the starter, you will need to configure and register the aforementioned components yourself.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/message-production.adoc", "title": "message-production", "heading": "Intercept Messages on the Producer", "heading_level": 2, "file_order": 13, "section_index": 10, "content_hash": "dfa66c070a6a74730938fdfbb0f43a18aedf38e971cd62d52368a5e25bfef6e8", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/message-production.adoc"}}
{"id": "sha256:3f1589698f734932685dce172b11b709ec14532d7c5277d5a0bb1314f98d1ac7", "content": "[[preface]]\n:toc: left\n:toclevels: 6\n:numbered:\n:icons: font\n:hide-uri-scheme:\n:sectnums:\n:sectnumlevels: 3\n\ninclude::attributes-variables.adoc[]\n\nNOTE: We recommend using a Spring-Boot-First approach for Spring for Apache Pulsar-based applications, as that simplifies things tremendously.\nTo do so, you can add the `spring-boot-starter-pulsar` module as a dependency.\n\nNOTE: The majority of this reference expects the reader to be using the starter and gives most directions for configuration with that in mind.\nHowever, an effort is made to call out when instructions are specific to the Spring Boot starter usage.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/preface.adoc", "title": "preface", "heading": "preface", "heading_level": 1, "file_order": 14, "section_index": 0, "content_hash": "3f1589698f734932685dce172b11b709ec14532d7c5277d5a0bb1314f98d1ac7", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/preface.adoc"}}
{"id": "sha256:5cf68c9c9af0d9605c45d4018081286e56aef9d62a14f30ed2cd1fad1a96e6e0", "content": "[[publishing-consuming-partitioned-topics]]\n:toc: left\n:toclevels: 6\n:numbered:\n:icons: font\n:hide-uri-scheme:\n:sectnums:\n:sectnumlevels: 3\n\ninclude::attributes-variables.adoc[]\n\nIn the following example, we publish to a topic called `hello-pulsar-partitioned`.\nIt is a topic that is partitioned, and, for this sample, we assume that the topic is already created with three partitions.\n\n[source, java]\n----\n@SpringBootApplication\npublic class PulsarBootPartitioned {\n\n\tpublic static void main(String[] args) {\n SpringApplication.run(PulsarBootPartitioned.class, \"--spring.pulsar.producer.message-routing-mode=CustomPartition\");\n\t}\n\n\t@Bean\n\tpublic ApplicationRunner runner(PulsarTemplate<String> pulsarTemplate) {\n pulsarTemplate.setDefaultTopicName(\"hello-pulsar-partitioned\");\n return args -> {\n for (int i = 0; i < 10; i++) {\n pulsarTemplate.sendAsync(\"hello john doe 0 \", new FooRouter());\n pulsarTemplate.sendAsync(\"hello alice doe 1\", new BarRouter());\n pulsarTemplate.sendAsync(\"hello buzz doe 2\", new BuzzRouter());\n }\n };\n\t}\n\n\t@PulsarListener(subscriptionName = \"hello-pulsar-partitioned-subscription\", topics = \"hello-pulsar-partitioned\")\n\tpublic void listen(String message) {\n System.out.println(\"Message Received: \" + message);\n\t}\n\n static class FooRouter implements MessageRouter {\n\n @Override\n public int choosePartition(Message<?> msg, TopicMetadata metadata) {\n return 0;\n }\n\t}\n\n\tstatic class BarRouter implements MessageRouter {\n\n @Override\n public int choosePartition(Message<?> msg, TopicMetadata metadata) {\n return 1;\n }\n\t}\n\n\tstatic class BuzzRouter implements MessageRouter {\n\n @Override\n public int choosePartition(Message<?> msg, TopicMetadata metadata) {\n return 2;\n }\n\t}\n\n}\n----\n\nIn the preceding example, we publish to a partitioned topic, and we would like to publish some data segment to a specific partition.\nIf you leave it to Pulsar's default, it follows a round-robin mode of partition assignments, and we would like to override that.\nTo do so, we provide a message router object with the `send` method.\nConsider the three message routers implemented.\n`FooRouter` always sends data to partition `0`, `BarRouter` sends to partition `1`, and `BuzzRouter` sends to partition `2`.\nAlso note that we now use the `sendAsync` method of `PulsarTemplate` that returns a `CompletableFuture`.\nWhen running the application, we also need to set the `messageRoutingMode` on the producer to `CustomPartition` (`spring.pulsar.producer.message-routing-mode`).\n\nOn the consumer side, we use a `PulsarListener` with the exclusive subscription type.\nThis means that data from all the partitions ends up in the same consumer and there is no ordering guarantee.\n\nWhat can we do if we want each partition to be consumed by a single distinct consumer?\nWe can switch to the `failover` subscription mode and add three separate consumers:\n\n[source, java]\n----\n@PulsarListener(subscriptionName = \"hello-pulsar-partitioned-subscription\", topics = \"hello-pulsar-partitioned\", subscriptionType = SubscriptionType.Failover)\npublic void listen1(String foo) {\n System.out.println(\"Message Received 1: \" + foo);\n}\n\n@PulsarListener(subscriptionName = \"hello-pulsar-partitioned-subscription\", topics = \"hello-pulsar-partitioned\", subscriptionType = SubscriptionType.Failover)\npublic void listen2(String foo) {\n System.out.println(\"Message Received 2: \" + foo);\n}\n\n@PulsarListener(subscriptionName = \"hello-pulsar-partitioned-subscription\", topics = \"hello-pulsar-partitioned\", subscriptionType = SubscriptionType.Failover)\npublic void listen3(String foo) {\n System.out.println(\"Message Received 3: \" + foo);\n}\n----\n\nWhen you follow this approach, a single partition always gets consumed by a dedicated consumer.\n\nIn a similar vein, if you want to use Pulsar's shared consumer type, you can use the `shared` subscription type.\nHowever, when you use the `shared` mode, you lose any ordering guarantees, as a single consumer may receive messages from all the partitions before another consumer gets a chance.\n\nConsider the following example:\n\n[source, java]\n----\n@PulsarListener(subscriptionName = \"hello-pulsar-shared-subscription\", topics = \"hello-pulsar-partitioned\", subscriptionType = SubscriptionType.Shared)\npublic void listen1(String foo) {\n System.out.println(\"Message Received 1: \" + foo);\n}\n\n@PulsarListener(subscriptionName = \"hello-pulsar-shared-subscription\", topics = \"hello-pulsar-partitioned\", subscriptionType = SubscriptionType.Shared)\npublic void listen2(String foo) {\n System.out.println(\"Message Received 2: \" + foo);\n}\n----", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/publishing-consuming-partitioned-topics.adoc", "title": "publishing-consuming-partitioned-topics", "heading": "publishing-consuming-partitioned-topics", "heading_level": 1, "file_order": 15, "section_index": 0, "content_hash": "5cf68c9c9af0d9605c45d4018081286e56aef9d62a14f30ed2cd1fad1a96e6e0", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/publishing-consuming-partitioned-topics.adoc"}}
{"id": "sha256:0536a100a477e200a0c37dd08e8bce70ae4fc2505ca1c1b4658101fd8513c882", "content": "[[pulsar-client]]\n:toc: left\n:toclevels: 6\n:numbered:\n:icons: font\n:hide-uri-scheme:\n:sectnums:\n:sectnumlevels: 3\n\ninclude::attributes-variables.adoc[]\n\nWhen you use the Pulsar Spring Boot Starter, you get the `PulsarClient` auto-configured.\n\nBy default, the application tries to connect to a local Pulsar instance at `pulsar://localhost:6650`.\nThis can be adjusted by setting the `spring.pulsar.client.service-url` property to a different value.\n\nTIP: The value must be a valid {apache-pulsar-docs}/client-libraries-java/#connection-urls[Pulsar Protocol] URL\n\nYou can further configure the client by specifying any of the {spring-boot-pulsar-config-props}[`spring.pulsar.client.*`] application properties.\n\nNOTE: If you are not using the starter, you will need to configure and register the `PulsarClient` yourself.\nThere is a `DefaultPulsarClientFactory` that accepts a builder customizer that can be used to help with this.\n\n[[tls-encryption]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/pulsar-client.adoc", "title": "pulsar-client", "heading": "pulsar-client", "heading_level": 1, "file_order": 16, "section_index": 0, "content_hash": "0536a100a477e200a0c37dd08e8bce70ae4fc2505ca1c1b4658101fd8513c882", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/pulsar-client.adoc"}}
{"id": "sha256:cf330f8a8acd59d4e9fa4fe132bc30b410e8f93b530200176efbb533f607cda0", "content": "include::../../attributes/attributes.adoc[]\n\nBy default, Pulsar clients communicate with Pulsar services in plain text.\nThe following section describes how to configure Pulsar clients to use TLS encryption (SSL).\nA pre-requisite is that the Broker has also been configured to use TLS encryption.\n\nThe Spring Boot auto-configuration does not currently support any TLS/SSL configuration properties.\nYou can instead provide a `PulsarClientBuilderCustomizer` that sets the necessary properties on the Pulsar client builder.\nPulsar supports both Privacy Enhanced Mail (PEM) and Java KeyStore (JKS) certificate formats.\n\nFollow these steps to configure TLS:\n\n1. Adjust the Pulsar client service url to use the `pulsar+ssl://` scheme and TLS port (typically `6651`).\n2. Adjust the admin client service url to use the `https://` scheme and TLS web port (typically `8443`).\n3. Provide client builder customizer(s) that sets the relevant properties on the builder.\n    - {github}/blob/02730275e8d0291525eed9db5babe880c555a7bd/integration-tests/src/intTest/java/org/springframework/pulsar/inttest/app/SamplePemBasedSslConfig.java#L30-L49[PEM based sample]\n    - {github}/blob/02730275e8d0291525eed9db5babe880c555a7bd/integration-tests/src/intTest/java/org/springframework/pulsar/inttest/app/SampleJksBasedSslConfig.java#L30-L57[JKS based sample]\n\nYou can find more information on the above in the official {apache-pulsar-docs}/security-tls-transport/[Pulsar TLS Encryption] documentation.\n\n[[client-authentication]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/pulsar-client.adoc", "title": "pulsar-client", "heading": "TLS Encryption (SSL)", "heading_level": 2, "file_order": 16, "section_index": 1, "content_hash": "cf330f8a8acd59d4e9fa4fe132bc30b410e8f93b530200176efbb533f607cda0", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/pulsar-client.adoc"}}
{"id": "sha256:42453c644d7d0cbd7608e2e8f2e0b6686020d30d59dccd31c188034d0138a461", "content": "include::../../attributes/attributes.adoc[]\n\nTo connect to a Pulsar cluster that requires authentication, you need to specify which authentication plugin to use and any parameters required by the specified plugin.\nWhen **using Spring Boot** auto-configuration, you can set the plugin and the plugin parameters via configuration properties (in most cases).\n\n[NOTE]\n====\nYou need to ensure that names defined under `+spring.pulsar.client.authentication.param.*+` exactly match those expected by your auth plugin (which is typically camel cased).\nSpring Boot will not attempt any kind of relaxed binding for these entries.\n\nFor example, if you want to configure the issuer url for the `AuthenticationOAuth2` auth plugin you must use `+spring.pulsar.client.authentication.param.issuerUrl+`.\nIf you use other forms, such as `issuerurl` or `issuer-url`, the setting will not be applied to the plugin.\n====\n\n[[client-authentication-env-vars]]\n[TIP]\n====\nUsing environment variables for auth parameters is typically problematic because the case sensitivity is lost during translation.\nFor example, consider the following `issuerUrl` auth parameter set via an environment variable:\n[source,properties]\n----\nSPRING_PULSAR_CLIENT_AUTHENTICATION_PARAM_ISSUERURL=https://some.server.com\n----\nWhen Spring Boot loads this property it will use `issuerurl` (lower-cased) rather than the expected `issuerUrl` (camel-cased).\nYou can get around this limitation by using the value of the env var as the value of the related auth property in your application.yml.\nContinuing the example above:\n[source,yaml]\n----\nspring:\n  pulsar:\n    client:\n      authentication:\n        param:\n          issuerUrl: ${SPRING_PULSAR_CLIENT_AUTHENTICATION_PARAM_ISSUERURL}\n----\n====\n\nWhen **not using Spring Boot** auto-configuration, you can use the `org.apache.pulsar.client.api.AuthenticationFactory` to create the authentication and then set it directly on the Pulsar client builder in a client customizer that you provide to the client factory.\n\n\nThe following listings show how to configure each of the supported authentication mechanisms.\n\n[[Athenz]]\n.[.underline]#Click ##here## for **Athenz**#\n[%collapsible]\n[source, yaml]\n====\n----\nspring:\n  pulsar:\n    client:\n      authentication:\n        plugin-class-name: org.apache.pulsar.client.impl.auth.AuthenticationAthenz\n        param:\n          tenantDomain: ...\n          tenantService: ...\n          providerDomain: ...\n          privateKey: ...\n          keyId: ...\n----\nNOTE: This also requires xref:reference/pulsar/pulsar-client.adoc#tls-encryption[TLS encryption].\n====\n\n[[Token]]\n.[.underline]#Click ##here## for **Token**#\n[%collapsible]\n[source, yaml]\n====\n----\nspring:\n  pulsar:\n    client:\n      authentication:\n        plugin-class-name: org.apache.pulsar.client.impl.auth.AuthenticationToken\n        param:\n          token: some-token-goes-here\n----\n====\n\n[[Basic]]\n.[.underline]#Click ##here## for **Basic**#\n[%collapsible]\n[source, yaml]\n====\n----\nspring:\n  pulsar:\n    client:\n      authentication:\n        plugin-class-name: org.apache.pulsar.client.impl.auth.AuthenticationBasic\n        param:\n          userId: ...\n          password: ...\n----\n====\n\n[[OAuth2]]\n.[.underline]#Click ##here## for **OAuth2**#\n[%collapsible]\n[source, yaml]\n====\n----\nspring:\n  pulsar:\n    client:\n      authentication:\n        plugin-class-name: org.apache.pulsar.client.impl.auth.oauth2.AuthenticationOAuth2\n        param:\n          issuerUrl: ...\n          privateKey: ...\n          audience: ...\n          scope: ...\n----\n====\n\n[[Sasl]]\n.[.underline]#Click ##here## for **Sasl**#\n[%collapsible]\n[source, yaml]\n====\n----\nspring:\n  pulsar:\n    client:\n      authentication:\n        plugin-class-name: org.apache.pulsar.client.impl.auth.AuthenticationSasl\n        param:\n          saslJaasClientSectionName: ...\n          serverType: ...\n----\n====\n\n[[mTlS-pem]]\n.[.underline]#Click ##here## for **mTLS (PEM)**#\n[%collapsible]\n====\nNOTE: Because this option requires TLS encryption, which already requires you to xref:reference/pulsar/pulsar-client.adoc#tls-encryption[provide a client builder customizer], it is recommended to simply add the authentication directly on the client builder in your provided TLS customizer.\nYou can use the `org.apache.pulsar.client.api.AuthenticationFactory` to help create the authentication object as follows:\n[source,java]\n----\nAuthentication auth = AuthenticationFactory.TLS(\"/path/to/my-role.cert.pem\", \"/path/to/my-role.key-pk8.pem\");\n----\nSee the official Pulsar documentation on {apache-pulsar-docs}/security-tls-authentication/#configure-mtls-authentication-in-pulsar-clients[mTLS (PEM)].\n====\n\n[[mTLS-jks]]\n.[.underline]#Click ##here## for **mTLS (JKS)**#\n[%collapsible]\n====\nNOTE: Because this option requires TLS encryption, which already requires you to xref:reference/pulsar/pulsar-client.adoc#tls-encryption[provide a client builder customizer], it is recommended to simply add the authentication directly on the client builder in your provided TLS customizer.\nYou can use the `org.apache.pulsar.client.api.AuthenticationFactory` to help create the authentication object as follows:\n[source,java]\n----\nAuthentication auth = AuthenticationFactory.create(\n        \"org.apache.pulsar.client.impl.auth.AuthenticationKeyStoreTls\",\n        Map.of(\"keyStoreType\", \"JKS\", \"keyStorePath\", \"/path/to/my/keystore.jks\", \"keyStorePassword\", \"clientpw\"));\n----\nSee the official Pulsar documentation on {apache-pulsar-docs}/security-tls-authentication/#configure-clients[mTLS (JKS)].\n====\n\nYou can find more information on each of the support plugins and their required properties in the official {apache-pulsar-docs}/security-overview#authentication-providers[Pulsar security] documentation.\n\n[[auto-cluster-failover]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/pulsar-client.adoc", "title": "pulsar-client", "heading": "Authentication", "heading_level": 2, "file_order": 16, "section_index": 2, "content_hash": "42453c644d7d0cbd7608e2e8f2e0b6686020d30d59dccd31c188034d0138a461", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/pulsar-client.adoc"}}
{"id": "sha256:6c71a0f69cb86a3b960904091b2b4f1c90f275d8e9f4f8450e0a00226c4dd02e", "content": "The Pulsar Spring Boot Starter also auto-configures the `PulsarClient` for {apache-pulsar-docs}/concepts-cluster-level-failover/[automatic cluster-level failover].\n\nYou can use the {spring-boot-pulsar-config-props}[`spring.pulsar.client.failover.*`] application properties to configure cluster-level failover.\n\nThe following example configures the client with a primary and two backup clusters.\n\n.application.yml\n[source,yaml,subs=\"attributes,verbatim\"]\n----\nspring:\n pulsar:\n client:\n service-url: \"pulsar://my.primary.server:6650\"\n failover:\n delay: 30s\n switch-back-delay: 15s\n check-interval: 1s\n backup-clusters:\n - service-url: \"pulsar://my.second.server:6650\"\n authentication:\n plugin-class-name: org.apache.pulsar.client.impl.auth.AuthenticationToken\n param:\n token: \"my-token\"\n - service-url: \"pulsar://my.third.server:6650\"\n----\n\nIMPORTANT: In addition to the client configuration, there a {apache-pulsar-docs}/client-libraries-cluster-level-failover/#prerequisites[few prerequisites] on the broker that must be satisfied in order to use this feature.\n\nWhen not using Spring Boot auto-configuration, you can provide a client customizer that configures the client for cluster-level failover.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/pulsar-client.adoc", "title": "pulsar-client", "heading": "Automatic Cluster-Level Failover", "heading_level": 2, "file_order": 16, "section_index": 3, "content_hash": "6c71a0f69cb86a3b960904091b2b4f1c90f275d8e9f4f8450e0a00226c4dd02e", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/pulsar-client.adoc"}}
{"id": "sha256:a2bf65097b4103f385df7d47f798049bbb8a126356519ae0d069c3e31fc944bf", "content": "[[quick-tour]]\n:toc: left\n:toclevels: 6\n:numbered:\n:icons: font\n:hide-uri-scheme:\n:sectnums:\n:sectnumlevels: 3\n\ninclude::attributes-variables.adoc[]\n\nWe will take a quick tour of Spring for Apache Pulsar by showing a sample Spring Boot application that produces and consumes.\nThis is a complete application and does not require any additional configuration, as long as you have a Pulsar cluster running on the default location - `localhost:6650`.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/quick-tour.adoc", "title": "quick-tour", "heading": "quick-tour", "heading_level": 1, "file_order": 17, "section_index": 0, "content_hash": "a2bf65097b4103f385df7d47f798049bbb8a126356519ae0d069c3e31fc944bf", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/quick-tour.adoc"}}
{"id": "sha256:83b7c1e1df020487ec610f75fd7c677d9cb41b57007d3d4478750e2e68ee0089", "content": "Spring Boot applications need only the `spring-boot-starter-pulsar` dependency. The following listings show how to define the dependency for Maven and Gradle, respectively:\n\n[tabs]\n======\nMaven::\n+\n[source,xml,indent=0,subs=\"verbatim,attributes\",role=\"primary\"]\n----\n<dependencies>\n <dependency>\n <groupId>org.springframework.boot</groupId>\n <artifactId>spring-boot-starter-pulsar</artifactId>\n <version>{spring-boot-version}</version>\n </dependency>\n</dependencies>\n----\n\nGradle::\n+\n[source,groovy,indent=0,subs=\"verbatim,attributes\",role=\"secondary\"]\n----\ndependencies {\n implementation 'org.springframework.boot:spring-boot-starter-pulsar:{spring-boot-version}'\n}\n----\n======", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/quick-tour.adoc", "title": "quick-tour", "heading": "Dependencies", "heading_level": 2, "file_order": 17, "section_index": 1, "content_hash": "83b7c1e1df020487ec610f75fd7c677d9cb41b57007d3d4478750e2e68ee0089", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/quick-tour.adoc"}}
{"id": "sha256:692e85710f78f1b485498f58841c07bdc9534de64497fcc811ed0aab171ed3bc", "content": "The following listing shows the Spring Boot application case for the example:\n\n[source,java,indent=0,pending-extract=true,subs=\"verbatim\"]\n----\n@SpringBootApplication\npublic class PulsarBootHelloWorld {\n\n public static void main(String[] args) {\n SpringApplication.run(PulsarBootHelloWorld.class, args);\n }\n\n @Bean\n ApplicationRunner runner(PulsarTemplate<String> pulsarTemplate) {\n return (args) -> pulsarTemplate.send(\"hello-pulsar-topic\", \"Hello Pulsar World!\");\n }\n\n @PulsarListener(subscriptionName = \"hello-pulsar-sub\", topics = \"hello-pulsar-topic\")\n void listen(String message) {\n System.out.println(\"Message Received: \" + message);\n }\n}\n----\n\nLet us quickly go through the higher-level details of this application.\nLater in the documentation we see these components in much more detail.\n\nIn the preceding sample, we heavily rely on Spring Boot auto-configuration.\nSpring Boot auto-configures several components for our application.\nIt automatically provides a `PulsarClient`, which is used by both the producer and the consumer, for the application.\n\nSpring Boot also auto-configures `PulsarTemplate`, which we inject in the application and start sending records to a Pulsar topic.\nThe application sends messages to a topic named `hello-pulsar`.\nNote that the application does not specify any schema information, because Spring for Apache Pulsar library automatically infers the schema type from the type of the data that you send.\n\nWe use the `PulsarListener` annotation to consume from the `hello-pulsar` topic where we publish the data.\n`PulsarListener` is a convenience annotation that wraps the message listener container infrastructure in Spring for Apache Pulsar.\nBehind the scenes, it creates a message listener container to create and manage the Pulsar consumer.\nAs with a regular Pulsar consumer, the default subscription type when using `PulsarListener` is the `Exclusive` mode.\nAs records are published in to the `hello-pulsar` topic, the `Pulsarlistener` consumes them and prints them on the console.\nThe framework also infers the schema type used from the data type that the `PulsarListner` method uses as the payload -- `String`, in this case.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/quick-tour.adoc", "title": "quick-tour", "heading": "Application Code", "heading_level": 2, "file_order": 17, "section_index": 2, "content_hash": "692e85710f78f1b485498f58841c07bdc9534de64497fcc811ed0aab171ed3bc", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/quick-tour.adoc"}}
{"id": "sha256:837d2165b0afcb905766d8f90658e31dc960b97580e1ab0bfbd1145887e917fa", "content": ":toc: left\n:toclevels: 6\n:numbered:\n:icons: font\n:hide-uri-scheme:\n:sectnums:\n:sectnumlevels: 3\n\ninclude::attributes-variables.adoc[]\n\nBy default, Pulsar clients communicate with Pulsar services in plain text.\nThe following section describes how to configure Pulsar clients to use TLS encryption (SSL).\nA pre-requisite is that the Broker has also been configured to use TLS encryption.\n\nThe Spring Boot auto-configuration does not currently support any TLS/SSL configuration properties.\nYou can instead provide a `PulsarClientBuilderCustomizer` that sets the necessary properties on the Pulsar client builder.\nPulsar supports both Privacy Enhanced Mail (PEM) and Java KeyStore (JKS) certificate formats.\n\nFollow these steps to configure TLS:\n\n1. Adjust the Pulsar client service url to use the `pulsar+ssl://` scheme and TLS port (typically `6651`).\n2. Adjust the admin client service url to use the `https://` scheme and TLS web port (typically `8443`).\n3. Provide client builder customizer(s) that sets the relevant properties on the builder.\n - {github}/blob/02730275e8d0291525eed9db5babe880c555a7bd/integration-tests/src/intTest/java/org/springframework/pulsar/inttest/app/SamplePemBasedSslConfig.java#L30-L49[PEM based sample]\n - {github}/blob/02730275e8d0291525eed9db5babe880c555a7bd/integration-tests/src/intTest/java/org/springframework/pulsar/inttest/app/SampleJksBasedSslConfig.java#L30-L57[JKS based sample]\n\nYou can find more information on the above in the official {apache-pulsar-docs}/security-tls-transport/[Pulsar TLS Encryption] documentation.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/tls-encryption.adoc", "title": "tls-encryption", "heading": "tls-encryption", "heading_level": 1, "file_order": 18, "section_index": 0, "content_hash": "837d2165b0afcb905766d8f90658e31dc960b97580e1ab0bfbd1145887e917fa", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/tls-encryption.adoc"}}
{"id": "sha256:63b7f1a496708d168153287cdcdcc9036e56f628bfde95280e9ee3d24d25426c", "content": "[[transactions]]\n\nThis section describes how Spring for Apache Pulsar supports transactions.\n\n[[overview]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/transactions.adoc", "title": "transactions", "heading": "transactions", "heading_level": 1, "file_order": 19, "section_index": 0, "content_hash": "63b7f1a496708d168153287cdcdcc9036e56f628bfde95280e9ee3d24d25426c", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/transactions.adoc"}}
{"id": "sha256:e5100c3cb998c8e54e2376705836ba9a262f012fb8795c98daa8d521a7936aad", "content": "Spring for Apache Pulsar transaction support is built upon the https://docs.spring.io/spring-framework/reference/data-access/transaction.html[transaction support] provided by Spring Framework.\nAt a high-level, transactional resources are registered with a transaction manager which in turn handles the transactional state (commit, rollback, etc..) of the registered resources.\n\nSpring for Apache Pulsar provides the following:\n\n* `PulsarTransactionManager` - used with normal Spring transaction support (`@Transactional`, `TransactionTemplate`, etc)\n* Transactional `PulsarTemplate`\n* Transactional `@PulsarListener`\n* Transaction synchronization with other transaction managers\n\nTransaction support is disabled by default.\nTo enable support when using Spring Boot, simply set the `spring.pulsar.transaction.enabled` property.\nFurther configuration options are outlined in each component section below.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/transactions.adoc", "title": "transactions", "heading": "Overview", "heading_level": 2, "file_order": 19, "section_index": 1, "content_hash": "e5100c3cb998c8e54e2376705836ba9a262f012fb8795c98daa8d521a7936aad", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/transactions.adoc"}}
{"id": "sha256:70130342e18614dd87860689c3779fb0c55cf1c44d549b780200b63ffccd3078", "content": "All send operations on a transactional `PulsarTemplate` look for an active transaction and enlist each send operation in the transaction (if one is found).", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/transactions.adoc", "title": "transactions", "heading": "Transactional Publishing with `PulsarTemplate`", "heading_level": 2, "file_order": 19, "section_index": 2, "content_hash": "70130342e18614dd87860689c3779fb0c55cf1c44d549b780200b63ffccd3078", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/transactions.adoc"}}
{"id": "sha256:c0a4eb42d9377ed122f09f3802ae165251f21bca02ef073945e590498a16d995", "content": "By default, a transactional `PulsarTemplate` can also be used for non-transactional operations.\nWhen an existing transaction is not found it will continue the send operation in a non-transactional fashion.\nHowever, if the template is configured to require transactions then any attempt to use the template outside the scope of a transaction results in an exception.\n\nTIP: A transaction can be started by a `TransactionTemplate`, a `@Transactional` method, calling `executeInTransaction`, or by a transactional listener container.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/transactions.adoc", "title": "transactions", "heading": "Non-transactional use", "heading_level": 3, "file_order": 19, "section_index": 3, "content_hash": "c0a4eb42d9377ed122f09f3802ae165251f21bca02ef073945e590498a16d995", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/transactions.adoc"}}
{"id": "sha256:62a1e4746c496be7faa5e1648db37c393612d10363e9afd2625ecec7993b8e9d", "content": "We use the term \"local\" transaction to denote a Pulsar native transaction that is *not managed* by or associated with Spring's transaction management facility (i.e. `PulsarTransactionManager`).\nConversely, a \"synchronized\" transaction is one that *is managed* by or associated with the `PulsarTransactionManager`.\n\nYou can use the `PulsarTemplate` to execute a series of operations within a local transaction.\nThe following example shows how to do so:\n\n[source, java]\n----\nvar results = pulsarTemplate.executeInTransaction((template) -> {\n var rv = new HashMap<String, MessageId>();\n rv.put(\"msg1\", template.send(topic, \"msg1\"));\n rv.put(\"msg2\", template.send(topic, \"msg2\"));\n return rv;\n});\n----\n\nThe argument in the callback is the template instance that the `executeInTransaction` method was invoked on.\nAll operations on the template are enlisted in the current transaction.\nIf the callback exits normally, the transaction is committed.\nIf an exception is thrown, the transaction is rolled back.\n\nNOTE: If there is a synchronized transaction in process, it is ignored and a new \"nested\" transaction is used.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/transactions.adoc", "title": "transactions", "heading": "Local Transactions", "heading_level": 3, "file_order": 19, "section_index": 4, "content_hash": "62a1e4746c496be7faa5e1648db37c393612d10363e9afd2625ecec7993b8e9d", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/transactions.adoc"}}
{"id": "sha256:aa2e3e27d7c4955bdf16748c5f0d779770fc70be3c62799110a100b0c4a9ab62", "content": "The following transaction settings are available directly on the `PulsarTemplate` (via the `transactions` field):\n\n* `enabled` - whether the template supports transactions (default `false`)\n\n* `required` - whether the template requires transactions (default `false`)\n\n* `timeout` - duration of the transaction timeout (default `null`)\n\nWhen not using Spring Boot, you can adjust these settings on the template that you provide.\nHowever, when using Spring Boot, the template is auto-configured and there is no mechanism to affect the properties.\nIn this case you can register a `PulsarTemplateCustomizer` bean that can be used to adjust the settings.\nThe following example shows how to set the timeout on the auto-configured template:\n\n[source, java]\n----\n@Bean\nPulsarTemplateCustomizer<?> templateCustomizer() {\n return (template) -> template.transactions().setTimeout(Duration.ofSeconds(45));\n}\n----", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/transactions.adoc", "title": "transactions", "heading": "Configuration", "heading_level": 3, "file_order": 19, "section_index": 5, "content_hash": "aa2e3e27d7c4955bdf16748c5f0d779770fc70be3c62799110a100b0c4a9ab62", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/transactions.adoc"}}
{"id": "sha256:3c01af278dc7b6a5e244e5a74a810f300962a64ff3d3517eeeac65ce9ba8a38f", "content": "When listener transactions are enabled, the `@PulsarListener` annotated listener method is invoked in the scope of a synchronized transaction.\n\nThe `DefaultPulsarMessageListenerContainer` uses a Spring `TransactionTemplate` configured with a `PulsarTransactionManager` to initiate the transaction prior to method invocation.\n\nThe acknowledgment of each received message is enlisted in the scoped transaction.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/transactions.adoc", "title": "transactions", "heading": "Transactional Receiving with `@PulsarListener`", "heading_level": 2, "file_order": 19, "section_index": 6, "content_hash": "3c01af278dc7b6a5e244e5a74a810f300962a64ff3d3517eeeac65ce9ba8a38f", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/transactions.adoc"}}
{"id": "sha256:5ca4db75ed249a25afc9e9374b53e3a571e9737192a7cbd407c04c2524c359ff", "content": "A common transactional pattern is where a consumer reads messages from a Pulsar topic, transforms the messages, and finally a producer writes the resulting messages to another Pulsar topic.\nThe framework supports this use case when transactions are enabled and your listener method uses a transactional `PulsarTemplate` to produce the transformed message.\n\nGiven the following listener method:\n[source, java]\n----\n@PulsarListener(topics = \"my-input-topic\") // <1>\nvoid listen(String msg) { // <2>\n var transformedMsg = msg.toUpperCase(Locale.ROOT); // <3>\n this.transactionalTemplate.send(\"my-output-topic\", transformedMsg); // <4>\n} // <5> <6>\n----\nThe following interactions occur when listener transactions are enabled:\n\n<1> Listener container initiates new transaction and invokes listener method in scope of transaction\n<2> Listener method receives message\n<3> Listener method transforms message\n<4> Listener method sends transformed message with transactional template which enlists send operation in active transaction\n<5> Listener container auto-acks message and enlists ack operation in active transaction\n<6> Listener container (via `TransactionTemplate`) commits transaction\n\nIf you are not using `@PulsarListener` and instead using listener containers directly, the same transaction support is provided as described above.\nRemember, the `@PulsarListener` is just a convenience to register a Java method as the listener container message listener.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/transactions.adoc", "title": "transactions", "heading": "Consume-Process-Produce Scenario", "heading_level": 3, "file_order": 19, "section_index": 7, "content_hash": "5ca4db75ed249a25afc9e9374b53e3a571e9737192a7cbd407c04c2524c359ff", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/transactions.adoc"}}
{"id": "sha256:96e667d9b96055e6f5c3babc45dc4553e9b0367f17ac308e1d28393e6efb1811", "content": "The above example uses a record listener.\nWhen using a record listener, a new transaction is created on every listener method invocation which equates to a transaction per message.\n\nNOTE: Because the transaction boundary is per message and each message acknowledgement is enlisted in each transaction, batch ack mode can not be used with transactional record listeners.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/transactions.adoc", "title": "transactions", "heading": "Transactions with Record Listeners", "heading_level": 3, "file_order": 19, "section_index": 8, "content_hash": "96e667d9b96055e6f5c3babc45dc4553e9b0367f17ac308e1d28393e6efb1811", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/transactions.adoc"}}
{"id": "sha256:c6ad3a088a3b648e455a99cd5518031dac61f81b437b5967c1ce707fbcdab9b1", "content": "When using a batch listener, a new transaction is created on every listener method invocation which equates to a transaction per batch of messages.\n\nNOTE: Transactional batch listeners do not currently support custom error handlers.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/transactions.adoc", "title": "transactions", "heading": "Transactions with Batch Listeners", "heading_level": 3, "file_order": 19, "section_index": 9, "content_hash": "c6ad3a088a3b648e455a99cd5518031dac61f81b437b5967c1ce707fbcdab9b1", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/transactions.adoc"}}
{"id": "sha256:4ed5a9a645782b1a004346dd3447d0c822cb7a3c8abff0507693260a4ef01a3d", "content": "The following transaction settings are available directly on the `PulsarContainerProperties` used by the `ConcurrentPulsarListenerContainerFactory` when creating listener containers.\nThese settings affect all listener containers, including the ones used by `@PulsarListener`.\n\n* `enabled` - whether the container supports transactions (default `false`)\n\n* `required` - whether the container requires transactions (default `false`)\n\n* `timeout` - duration of the transaction timeout (default `null`)\n\n* `transactionDefinition` - a blueprint transaction definition with properties that will be copied to the container's transaction template (default `null`)\n\n* `transactionManager` - the transaction manager used to start transactions\n\nWhen not using Spring Boot, you can adjust these settings on the container factory that you provide.\nHowever, when using Spring Boot, the container factory is auto-configured.\nIn this case you can register a `org.springframework.boot.pulsar.autoconfigure.PulsarContainerFactoryCustomizer<ConcurrentPulsarListenerContainerFactory<?>>` bean to access and customize the container properties.\nThe following example shows how to set the timeout on the container factory:\n\n[source, java]\n----\n@Bean\nPulsarContainerFactoryCustomizer<ConcurrentPulsarListenerContainerFactory<?>> containerCustomizer() {\n return (containerFactory) -> containerFactory.getContainerProperties().transactions().setTimeout(Duration.ofSeconds(45));\n}\n----", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/transactions.adoc", "title": "transactions", "heading": "Listener container factory", "heading_level": 4, "file_order": 19, "section_index": 10, "content_hash": "4ed5a9a645782b1a004346dd3447d0c822cb7a3c8abff0507693260a4ef01a3d", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/transactions.adoc"}}
{"id": "sha256:f3b4f5ea744b0e696e280e34ae65ef98ea96bf86a6ec1cd3918c176b12df3e4d", "content": "By default, each listener respects the transactional settings of its corresponding listener container factory.\nHowever, the user can set the `transactional` attribute on each `@PulsarListener` to override the container factory setting as follows:\n\n* If the container factory has transactions enabled then `transactional = false` will disable transactions for the indiviual listener.\n* If the container factory has transactions enabled and required, then an attempt to set `transactional = false` will result in an exception being thrown stating that transactions are required.\n* If the container factory has transactions disabled then an attempt to set `transactional = true` will be ignored and a warning will be logged.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/transactions.adoc", "title": "transactions", "heading": "`@PulsarListener`", "heading_level": 4, "file_order": 19, "section_index": 11, "content_hash": "f3b4f5ea744b0e696e280e34ae65ef98ea96bf86a6ec1cd3918c176b12df3e4d", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/transactions.adoc"}}
{"id": "sha256:715ece2a0aaf78a0278932dc96ea64bcd9dd80f3a096669a59abe8ca50f597bf", "content": "The `PulsarTransactionManager` is an implementation of Spring Framework's `PlatformTransactionManager`.\nYou can use the `PulsarTransactionManager` with normal Spring transaction support (`@Transactional`, `TransactionTemplate`, and others).\n\nIf a transaction is active, any `PulsarTemplate` operations performed within the scope of the transaction enlist and participate in the ongoing transaction.\nThe manager commits or rolls back the transaction, depending on success or failure.\n\nTIP: You probably will not need to use `PulsarTransactionManager` directly since the majority of transactional use cases are covered by `PulsarTemplate` and `@PulsarListener`.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/transactions.adoc", "title": "transactions", "heading": "Using `PulsarTransactionManager`", "heading_level": 2, "file_order": 19, "section_index": 12, "content_hash": "715ece2a0aaf78a0278932dc96ea64bcd9dd80f3a096669a59abe8ca50f597bf", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/transactions.adoc"}}
{"id": "sha256:7c3e26ac51946fdd8e4062f4d6e9e9b819f3798029838c683775baf03a9f8920", "content": "If you want to send records to Pulsar and perform some database updates in a single transaction, you can use normal Spring transaction management with a `DataSourceTransactionManager`.\n\nNOTE: The following examples assume there is a `DataSourceTransactionManager` bean registered under the name \"dataSourceTransactionManager\"\n\n[source, java]\n----\n@Transactional(\"dataSourceTransactionManager\")\npublic void myServiceMethod() {\n var msg = calculateMessage();\n this.pulsarTemplate.send(\"my-topic\", msg);\n this.jdbcTemplate.execute(\"insert into my_table (data) values ('%s')\".formatted(msg));\n}\n----\n\nThe interceptor for the `@Transactional` annotation starts the database transaction and the `PulsarTemplate` will synchronize a transaction with the DB transaction manager; each send will participate in that transaction.\nWhen the method exits, the database transaction will commit followed by the Pulsar transaction.\n\nIf you wish to commit the Pulsar transaction first, and only commit the DB transaction if the Pulsar transaction is successful, use nested `@Transactional` methods, with the outer method configured to use the `DataSourceTransactionManager`, and the inner method configured to use the `PulsarTransactionManager`.\n\n[source, java]\n----\n@Transactional(\"dataSourceTransactionManager\")\npublic void myServiceMethod() {\n var msg = calculateMessage();\n this.jdbcTemplate.execute(\"insert into my_table (data) values ('%s')\".formatted(msg));\n this.sendToPulsar(msg);\n}\n\n@Transactional(\"pulsarTransactionManager\")\npublic void sendToPulsar(String msg) {\n this.pulsarTemplate.send(\"my-topic\", msg);\n}\n----", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/transactions.adoc", "title": "transactions", "heading": "Producer-only transaction", "heading_level": 3, "file_order": 19, "section_index": 13, "content_hash": "7c3e26ac51946fdd8e4062f4d6e9e9b819f3798029838c683775baf03a9f8920", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/transactions.adoc"}}
{"id": "sha256:17715a4274432361c7d03241940c2c97e48a93d30fa386e5fb574584343a353c", "content": "If you want to consume records from Pulsar, send records to Pulsar, and perform some database updates in a transaction, you can combine normal Spring transaction management (using a `DataSourceTransactionManager`) with container initiated transactions.\n\nIn the following example, the listener container starts the Pulsar transaction and the `@Transactional` annotation starts the DB transaction.\nThe DB transaction is committed first; if the Pulsar transaction fails to commit, the record will be redelivered so the DB update should be idempotent.\n\n[source,java]\n----\n@PulsarListener(topics = \"my-input-topic\")\n@Transactional(\"dataSourceTransactionManager\")\nvoid listen(String msg) {\n var transformedMsg = msg.toUpperCase(Locale.ROOT);\n this.pulsarTemplate.send(\"my-output-topic\", transformedMsg);\n this.jdbcTemplate.execute(\"insert into my_table (data) values ('%s')\".formatted(transformedMsg));\n}\n----", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar/transactions.adoc", "title": "transactions", "heading": "Consumer + Producer transaction", "heading_level": 3, "file_order": 19, "section_index": 14, "content_hash": "17715a4274432361c7d03241940c2c97e48a93d30fa386e5fb574584343a353c", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar/transactions.adoc"}}
{"id": "sha256:6732c9d7847345bc4f5fa5952d74e885db947c9471cb0fd73cb92f3d0ff3f7fb", "content": "[source,java,subs=\"attributes,verbatim\"]\n----\n@PulsarListener(subscriptionName = \"user-sub\", topics = \"user-topic\")\npublic void listen(User user) {\n System.out.println(user);\n}\n----", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/schema-info/PulsarListener/listener-snippet.adoc", "title": "listener-snippet", "heading": "listener-snippet", "heading_level": 1, "file_order": 20, "section_index": 0, "content_hash": "6732c9d7847345bc4f5fa5952d74e885db947c9471cb0fd73cb92f3d0ff3f7fb", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/schema-info/PulsarListener/listener-snippet.adoc"}}
{"id": "sha256:217c811eba6c15eb5c998db7f8cf831501a2abec3abc85927603d452828bd3b1", "content": "[source,java,subs=\"attributes,verbatim\"]\n----\nvoid sendUserAsBytes(PulsarTemplate<byte[]> template, byte[] userAsBytes) {\n\ttemplate.send(\"user-topic\", userAsBytes, Schema.AUTO_PRODUCE_BYTES());\n}\n----", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/schema-info/PulsarTemplate/template-snippet.adoc", "title": "template-snippet", "heading": "template-snippet", "heading_level": 1, "file_order": 21, "section_index": 0, "content_hash": "217c811eba6c15eb5c998db7f8cf831501a2abec3abc85927603d452828bd3b1", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/schema-info/PulsarTemplate/template-snippet.adoc"}}
{"id": "sha256:362c65792e1b96aaeb8e34c0e4230528773543d3aa4ff180d2180488f9b26023", "content": "Another option for specifying default schema information to use for a particular message type is to mark the message class with the `@PulsarMessage` annotation.\nThe schema info can be specified via the `schemaType` attribute on the annotation.\n\nThe following example configures the system to use JSON as the default schema when producing or consuming messages of type `Foo`:\n\n[source,java,indent=0,subs=\"verbatim\"]\n----\n@PulsarMessage(schemaType = SchemaType.JSON)\nrecord Foo(String value) {\n}\n----", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/schema-info/custom-schema-mapping-annotation.adoc", "title": "custom-schema-mapping-annotation", "heading": "Type mapping annotation", "heading_level": 2, "file_order": 22, "section_index": 0, "content_hash": "362c65792e1b96aaeb8e34c0e4230528773543d3aa4ff180d2180488f9b26023", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/schema-info/custom-schema-mapping-annotation.adoc"}}
{"id": "sha256:c266650098d12c3345b7d4bf0fecc75eb32378fb3343c3a1ab53e4426b3be686", "content": "Schema mappings can be configured with the `spring.pulsar.defaults.type-mappings` property.\nThe following example uses `application.yml` to add mappings for the `User` and `Address` complex objects using `AVRO` and `JSON` schemas, respectively:\n\n[source,yaml,indent=0,subs=\"verbatim\"]\n----\nspring:\n pulsar:\n defaults:\n type-mappings:\n - message-type: com.acme.User\n schema-info:\n schema-type: AVRO\n - message-type: com.acme.Address\n schema-info:\n schema-type: JSON\n----\n\nNOTE: The `message-type` is the fully-qualified name of the message class.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/schema-info/custom-schema-mapping.adoc", "title": "custom-schema-mapping", "heading": "Configuration properties", "heading_level": 4, "file_order": 23, "section_index": 0, "content_hash": "c266650098d12c3345b7d4bf0fecc75eb32378fb3343c3a1ab53e4426b3be686", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/schema-info/custom-schema-mapping.adoc"}}
{"id": "sha256:b1cec61d8fd85729e23fb0fb16f1cff72e0bd45e37f689674195a9a033047baa", "content": "The preferred method of adding mappings is via the property mentioned above.\nHowever, if more control is needed you can provide a schema resolver customizer to add the mapping(s).\n\nThe following example uses a schema resolver customizer to add mappings for the `User` and `Address` complex objects using `AVRO` and `JSON` schemas, respectively:\n\n[source, java]\n----\n@Bean\npublic SchemaResolverCustomizer<DefaultSchemaResolver> schemaResolverCustomizer() {\n\treturn (schemaResolver) -> {\n schemaResolver.addCustomSchemaMapping(User.class, Schema.AVRO(User.class));\n schemaResolver.addCustomSchemaMapping(Address.class, Schema.JSON(Address.class));\n\t}\n}\n----", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/schema-info/custom-schema-mapping.adoc", "title": "custom-schema-mapping", "heading": "Schema resolver customizer", "heading_level": 4, "file_order": 23, "section_index": 1, "content_hash": "b1cec61d8fd85729e23fb0fb16f1cff72e0bd45e37f689674195a9a033047baa", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/schema-info/custom-schema-mapping.adoc"}}
{"id": "sha256:3bf3907c70eace7739e58bd87acd6fc2e821f8c1ca203c4f560aa89b23e6b75b", "content": "As indicated earlier, for Java primitives, the Spring for Apache Pulsar framework can infer the proper Schema to use on the `{listener-class}`.\nFor non-primitive types, if the Schema is not explicitly specified on the annotation, the Spring for Apache Pulsar framework will try to build a `Schema.JSON` from the type.\n\nIMPORTANT: Complex Schema types that are currently supported are JSON, AVRO, PROTOBUF, AUTO_CONSUME, KEY_VALUE w/ INLINE encoding.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/schema-info/schema-info-listener.adoc", "title": "schema-info-listener", "heading": "Specifying Schema Information", "heading_level": 2, "file_order": 24, "section_index": 0, "content_hash": "3bf3907c70eace7739e58bd87acd6fc2e821f8c1ca203c4f560aa89b23e6b75b", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/schema-info/schema-info-listener.adoc"}}
{"id": "sha256:d949bcd434d0984eb94f3a155034cee64adc07a6d1075637eb14b1d373a1da56", "content": "As an alternative to specifying the schema on the `{listener-class}` for complex types, the schema resolver can be configured with mappings for the types.\nThis removes the need to set the schema on the listener as the framework consults the resolver using the incoming message type.\n\n==== Configuration properties\nSchema mappings can be configured with the `spring.pulsar.defaults.type-mappings` property.\nThe following example uses `application.yml` to add mappings for the `User` and `Address` complex objects using `AVRO` and `JSON` schemas, respectively:\n\n[source,yaml,indent=0,subs=\"verbatim\"]\n----\nspring:\n  pulsar:\n    defaults:\n      type-mappings:\n        - message-type: com.acme.User\n          schema-info:\n            schema-type: AVRO\n        - message-type: com.acme.Address\n          schema-info:\n            schema-type: JSON\n----\n\nNOTE: The `message-type` is the fully-qualified name of the message class.\n\n==== Schema resolver customizer\nThe preferred method of adding mappings is via the property mentioned above.\nHowever, if more control is needed you can provide a schema resolver customizer to add the mapping(s).\n\nThe following example uses a schema resolver customizer to add mappings for the `User` and `Address` complex objects using `AVRO` and `JSON` schemas, respectively:\n\n[source, java]\n----\n@Bean\npublic SchemaResolverCustomizer<DefaultSchemaResolver> schemaResolverCustomizer() {\n\treturn (schemaResolver) -> {\n\t\tschemaResolver.addCustomSchemaMapping(User.class, Schema.AVRO(User.class));\n\t\tschemaResolver.addCustomSchemaMapping(Address.class, Schema.JSON(Address.class));\n\t}\n}\n----\n\n[[listener-default-schema-annotation]]\n== Type mapping annotation\n\nAnother option for specifying default schema information to use for a particular message type is to mark the message class with the `@PulsarMessage` annotation.\nThe schema info can be specified via the `schemaType` attribute on the annotation.\n\nThe following example configures the system to use JSON as the default schema when producing or consuming messages of type `Foo`:\n\n[source,java,indent=0,subs=\"verbatim\"]\n----\n@PulsarMessage(schemaType = SchemaType.JSON)\nrecord Foo(String value) {\n}\n----\n\nWith this configuration in place, there is no need to set the schema on the listener, for example:\n\ninclude::{listener-class}/listener-snippet.adoc[]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/schema-info/schema-info-listener.adoc", "title": "schema-info-listener", "heading": "Custom Schema Mapping", "heading_level": 3, "file_order": 24, "section_index": 1, "content_hash": "d949bcd434d0984eb94f3a155034cee64adc07a6d1075637eb14b1d373a1da56", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/schema-info/schema-info-listener.adoc"}}
{"id": "sha256:fd4d913456c634bf7203f1bd0d4a9e043e1307024c3a025363a53f404d350a94", "content": ":spring-boot-version: current\n:spring-framework-version: current\n:spring-cloud-stream-version: current\n:spring-pulsar-version: current\n:pulsar-client-version: current\n:pulsar-client-version-family: current\n:is-snapshot-version:  false\n\n:github: https://github.com/spring-projects/spring-pulsar\n:javadocs: https://docs.spring.io/spring-pulsar/docs/{spring-pulsar-version}/api\n:spring-framework-docs: https://spring.io/projects/spring-framework#learn\n:spring-boot-docs: https://docs.spring.io/spring-boot/{spring-boot-version}\n:spring-boot-pulsar-config-props: {spring-boot-docs}/appendix/application-properties/index.html#appendix.application-properties.integration\n:spring-cloud-stream-docs: https://docs.spring.io/spring-cloud-stream/docs/{spring-cloud-stream-version}/reference/html/\n:spring-cloud-function: https://spring.io/projects/spring-cloud-function\n\n:apache-pulsar-docs: https://pulsar.apache.org/docs/{pulsar-client-version-family}\n:apache-pulsar-cient-docs: {apache-pulsar-docs}/client-libraries-java\n:apache-pulsar-io-docs: {apache-pulsar-docs}/io-connectors\n:apache-pulsar-function-docs: {apache-pulsar-docs}/functions-overview", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/schema-info/schema-info-template.adoc", "title": "schema-info-template", "heading": "schema-info-template", "heading_level": 1, "file_order": 25, "section_index": 0, "content_hash": "fd4d913456c634bf7203f1bd0d4a9e043e1307024c3a025363a53f404d350a94", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/schema-info/schema-info-template.adoc"}}
{"id": "sha256:ce37113b51a143dd5d07f66db6c07d7d9c46f8d10b55c763f965ea68a4674151", "content": "If you use Java primitive types, the framework auto-detects the schema for you, and you need not specify any schema types for publishing the data.\nFor non-primitive types, if the Schema is not explicitly specified when invoking send operations on the `{template-class}`, the Spring for Apache Pulsar framework will try to build a `Schema.JSON` from the type.\n\nIMPORTANT: Complex Schema types that are currently supported are JSON, AVRO, PROTOBUF, AUTO_PRODUCE_BYTES, and KEY_VALUE w/ INLINE encoding.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/schema-info/schema-info-template.adoc", "title": "schema-info-template", "heading": "Specifying Schema Information", "heading_level": 2, "file_order": 25, "section_index": 1, "content_hash": "ce37113b51a143dd5d07f66db6c07d7d9c46f8d10b55c763f965ea68a4674151", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/schema-info/schema-info-template.adoc"}}
{"id": "sha256:02d965de32fff8678ca4527fa88862b26ff066242e480843569594bf181de4ff", "content": "As an alternative to specifying the schema when invoking send operations on the `{template-class}` for complex types, the schema resolver can be configured with mappings for the types.\nThis removes the need to specify the schema as the framework consults the resolver using the outgoing message type.\n\n==== Configuration properties\nSchema mappings can be configured with the `spring.pulsar.defaults.type-mappings` property.\nThe following example uses `application.yml` to add mappings for the `User` and `Address` complex objects using `AVRO` and `JSON` schemas, respectively:\n\n[source,yaml,indent=0,subs=\"verbatim\"]\n----\nspring:\n  pulsar:\n    defaults:\n      type-mappings:\n        - message-type: com.acme.User\n          schema-info:\n            schema-type: AVRO\n        - message-type: com.acme.Address\n          schema-info:\n            schema-type: JSON\n----\n\nNOTE: The `message-type` is the fully-qualified name of the message class.\n\n==== Schema resolver customizer\nThe preferred method of adding mappings is via the property mentioned above.\nHowever, if more control is needed you can provide a schema resolver customizer to add the mapping(s).\n\nThe following example uses a schema resolver customizer to add mappings for the `User` and `Address` complex objects using `AVRO` and `JSON` schemas, respectively:\n\n[source, java]\n----\n@Bean\npublic SchemaResolverCustomizer<DefaultSchemaResolver> schemaResolverCustomizer() {\n\treturn (schemaResolver) -> {\n\t\tschemaResolver.addCustomSchemaMapping(User.class, Schema.AVRO(User.class));\n\t\tschemaResolver.addCustomSchemaMapping(Address.class, Schema.JSON(Address.class));\n\t}\n}\n----\n\n[[template-default-schema-annotation]]\n== Type mapping annotation\n\nAnother option for specifying default schema information to use for a particular message type is to mark the message class with the `@PulsarMessage` annotation.\nThe schema info can be specified via the `schemaType` attribute on the annotation.\n\nThe following example configures the system to use JSON as the default schema when producing or consuming messages of type `Foo`:\n\n[source,java,indent=0,subs=\"verbatim\"]\n----\n@PulsarMessage(schemaType = SchemaType.JSON)\nrecord Foo(String value) {\n}\n----\n\nWith this configuration in place, there is no need to set specify the schema on send operations.\n\n[[template-auto-produce]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/schema-info/schema-info-template.adoc", "title": "schema-info-template", "heading": "Custom Schema Mapping", "heading_level": 3, "file_order": 25, "section_index": 2, "content_hash": "02d965de32fff8678ca4527fa88862b26ff066242e480843569594bf181de4ff", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/schema-info/schema-info-template.adoc"}}
{"id": "sha256:f990e704be71cfb562aae7f21f3fa5e5a809428c2afbd4a2bf52aec29a12002b", "content": "If there is no chance to know the type of schema of a Pulsar topic in advance, you can use an {apache-pulsar-docs}/schema-get-started/#auto_produce[AUTO_PRODUCE] schema to publish a raw JSON or Avro payload as a `byte[]` safely.\n\nIn this case, the producer validates whether the outbound bytes are compatible with the schema of the destination topic.\n\nSimply specify a schema of `Schema.AUTO_PRODUCE_BYTES()` on your template send operations as shown in the example below:\n\ninclude::{template-class}/template-snippet.adoc[]\n\nNOTE: This is only supported with Avro and JSON schema types.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/schema-info/schema-info-template.adoc", "title": "schema-info-template", "heading": "Producing with AUTO_SCHEMA", "heading_level": 3, "file_order": 25, "section_index": 3, "content_hash": "f990e704be71cfb562aae7f21f3fa5e5a809428c2afbd4a2bf52aec29a12002b", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/schema-info/schema-info-template.adoc"}}
{"id": "sha256:7c979824683e8bc0a99207617b4c5e86fa42084ef29d4c4440db39b64f6d955c", "content": "[[custom-object-mapper]]\n:spring-boot-version: current\n:spring-framework-version: current\n:spring-cloud-stream-version: current\n:spring-pulsar-version: current\n:pulsar-client-version: current\n:pulsar-client-version-family: current\n:is-snapshot-version:  false\n\n:github: https://github.com/spring-projects/spring-pulsar\n:javadocs: https://docs.spring.io/spring-pulsar/docs/{spring-pulsar-version}/api\n:spring-framework-docs: https://spring.io/projects/spring-framework#learn\n:spring-boot-docs: https://docs.spring.io/spring-boot/{spring-boot-version}\n:spring-boot-pulsar-config-props: {spring-boot-docs}/appendix/application-properties/index.html#appendix.application-properties.integration\n:spring-cloud-stream-docs: https://docs.spring.io/spring-cloud-stream/docs/{spring-cloud-stream-version}/reference/html/\n:spring-cloud-function: https://spring.io/projects/spring-cloud-function\n\n:apache-pulsar-docs: https://pulsar.apache.org/docs/{pulsar-client-version-family}\n:apache-pulsar-cient-docs: {apache-pulsar-docs}/client-libraries-java\n:apache-pulsar-io-docs: {apache-pulsar-docs}/io-connectors\n:apache-pulsar-function-docs: {apache-pulsar-docs}/functions-overview\n\nPulsar uses an internal shaded Jackson `ObjectMapper` when de/serializing JSON messages.\nIf you instead want to provide your own Jackson 2 object mapper instance, you can register a `SchemaResolverCustomizer` and set your mapper on the `DefaultSchemaResolver` as follows:\n\n[source,java,indent=0,subs=\"verbatim\"]\n----\n@Bean\nSchemaResolverCustomizer<DefaultSchemaResolver> schemaResolverCustomizer() {\n return (DefaultSchemaResolver schemaResolver) -> {\n var myObjectMapper = obtainMyObjectMapper();\n schemaResolver.setObjectMapper(myObjectMapper);\n };\n}\n----\n\nIMPORTANT: The object mapper in the example above should be an instance of `com.fasterxml.jackson.databind.ObjectMapper`, **not** the shaded `org.apache.pulsar.shade.com.fasterxml.jackson.databind.ObjectMapper`.\n\nThis results in your object mapper being used to de/serialize all JSON messages that go through the schema resolution process (i.e. in cases where you do not pass a schema in directly when producing/consuming messages).\n\nUnder the hood, the resolver creates a special JSON schema which leverages the custom mapper and is used as the schema for all resolved JSON messages.\n\nIf you need to pass schema instances directly you can use the `JSONSchemaUtil` to create schemas that respect the custom mapper.\nThe following example shows how to do this when sending a message with the `PulsarTemplate` variant that takes a schema parameter:\n\n[source,java,indent=0,subs=\"verbatim\"]\n----\nvoid sendMessage(PulsarTemplate<MyPojo> template, MyPojo toSend) {\n var myObjectMapper = obtainMyObjectMapper();\n var schema = JSONSchemaUtil.schemaForTypeWithObjectMapper(MyPojo.class, myObjectMapper);\n template.send(toSend, schema);\n}\n----\n\n[CAUTION]\n====\nPulsar configures its default object mapper in a particular way.\nUnless you have a specific reason to not do so, it is highly recommended that you configure your mapper with these same options as follows:\n[source,java,indent=0,subs=\"verbatim\"]\n----\nmyObjectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);\nmyObjectMapper.configure(DeserializationFeature.READ_UNKNOWN_ENUM_VALUES_AS_NULL, false);\nmyObjectMapper.setSerializationInclusion(JsonInclude.Include.NON_NULL);\n----\n\n====\nNOTE: A later version of the framework may instead provide a customizer that operates on the default mapper rather than requiring a separate instance.\n\n[[jackson2vs3]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/custom-object-mapper.adoc", "title": "custom-object-mapper", "heading": "custom-object-mapper", "heading_level": 1, "file_order": 26, "section_index": 0, "content_hash": "7c979824683e8bc0a99207617b4c5e86fa42084ef29d4c4440db39b64f6d955c", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/custom-object-mapper.adoc"}}
{"id": "sha256:49ead963776be11e01e94eab137c19e5f3b4884d34c2ca236b47c72419b4f6c7", "content": "In Spring Boot 4 the default version of {spring-boot-docs}/reference/features/json.html#features.json.jackson[Jackson is 3] and is auto-configured via the spring-boot-starter-json module.\nHowever, Spring for Apache Pulsar expects a {spring-boot-docs}/reference/features/json.html#features.json.jackson2[Jackson 2] custom mapper.\n\nIf you are using Jackson 3 in your Spring Boot 4 application and want to use a custom mapper you will need to add Jackson 2 to the classpath.\nDon't worry, Spring Boot 4 allows Jackson 2 and 3 to co-exist in an application.\n\nNOTE: A later version of the framework may support using a Jackson 2 or Jackson 3 custom mapper.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/custom-object-mapper.adoc", "title": "custom-object-mapper", "heading": "Jackson 2 / Jackson 3", "heading_level": 2, "file_order": 26, "section_index": 1, "content_hash": "49ead963776be11e01e94eab137c19e5f3b4884d34c2ca236b47c72419b4f6c7", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/custom-object-mapper.adoc"}}
{"id": "sha256:82ebfefd048c556c2b2b977d5a5453ced3781ab773a3999736bf7afc74814adc", "content": "[[default-tenant-namespace]]\n:toc: left\n:toclevels: 6\n:numbered:\n:icons: font\n:hide-uri-scheme:\n:sectnums:\n:sectnumlevels: 3\n\ninclude::attributes-variables.adoc[]\n\nPulsar has built-in support for {apache-pulsar-docs}/concepts-multi-tenancy/[multi-tenancy].\nWhen producing or consuming messages in Pulsar, the specified topic is actually a topic URL of the following format:\n```\n(persistent|non-persistent)://tenant/namespace/topic\n```\nThe URL dictates which tenant and namespace the operation is targeted against.\nHowever, when not fully-qualified (i.e. only topic name is specified), the default tenant of `public` and namespace of `default` is used.\n\nSpring for Apache Pulsar allows you to specify a default tenant and/or namespace to use when producing or consuming messages against a non-fully-qualified topic URL.\n\n[discrete]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/default-tenant-namespace.adoc", "title": "default-tenant-namespace", "heading": "default-tenant-namespace", "heading_level": 1, "file_order": 27, "section_index": 0, "content_hash": "82ebfefd048c556c2b2b977d5a5453ced3781ab773a3999736bf7afc74814adc", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/default-tenant-namespace.adoc"}}
{"id": "sha256:718d4313b7bcbc9036864ca07726b2aaa0d70c40f7b421d308e76baf9f751ba3", "content": "[discrete]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/default-tenant-namespace.adoc", "title": "default-tenant-namespace", "heading": "Configuration", "heading_level": 2, "file_order": 27, "section_index": 1, "content_hash": "718d4313b7bcbc9036864ca07726b2aaa0d70c40f7b421d308e76baf9f751ba3", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/default-tenant-namespace.adoc"}}
{"id": "sha256:7bedf104b9ea3f8d1e000e46a9cc8fc4d9c5dc68120cec1034a17ab46c3a577d", "content": "When using the Spring Boot you can simply set the {spring-boot-pulsar-config-props}[`spring.pulsar.defaults.topic.tenant`] and {spring-boot-pulsar-config-props}[`spring.pulsar.defaults.topic.namespace`] application properties to specify these defaults.\n\nIf you want to disable this feature, simply set the `spring.pulsar.defaults.topic.enabled` property to `false`.\n\n[discrete]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/default-tenant-namespace.adoc", "title": "default-tenant-namespace", "heading": "With Spring Boot", "heading_level": 3, "file_order": 27, "section_index": 2, "content_hash": "7bedf104b9ea3f8d1e000e46a9cc8fc4d9c5dc68120cec1034a17ab46c3a577d", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/default-tenant-namespace.adoc"}}
{"id": "sha256:3c969465562206164867e38bb28c2ccb2e438ea701ebfcf0e746cd95dbc19714", "content": "However, if you are instead manually configuring the components, you will have to provide a `PulsarTopicBuilder` configured with the desired default topic and namespace when constructing the corresponding producer or consumer factory.\nAll default consumer/reader/producer factory implementations allow a topic builder to be specified.\n\n[NOTE]\nYou will need to specify the topic builder on each manually configured factory that you want to use the default tenant/namespace", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/default-tenant-namespace.adoc", "title": "default-tenant-namespace", "heading": "Without Spring Boot", "heading_level": 3, "file_order": 27, "section_index": 3, "content_hash": "3c969465562206164867e38bb28c2ccb2e438ea701ebfcf0e746cd95dbc19714", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/default-tenant-namespace.adoc"}}
{"id": "sha256:aa6f5ea0120a20e7af5fd5ac158af8e21fc27e52a0dabe31e270d2e3509aa651", "content": ":spring-boot-version: current\n:spring-framework-version: current\n:spring-cloud-stream-version: current\n:spring-pulsar-version: current\n:pulsar-client-version: current\n:pulsar-client-version-family: current\n:is-snapshot-version:  false\n\n:github: https://github.com/spring-projects/spring-pulsar\n:javadocs: https://docs.spring.io/spring-pulsar/docs/{spring-pulsar-version}/api\n:spring-framework-docs: https://spring.io/projects/spring-framework#learn\n:spring-boot-docs: https://docs.spring.io/spring-boot/{spring-boot-version}\n:spring-boot-pulsar-config-props: {spring-boot-docs}/appendix/application-properties/index.html#appendix.application-properties.integration\n:spring-cloud-stream-docs: https://docs.spring.io/spring-cloud-stream/docs/{spring-cloud-stream-version}/reference/html/\n:spring-cloud-function: https://spring.io/projects/spring-cloud-function\n\n:apache-pulsar-docs: https://pulsar.apache.org/docs/{pulsar-client-version-family}\n:apache-pulsar-cient-docs: {apache-pulsar-docs}/client-libraries-java\n:apache-pulsar-io-docs: {apache-pulsar-docs}/io-connectors\n:apache-pulsar-function-docs: {apache-pulsar-docs}/functions-overview\n\nMessage listener containers are started when the application context is refreshed.\nBy default, any failures encountered during startup are re-thrown and the application will fail to start.\nYou can adjust this behavior with the `StartupFailurePolicy` on the corresponding container properties.\n\nThe available options are:\n\n- `Stop` (default) - log and re-throw the exception, effectively stopping the application\n- `Continue` - log the exception, leave the container in a non-running state, but do not stop the application\n- `Retry` - log the exception, retry to start the container asynchronously, but do not stop the application.\n\nThe default retry behavior is to retry 3 times with a 10-second delay between\neach attempt.\nHowever, a custom retry template can be specified on the corresponding container properties.\nIf the container fails to restart after the retries are exhausted, it is left in a non-running state.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/message-listener-startup-failure.adoc", "title": "Handling Startup Failures", "heading": "Handling Startup Failures", "heading_level": 1, "file_order": 28, "section_index": 0, "content_hash": "aa6f5ea0120a20e7af5fd5ac158af8e21fc27e52a0dabe31e270d2e3509aa651", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/message-listener-startup-failure.adoc"}}
{"id": "sha256:dc2094a58f8beeebbfa9ce166098608e9d4790a4613bdf837262e88e5527a7fc", "content": "[discrete]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/message-listener-startup-failure.adoc", "title": "Handling Startup Failures", "heading": "Configuration", "heading_level": 2, "file_order": 28, "section_index": 1, "content_hash": "dc2094a58f8beeebbfa9ce166098608e9d4790a4613bdf837262e88e5527a7fc", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/message-listener-startup-failure.adoc"}}
{"id": "sha256:3f7817548f76a5902062eed5d4af31373b13a661c505ba112c4e65851e9f700a", "content": "When using Spring Boot you can register a `PulsarContainerFactoryCustomizer<{container-class}<?>>` bean that sets the container startup properties.\n\n[discrete]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/message-listener-startup-failure.adoc", "title": "Handling Startup Failures", "heading": "With Spring Boot", "heading_level": 3, "file_order": 28, "section_index": 2, "content_hash": "3f7817548f76a5902062eed5d4af31373b13a661c505ba112c4e65851e9f700a", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/message-listener-startup-failure.adoc"}}
{"id": "sha256:fee56cf71b2a5fb5be7f24bd40324b083169b8360a47273106f4537fd47bb62f", "content": "However, if you are instead manually configuring the components, you will have to update the container startup properties accordingly when constructing the message listener container factory.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/message-listener-startup-failure.adoc", "title": "Handling Startup Failures", "heading": "Without Spring Boot", "heading_level": 3, "file_order": 28, "section_index": 3, "content_hash": "fee56cf71b2a5fb5be7f24bd40324b083169b8360a47273106f4537fd47bb62f", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/message-listener-startup-failure.adoc"}}
{"id": "sha256:4b881fafac2eae33a11a1e4e491d8cc705e77c07ed9e98ba137b53bde887b84d", "content": "[[micrometer]]\n\nSpring for Apache Pulsar includes a way to manage observability through https://micrometer.io/[Micrometer].\n\n[[observation]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/observability.adoc", "title": "observability", "heading": "observability", "heading_level": 1, "file_order": 29, "section_index": 0, "content_hash": "4b881fafac2eae33a11a1e4e491d8cc705e77c07ed9e98ba137b53bde887b84d", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/observability.adoc"}}
{"id": "sha256:c67867ee542a55c73c1db5772f4241fc8ab8b4cc642989af6be876544084f138", "content": "The `PulsarTemplate` and `PulsarListener` are instrumented with the Micrometer observations API.\nWhen a Micrometer `ObservationRegistry` bean is provided, send and receive operations are traced and timed.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/observability.adoc", "title": "observability", "heading": "Micrometer Observations", "heading_level": 2, "file_order": 29, "section_index": 1, "content_hash": "c67867ee542a55c73c1db5772f4241fc8ab8b4cc642989af6be876544084f138", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/observability.adoc"}}
{"id": "sha256:0e0e00541d55d88f60b11924ce284ee68d66950ed7727e2c1599032b26e65185", "content": "The default implementation adds the `bean.name` tag for template observations and `listener.id` tag for listener observations.\nTo add other tags to timers and traces, configure a custom `PulsarTemplateObservationConvention` or `PulsarListenerObservationConvention` to the template or listener container, respectively.\n\nTIP: You can subclass either `DefaultPulsarTemplateObservationConvention` or `DefaultPulsarListenerObservationConvention` or provide completely new implementations.\n\ninclude::partial$_metrics.adoc[]\n\ninclude::partial$_spans.adoc[]\n\nSee {micrometer-docs}/tracing/reference[Micrometer Tracing] for more information.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/observability.adoc", "title": "observability", "heading": "Custom tags", "heading_level": 3, "file_order": 29, "section_index": 2, "content_hash": "0e0e00541d55d88f60b11924ce284ee68d66950ed7727e2c1599032b26e65185", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/observability.adoc"}}
{"id": "sha256:3865f0ab2691af9bd7bcba5db11fe3296f10fc64337335f6073da6a2d61cff22", "content": "If you do not use Spring Boot, you need to configure and provide an `ObservationRegistry` as well as Micrometer Tracing. See {micrometer-docs}/tracing/reference[Micrometer Tracing] for more information.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/observability.adoc", "title": "observability", "heading": "Manual Configuration without Spring Boot", "heading_level": 3, "file_order": 29, "section_index": 3, "content_hash": "3865f0ab2691af9bd7bcba5db11fe3296f10fc64337335f6073da6a2d61cff22", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/observability.adoc"}}
{"id": "sha256:d4404ef20ae8e8f33a13f327203a6e492728d0a1d19e75d4862f860220811c89", "content": "If you use Spring Boot, the Spring Boot Actuator auto-configures an instance of `ObservationRegistry` for you.\nIf `micrometer-core` is on the classpath, every stopped observation leads to a timer.\n\nSpring Boot also auto-configures Micrometer Tracing for you. This includes support for Brave OpenTelemetry, Zipkin, and Wavefront. When using the Micrometer Observation API, finishing observations leads to spans reported to Zipkin or Wavefront. You can control tracing by setting properties under `management.tracing`. You can use Zipkin with `management.zipkin.tracing`, while Wavefront uses `management.wavefront`.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/observability.adoc", "title": "observability", "heading": "Auto-Configuration with Spring Boot", "heading_level": 3, "file_order": 29, "section_index": 4, "content_hash": "d4404ef20ae8e8f33a13f327203a6e492728d0a1d19e75d4862f860220811c89", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/observability.adoc"}}
{"id": "sha256:d779c9cafd55241312286b905519c53dfa371df79277b91a076d65fc9eea006e", "content": "The following example shows the steps to configure your Spring Boot application to use Zipkin with Brave.\n\n. Add the required dependencies to your application (in Maven or Gradle, respectively):\n+\n[tabs]\n======\nMaven::\n+\n[source,xml,indent=0,subs=\"verbatim,attributes\",role=\"primary\"]\n----\n<dependencies>\n <dependency>\n <groupId>org.springframework.boot</groupId>\n <artifactId>spring-boot-starter-actuator</artifactId>\n </dependency>\n <dependency>\n <groupId>io.micrometer</groupId>\n <artifactId>micrometer-tracing-bridge-brave</artifactId>\n </dependency>\n <dependency>\n <groupId>io.zipkin.reporter2</groupId>\n <artifactId>zipkin-reporter-brave</artifactId>\n </dependency>\n <dependency>\n <groupId>io.zipkin.reporter2</groupId>\n <artifactId>zipkin-sender-urlconnection</artifactId>\n </dependency>\n</dependencies>\n----\n======\n+\n[source,groovy,indent=0,subs=\"verbatim,attributes\",role=\"secondary\"]\n.Gradle\n----\ndependencies {\n implementation 'org.springframework.boot:spring-boot-starter-actuator'\n implementation 'io.micrometer:micrometer-tracing-bridge-brave'\n implementation 'io.zipkin.reporter2:zipkin-reporter-brave'\n implementation 'io.zipkin.reporter2:zipkin-sender-urlconnection'\n}\n----\n+\nNOTE\nYou need the `'io.zipkin.reporter2:zipkin-sender-urlconnection'` dependency only if your application does not have a configured WebClient or RestTemplate.\n. Add the required properties to your application:\n+\n[source,yaml,indent=0,subs=\"verbatim\"]\n----\nmanagement:\n tracing.enabled: true\n zipkin:\n tracing.endpoint: \"http://localhost:9411/api/v2/spans\"\n----\n+\nThe `tracing.endpoint` above expects Zipkin is running locally as described https://zipkin.io/pages/quickstart.html[here].\n\nAt this point, your application should record traces when you send and receive Pulsar messages. You should be able to view them in the Zipkin UI (at http://localhost:9411, when running locally).\n\nTIP: You can also see the preceding configuration on the link:{github}/blob/main/spring-pulsar-sample-apps/README.adoc[Spring for Apache Pulsar Sample Apps].\n\nThe steps are very similar to configuring any of the other supported Tracing environments.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/observability.adoc", "title": "observability", "heading": "Example Configuration", "heading_level": 4, "file_order": 29, "section_index": 5, "content_hash": "d779c9cafd55241312286b905519c53dfa371df79277b91a076d65fc9eea006e", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/observability.adoc"}}
{"id": "sha256:3b8a484ebf1e9d4c554bb568b91e24fd03856b6ffd7cdc7524fd5e62b1c4ab74", "content": "[[pulsar-admin]]\n:toc: left\n:toclevels: 6\n:numbered:\n:icons: font\n:hide-uri-scheme:\n:sectnums:\n:sectnumlevels: 3\n\ninclude::attributes-variables.adoc[]\n\n[[pulsar-admin-client]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar-admin.adoc", "title": "pulsar-admin", "heading": "pulsar-admin", "heading_level": 1, "file_order": 30, "section_index": 0, "content_hash": "3b8a484ebf1e9d4c554bb568b91e24fd03856b6ffd7cdc7524fd5e62b1c4ab74", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar-admin.adoc"}}
{"id": "sha256:806a38bdd862d1ae5e956f385046420368efe337bcd6fb17766a122fb72d5dd3", "content": "On the Pulsar administration side, Spring Boot auto-configuration provides a `PulsarAdministration` to manage Pulsar clusters.\nThe administration implements an interface called `PulsarAdminOperations` and provides {javadocs}/org/springframework/pulsar/core/PulsarAdminOperations.html[a `createOrModify` method] to handle topic administration through its contract.\n\nWhen you use the Pulsar Spring Boot starter, you get the `PulsarAdministration` auto-configured.\n\nBy default, the application tries to connect to a local Pulsar instance at `\\http://localhost:8080`.\nThis can be adjusted by setting the `spring.pulsar.admin.service-url` property to a different value in the form `(http|https)://<host>:<port>`.\n\nThere are many application properties available to configure the client.\nSee the {spring-boot-pulsar-config-props}[`spring.pulsar.admin.*`] application properties.\n\n[[pulsar-admin-authentication]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar-admin.adoc", "title": "pulsar-admin", "heading": "Pulsar Admin Client", "heading_level": 2, "file_order": 30, "section_index": 1, "content_hash": "806a38bdd862d1ae5e956f385046420368efe337bcd6fb17766a122fb72d5dd3", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar-admin.adoc"}}
{"id": "sha256:5bceaabc45e4b0d3a609826a3f89c79d0897354201a67ea0369eb4cbc1287337", "content": "When accessing a Pulsar cluster that requires authentication, the admin client requires the same security configuration as the regular Pulsar client.\nYou can use the aforementioned xref:reference/pulsar/pulsar-client.adoc#client-authentication[security configuration] by replacing `spring.pulsar.client` with `spring.pulsar.admin`.\n\n[[pulsar-auto-topic-creation]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar-admin.adoc", "title": "pulsar-admin", "heading": "Authentication", "heading_level": 3, "file_order": 30, "section_index": 2, "content_hash": "5bceaabc45e4b0d3a609826a3f89c79d0897354201a67ea0369eb4cbc1287337", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar-admin.adoc"}}
{"id": "sha256:801f806632b4e54fb4b0cf307f814d2bcf1068d79f0b28edd74acf71ea0212b6", "content": "On initialization, the `PulsarAdministration` checks if there are any `PulsarTopic` beans in the application context.\nFor all such beans, the `PulsarAdministration` either creates the corresponding topic or, if necessary, modifies the number of partitions.\n\nThe following example shows how to add `PulsarTopic` beans to let the `PulsarAdministration` auto-create topics for you:\n\n[source,java,indent=0,subs=\"verbatim\"]\n----\n@Bean\nPulsarTopic simpleTopic(PulsarTopicBuilder topicBuilder) {\n // This will create a non-partitioned persistent topic in the 'public/default' tenant/namespace\n return topicBuilder.name(\"my-topic\").build();\n}\n\n@Bean\nPulsarTopic partitionedTopic(PulsarTopicBuilder topicBuilder) {\n // This will create a persistent topic with 3 partitions in the provided tenant and namespace\n return topicBuilder\n .name(\"persistent://my-tenant/my-namespace/partitioned-topic\")\n .numberOfPartitions(3)\n .build();\n}\n----\n\n[[pulsar-topic-builder]]\n[NOTE]\n====\nWhen using Spring Boot the `PulsarTopicBuilder` is a registered bean that is configured with default values for domain, tenant, and namespace.\nYou can simply inject the builder where needed.\nOtherwise, use one of the `PulsarTopicBuilder` constructors directly.\n====", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar-admin.adoc", "title": "pulsar-admin", "heading": "Automatic Topic Creation", "heading_level": 2, "file_order": 30, "section_index": 3, "content_hash": "801f806632b4e54fb4b0cf307f814d2bcf1068d79f0b28edd74acf71ea0212b6", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar-admin.adoc"}}
{"id": "sha256:3442780a7f838a6355fdf1ef1ec8b1e4fe5760d85b64b33792750e04ddc477f9", "content": "[[pulsar-function]]\n:toc: left\n:toclevels: 6\n:numbered:\n:icons: font\n:hide-uri-scheme:\n:sectnums:\n:sectnumlevels: 3\n\ninclude::attributes-variables.adoc[]\n\nSpring for Apache Pulsar provides basic suppport for {apache-pulsar-io-docs}/[Pulsar IO] (connectors) and {apache-pulsar-function-docs}[Pulsar Functions] which allow users to define stream processing pipelines made up of `sources`, `processors`, and `sinks`.\nThe `sources` and `sinks` are modeled by _Pulsar IO (connectors)_ and the `processors` are represented by _Pulsar Functions_.\n\nNOTE: Because connectors are just special functions, and for simplicity, we refer to sources, sinks and functions collectively as \"Pulsar Functions\".\n\n.Pre-requisites\n****\n\n*Familiarity* - the audience is expected to be somewhat familiar w/ _Pulsar IO_ and _Pulsar Functions_.\nIf that is not the case it may be helpful to see their getting started guides.\n\n*Feature enabled* - to use these features the functions support in Apache Pulsar must be enabled and configured (it is disabled by default).\nThe built-in connectors may also need to be installed on the Pulsar cluster.\n\nSee the {apache-pulsar-io-docs}/[Pulsar IO] and {apache-pulsar-function-docs}[Pulsar Functions] docs for more details.\n****", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar-function.adoc", "title": "pulsar-function", "heading": "pulsar-function", "heading_level": 1, "file_order": 31, "section_index": 0, "content_hash": "3442780a7f838a6355fdf1ef1ec8b1e4fe5760d85b64b33792750e04ddc477f9", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar-function.adoc"}}
{"id": "sha256:63f9225d2430ad43dfc3e1044de9333eb8daea0899375babeb3b6b8a7b4378d7", "content": "The framework provides the `PulsarFunctionAdministration` component to manage Pulsar functions.\nWhen you use the Pulsar Spring Boot starter, you get the `PulsarFunctionAdministration` auto-configured.\n\nBy default, the application tries to connect to a local Pulsar instance at `http://localhost:8080`.\nHowever, because it leverages the already configured `PulsarAdministration`, see xref:reference/pulsar-admin.adoc#pulsar-admin-client[Pulsar Admin Client] for available client options (including authentication).\nAdditional configuration options are available with the {spring-boot-pulsar-config-props}[`spring.pulsar.function.*`] application properties.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar-function.adoc", "title": "pulsar-function", "heading": "Pulsar Function Administration", "heading_level": 2, "file_order": 31, "section_index": 1, "content_hash": "63f9225d2430ad43dfc3e1044de9333eb8daea0899375babeb3b6b8a7b4378d7", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar-function.adoc"}}
{"id": "sha256:b3696eeb7bc4f7bbec23371cfef22cabda6bfc36f9c717197ad8ecdc5702cd57", "content": "On application startup, the framework finds all `PulsarFunction`, `PulsarSink`, and `PulsarSource` beans in the application context.\nFor each bean, the corresponding Pulsar function is either created or updated.\nThe proper API is called based on function type, function config, and whether the function already exists.\n\nNOTE: The `PulsarFunction`, `PulsarSink`, and `PulsarSource` beans are simple wrappers around the Apache Pulsar config objects `FunctionConfig`, `SinkConfig`, and `SourceConfig`, respectively.\nDue to the large number of supported connectors (and their varied configurations) the framework does not attempt to create a configuration properties hierarchy to mirror the varied Apache Pulsar connectors.\nInstead, the burden is on the user to supply the full config object and then the framework handles the management (create/update) using the supplied config.\n\nOn application shutdown, all functions that were processed during application startup have their stop policy enforced and are either left alone, stopped, or deleted from the Pulsar server.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar-function.adoc", "title": "pulsar-function", "heading": "Automatic Function Management", "heading_level": 2, "file_order": 31, "section_index": 2, "content_hash": "b3696eeb7bc4f7bbec23371cfef22cabda6bfc36f9c717197ad8ecdc5702cd57", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar-function.adoc"}}
{"id": "sha256:2e2983e9e9773141c66ade1c84cc586a6baf01d9b474f59eecf25d5daa76fa8b", "content": "Pulsar functions and custom connectors are represented by custom application code (eg. a `java.util.Function`).\nThere is no magic support to automatically register the custom code.\nWhile this would be amazing, it has some technical challenges and not yet been implemented.\nAs such, it is up to the user to ensure the function (or custom connector) is available at the location specified in the function config.\nFor example, if the function config has a `jar` value of `./some/path/MyFunction.jar` then the function jar file must exist at the specified path.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar-function.adoc", "title": "pulsar-function", "heading": "No Magic Pulsar Functions", "heading_level": 3, "file_order": 31, "section_index": 3, "content_hash": "2e2983e9e9773141c66ade1c84cc586a6baf01d9b474f59eecf25d5daa76fa8b", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar-function.adoc"}}
{"id": "sha256:bb1144625a5e4af4fc10a765eef8d6643f12ade9615898527203640cfe59ab6b", "content": "The `name` property from the function config is used as the identifier to determine if a function already exists in order to decide if an update or create operation is performed.\nAs such, the name should not be modified if function updates are desired.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar-function.adoc", "title": "pulsar-function", "heading": "Name Identifier", "heading_level": 3, "file_order": 31, "section_index": 4, "content_hash": "bb1144625a5e4af4fc10a765eef8d6643f12ade9615898527203640cfe59ab6b", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar-function.adoc"}}
{"id": "sha256:7198bc8666ad91297073db8be84dc479aab98f75ece6ee9d0ea85bd4e9f1023c", "content": "Each Pulsar function is represented by an actual archive (eg. jar file).\nThe path to the archive is specified via the `archive` property for sources and sinks, and the `jar` property for functions.\n\nThe following rules determine the \"type\" of path:\n\n* The path is a *URL* when it starts w/ `(file|http|https|function|sink|source)://`\n* The path is *built-in* when it starts w/ `builtin://` (points to one of the provided out-of-the-box connectors)\n* The path is *local* otherwise.\n\nThe action that occurs during the create/update operation is dependent on path \"type\" as follows:\n\n* When the path is a *URL* the content is downloaded by the server\n* When the path is *built-in* the content is already available on the server\n* When the path is *local* the content is uploaded to the server", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar-function.adoc", "title": "pulsar-function", "heading": "Pulsar Function Archive", "heading_level": 3, "file_order": 31, "section_index": 5, "content_hash": "7198bc8666ad91297073db8be84dc479aab98f75ece6ee9d0ea85bd4e9f1023c", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar-function.adoc"}}
{"id": "sha256:62282992210ebfb0b4427f44711a4c0b4d99494adb26dba1a77fbc7936d115e9", "content": "Apache Pulsar provides many source and sink connectors out-of-the-box, aka built-in connectors. To use a built-in connector simply set the `archive` to `builtin://<connector-type>` (eg `builtin://rabbit`).", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar-function.adoc", "title": "pulsar-function", "heading": "Built-in Source and Sinks", "heading_level": 3, "file_order": 31, "section_index": 6, "content_hash": "62282992210ebfb0b4427f44711a4c0b4d99494adb26dba1a77fbc7936d115e9", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar-function.adoc"}}
{"id": "sha256:b696574697b712d8c2ddc9505b8fb9b8208f0c7f2437f7f34c782cdbda502e69", "content": "The details on how to develop and package custom functions can be found in the {apache-pulsar-docs}/functions-develop[Pulsar docs].\nHowever, at a high-level, the requirements are as follows:\n\n* Code uses Java8\n* Code implements either `java.util.Function` or `org.apache.pulsar.functions.api.Function`\n* Packaged as uber jar\n\nOnce the function is built and packaged, there are several ways to make it available for function registration.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar-function.adoc", "title": "pulsar-function", "heading": "Custom functions", "heading_level": 2, "file_order": 31, "section_index": 7, "content_hash": "b696574697b712d8c2ddc9505b8fb9b8208f0c7f2437f7f34c782cdbda502e69", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar-function.adoc"}}
{"id": "sha256:d3f82f83dd5ac36e1de669bfe603877a49e5eec7ccba174bc3db3b8d29d8b43b", "content": "The jar file can be uploaded to the server and then referenced via `file://` in the `jar` property of the function config", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar-function.adoc", "title": "pulsar-function", "heading": "file://", "heading_level": 3, "file_order": 31, "section_index": 8, "content_hash": "d3f82f83dd5ac36e1de669bfe603877a49e5eec7ccba174bc3db3b8d29d8b43b", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar-function.adoc"}}
{"id": "sha256:6d0d2601a822acd8914f3d4f36919f3236352b070271601920407b454a53ff22", "content": "The jar file can remain local and then referenced via the local path in the `jar` property of the function config.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar-function.adoc", "title": "pulsar-function", "heading": "local", "heading_level": 3, "file_order": 31, "section_index": 9, "content_hash": "6d0d2601a822acd8914f3d4f36919f3236352b070271601920407b454a53ff22", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar-function.adoc"}}
{"id": "sha256:3d70e8240f34dad4675d3ece64580941bded28ccd9e3dbb0983e284da79c8b08", "content": "The jar file can be made available via HTTP server and then referenced via `http(s)://` in the `jar` property of the function config", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar-function.adoc", "title": "pulsar-function", "heading": "http://", "heading_level": 3, "file_order": 31, "section_index": 10, "content_hash": "3d70e8240f34dad4675d3ece64580941bded28ccd9e3dbb0983e284da79c8b08", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar-function.adoc"}}
{"id": "sha256:44674c17a6e8876c572f3c423b1b71a13b8a73dfe254c73a5fa98b6f04214b3a", "content": "The jar file can be uploaded to the Pulsar package manager and then referenced via `function://` in the `jar` property of the function config", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar-function.adoc", "title": "pulsar-function", "heading": "function://", "heading_level": 3, "file_order": 31, "section_index": 11, "content_hash": "44674c17a6e8876c572f3c423b1b71a13b8a73dfe254c73a5fa98b6f04214b3a", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar-function.adoc"}}
{"id": "sha256:b4e01fd42281827d8b7b585e084f8c33255eb41c7a8dd1519b8dcf741396fbb0", "content": "Here are some examples that show how to configure a `PulsarSource` bean which results in the `PulsarFunctionAdministration` auto-creating the backing Pulsar source connector.\n\n.PulsarSource using built-in Rabbit connector\n[source,java]\n----\n@Bean\nPulsarSource rabbitSource() {\n Map<String, Object> configs = new HashMap<>();\n configs.put(\"host\", \"my.rabbit.host\");\n configs.put(\"port\", 5672);\n configs.put(\"virtualHost\", \"/\");\n configs.put(\"username\", \"guest\");\n configs.put(\"password\", \"guest\");\n configs.put(\"queueName\", \"test_rabbit\");\n configs.put(\"connectionName\", \"test-connection\");\n SourceConfig sourceConfig = SourceConfig.builder()\n .tenant(\"public\")\n .namespace(\"default\")\n .name(\"rabbit-test-source\")\n .archive(\"builtin://rabbitmq\")\n .topicName(\"incoming_rabbit\")\n .configs(configs).build();\n return new PulsarSource(sourceConfig, null);\n}\n----\n\nThis next example is the same as the previous, except that it uses the Spring Boot auto-configured `RabbitProperties` to ease the configuration burden. This of course requires the application to be using Spring Boot with Rabbit auto-configuration enabled.\n\n.PulsarSource using built-in Rabbit connector and Spring Boot RabbitProperties\n[source,java]\n----\n@Bean\nPulsarSource rabbitSourceWithBootProps(RabbitProperties props) {\n Map<String, Object> configs = new HashMap<>();\n configs.put(\"host\", props.determineHost());\n configs.put(\"port\", props.determinePort());\n configs.put(\"virtualHost\", props.determineVirtualHost());\n configs.put(\"username\", props.determineUsername());\n configs.put(\"password\", props.determinePassword());\n configs.put(\"queueName\", \"test_rabbit\");\n configs.put(\"connectionName\", \"test-connection\");\n SourceConfig sourceConfig = SourceConfig.builder()\n .tenant(\"public\")\n .namespace(\"default\")\n .name(\"rabbit-test-source\")\n .archive(\"builtin://rabbitmq\")\n .topicName(\"incoming_rabbit\")\n .configs(configs).build();\n return new PulsarSource(sourceConfig, null);\n}\n----\n\nTIP: For a more elaborate example see the link:{github}/blob/main/spring-pulsar-sample-apps/sample-pulsar-functions/README.adoc[Sample Stream Pipeline with Pulsar Functions] sample app", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar-function.adoc", "title": "pulsar-function", "heading": "Examples", "heading_level": 2, "file_order": 31, "section_index": 12, "content_hash": "b4e01fd42281827d8b7b585e084f8c33255eb41c7a8dd1519b8dcf741396fbb0", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar-function.adoc"}}
{"id": "sha256:bbcac1dff08fcc34c029ca2a0f481f54c9ea989be2796c8974ff146040a7be13", "content": ":spring-boot-version: current\n:spring-framework-version: current\n:spring-cloud-stream-version: current\n:spring-pulsar-version: current\n:pulsar-client-version: current\n:pulsar-client-version-family: current\n:is-snapshot-version:  false\n\n:github: https://github.com/spring-projects/spring-pulsar\n:javadocs: https://docs.spring.io/spring-pulsar/docs/{spring-pulsar-version}/api\n:spring-framework-docs: https://spring.io/projects/spring-framework#learn\n:spring-boot-docs: https://docs.spring.io/spring-boot/{spring-boot-version}\n:spring-boot-pulsar-config-props: {spring-boot-docs}/appendix/application-properties/index.html#appendix.application-properties.integration\n:spring-cloud-stream-docs: https://docs.spring.io/spring-cloud-stream/docs/{spring-cloud-stream-version}/reference/html/\n:spring-cloud-function: https://spring.io/projects/spring-cloud-function\n\n:apache-pulsar-docs: https://pulsar.apache.org/docs/{pulsar-client-version-family}\n:apache-pulsar-cient-docs: {apache-pulsar-docs}/client-libraries-java\n:apache-pulsar-io-docs: {apache-pulsar-docs}/io-connectors\n:apache-pulsar-function-docs: {apache-pulsar-docs}/functions-overview\n\n[[pulsar-headers]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar-header.adoc", "title": "pulsar-header", "heading": "pulsar-header", "heading_level": 1, "file_order": 32, "section_index": 0, "content_hash": "bbcac1dff08fcc34c029ca2a0f481f54c9ea989be2796c8974ff146040a7be13", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar-header.adoc"}}
{"id": "sha256:ff83886281ad7a1adc1b8d10797f142259a33ad539d05590c1fa9cc7d23c5d3a", "content": "Pulsar does not have a first-class \"`header`\" concept but instead provides a map for custom user properties as well as methods to access the message metadata typically stored in a message header (eg. `id` and `event-time`).\nAs such, the terms \"`Pulsar message header`\" and \"`Pulsar message metadata`\" are used interchangeably.\nThe list of available message metadata (headers) can be found in {github}/blob/main/spring-pulsar/src/main/java/org/springframework/pulsar/support/PulsarHeaders.java[PulsarHeaders.java].", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar-header.adoc", "title": "pulsar-header", "heading": "Pulsar Headers", "heading_level": 2, "file_order": 32, "section_index": 1, "content_hash": "ff83886281ad7a1adc1b8d10797f142259a33ad539d05590c1fa9cc7d23c5d3a", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar-header.adoc"}}
{"id": "sha256:e4bf3fa152a0b34decb92dd2732c65d97be0c83664cbc2b4c14bf27f0b6eead5", "content": "Spring Messaging provides first-class \"`header`\" support via its `MessageHeaders` abstraction.\n\nThe Pulsar message metadata can be consumed as Spring message headers.\nThe list of available headers can be found in {github}/blob/main/spring-pulsar/src/main/java/org/springframework/pulsar/support/PulsarHeaders.java[PulsarHeaders.java].", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar-header.adoc", "title": "pulsar-header", "heading": "Spring Headers", "heading_level": 3, "file_order": 32, "section_index": 2, "content_hash": "e4bf3fa152a0b34decb92dd2732c65d97be0c83664cbc2b4c14bf27f0b6eead5", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar-header.adoc"}}
{"id": "sha256:89fd44267cba6c22fe953bcf4d7ef3a6d7f3859b66bc86477ced0391ae0d9b20", "content": "The following example shows how you can access the various Pulsar Headers in an application that uses the single record mode of consuming:\n\n[source,java]\n----\n@PulsarListener(topics = \"simpleListenerWithHeaders\")\nvoid simpleListenerWithHeaders(String data, @Header(PulsarHeaders.MESSAGE_ID) MessageId messageId,\n @Header(PulsarHeaders.RAW_DATA) byte[] rawData,\n @Header(\"foo\") String foo) {\n\n}\n----\n\nIn the preceding example, we access the values for the `messageId` and `rawData` message metadata as well as a custom message property named `foo`.\nThe Spring `@Header` annotation is used for each header field.\n\nYou can also use Pulsar's `Message` as the envelope to carry the payload.\nWhen doing so, the user can directly call the corresponding methods on the Pulsar message for retrieving the metadata.\nHowever, as a convenience, you can also retrieve it by using the `Header` annotation.\nNote that you can also use the Spring messaging `Message` envelope to carry the payload and then retrieve the Pulsar headers by using `@Header`.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar-header.adoc", "title": "pulsar-header", "heading": "Accessing in Single Record based Consumer", "heading_level": 3, "file_order": 32, "section_index": 3, "content_hash": "89fd44267cba6c22fe953bcf4d7ef3a6d7f3859b66bc86477ced0391ae0d9b20", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar-header.adoc"}}
{"id": "sha256:a5bc969ff186e7274e8c7761417cdd22739ddd724474762214b1e7c7c5a0eb07", "content": "In this section, we see how to access the various Pulsar Headers in an application that uses a batch consumer:\n\n[source,java]\n----\n@PulsarListener(topics = \"simpleBatchListenerWithHeaders\", batch = true)\nvoid simpleBatchListenerWithHeaders(List<String> data,\n @Header(PulsarHeaders.MESSAGE_ID) List<MessageId> messageIds,\n @Header(PulsarHeaders.TOPIC_NAME) List<String> topicNames, @Header(\"foo\") List<String> fooValues) {\n\n}\n----\n\nIn the preceding example, we consume the data as a `List<String>`.\nWhen extracting the various headers, we do so as a `List<>` as well.\nSpring for Apache Pulsar ensures that the headers list corresponds to the data list.\n\nYou can also extract headers in the same manner when you use the batch listener and receive payloads as `List<org.apache.pulsar.client.api.Message<?>`, `org.apache.pulsar.client.api.Messages<?>`, or `org.springframework.messaging.Messsge<?>`.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar-header.adoc", "title": "pulsar-header", "heading": "Accessing in Batch Record based Consumer", "heading_level": 3, "file_order": 32, "section_index": 4, "content_hash": "a5bc969ff186e7274e8c7761417cdd22739ddd724474762214b1e7c7c5a0eb07", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar-header.adoc"}}
{"id": "sha256:5172684d891045100cbd3c9530e4b9d976dd7141106610c10d0afb90a0807240", "content": "The `PulsarHeaderMapper` strategy is provided to map headers to and from Pulsar user properties and Spring `MessageHeaders`.\n\nIts interface definition is as follows:\n[source, java]\n----\npublic interface PulsarHeaderMapper {\n\n\tMap<String, String> toPulsarHeaders(MessageHeaders springHeaders);\n\n\tMessageHeaders toSpringHeaders(Message<?> pulsarMessage);\n}\n----\n\nThe framework provides a couple of mapper implementations.\n\n- The `JsonPulsarHeaderMapper` maps headers as JSON in order to support rich header types and is the default when the Jackson JSON library is on the classpath.\n\n- The `ToStringPulsarHeaderMapper` maps headers as strings using the `toString()` method on the header values and is the fallback mapper.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar-header.adoc", "title": "pulsar-header", "heading": "Message Header Mapping", "heading_level": 3, "file_order": 32, "section_index": 5, "content_hash": "5172684d891045100cbd3c9530e4b9d976dd7141106610c10d0afb90a0807240", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar-header.adoc"}}
{"id": "sha256:6bf43ced28a8385b10a4c3491bdec7ff56ed2bc23c37281444fa1f9e7392e004", "content": "The `JsonPulsarHeaderMapper` uses a \"`special`\" header (with a key of `spring_json_header_types`) that contains a JSON map of `<key>:<type>`.\nThis header is used on the inbound side (Pulsar -> Spring) to provide appropriate conversion of each header value to the original type.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar-header.adoc", "title": "pulsar-header", "heading": "JSON Header Mapper", "heading_level": 4, "file_order": 32, "section_index": 6, "content_hash": "6bf43ced28a8385b10a4c3491bdec7ff56ed2bc23c37281444fa1f9e7392e004", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar-header.adoc"}}
{"id": "sha256:c16b49f7f51e1549d9d0f33ae5174a1273688a06235c30c1985a4393ee6815b4", "content": "By default, the JSON mapper deserializes classes in all packages.\nHowever, if you receive messages from untrusted sources, you may wish to add only those packages you trust via the `trustedPackages` property on a custom configured `JsonPulsarHeaderMapper` bean you provide.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar-header.adoc", "title": "pulsar-header", "heading": "Trusted Packages", "heading_level": 5, "file_order": 32, "section_index": 7, "content_hash": "c16b49f7f51e1549d9d0f33ae5174a1273688a06235c30c1985a4393ee6815b4", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar-header.adoc"}}
{"id": "sha256:ba5ae1b3d74b2d688e1d5750b8cb1374d37bd8faca794d49fab68f2ad2862273", "content": "Certain types are not suitable for JSON serialization, and a simple `toString()` serialization might be preferred for these types.\nThe `JsonPulsarHeaderMapper` has a property called `addToStringClasses()` that lets you supply the names of classes that should be treated this way for outbound mapping.\nDuring inbound mapping, they are mapped as `String`.\nBy default, only `org.springframework.util.MimeType` and `org.springframework.http.MediaType` are mapped this way.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar-header.adoc", "title": "pulsar-header", "heading": "ToString Classes", "heading_level": 5, "file_order": 32, "section_index": 8, "content_hash": "ba5ae1b3d74b2d688e1d5750b8cb1374d37bd8faca794d49fab68f2ad2862273", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar-header.adoc"}}
{"id": "sha256:6425e9f4cc0f90c523e06781117becfe2a9c963896a356cdb5860d3708b6087e", "content": "The JSON mapper uses a reasonable configured Jackson 2 `ObjectMapper` to handle serialization of header values.\nHowever, to provide a custom object mapper one must simply provide an `ObjectMapper` bean with the name `pulsarHeaderObjectMapper`.\nFor example:\n[source, java]\n----\n@Configuration(proxyBeanMethods = false)\nstatic class PulsarHeadersCustomObjectMapperTestConfig {\n\n @Bean(name = \"pulsarHeaderObjectMapper\")\n ObjectMapper customObjectMapper() {\n var objectMapper = new ObjectMapper();\n // do things with your special header object mapper here\n return objectMapper;\n }\n}\n----\n\nIMPORTANT: The object mapper in the example above should be an instance of `com.fasterxml.jackson.databind.ObjectMapper`, **not** the shaded `org.apache.pulsar.shade.com.fasterxml.jackson.databind.ObjectMapper`.\n\nIMPORTANT: The xref:reference/custom-object-mapper.adoc#jackson2vs3[same limitations] regarding Jackson 2 vs. Jackson 3 apply here }", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar-header.adoc", "title": "pulsar-header", "heading": "Custom ObjectMapper", "heading_level": 5, "file_order": 32, "section_index": 9, "content_hash": "6425e9f4cc0f90c523e06781117becfe2a9c963896a356cdb5860d3708b6087e", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar-header.adoc"}}
{"id": "sha256:3166eb683f4c893ef8a51af545f9303a070d128c602bfcf33c0d0e14ba3f0f1d", "content": "On the inbound side, by default, all Pulsar headers (message metadata plus user properties) are mapped to `MessageHeaders`.\nOn the outbound side, by default, all `MessageHeaders` are mapped, except `id`, `timestamp`, and the headers that represent the Pulsar message metadata (i.e. the headers that are prefixed with `pulsar_message_`).\nYou can specify which headers are mapped for inbound and outbound messages by configuring the `inboundPatterns` and `outboundPatterns` on a mapper bean you provide.\nYou can include Pulsar message metadata headers on the outbound messages by adding the exact header name to the `outboundPatterns` as patterns are not supported for metadata headers.\nPatterns are rather simple and can contain a leading wildcard (`\\*`), a trailing wildcard, or both (for example, `*.cat.*`).\nYou can negate patterns with a leading `!`.\nThe first pattern that matches a header name (whether positive or negative) wins.\n\nIMPORTANT: When you provide your own patterns, we recommend including `!id` and `!timestamp`, since these headers are read-only on the inbound side.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar-header.adoc", "title": "pulsar-header", "heading": "Inbound/Outbound Patterns", "heading_level": 3, "file_order": 32, "section_index": 10, "content_hash": "3166eb683f4c893ef8a51af545f9303a070d128c602bfcf33c0d0e14ba3f0f1d", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar-header.adoc"}}
{"id": "sha256:f87e0a60d18765bbca720b3ac2e817f470667fd784bd4d823bb18aa06acc450b", "content": "[[pulsar]]\n\n[[preface]]\n= Preface\ninclude::../../attributes/attributes.adoc[]\n\nNOTE: We recommend using a Spring-Boot-First approach for Spring for Apache Pulsar-based applications, as that simplifies things tremendously.\nTo do so, you can add the `spring-boot-starter-pulsar` module as a dependency.\n\nNOTE: The majority of this reference expects the reader to be using the starter and gives most directions for configuration with that in mind.\nHowever, an effort is made to call out when instructions are specific to the Spring Boot starter usage.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/pulsar.adoc", "title": "pulsar", "heading": "pulsar", "heading_level": 1, "file_order": 33, "section_index": 0, "content_hash": "f87e0a60d18765bbca720b3ac2e817f470667fd784bd4d823bb18aa06acc450b", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/pulsar.adoc"}}
{"id": "sha256:e5344a5e416408cd22f45ef0dcc63df2fb9a7a830bd4507630a30f9570ca1d2f", "content": "[[reference]]\n\nThis part of the reference documentation details the various components that comprise Spring for Apache Pulsar.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/reference.adoc", "title": "reference", "heading": "reference", "heading_level": 1, "file_order": 34, "section_index": 0, "content_hash": "e5344a5e416408cd22f45ef0dcc63df2fb9a7a830bd4507630a30f9570ca1d2f", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/reference.adoc"}}
{"id": "sha256:8736948314a0b8fc4d3afe5a7ea584d2e15bd9865b7752032c6208a4a0147449", "content": "[[testing-applications]]\n\n:toc: left\n:toclevels: 6\n:numbered:\n:icons: font\n:hide-uri-scheme:\n:sectnums:\n:sectnumlevels: 3\n\ninclude::attributes-variables.adoc[]\n\nThe `spring-pulsar-test` dependency includes some useful utilities when testing your applications.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/testing-applications.adoc", "title": "testing-applications", "heading": "testing-applications", "heading_level": 1, "file_order": 35, "section_index": 0, "content_hash": "8736948314a0b8fc4d3afe5a7ea584d2e15bd9865b7752032c6208a4a0147449", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/testing-applications.adoc"}}
{"id": "sha256:354890010c8cfdd07bd25ef5d9261644e14a45f2ca63efd3000d776f41dd81c8", "content": "The `org.springframework.pulsar.test.support.PulsarConsumerTestUtil` provides a type-safe fluent API for consuming messages from a Pulsar topic within a test.\n\nThe following example shows how to consume messages from a topic for 5 seconds:\n[source,java,indent=0,subs=\"verbatim\"]\n----\nList<Message<String>> messages = PulsarConsumerTestUtil.consumeMessages(consumerFactory)\n .fromTopic(\"my-topic\")\n .withSchema(Schema.STRING)\n .awaitAtMost(Duration.ofSeconds(5))\n .get();\n----\n\nAn `until` method is also available to allow you to specify a condition that must be met before the messages are returned.\nThe following example uses a condition to consume 5 messages from a topic.\n\n[source,java,indent=0,subs=\"verbatim\"]\n----\nList<Message<String>> messages = PulsarConsumerTestUtil.consumeMessages(consumerFactory)\n .fromTopic(\"my-topic\")\n .withSchema(Schema.STRING)\n .awaitAtMost(Duration.ofSeconds(5))\n .until(messages -> messages.size() == 5)\n .get();\n----\n\nA set of commonly used conditions are available in `org.springframework.pulsar.test.support.ConsumedMessagesConditions`.\nThe following example uses the factory-provided `atLeastOneMessageMatches` condition to return the consumed messages once one of them has a value of `\"boom\"`.\n\n[source,java,indent=0,subs=\"verbatim\"]\n----\nList<Message<String>> messages = PulsarConsumerTestUtil.consumeMessages(consumerFactory)\n .fromTopic(\"my-topic\")\n .withSchema(Schema.STRING)\n .awaitAtMost(Duration.ofSeconds(5))\n .until(ConsumedMessagesConditions.atLeastOneMessageMatches(\"boom\"))\n .get();\n----", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/testing-applications.adoc", "title": "testing-applications", "heading": "PulsarConsumerTestUtil", "heading_level": 2, "file_order": 35, "section_index": 1, "content_hash": "354890010c8cfdd07bd25ef5d9261644e14a45f2ca63efd3000d776f41dd81c8", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/testing-applications.adoc"}}
{"id": "sha256:b3c5a161c8768b92f76c602060ac058c5fcba8f3098b97229b48a7067e3ae8f5", "content": "The `org.springframework.pulsar.test.support.PulsarTestContainerSupport` interface provides a static Pulsar Testcontainer.\nWhen using Junit Jupiter, the container is automatically started once per test class via `@BeforeAll` annotation.\n\nThe following example shows how you can use the container support in a `@SpringBootTest` in conjunction with the previously mentioned `PulsarConsumerTestUtil`.\n\n[source,java,indent=0,subs=\"verbatim\"]\n----\n@SpringBootTest\nclass MyApplicationTests implements PulsarTestContainerSupport {\n\n\t@DynamicPropertySource\n\tstatic void pulsarProperties(DynamicPropertyRegistry registry) {\n registry.add(\"spring.pulsar.client.service-url\", PULSAR_CONTAINER::getPulsarBrokerUrl);\n registry.add(\"spring.pulsar.admin.service-url\", PULSAR_CONTAINER::getHttpServiceUrl);\n\t}\n\n\t@Test\n\tvoid sendAndReceiveWorksAsExpected(\n @Autowired PulsarTemplate<String> template,\n @Autowired PulsarConsumerFactory<String> consumerFactory) {\n var topic = \"some-topic\";\n var msg = \"foo-5150\";\n template.send(topic, msg);\n var matchedUsers = PulsarConsumerTestUtil.consumeMessages(consumerFactory)\n .fromTopic(topic)\n .withSchema(Schema.STRING)\n .awaitAtMost(Duration.ofSeconds(2))\n .until(ConsumedMessagesConditions.atLeastOneMessageMatches(msg))\n .get();\n assertThat(matchedUsers).hasSize(1);\n\t}\n}\n----", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/testing-applications.adoc", "title": "testing-applications", "heading": "PulsarTestContainerSupport", "heading_level": 2, "file_order": 35, "section_index": 2, "content_hash": "b3c5a161c8768b92f76c602060ac058c5fcba8f3098b97229b48a7067e3ae8f5", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/testing-applications.adoc"}}
{"id": "sha256:ed89f3a6bacb13463831031f71300fe4f2dc12157b403cb92d0af9466b14d542", "content": "[[tombstones]]\n\nWhen using log compaction, you can send and receive messages with `null` payloads to identify the deletion of a key.\nYou can also receive `null` values for other reasons, such as a deserializer that might return `null` when it cannot deserialize a value.\n\n[[tombstones.produce]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/tombstones.adoc", "title": "tombstones", "heading": "tombstones", "heading_level": 1, "file_order": 36, "section_index": 0, "content_hash": "ed89f3a6bacb13463831031f71300fe4f2dc12157b403cb92d0af9466b14d542", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/tombstones.adoc"}}
{"id": "sha256:aab5d2c959aef403e86e4f012e892e32a55ee32aca6c583e667e4f7206fef983", "content": "To send a `null` payload by using the `PulsarTemplate`, you can use the fluent API and pass null into the value argument of the `newMessage()` method, for example:\n[source, java]\n----\npulsarTemplate\n .newMessage(null)\n .withTopic(\"my-topic\")\n .withSchema(Schema.STRING)\n .withMessageCustomizer((mb) -> mb.key(\"key:1234\"))\n .send();\n----\nNOTE: When sending null values you must specify the schema type as the system can not determine the type of the message from a `null` payload.\n\n[[tombstones.consume]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/tombstones.adoc", "title": "tombstones", "heading": "Producing Null Payloads", "heading_level": 2, "file_order": 36, "section_index": 1, "content_hash": "aab5d2c959aef403e86e4f012e892e32a55ee32aca6c583e667e4f7206fef983", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/tombstones.adoc"}}
{"id": "sha256:ca00fd4bd437f9c8237aeb74f993011ff47545c5b8357d4c2635b4f71ca1d6a0", "content": "For `@PulsarListener` and `@PulsarReader`, the `null` payload is passed into the listener method based on the type of its message parameter as follows:\n|===\n| Parameter type | Passed-in value\n\n| primitive\n| `null`\n\n| user-defined\n| `null`\n\n| `org.apache.pulsar.client.api.Message<T>`\n| non-null Pulsar message whose `getValue()` returns `null`\n\n| `org.springframework.messaging.Message<T>`\n| non-null Spring message whose `getPayload()` returns `PulsarNull`\n\n| `List<X>`\n| non-null list whose entries (`X`) are one of the above types and act accordingly (ie. primitive entries are `null` etc..)\n\n| `org.apache.pulsar.client.api.Messages<T>`\n| non-null container of non-null Pulsar messages whose `getValue()` returns `null`\n\n|===\n\nIMPORTANT: When the passed-in value is `null` (ie. single record listeners with primitive or user-defined types) you must use the `@Payload` parameter annotation with `required = false`.\n\nIMPORTANT: When using the Spring `org.springframework.messaging.Message` for your listener payload type, its generic type information must be wide enough to accept `Message<PulsarNull>` (eg. `Message`, `Message<?>`, or `Message<Object>`).\nThis is due to the fact that the Spring Message does not allow null values for its payload and instead uses the `PulsarNull` placeholder.\n\nIf it is a tombstone message for a compacted log, you usually also need the key so that your application can determine which key was +++\"+++`deleted`+++\"+++.\nThe following example shows such a configuration:\n\n[source, java]\n----\n@PulsarListener(\n topics = \"my-topic\",\n subscriptionName = \"my-topic-sub\",\n schemaType = SchemaType.STRING)\nvoid myListener(\n @Payload(required = false) String msg,\n @Header(PulsarHeaders.KEY) String key) {\n ...\n}\n----\n\nNOTE: The `@PulsarReader` does not yet support `@Header` arguments, so it is less useful in the log compaction scenario.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/tombstones.adoc", "title": "tombstones", "heading": "Consuming Null Payloads", "heading_level": 2, "file_order": 36, "section_index": 2, "content_hash": "ca00fd4bd437f9c8237aeb74f993011ff47545c5b8357d4c2635b4f71ca1d6a0", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/tombstones.adoc"}}
{"id": "sha256:a3a93536f7f73adbedfe746deec03e9316da1e87175d22daff111498f93a0eec", "content": "[[topic-resolution-process]]\n:toc: left\n:toclevels: 6\n:numbered:\n:icons: font\n:hide-uri-scheme:\n:sectnums:\n:sectnumlevels: 3\n\ninclude::attributes-variables.adoc[]\n\nA destination topic is needed when producing or consuming messages.\nThe framework looks in the following ordered locations to determine a topic (stopping at the first find):\n\n* User specified\n* Message type default\n* Global default\n\nWhen a topic is found via one of the default mechanisms, there is no need to specify the topic on the produce or consume API.\n\nWhen a topic is not found, the API will throw an exception accordingly.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/topic-resolution.adoc", "title": "topic-resolution", "heading": "topic-resolution", "heading_level": 1, "file_order": 37, "section_index": 0, "content_hash": "a3a93536f7f73adbedfe746deec03e9316da1e87175d22daff111498f93a0eec", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/topic-resolution.adoc"}}
{"id": "sha256:3dc2805ffbd108db24b6a77eb091a5429e81de44f66bf1eae4b30f98dab966c2", "content": "A topic passed into the API being used has the highest precedence (eg. `PulsarTemplate.send(\"my-topic\", myMessage)` or `@PulsarListener(topics = \"my-topic\"`).", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/topic-resolution.adoc", "title": "topic-resolution", "heading": "User specified", "heading_level": 2, "file_order": 37, "section_index": 1, "content_hash": "3dc2805ffbd108db24b6a77eb091a5429e81de44f66bf1eae4b30f98dab966c2", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/topic-resolution.adoc"}}
{"id": "sha256:a15c4f6822d9fc3c322c2122ef13e5c0003cbe675e12325e2ca6aa73d31645f3", "content": "When no topic is passed into the API, the system looks for a message type to topic mapping configured for the type of the message being produced or consumed.\n\nMappings can be configured with the `spring.pulsar.defaults.type-mappings` property.\nThe following example uses `application.yml` to configure default topics to use when consuming or producing `Foo` or `Bar` messages:\n\n[source,yaml,indent=0,subs=\"verbatim\"]\n----\nspring:\n pulsar:\n defaults:\n type-mappings:\n - message-type: com.acme.Foo\n topic-name: foo-topic\n - message-type: com.acme.Bar\n topic-name: bar-topic\n----\n\nNOTE: The `message-type` is the fully-qualified name of the message class.\n\nWARNING: If the message (or the first message of a `Publisher` input) is `null`, the framework won't be able to determine the topic from it. Another method shall be used to specify the topic if your application is likely to send `null` messages.\n\n[[default-topic-via-annotation]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/topic-resolution.adoc", "title": "topic-resolution", "heading": "Message type default", "heading_level": 2, "file_order": 37, "section_index": 2, "content_hash": "a15c4f6822d9fc3c322c2122ef13e5c0003cbe675e12325e2ca6aa73d31645f3", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/topic-resolution.adoc"}}
{"id": "sha256:a36e86780882d950efdd90d766c1dc3ca64e3cbb0e001c61a9ce33a8aa1a1637", "content": "When no topic is passed into the API and there are no custom topic mappings configured, the system looks for a `@PulsarMessage` annotation on the class of the message being produced or consumed.\nThe default topic can be specified via the `topic` attribute on the annotation.\n\nThe following example configures the default topic to use when producing or consuming messages of type `Foo`:\n\n[source,java,indent=0,subs=\"verbatim\"]\n----\n@PulsarMessage(topic = \"foo-topic\")\nrecord Foo(String value) {\n}\n----\n\nProperty placeholders and SpEL expressions are supported in the `@PulsarMessage` annotation,\nfor example:\n[source,java,indent=0,subs=\"verbatim\"]\n----\n@PulsarMessage(topic = \"${app.topics.foo}\")\nrecord Foo(String value) {\n}\n\n@PulsarMessage(topic = \"#{someBean.getTopic()}\")\nrecord Bar(String value) {\n}\n----", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/topic-resolution.adoc", "title": "topic-resolution", "heading": "Specified via annotation", "heading_level": 3, "file_order": 37, "section_index": 3, "content_hash": "a36e86780882d950efdd90d766c1dc3ca64e3cbb0e001c61a9ce33a8aa1a1637", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/topic-resolution.adoc"}}
{"id": "sha256:f82b66720db57b0579acca33bd9427d8c77eab893b8ee64f40f68b70c9e996a6", "content": "The preferred method of adding mappings is via the property mentioned above.\nHowever, if more control is needed you can replace the default resolver by proving your own implementation, for example:\n\n[source,java,indent=0,subs=\"verbatim\"]\n----\n@Bean\npublic MyTopicResolver topicResolver() {\n\treturn new MyTopicResolver();\n}\n----", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/topic-resolution.adoc", "title": "topic-resolution", "heading": "Custom topic resolver", "heading_level": 3, "file_order": 37, "section_index": 4, "content_hash": "f82b66720db57b0579acca33bd9427d8c77eab893b8ee64f40f68b70c9e996a6", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/topic-resolution.adoc"}}
{"id": "sha256:0d090b78e7fe4626089a1bbb2a09f8e3359c76d7330e4a23dc88d4394f8785cb", "content": "The final location consulted (when producing) is the system-wide producer default topic.\nIt is configured via the `spring.pulsar.producer.topic-name` property.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/topic-resolution.adoc", "title": "topic-resolution", "heading": "Producer global default", "heading_level": 2, "file_order": 37, "section_index": 5, "content_hash": "0d090b78e7fe4626089a1bbb2a09f8e3359c76d7330e4a23dc88d4394f8785cb", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/topic-resolution.adoc"}}
{"id": "sha256:487c18b33ed52476737e5d7ec3a04bf8c6803aefa491667eb8b2db3f9aa8fd27", "content": "The final location consulted (when consuming) is the system-wide consumer default topic.\nIt is configured via the `spring.pulsar.consumer.topics` or `spring.pulsar.consumer.topics-pattern` property.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/reference/topic-resolution.adoc", "title": "topic-resolution", "heading": "Consumer global default", "heading_level": 2, "file_order": 37, "section_index": 6, "content_hash": "487c18b33ed52476737e5d7ec3a04bf8c6803aefa491667eb8b2db3f9aa8fd27", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/reference/topic-resolution.adoc"}}
{"id": "sha256:61896cef4a0a246dce3dc074ae8e5cc68f1b90e0c4e779070f56dae312df47b5", "content": "[[overview]]\ninclude::attributes/attributes.adoc[]\n\ninclude::overview/authors.adoc[]\n(v{spring-pulsar-version})\n\nifeval::[{is-snapshot-version} == true]\nCAUTION: You are viewing documentation for a SNAPSHOT version ({spring-pulsar-version}). While it is usually in-sync with the underlying code, it is subject to change and not guaranteed to be up-to-date with the underlying code.\nendif::[]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/index.adoc", "title": "index", "heading": "index", "heading_level": 1, "file_order": 38, "section_index": 0, "content_hash": "61896cef4a0a246dce3dc074ae8e5cc68f1b90e0c4e779070f56dae312df47b5", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/index.adoc"}}
{"id": "sha256:5310315d6141c28b9654fc8fa0ee05d0ff161c83cf60b68ee3716ee44002510b", "content": "[[introduction]]\n\nThis project provides a basic Spring-friendly API for developing https://pulsar.apache.org/[Apache Pulsar] applications.\n\nOn a very high level, Spring for Apache Pulsar provides a `PulsarTemplate` for publishing to a Pulsar topic and a `PulsarListener` annotation for consuming from a Pulsar topic.\nIn addition, it also provides various convenience APIs for Spring developers to ramp up their development journey into Apache Pulsar.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/intro.adoc", "title": "intro", "heading": "intro", "heading_level": 1, "file_order": 39, "section_index": 0, "content_hash": "5310315d6141c28b9654fc8fa0ee05d0ff161c83cf60b68ee3716ee44002510b", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/intro.adoc"}}
{"id": "sha256:922be407f78c1c2d629d969f0bfd4a1bc4a52d62113383e25738523fe924cf1e", "content": "[[other-resources]]\n\ninclude::attributes/attributes-variables.adoc[]\n\nIn addition to this reference documentation, we recommend a number of other resources that may help you learn about Spring and Apache Pulsar.\n\n- {github}[Spring for Apache Pulsar GitHub Repository]\n- https://pulsar.apache.org/[Apache Pulsar Project Home Page]\n- {apache-pulsar-docs}/client-libraries-java/[Apache Pulsar Java Client]\n- https://github.com/apache/pulsar[Apache Pulsar GitHub Repository]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/other-resources.adoc", "title": "other-resources", "heading": "other-resources", "heading_level": 1, "file_order": 40, "section_index": 0, "content_hash": "922be407f78c1c2d629d969f0bfd4a1bc4a52d62113383e25738523fe924cf1e", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/other-resources.adoc"}}
{"id": "sha256:06ef7cde239ccebad466995b9605fb4b8dbfb370f3ac359ddb06d947dc61ce7d", "content": "[[what-s-new-in-2-0-since-1-2]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/whats-new.adoc", "title": "What's new?", "heading": "What's new?", "heading_level": 1, "file_order": 41, "section_index": 0, "content_hash": "06ef7cde239ccebad466995b9605fb4b8dbfb370f3ac359ddb06d947dc61ce7d", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/whats-new.adoc"}}
{"id": "sha256:3d037a639353a8b21c92c403d0bdf1b7ea2c6c7baaca72d4fd434d4d55b26966", "content": "This section covers the changes made from version 1.2 to version 2.0.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/whats-new.adoc", "title": "What's new?", "heading": "What's New in 2.0 Since 1.2", "heading_level": 2, "file_order": 41, "section_index": 1, "content_hash": "3d037a639353a8b21c92c403d0bdf1b7ea2c6c7baaca72d4fd434d4d55b26966", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/whats-new.adoc"}}
{"id": "sha256:44e7a32a97656b062f1e750648b343f91ca4afb75043c3a4b28cbbf90ef2cf30", "content": "All usages of Spring Retry have been replaced with a simpler retry mechanism recently introduced by Spring Framework.\n\nThis is mostly an internal implementation detail used when restarting message containers.\nThis will only affect you if you were providing a custom `RetryTemplate` via a `PulsarContainerFactoryCustomizer` bean.\n\nThe `RetryTemplate` class still exists in Core Retry but the package name has changed from `org.springframework.retry.support` to `org.springframework.core.retry` and the API has slightly changed.\n\nSee the https://github.com/spring-projects/spring-pulsar/commit/fc4742f419fb882c7a045a742cae259f8ab45cc5[commit] for more details.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/whats-new.adoc", "title": "What's new?", "heading": "Spring Retry replaced with Core Retry", "heading_level": 3, "file_order": 41, "section_index": 2, "content_hash": "44e7a32a97656b062f1e750648b343f91ca4afb75043c3a4b28cbbf90ef2cf30", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/whats-new.adoc"}}
{"id": "sha256:d78dc346b7d576374eff0c1a6bac94ecaf141f71a8fbbbe42559967cc3b359fb", "content": "The following previously deprecated APIs, which were marked for removal in version 2.0.x, have now been removed:\n\n- `org.springframework.pulsar.config.ConcurrentPulsarListenerContainerFactory#setConcurrency`\n- `org.springframework.pulsar.config.ConcurrentPulsarListenerContainerFactoryCustomizer`\n- `org.springframework.pulsar.config.ListenerContainerFactory#createListenerContainer`\n- `org.springframework.pulsar.config.ReaderContainerFactory#createReaderContainer`\n- `org.springframework.pulsar.config.ProducerBuilderConfigurationUtil`\n- `org.springframework.pulsar.config.PulsarClientProxy#getPartitionsForTopic`\n- `org.springframework.pulsar.config.PulsarTopic#builder`\n- `org.springframework.pulsar.config.PulsarTopic#getFullyQualifiedTopicName`\n- `org.springframework.pulsar.config.Resolved#get`\n- `org.springframework.pulsar.test.support.model.UserPojo`\n- `org.springframework.pulsar.test.support.model.UserRecord`", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/whats-new.adoc", "title": "What's new?", "heading": "Previously deprecated APIs", "heading_level": 4, "file_order": 41, "section_index": 3, "content_hash": "d78dc346b7d576374eff0c1a6bac94ecaf141f71a8fbbbe42559967cc3b359fb", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/whats-new.adoc"}}
{"id": "sha256:dcc615ff7c7d4a9c19396001c777dbb1ef715d12e8163d3d82a5d9d1748ced36", "content": "Reactive support has been removed from Spring Pulsar `2.0.0` - there is no longer a `spring-pulsar-reactive` module published.\n\n[[what-s-new-in-1-2-since-1-1]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/whats-new.adoc", "title": "What's new?", "heading": "Reactive Support", "heading_level": 4, "file_order": 41, "section_index": 4, "content_hash": "dcc615ff7c7d4a9c19396001c777dbb1ef715d12e8163d3d82a5d9d1748ced36", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/whats-new.adoc"}}
{"id": "sha256:156be66067e0421b88610dec19df014103af513b557aaf402d1fc94fba7622cb", "content": "This section covers the changes made from version 1.1 to version 1.2.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/whats-new.adoc", "title": "What's new?", "heading": "What's New in 1.2 Since 1.1", "heading_level": 2, "file_order": 41, "section_index": 5, "content_hash": "156be66067e0421b88610dec19df014103af513b557aaf402d1fc94fba7622cb", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/whats-new.adoc"}}
{"id": "sha256:f80d3d07498c29abd8e6bc98fdebf9905b5287caebfe3d60e2349f94c05369b6", "content": "You can provide your own Jackson `ObjectMapper` that Pulsar will use when producing and consuming JSON messages.\nSee xref:./reference/custom-object-mapper.adoc[Custom Object Mapper] for more details.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/whats-new.adoc", "title": "What's new?", "heading": "Custom Object Mapper", "heading_level": 3, "file_order": 41, "section_index": 6, "content_hash": "f80d3d07498c29abd8e6bc98fdebf9905b5287caebfe3d60e2349f94c05369b6", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/whats-new.adoc"}}
{"id": "sha256:83119daeb2db523b1566b1ad8c6c2ef87f6ca57f83fc1deb186b6b5d32d50d4d", "content": "You can specify a default tenant and/or namespace to use when producing or consuming messages against a non-fully-qualified topic URL.\nSee xref:./reference/default-tenant-namespace.adoc[Default Tenant / Namespace] for more details.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/whats-new.adoc", "title": "What's new?", "heading": "Default Tenant and Namespace", "heading_level": 3, "file_order": 41, "section_index": 7, "content_hash": "83119daeb2db523b1566b1ad8c6c2ef87f6ca57f83fc1deb186b6b5d32d50d4d", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/whats-new.adoc"}}
{"id": "sha256:1103b607ab384ddd5d7f2b7f12420e6b3efbbab634f23508a7db774f1cef2042", "content": "You can now configure the message listener container startup failure policy to `stop`, `continue`, or `retry`.\nFor more details see the corresponding section for one of the supported containers xref:./reference/pulsar/message-consumption.adoc#message-listener-startup-failure[@PulsarListener] or xref:./reference/pulsar/message-consumption.adoc#message-reader-startup-failure[@PulsarReader].", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/whats-new.adoc", "title": "What's new?", "heading": "Message Container Startup Policy", "heading_level": 3, "file_order": 41, "section_index": 8, "content_hash": "1103b607ab384ddd5d7f2b7f12420e6b3efbbab634f23508a7db774f1cef2042", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/whats-new.adoc"}}
{"id": "sha256:cc91ff3f4654397947ae79299be8ad4028b829e8bce9c3f654d2f339192bbdf4", "content": "Spring Boot has introduced a generic message container factory customizer `org.springframework.boot.pulsar.autoconfigure.PulsarContainerFactoryCustomizer<T extends PulsarContainerFactory<?, ?>>` that can be used to further configure one or more of the auto-configured container factories that back the following listener annotations:\n\n- For `@PulsarListener` register one or more PulsarContainerFactoryCustomizer<ConcurrentPulsarListenerContainerFactory<?>> beans.\n\n- For `@PulsarReader` register one or more PulsarContainerFactoryCustomizer<DefaultPulsarReaderContainerFactory<?>> beans.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/whats-new.adoc", "title": "What's new?", "heading": "Message Container Factory Customizers (Spring Boot)", "heading_level": 3, "file_order": 41, "section_index": 9, "content_hash": "cc91ff3f4654397947ae79299be8ad4028b829e8bce9c3f654d2f339192bbdf4", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/whats-new.adoc"}}
{"id": "sha256:c26638f192ef3556487b28aa88849ea1d3a85df6f539a4ed28013fd19ee5addd", "content": "Version `3.3.1` of the Pulsar client deprecates the `getPartitionsForTopic(java.lang.String)` in favor of `getPartitionsForTopic(java.lang.String, boolean metadataAutoCreationEnabled)`.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/whats-new.adoc", "title": "What's new?", "heading": "PulsarClient#getPartitionsForTopic(java.lang.String)", "heading_level": 4, "file_order": 41, "section_index": 10, "content_hash": "c26638f192ef3556487b28aa88849ea1d3a85df6f539a4ed28013fd19ee5addd", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/whats-new.adoc"}}
{"id": "sha256:93fce2fd0fbb97c0808c081491fc37d8c74988af4520f9dee1fd67548a91d88f", "content": "When using Spring Boot the `PulsarTopicBuilder` is now a registered bean that is configured with default values for domain, tenant, and namespace.\nTherefore, if you are using Spring Boot, you can simply inject the builder where needed.\nOtherwise, use one of the `PulsarTopicBuilder` constructors directly.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/whats-new.adoc", "title": "What's new?", "heading": "PulsarTopic#builder", "heading_level": 4, "file_order": 41, "section_index": 11, "content_hash": "93fce2fd0fbb97c0808c081491fc37d8c74988af4520f9dee1fd67548a91d88f", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/whats-new.adoc"}}
{"id": "sha256:16189b41d3ec13af2ace8d76203b367758ff44dc40c36ec24ebad334e2ce43e4", "content": "The `PulsarContainerFactory` common interface was introduced to bridge the gap between listener and reader container factories.\nAs part of this, the following APIs were deprecated, copied, and renamed:\n\n- `ListenerContainerFactory#createListenerContainer` replaced with `ListenerContainerFactory#createRegisteredContainer`\n\n- `ReaderContainerFactory#createReaderContainer(E endpoint)` replaced with `ReaderContainerFactory#createRegisteredContainer`\n\n- `ReaderContainerFactory#createReaderContainer(String... topics)` replaced with `ReaderContainerFactory#createContainer`", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/whats-new.adoc", "title": "What's new?", "heading": "Listener/ReaderContainerFactory", "heading_level": 4, "file_order": 41, "section_index": 12, "content_hash": "16189b41d3ec13af2ace8d76203b367758ff44dc40c36ec24ebad334e2ce43e4", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/whats-new.adoc"}}
{"id": "sha256:114cc7c6c3fb519d22ca67bfd240929a021a248fd20e2afaa933bdb2a2cd59aa", "content": "The purpose of `ConcurrentPulsarListenerContainerFactoryCustomizer` was to customize the Spring Boot auto-configured message container factories.\nHowever, Spring Boot has introduced a generic message container factory customizer `org.springframework.boot.pulsar.autoconfigure.PulsarContainerFactoryCustomizer<T extends PulsarContainerFactory<?, ?>>` that removes the need for this customizer.\n\nReplace all instances of `ConcurrentPulsarListenerContainerFactoryCustomizer` with `org.springframework.boot.pulsar.autoconfigure.PulsarContainerFactoryCustomizer<ConcurrentPulsarListenerContainerFactoryCustomizer<?>>`.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/whats-new.adoc", "title": "What's new?", "heading": "ConcurrentPulsarListenerContainerFactoryCustomizer", "heading_level": 4, "file_order": 41, "section_index": 13, "content_hash": "114cc7c6c3fb519d22ca67bfd240929a021a248fd20e2afaa933bdb2a2cd59aa", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/whats-new.adoc"}}
{"id": "sha256:5ea93b0825ae4bf29e8b9aa49f2f390d26af7401a7cbe6bd9b0549ce28f0dc41", "content": "The following previously deprecated listener endpoint adapters have been removed in favor of default methods in the listener endpoint interfaces:\n\n- `org.springframework.pulsar.config.PulsarListenerEndpointAdapter`\n- `org.springframework.pulsar.reactive.config.ReactivePulsarListenerEndpointAdapter`", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/whats-new.adoc", "title": "What's new?", "heading": "Removals", "heading_level": 3, "file_order": 41, "section_index": 14, "content_hash": "5ea93b0825ae4bf29e8b9aa49f2f390d26af7401a7cbe6bd9b0549ce28f0dc41", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/whats-new.adoc"}}
{"id": "sha256:13e71e3a2ccf07b3d4f7bed7e8014bd8891567bd00acd942f4d42770dadba61d", "content": "The `PulsarTopic` constructor now requires a fully qualified topic name (`domain://tenant/namespace/name`).\nIf you are invoking the constructor you will need to be sure the topic you pass in is fully-qualified.\nA better alternative is to instead use the `PulsarTopicBuilder` as it does not require fully qualified names and will add default values for the missing components in the specified name.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/whats-new.adoc", "title": "What's new?", "heading": "PulsarTopic#<init>", "heading_level": 4, "file_order": 41, "section_index": 15, "content_hash": "13e71e3a2ccf07b3d4f7bed7e8014bd8891567bd00acd942f4d42770dadba61d", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/whats-new.adoc"}}
{"id": "sha256:0728c9e26522f32b19fdf68891b029170624f6807ec5ecabfc0ea477a928b221", "content": "The `PulsarReaderFactory#createReader` API now throws an unchecked `PulsarException` rather than a checked `PulsarClientException`.\nReplace any `try/catch` blocks on this API accordingly.\n\n[[what-s-new-in-1-1-since-1-0]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/whats-new.adoc", "title": "What's new?", "heading": "PulsarReaderFactory#createReader", "heading_level": 4, "file_order": 41, "section_index": 16, "content_hash": "0728c9e26522f32b19fdf68891b029170624f6807ec5ecabfc0ea477a928b221", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/whats-new.adoc"}}
{"id": "sha256:0d6771646e630604adfb43dd224899b87490f96230a5dc307941c07a7b269bea", "content": "This section covers the changes made from version 1.0 to version 1.1.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/whats-new.adoc", "title": "What's new?", "heading": "What's New in 1.1 Since 1.0", "heading_level": 2, "file_order": 41, "section_index": 17, "content_hash": "0d6771646e630604adfb43dd224899b87490f96230a5dc307941c07a7b269bea", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/whats-new.adoc"}}
{"id": "sha256:89637e27f425ae6c535864355bc26fa89cc136dd010fabb5f18299b6c1275efe", "content": "If there is no chance to know the schema of a Pulsar topic in advance, you can use AUTO Schemas to produce/consume generic records to/from brokers.\nSee xref:./reference/pulsar/message-production.adoc#template-auto-produce[Producing with AUTO_SCHEMA] and xref:./reference/pulsar/message-consumption.adoc#listener-auto-consume[Consuming with AUTO_SCHEMA] for more details.\n\nNOTE: While the above links focus on `PulsarTemplate` and `@PulsarListener`, this feature is also supported in `ReactivePulsarTemplate`, `@ReactivePulsarListener`, and `@PulsarReader`.\nDetails for each can be found in their respective section of this reference guide.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/whats-new.adoc", "title": "What's new?", "heading": "Auto Schema support", "heading_level": 3, "file_order": 41, "section_index": 18, "content_hash": "89637e27f425ae6c535864355bc26fa89cc136dd010fabb5f18299b6c1275efe", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/whats-new.adoc"}}
{"id": "sha256:0692777e629250e18fad8a92a728bc9e9d255adfcb3b562d8a165936b8c43013", "content": "You can now mark a message class with `@PulsarMessage` to specify the xref:./reference/topic-resolution.adoc#default-topic-via-annotation[default topic] and/or xref:./reference/pulsar/message-consumption.adoc#listener-default-schema-annotation[default schema] to use when producing/consuming messages of that type.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/whats-new.adoc", "title": "What's new?", "heading": "Default topic/schema via message annotation", "heading_level": 3, "file_order": 41, "section_index": 19, "content_hash": "0692777e629250e18fad8a92a728bc9e9d255adfcb3b562d8a165936b8c43013", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/whats-new.adoc"}}
{"id": "sha256:54b3ab7e02ac3a59032f4b72327696f1956e4677a51ab11490cb0daf6ee35c52", "content": "The APIs provided by the framework no longer throw the checked `PulsarClientException`, but rather the unchecked `PulsarException`.\n\nWARNING: If you were previously catching or rethrowing `PulsarClientException` just to appease the compiler and were not actually handling the exception, you can simply remove your `catch` or `throws` clause.\nIf you were actually handling the exception then you will need to replace `PulsarClientException` with `PulsarException` in your catch clause.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/whats-new.adoc", "title": "What's new?", "heading": "Remove checked exceptions", "heading_level": 3, "file_order": 41, "section_index": 20, "content_hash": "54b3ab7e02ac3a59032f4b72327696f1956e4677a51ab11490cb0daf6ee35c52", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/whats-new.adoc"}}
{"id": "sha256:6c742e6bb3cdfd33613c106eb842eea87225a844bd5305e9de9a9805d5980cf3", "content": "The `spring-pulsar-test` module is now available to help test your Spring for Apache Pulsar applications.\nSee xref:./reference/testing-applications.adoc#testing-applications[Testing Applications] for more details.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-pulsar", "path": "antora/modules/ROOT/pages/whats-new.adoc", "title": "What's new?", "heading": "Testing support", "heading_level": 3, "file_order": 41, "section_index": 21, "content_hash": "6c742e6bb3cdfd33613c106eb842eea87225a844bd5305e9de9a9805d5980cf3", "source_url": "https://github.com/spring-projects/spring-pulsar/blob/4780fb2f03cb4307b070833b95831ae26350bd09/spring-pulsar-docs/src/main/antora/modules/ROOT/pages/whats-new.adoc"}}
