{"id": "sha256:ecda4b2d3be5fc705eb475aaa0aed4cedca399c5141f8a3328016b9c33143dc9", "content": "[[couchbase.migrating]]\n\nThis chapter is a quick reference of what major changes have been introduced in 4.x and gives a high-level overview of things to consider when migrating.\n\nPlease note that implicitly the minimum Couchbase Server version has been bumped up to 5.5 and later, and we recommend running at least 6.0.x.\n\n[[couchbase.migrating.configuration]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/commons/migrating.adoc", "title": "migrating", "heading": "migrating", "heading_level": 1, "file_order": 0, "section_index": 0, "content_hash": "ecda4b2d3be5fc705eb475aaa0aed4cedca399c5141f8a3328016b9c33143dc9", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/commons/migrating.adoc"}}
{"id": "sha256:03b7d894a54794329e454e32b10fb583095510dc27d712587e72658cee5aa854", "content": "Since the main objective was to migrate from the Java SDK 2 to 3, configuration has changed to adapt to the new SDK and also in the long run to prepare it for scopes and collections (but it can still be used without collection support).\n\nIMPORTANT: XML Configuration support has been dropped, so only java/annotation based configuration is supported.\n\nYour configuration still has to extend the `AbstractCouchbaseConfiguration`, but since RBAC (role-based access control) is now mandatory, different properties need to be overridden in order to be configured: `getConnectionString`, `getUserName`, `getPassword` and `getBucketName`.If you want to use a non-default scope optionally you can override the `getScopeName` method.Note that if you want to use certificate based authentication or you need to customize the password authentication, the `authenticator` method can be overridden to perform this task.\n\nThe new SDK still has an environment that is used to configure it, so you can override the `configureEnvironment` method and supply custom configuration if needed.\n\nFor more information, see xref:couchbase/configuration.adoc[Installation & Configuration].\n\n[[spring-boot-version-compatibility]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/commons/migrating.adoc", "title": "migrating", "heading": "Configuration", "heading_level": 2, "file_order": 0, "section_index": 1, "content_hash": "03b7d894a54794329e454e32b10fb583095510dc27d712587e72658cee5aa854", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/commons/migrating.adoc"}}
{"id": "sha256:1c50063f0c8bda035db803486e2d5ad96f2d78c9e214c0e8547c0ddb829fda3c", "content": "Spring Boot 2.3.x or higher depends on Spring Data Couchbase 4.x.Earlier versions of Couchbase are not available because SDK 2 and 3 cannot live on the same classpath.\n\n[[couchbase.migrating.entities]]\n\n[[entities]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/commons/migrating.adoc", "title": "migrating", "heading": "Spring Boot Version Compatibility", "heading_level": 3, "file_order": 0, "section_index": 2, "content_hash": "1c50063f0c8bda035db803486e2d5ad96f2d78c9e214c0e8547c0ddb829fda3c", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/commons/migrating.adoc"}}
{"id": "sha256:398ee560558ec69fa7a51c45ccb7790fa0050e487f0b49aa80568a44d9aa406f", "content": "How to deal with entities has not changed, although since the SDK now does not ship annotations anymore only Spring-Data related annotations are supported.\n\nSpecifically:\n\n- `com.couchbase.client.java.repository.annotation.Id` became `import org.springframework.data.annotation.Id`\n- `com.couchbase.client.java.repository.annotation.Field` became `import org.springframework.data.couchbase.core.mapping.Field`\n\nThe `org.springframework.data.couchbase.core.mapping.Document` annotation stayed the same.\n\nFor more information, see xref:couchbase/entity.adoc[Modeling Entities].\n\n[[couchbase.migrating.indexes]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/commons/migrating.adoc", "title": "migrating", "heading": "Entities", "heading_level": 2, "file_order": 0, "section_index": 3, "content_hash": "398ee560558ec69fa7a51c45ccb7790fa0050e487f0b49aa80568a44d9aa406f", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/commons/migrating.adoc"}}
{"id": "sha256:fe0af3f9e45c1a08d7b582867ddcd830366d8968c00cfbf816d13cfd9d20245f", "content": "Automatic Index Management has been redesigned to allow more flexible indexing.\nNew annotations have been introduced and old ones like `@ViewIndexed`, `@N1qlSecondaryIndexed` and `@N1qlPrimaryIndexed` were removed.\n\nFor more information, see xref:couchbase/repository.adoc#couchbase.repository.indexing[Automatic Index Management].\n\n[[couchbase.migrating.template]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/commons/migrating.adoc", "title": "migrating", "heading": "Automatic Index Management", "heading_level": 2, "file_order": 0, "section_index": 4, "content_hash": "fe0af3f9e45c1a08d7b582867ddcd830366d8968c00cfbf816d13cfd9d20245f", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/commons/migrating.adoc"}}
{"id": "sha256:22a9518826ec3f8d97d5c769c6df5fbaa958d52215b135544aaf7a5284cf1e51", "content": "Since the Couchbase SDK 3 removes support for `RxJava` and instead adds support for `Reactor`, both the `couchbaseTemplate` as well as the `reactiveCouchbaseTemplate` can be directly accessed from the `AbstractCouchbaseConfiguration`.\n\nThe template has been completely overhauled so that it now uses a fluent API to configure instead of many method overloads.This has the advantage that in the future we are able to extend the functionality without having to introduce more and more overloads that make it complicated to navigate.\n\nThe following table describes the method names in 3.x and compares them to their 4.x equivalents:\n\n.Template Method Comparison\n|===\n|SDC 3.x |SDC 4.x\n\n|save\n|upsertById\n\n|insert\n|insertById\n\n|update\n|replaceById\n\n|findById\n|findById\n\n|findByView\n|(removed)\n\n|findBySpatialView\n|(removed)\n\n|findByN1QL\n|findByQuery\n\n|findByN1QLProjection\n|findByQuery\n\n|queryN1QL\n|(call SDK directly)\n\n|exists\n|existsById\n\n|remove\n|removeById\n\n|execute\n|(call SDK directly)\n|===\n\nIn addition, the following methods have been added which were not available in 3.x:\n\n.Template Additions in 4.x\n|===\n|Name |Description\n\n|removeByQuery\n|Allows to remove entities through a N1QL query\n\n|findByAnalytics\n|Performs a find through the analytics service\n\n|findFromReplicasById\n|Like findById, but takes replicas into account\n|===\n\nWe tried to unify and align the APIs more closely to the underlying SDK semantics so they are easier to correlate and navigate.\n\nFor more information, see xref:couchbase/template.adoc[Template & direct operations].\n\n[[couchbase.migrating.repository]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/commons/migrating.adoc", "title": "migrating", "heading": "Template and ReactiveTemplate", "heading_level": 2, "file_order": 0, "section_index": 5, "content_hash": "22a9518826ec3f8d97d5c769c6df5fbaa958d52215b135544aaf7a5284cf1e51", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/commons/migrating.adoc"}}
{"id": "sha256:a94394e0c557ba27a6f9e1444d2210705a243eb7a1cc69505d2187084a80af59", "content": "- `org.springframework.data.couchbase.core.query.Query` became `org.springframework.data.couchbase.repository.Query`\n- `org.springframework.data.couchbase.repository.ReactiveCouchbaseSortingRepository` has been removed.Consider extending `ReactiveSortingRepository` or `ReactiveCouchbaseRepository`\n- `org.springframework.data.couchbase.repository.CouchbasePagingAndSortingRepository` has been removed.Consider extending `PagingAndSortingRepository` or `CouchbaseRepository`\n\nIMPORTANT: Support for views has been removed and N1QL queries are now the first-class citizens for all custom repository methods as well as the built-in ones by default.\n\nThe behavior itself has not changed over the previous version on how the query derivation is supposed to work. Should you encounter any queries that worked in the past and now do not work anymore please let us know.\n\nIt is possible to override the default scan consistency for N1QL queries through the new `ScanConsistency` annotation.\n\nThe method `getCouchbaseOperations()` has also been removed. You can still access all methods from the native Java SDK via the class `CouchbaseTemplate` or `Cluster`:\n\n====\n[source,java]\n----\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.data.couchbase.core.CouchbaseTemplate;\nimport org.springframework.stereotype.Service;\nimport com.couchbase.client.java.Cluster;\n\n@Service\npublic class MyService {\n\n @Autowired\n private CouchbaseTemplate couchbaseTemplate;\n\n @Autowired\n private Cluster cluster;\n}\n----\n====\n\nSee xref:couchbase/repository.adoc[Couchbase repositories] for more information.\n\n[[full-text-search-fts]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/commons/migrating.adoc", "title": "migrating", "heading": "Repositories & Queries", "heading_level": 2, "file_order": 0, "section_index": 6, "content_hash": "a94394e0c557ba27a6f9e1444d2210705a243eb7a1cc69505d2187084a80af59", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/commons/migrating.adoc"}}
{"id": "sha256:bf47b156a94d1e98ad55a13a554794de7824c886db45a0baa0fcb13567e66d64", "content": "The FTS API has been simplified and now can be accessed via the `Cluster` class:\n\n====\n[source,java]\n----\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\nimport com.couchbase.client.java.Cluster;\nimport com.couchbase.client.java.search.result.SearchResult;\nimport com.couchbase.client.java.search.result.SearchRow;\nimport com.couchbase.client.core.error.CouchbaseException;\n\n@Service\npublic class MyService {\n\n @Autowired\n private Cluster cluster;\n\n public void myMethod() {\n try {\n final SearchResult result = cluster\n .searchQuery(\"index\", SearchQuery.queryString(\"query\"));\n\n for (SearchRow row : result.rows()) {\n System.out.println(\"Found row: \" + row);\n }\n\n System.out.println(\"Reported total rows: \"\n + result.metaData().metrics().totalRows());\n } catch (CouchbaseException ex) {\n ex.printStackTrace();\n }\n }\n}\n----\n====\n\nSee link:https://docs.couchbase.com/java-sdk/current/howtos/full-text-searching-with-sdk.html[the FTS Documentation] for more information.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/commons/migrating.adoc", "title": "migrating", "heading": "Full Text Search (FTS)", "heading_level": 2, "file_order": 0, "section_index": 7, "content_hash": "bf47b156a94d1e98ad55a13a554794de7824c886db45a0baa0fcb13567e66d64", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/commons/migrating.adoc"}}
{"id": "sha256:43cbd2549100ed63938f23081eadc0002eee8b9c544f083a434936d68ae31979", "content": "include::{commons}@data-commons::page$upgrade.adoc[]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/commons/upgrade.adoc", "title": "upgrade", "heading": "upgrade", "heading_level": 1, "file_order": 1, "section_index": 0, "content_hash": "43cbd2549100ed63938f23081eadc0002eee8b9c544f083a434936d68ae31979", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/commons/upgrade.adoc"}}
{"id": "sha256:89618b4ebb9d3f9a988a4fa3e6dd498fe9c53ed1200ad38d1c7525d49492a7db", "content": "[[couchbase.ansijoins]]\n\nThis chapter describes hows ANSI joins can be used across entities.\nSince 5.5 version, Couchbase server provides support for ANSI joins for joining documents using fields.\nPrevious versions allowed index & lookup joins, which were supported in SDC only by querying directly through the SDK.\n\nRelationships between entities across repositories can be one to one or one to many.\nBy defining such relationships, a synchronized view of associated entities can be fetched.\n\n[[couchbase.ansijoins.configuration]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/ansijoins.adoc", "title": "ansijoins", "heading": "ansijoins", "heading_level": 1, "file_order": 2, "section_index": 0, "content_hash": "89618b4ebb9d3f9a988a4fa3e6dd498fe9c53ed1200ad38d1c7525d49492a7db", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/ansijoins.adoc"}}
{"id": "sha256:0c2b8bde600fca55a6a5bf9f4c6db6eb1256d5f0d9a385e99e30a80978505c7c", "content": "Associated entities can be fetched by annotating the entity's property reference with `@N1qlJoin`.\nThe prefix `lks` refers to left-hand side key space (current entity) and `rks` refers to the right-hand side key space (associated entity).\nThe required element for `@N1qlJoin` annotation is the `on` clause, a boolean expression representing the join condition between the left-hand side (`lks`) and the right-hand side (`rks`), which can be fields, constant expressions or any complex N1QL expression.\nThere could also be an optional `where` clause specified on the annotation for the join, similarly using\n`lks` to refer the current entity and `rks` to refer the associated entity.\n\n.Annotation for ANSI Join\n====\n[source,java]\n----\n@Document\npublic class Author {\n @Id\n String id;\n\n String name;\n\n @N1qlJoin(on = \"lks.name=rks.authorName\")\n List<Book> books;\n\n @N1qlJoin(on = \"lks.name=rks.name\")\n Address address;\n ...\n}\n----\n====\n\n[[couchbase.ansijoins.fetchtype]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/ansijoins.adoc", "title": "ansijoins", "heading": "Configuration", "heading_level": 2, "file_order": 2, "section_index": 1, "content_hash": "0c2b8bde600fca55a6a5bf9f4c6db6eb1256d5f0d9a385e99e30a80978505c7c", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/ansijoins.adoc"}}
{"id": "sha256:78bce660f946fd24b6a8f8f14ad81286f51dc2a358cd47fab907bc4bae6ce5cf", "content": "Associated entities can be lazily fetched upon the first access of the property, this could save on fetching more data than required when loading the entity.\nTo load the associated entities lazily, `@N1qlJoin` annotation's element `fetchType`\nhas to be set to `FetchType.LAZY`.\nThe default is `FetchType.IMMEDIATE`.\n\n.Configuration for lazy fetch\n====\n[source,java]\n----\n@N1qlJoin(on = \"lks.name=rks.authorName\", fetchType = FetchType.LAZY)\nList<Book> books;\n----\n====\n\n[[couchbase.ansijoins.joinhints]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/ansijoins.adoc", "title": "ansijoins", "heading": "Lazy fetching", "heading_level": 2, "file_order": 2, "section_index": 2, "content_hash": "78bce660f946fd24b6a8f8f14ad81286f51dc2a358cd47fab907bc4bae6ce5cf", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/ansijoins.adoc"}}
{"id": "sha256:85382560a39cac44dc7a40945ce2491f1696dc37a896a0797104a26b442b97a8", "content": "[[use-index-hint]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/ansijoins.adoc", "title": "ansijoins", "heading": "ANSI Join Hints", "heading_level": 2, "file_order": 2, "section_index": 3, "content_hash": "85382560a39cac44dc7a40945ce2491f1696dc37a896a0797104a26b442b97a8", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/ansijoins.adoc"}}
{"id": "sha256:8b49025820d254d1e704077865a8f2d977e1725f756406671d42a581ef1deb45", "content": "`index` element on the `@N1qlJoin` can be used to provided the hint for the `lks` (current entity) index and `rightIndex`\nelement can be used to provided the `rks` (associated entity) index.\n\n[[hash-join-hint]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/ansijoins.adoc", "title": "ansijoins", "heading": "Use Index Hint", "heading_level": 3, "file_order": 2, "section_index": 4, "content_hash": "8b49025820d254d1e704077865a8f2d977e1725f756406671d42a581ef1deb45", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/ansijoins.adoc"}}
{"id": "sha256:d602392865ddd8112bdaf009704e1d807b77ee255b52774bd0798bee86a3c664", "content": "If the join type is going to be hash join, the hash side can be specified for the `rks` (associated entity).\nIf the associated entity is on the build side, it can be specified as `HashSide.BUILD` else `HashSide.PROBE`.\n\n[[use-keys-hint]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/ansijoins.adoc", "title": "ansijoins", "heading": "Hash Join Hint", "heading_level": 3, "file_order": 2, "section_index": 5, "content_hash": "d602392865ddd8112bdaf009704e1d807b77ee255b52774bd0798bee86a3c664", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/ansijoins.adoc"}}
{"id": "sha256:a48aae84b6ed7aaf0da40a6bb3450c0719812a6b24dee624ee6c8e27c36f5eba", "content": "`keys` element on the `@N1qlJoin` annotation can be used to specify unique document keys to restrict the join key space.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/ansijoins.adoc", "title": "ansijoins", "heading": "Use Keys Hint", "heading_level": 3, "file_order": 2, "section_index": 6, "content_hash": "a48aae84b6ed7aaf0da40a6bb3450c0719812a6b24dee624ee6c8e27c36f5eba", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/ansijoins.adoc"}}
{"id": "sha256:6013556e86cb1de7778ea9dbdfa927a5e5c9d671da8f2933a652d12015863c83", "content": "[[couchbase.autokeygeneration]]\n\nThis chapter describes how couchbase document keys can be auto-generated using builtin mechanisms.\nThere are two types of auto-generation strategies supported.\n\n- xref:couchbase/autokeygeneration.adoc#couchbase.autokeygeneration.usingattributes[Key generation using attributes]\n- xref:couchbase/autokeygeneration.adoc#couchbase.autokeygeneration.unique[Key generation using uuid]\n\nNOTE: The maximum key length supported by couchbase is 250 bytes.\n\n[[couchbase.autokeygeneration.configuration]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/autokeygeneration.adoc", "title": "autokeygeneration", "heading": "autokeygeneration", "heading_level": 1, "file_order": 3, "section_index": 0, "content_hash": "6013556e86cb1de7778ea9dbdfa927a5e5c9d671da8f2933a652d12015863c83", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/autokeygeneration.adoc"}}
{"id": "sha256:3f6dd6216fad8fc2a79ecefff29e38a6618d7374f7f72aebb2b35e92a1a1cc6b", "content": "Keys to be auto-generated should be annotated with `@GeneratedValue`.\nThe default strategy is `USE_ATTRIBUTES`.\nPrefix and suffix for the key can be provided as part of the entity itself, these values are not persisted, they are only used for key generation.\nThe prefixes and suffixes are ordered using the `order` value.\nThe default order is `0`, multiple prefixes without order will overwrite the previous.\nIf a value for id is already available, auto-generation will be skipped.\nThe delimiter for concatenation can be provided using `delimiter`, the default delimiter is `.`.\n\n.Annotation for GeneratedValue\n====\n[source,java]\n----\n@Document\npublic class User {\n @Id @GeneratedValue(strategy = USE_ATTRIBUTES, delimiter = \".\")\n private String id;\n @IdPrefix(order=0)\n private String userPrefix;\n @IdSuffix(order=0)\n private String userSuffix;\n ...\n}\n----\n====\n\n[[couchbase.autokeygeneration.usingattributes]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/autokeygeneration.adoc", "title": "autokeygeneration", "heading": "Configuration", "heading_level": 2, "file_order": 3, "section_index": 1, "content_hash": "3f6dd6216fad8fc2a79ecefff29e38a6618d7374f7f72aebb2b35e92a1a1cc6b", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/autokeygeneration.adoc"}}
{"id": "sha256:e6c4e81f0f4e8914b6322056a6f1c7147a5c059548bec8cf61bc4ee98b9bf875", "content": "It is a common practice to generate keys using a combination of the document attributes.\nKey generation using attributes concatenates all the attribute values annotated with `IdAttribute`, based on the ordering provided similar to prefixes and suffixes.\n\n.Annotation for IdAttribute\n====\n[source,java]\n----\n@Document\npublic class User {\n @Id @GeneratedValue(strategy = USE_ATTRIBUTES)\n private String id;\n @IdAttribute\n private String userid;\n ...\n}\n----\n====\n\n[[couchbase.autokeygeneration.unique]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/autokeygeneration.adoc", "title": "autokeygeneration", "heading": "Key generation using attributes", "heading_level": 2, "file_order": 3, "section_index": 2, "content_hash": "e6c4e81f0f4e8914b6322056a6f1c7147a5c059548bec8cf61bc4ee98b9bf875", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/autokeygeneration.adoc"}}
{"id": "sha256:7aa9e4d6778b32df1752e93b22ce522b349a13b5656235841af4fdd5b9ee5733", "content": "This auto-generation uses UUID random generator to generate document keys consuming 16 bytes of key space.\nThis mechanism is only recommended for test scaffolding.\n\n.Annotation for Unique key generation\n====\n[source,java]\n----\n@Document\npublic class User {\n @Id @GeneratedValue(strategy = UNIQUE)\n private String id;\n ...\n}\n----\n====", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/autokeygeneration.adoc", "title": "autokeygeneration", "heading": "Key generation using uuid", "heading_level": 2, "file_order": 3, "section_index": 3, "content_hash": "7aa9e4d6778b32df1752e93b22ce522b349a13b5656235841af4fdd5b9ee5733", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/autokeygeneration.adoc"}}
{"id": "sha256:d8f7ccad4346edd809d3425eef09d1c3f572ad1dc8659b87ba225c0f97c91489", "content": "[[couchbase.caching]]\n\nThis chapter describes additional support for caching and `@Cacheable`.\n\n[[caching.usage]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/caching.adoc", "title": "caching", "heading": "caching", "heading_level": 1, "file_order": 4, "section_index": 0, "content_hash": "d8f7ccad4346edd809d3425eef09d1c3f572ad1dc8659b87ba225c0f97c91489", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/caching.adoc"}}
{"id": "sha256:f50cfe84dec3cfcc6dedb1578ec0cd62d62c145e3411be1f3a05fd4cfae32971", "content": "Technically, caching is not part of spring-data, but is implemented directly in the spring core. Most database implementations in the spring-data package can't support `@Cacheable`, because it is not possible to store arbitrary data.\n\nCouchbase supports both binary and JSON data, so you can get both out of the same database.\n\nTo make it work, you need to add the `@EnableCaching` annotation and configure the `cacheManager` bean:\n\n.`AbstractCouchbaseConfiguration` for Caching\n====\n[source,java]\n----\n\n@Configuration\n@EnableCaching\npublic class Config extends AbstractCouchbaseConfiguration {\n // general methods\n\n @Bean\n public CouchbaseCacheManager cacheManager(CouchbaseTemplate couchbaseTemplate) throws Exception {\n CouchbaseCacheManager.CouchbaseCacheManagerBuilder builder = CouchbaseCacheManager.CouchbaseCacheManagerBuilder\n .fromConnectionFactory(couchbaseTemplate.getCouchbaseClientFactory());\n builder.withCacheConfiguration(\"mySpringCache\", CouchbaseCacheConfiguration.defaultCacheConfig());\n return builder.build();\n }\n----\n====\n\nThe `persistent` identifier can then be used on the `@Cacheable` annotation to identify the cache manager to use (you can have more than one configured).\n\nOnce it is set up, you can annotate every method with the `@Cacheable` annotation to transparently cache it in your couchbase bucket. You can also customize how the key is generated.\n\n.Caching example\n====\n[source,java]\n----\n@Cacheable(value=\"persistent\", key=\"'longrunsim-'+#time\")\npublic String simulateLongRun(long time) {\n try {\n Thread.sleep(time);\n } catch(Exception ex) {\n System.out.println(\"This shouldnt happen...\");\n }\n return \"I've slept \" + time + \" miliseconds.;\n}\n----\n====\n\nIf you run the method multiple times, you'll see a set operation happening first, followed by multiple get operations and no sleep time (which fakes the expensive execution). You can store whatever you want, if it is JSON of course you can access it through views and look at it in the Web UI.\n\nNote that to use cache.clear() or cache.invalidate(), the bucket must have a primary key.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/caching.adoc", "title": "caching", "heading": "Configuration & Usage", "heading_level": 2, "file_order": 4, "section_index": 1, "content_hash": "f50cfe84dec3cfcc6dedb1578ec0cd62d62c145e3411be1f3a05fd4cfae32971", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/caching.adoc"}}
{"id": "sha256:4080e0debf1acf462f2a1a00a057d51094a5733f36a43a15d890ce71b25eb991", "content": "[[couchbase.collections]]\n\nCouchbase supports https://docs.couchbase.com/server/current/learn/data/scopes-and-collections.html[Scopes and Collections]. This section documents on how to use it with Spring Data Couchbase.\n\nThe https://github.com/couchbaselabs/try-cb-spring[try-cb-spring] sample application is a working example of using Scopes and Collections in Spring Data Couchbase.\n\nThe 2021 Couchbase Connect presentation on Collections in Spring Data can be found at https://www.youtube.com/watch?v=MrplTeEFItk[Presentation Only] and https://web.cvent.com/hub/events/1dce8283-986d-4de9-8368-94c98f60df01/sessions/9ee89a85-833c-4e0c-81b0-807864fa351b?goBackHref=%2Fevents%2F1dce8283-986d-4de9-8368-94c98f60df01%2Fsessions&goBackName=Add%2FView+Sessions&goBackTab=all[Presentation with Slide Deck]\n\n[[requirements]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/collections.adoc", "title": "collections", "heading": "collections", "heading_level": 1, "file_order": 5, "section_index": 0, "content_hash": "4080e0debf1acf462f2a1a00a057d51094a5733f36a43a15d890ce71b25eb991", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/collections.adoc"}}
{"id": "sha256:582359614ea4a03538596c3a6c6b6e86b7eef4d5783cd4f1f2ca49b7d9f053cf", "content": "- Couchbase Server 7.0 or above.\n - Spring Data Couchbase 4.3.1 or above.\n\n[[getting-started-configuration]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/collections.adoc", "title": "collections", "heading": "Requirements", "heading_level": 2, "file_order": 5, "section_index": 1, "content_hash": "582359614ea4a03538596c3a6c6b6e86b7eef4d5783cd4f1f2ca49b7d9f053cf", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/collections.adoc"}}
{"id": "sha256:a8de3858ff035bc34e0e2313248533f9fe05fb658ba6e95805a4fb00aa6d78d5", "content": "[[scope-and-collection-specification]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/collections.adoc", "title": "collections", "heading": "Getting Started & Configuration", "heading_level": 2, "file_order": 5, "section_index": 2, "content_hash": "a8de3858ff035bc34e0e2313248533f9fe05fb658ba6e95805a4fb00aa6d78d5", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/collections.adoc"}}
{"id": "sha256:fc0a22062457eac68cf4c55ad4f2a0453c2f4676bc4b0324d5188ca1db2bb3f2", "content": "There are several mechanisms of specifying scopes and collections, and these may be combined, or one mechanism may override another.\nFirst some definitions for scopes and collections. An unspecified scope indicates that the default scope is to be used, likewise, an\nunspecified collection indicates that the default collection is to be used.\nThere are only three combinations of scopes and collections that are valid. (1) the default scope and the default collection; (2) the default\nscope and a non-default collection; and (3) a non-default scope and a non-default collection. It is not possible to have a non-default\nscope and a default collection as non-default scopes do not contain a default collections, neither can one be created.\n\nA scope can be specified in the configuration:\n[source,java]\n----\n@Configuration\nstatic class Config extends AbstractCouchbaseConfiguration {\n\n // Usual Setup\n @Override public String getConnectionString() { /* ... */ }\n\n // optionally specify the scope in the Configuration\n @Override\n protected String getScopeName() {\n return \"myScope\"; // or a variable etc.;\n }\n\n}\n----\nScopes and Collections can be specified as annotations on entity classes and repositories:\n[source,java]\n----\n@Document\n@Scope(\"travel\")\n@Collection(\"airport\")\npublic class Airport {...\n----\n\n[source,java]\n----\n@Scope(\"travel\")\n@Collection(\"airport\")\npublic interface AirportRepository extends CouchbaseRepository<Airport, String> ...\n----\n\nScopes and Collections can be specified on templates using the inScope(scopeName) and inCollection(collectionName) fluent APIs:\n[source,java]\n----\nList<Airport> airports = template.findByQuery(Airport.class).inScope(\"archived\").all()\n----\n\nScopes and Collections can be specified on repositories that extend DynamicProxyable using the withScope(scopeName) and withCollection(collectionName) APIs:\n[source,java]\n----\npublic interface AirportRepository extends CouchbaseRepository<Airport, String>, DynamicProxyable<AirportRepository>{...}\n...\nList<Airport> airports = airportRepository.withScope(\"archived\").findByName(iata);\n----\n\n.The order of precedence is:\n. inScope()/inCollection() of the template fluent api\n. withScope()/withCollection() of the template/repository object\n. annotation of the repository method\n. annotation of the repository interface\n. annotation of the entity object\n. getScope() of the configuration", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/collections.adoc", "title": "collections", "heading": "Scope and Collection Specification", "heading_level": 3, "file_order": 5, "section_index": 3, "content_hash": "fc0a22062457eac68cf4c55ad4f2a0453c2f4676bc4b0324d5188ca1db2bb3f2", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/collections.adoc"}}
{"id": "sha256:ee3a5b6905e787eef792bf71674b9150b22adc5d45a5f36a97ad5246620796f1", "content": "[[couchbase.configuration]]\n\nThis chapter describes the common installation and configuration steps needed when working with the library.\n\n[[installation]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/configuration.adoc", "title": "configuration", "heading": "configuration", "heading_level": 1, "file_order": 6, "section_index": 0, "content_hash": "ee3a5b6905e787eef792bf71674b9150b22adc5d45a5f36a97ad5246620796f1", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/configuration.adoc"}}
{"id": "sha256:bdd8596c7697355568719f08efe7efc3b73063390f920e295ed45004b357619b", "content": "All versions intended for production use are distributed across Maven Central and the Spring release repository.\nAs a result, the library can be included like any other maven dependency:\n\n[[compatibility]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/configuration.adoc", "title": "configuration", "heading": "Installation", "heading_level": 2, "file_order": 6, "section_index": 1, "content_hash": "bdd8596c7697355568719f08efe7efc3b73063390f920e295ed45004b357619b", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/configuration.adoc"}}
{"id": "sha256:5d2e698f6de5c75eac2e57b32909cca38660f97a60bea53eb73e5bfb21028317", "content": "The simplest way to get the correct dependencies is by making a project with https://start.spring.io/[spring initializr]\nThe parent Spring Boot Starter artfacts have the required dependencies, they do not need to be specified.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/configuration.adoc", "title": "configuration", "heading": "Compatibility", "heading_level": 2, "file_order": 6, "section_index": 2, "content_hash": "5d2e698f6de5c75eac2e57b32909cca38660f97a60bea53eb73e5bfb21028317", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/configuration.adoc"}}
{"id": "sha256:3923b6b84a542ffc485b73db043cc08e55bd9a7f99af77631ad51c3067112c0b", "content": "* Spring Boot 3.4.* uses Spring Data Couchbase 5.4.*.\n* Spring Boot 3.3.* uses Spring Data Couchbase 5.3.*.\n* Spring Boot 3.2.* uses Spring Data Couchbase 5.2.*.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/configuration.adoc", "title": "configuration", "heading": "Spring Boot Version Compatibility", "heading_level": 3, "file_order": 6, "section_index": 3, "content_hash": "3923b6b84a542ffc485b73db043cc08e55bd9a7f99af77631ad51c3067112c0b", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/configuration.adoc"}}
{"id": "sha256:e62196646c8ac96a6a38b950971ca0c7f143c9b1c2f448b79b5799d626a2cfe0", "content": "* Spring Data Couchbase 5.4.* depends on Couchbase Java SDK 3.7.*\n* Spring Data Couchbase 5.3.* depends on Couchbase Java SDK 3.6.*\n* Spring Data Couchbase 5.2.* depends on Couchbase Java SDK 3.3.*\n\n[[configuration]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/configuration.adoc", "title": "configuration", "heading": "Couchbase Java SDK Compatibility", "heading_level": 3, "file_order": 6, "section_index": 4, "content_hash": "e62196646c8ac96a6a38b950971ca0c7f143c9b1c2f448b79b5799d626a2cfe0", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/configuration.adoc"}}
{"id": "sha256:8ad5a110081a360e8d6c942616745005449df2b5d4e9db05223273943b4911da", "content": ".Including the dependency through maven\n====\n[source,xml,subs=\"+attributes\"]\n----\n<dependency>\n <groupId>org.springframework.data</groupId>\n <artifactId>spring-data-couchbase</artifactId>\n <version>{version}</version>\n</dependency>\n----\n====\n\nThis will pull in several dependencies, including the underlying Couchbase Java SDK, common Spring dependencies and also Jackson as the JSON mapping infrastructure.\n\nYou can also grab snapshots from the https://repo.spring.io/ui/repos/tree/General/snapshot/org/springframework/data/spring-data-couchbase[spring snapshot repository] ( \\https://repo.spring.io/snapshot ) and milestone releases from the https://repo.spring.io/ui/repos/tree/General/milestone/org/springframework/data/spring-data-couchbase[spring milestone repository] ( \\https://repo.spring.io/milestone ).\nHere is an example on how to use the current SNAPSHOT dependency:\n\n[[snapshot-configuration]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/configuration.adoc", "title": "configuration", "heading": "Configuration", "heading_level": 2, "file_order": 6, "section_index": 5, "content_hash": "8ad5a110081a360e8d6c942616745005449df2b5d4e9db05223273943b4911da", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/configuration.adoc"}}
{"id": "sha256:e18303a23b87c255aa393821e6f78dc59cdaf0cdc8cb861ede38f2413eb38ab9", "content": ".Using a snapshot version\n====\n[source,xml]\n----\n<dependency>\n <groupId>org.springframework.data</groupId>\n <artifactId>spring-data-couchbase</artifactId>\n <version>${version}-SNAPSHOT</version>\n</dependency>\n\n<repository>\n <id>spring-snapshot</id>\n <name>Spring Snapshot Repository</name>\n <url>https://repo.spring.io/snapshot</url>\n</repository>\n----\n====\n\n[[overriding-the-couchbase-sdk-version]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/configuration.adoc", "title": "configuration", "heading": "Snapshot Configuration", "heading_level": 2, "file_order": 6, "section_index": 6, "content_hash": "e18303a23b87c255aa393821e6f78dc59cdaf0cdc8cb861ede38f2413eb38ab9", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/configuration.adoc"}}
{"id": "sha256:2d68991f7703aa5c0822450c108e1e6ffb66f4e6e60c4e55a8f393d4a218554c", "content": "Some users may wish to use a Couchbase Java SDK version different from the one referenced in a Spring Data Couchbase release for the purpose of obtaining bug and vulnerability fixes. Since Couchbase Java SDK minor version releases are backwards compatible, this version of Spring Data Couchbase is compatible and supported with any 3.x version of the Couchbase Java SDK newer than the one specified in the release dependencies. To change the Couchbase Java SDK version used by Spring Data Couchbase, simply override the dependency in the application pom.xml as follows:\n\n.If Using the spring-data-couchbase Dependency Directly\n====\n[source,xml]\n----\n<dependency>\n <groupId>org.springframework.data</groupId>\n <artifactId>spring-data-couchbase</artifactId>\n <version>${version}</version>\n <exclusions> <!-- exclude Couchbase Java SDK -->\n <exclusion>\n <groupId>com.couchbase.client</groupId>\n <artifactId>java-client</artifactId>\n </exclusion>\n </exclusions>\n</dependency>\n\n<dependency> <!-- add dependency for specific Couchbase Java SDK version -->\n <groupId>com.couchbase.client</groupId>\n <artifactId>java-client</artifactId>\n <version>3.4.7</version>\n</dependency>\n----\n====\n\n.If Using the spring-data-starter-couchbase Dependency (from Spring Initialzr)\n====\n[source,xml]\n----\n<parent>\n <groupId>org.springframework.boot</groupId>\n <artifactId>spring-boot-starter-parent</artifactId>\n <version>x.y.z</version>\n <relativePath/>\n</parent>\n\n<dependency>\n <groupId>org.springframework.boot</groupId>\n <artifactId>spring-boot-starter-data-couchbase</artifactId>\n <exclusions> <!-- exclude Couchbase Java SDK -->\n <exclusion>\n <groupId>com.couchbase.client</groupId>\n <artifactId>java-client</artifactId>\n </exclusion>\n </exclusions>\n</dependency>\n\n<dependency> <!-- add dependency for specific Couchbase Java SDK version -->\n <groupId>com.couchbase.client</groupId>\n <artifactId>java-client</artifactId>\n <version>3.4.7</version>\n</dependency>\n----\n====\n\nOnce you have all needed dependencies on the classpath, you can start configuring it.\nOnly Java config is supported (XML config has been removed in 4.0).\n\n[[configuration-java]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/configuration.adoc", "title": "configuration", "heading": "Overriding the Couchbase SDK Version", "heading_level": 2, "file_order": 6, "section_index": 7, "content_hash": "2d68991f7703aa5c0822450c108e1e6ffb66f4e6e60c4e55a8f393d4a218554c", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/configuration.adoc"}}
{"id": "sha256:47272a6ffe0c2bf593c3ba9348d3cf2f92bc1b62c3fe48a5117124a7770c43b4", "content": "To get started, all you need to do is subclass the `AbstractCouchbaseConfiguration` and implement the abstract methods.\n\n.Extending the `AbstractCouchbaseConfiguration`\n====\n[source,java]\n----\n\n@Configuration\npublic class Config extends AbstractCouchbaseConfiguration {\n\n @Override\n public String getConnectionString() {\n return \"couchbase://127.0.0.1\";\n }\n\n @Override\n public String getUserName() {\n return \"Administrator\";\n }\n\n @Override\n public String getPassword() {\n return \"password\";\n }\n\n @Override\n public String getBucketName() {\n return \"travel-sample\";\n }\n}\n----\n====\n\nThe connection string is made up of a list of hosts and an optional scheme (`couchbase://`) as shown in the code above.\nAll you need to provide is a list of Couchbase nodes to bootstrap into (separated by a `,`). Please note that while one\nhost is sufficient in development, it is recommended to add 3 to 5 bootstrap nodes here. Couchbase will pick up all nodes\nfrom the cluster automatically, but it could be the case that the only node you've provided is experiencing issues while\nyou are starting the application.\n\nThe `userName` and `password` are configured in your Couchbase Server cluster through RBAC (role-based access control).\nThe `bucketName` reflects the bucket you want to use for this configuration.\n\nAdditionally, the SDK environment can be tuned by overriding the `configureEnvironment` method which takes a\n`ClusterEnvironment.Builder` to return a configured `ClusterEnvironment`.\n\nMany more things can be customized and overridden as custom beans from this configuration (for example repositories,\nvalidation and custom converters).\n\nTIP: If you use `SyncGateway` and `CouchbaseMobile`, you may run into problem with fields prefixed by `_`.\nSince Spring Data Couchbase by default stores the type information as a `_class` attribute this can be problematic.\nOverride `typeKey()` (for example to return `MappingCouchbaseConverter.TYPEKEY_SYNCGATEWAY_COMPATIBLE`) to change the\nname of said attribute.\n\nIf you start your application, you should see Couchbase INFO level logging in the logs, indicating that the underlying\nCouchbase Java SDK is connecting to the database.If any errors are reported, make sure that the given credentials\nand host information are correct.\n\n[[configuring-multiple-buckets]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/configuration.adoc", "title": "configuration", "heading": "Annotation-based Configuration (\"JavaConfig\")", "heading_level": 2, "file_order": 6, "section_index": 8, "content_hash": "47272a6ffe0c2bf593c3ba9348d3cf2f92bc1b62c3fe48a5117124a7770c43b4", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/configuration.adoc"}}
{"id": "sha256:69ab030d5e02660d43c865056eb573d6d4f4641804400e5eebc51e38a12b4c1b", "content": "To leverage multi-bucket repositories, implement the methods below in your Config class.\nThe config*OperationsMapping methods configure the mapping of entity-objects to buckets.\nBe careful with the method names - using a method name that is a Bean will result in the value of that bean being used instead of the result of the method.\n\nThis example maps Person -> protected, User -> mybucket, and everything else goes to getBucketName().\nNote that this only maps calls through the Repository.\n\n====\n[source,java]\n----\n@Override\npublic void configureReactiveRepositoryOperationsMapping(ReactiveRepositoryOperationsMapping baseMapping) {\n try {\n ReactiveCouchbaseTemplate personTemplate = myReactiveCouchbaseTemplate(myCouchbaseClientFactory(\"protected\"),new MappingCouchbaseConverter());\n baseMapping.mapEntity(Person.class, personTemplate); // Person goes in \"protected\" bucket\n ReactiveCouchbaseTemplate userTemplate = myReactiveCouchbaseTemplate(myCouchbaseClientFactory(\"mybucket\"),new MappingCouchbaseConverter());\n baseMapping.mapEntity(User.class, userTemplate); // User goes in \"mybucket\"\n // everything else goes in getBucketName()\n } catch (Exception e) {\n throw e;\n }\n}\n@Override\npublic void configureRepositoryOperationsMapping(RepositoryOperationsMapping baseMapping) {\n try {\n CouchbaseTemplate personTemplate = myCouchbaseTemplate(myCouchbaseClientFactory(\"protected\"),new MappingCouchbaseConverter());\n baseMapping.mapEntity(Person.class, personTemplate); // Person goes in \"protected\" bucket\n CouchbaseTemplate userTemplate = myCouchbaseTemplate(myCouchbaseClientFactory(\"mybucket\"),new MappingCouchbaseConverter());\n baseMapping.mapEntity(User.class, userTemplate); // User goes in \"mybucket\"\n // everything else goes in getBucketName()\n } catch (Exception e) {\n throw e;\n }\n}\n\npublic ReactiveCouchbaseTemplate myReactiveCouchbaseTemplate(CouchbaseClientFactory couchbaseClientFactory,\n MappingCouchbaseConverter mappingCouchbaseConverter) {\n return new ReactiveCouchbaseTemplate(couchbaseClientFactory, mappingCouchbaseConverter);\n}\n\npublic CouchbaseTemplate myCouchbaseTemplate(CouchbaseClientFactory couchbaseClientFactory,\n MappingCouchbaseConverter mappingCouchbaseConverter) {\n return new CouchbaseTemplate(couchbaseClientFactory, mappingCouchbaseConverter);\n}\n\npublic CouchbaseClientFactory myCouchbaseClientFactory(String bucketName) {\n return new SimpleCouchbaseClientFactory(getConnectionString(),authenticator(), bucketName );\n}\n----\n====", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/configuration.adoc", "title": "configuration", "heading": "Configuring Multiple Buckets", "heading_level": 2, "file_order": 6, "section_index": 9, "content_hash": "69ab030d5e02660d43c865056eb573d6d4f4641804400e5eebc51e38a12b4c1b", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/configuration.adoc"}}
{"id": "sha256:251738f9b7b2c5587d4e93205f49a3afb5fe262ed9572381a2c46a3cc1613127", "content": "[[couchbase.entity]]\n\nThis chapter describes how to model Entities and explains their counterpart representation in Couchbase Server itself.\n\ninclude::{commons}@data-commons::page$object-mapping.adoc[leveloffset=+1]\n\n[[basics]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/entity.adoc", "title": "entity", "heading": "entity", "heading_level": 1, "file_order": 7, "section_index": 0, "content_hash": "251738f9b7b2c5587d4e93205f49a3afb5fe262ed9572381a2c46a3cc1613127", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/entity.adoc"}}
{"id": "sha256:7670aded5bab3cef8f52ba2c47f89ab897d823f624ae11eb89e932e921acc5ab", "content": "All entities should be annotated with the `@Document` annotation, but it is not a requirement.\n\nAlso, every field in the entity should be annotated with the `@Field` annotation. While this is - strictly speaking -\noptional, it helps to reduce edge cases and clearly shows the intent and design of the entity. It can also be used to\nstore the field under a different name.\n\nThere is also a special `@Id` annotation which needs to be always in place. Best practice is to also name the property\n`id`.\n\nHere is a very simple `User` entity:\n\n.A simple Document with Fields\n====\n[source,java]\n----\nimport org.springframework.data.annotation.Id;\nimport org.springframework.data.couchbase.core.mapping.Field;\nimport org.springframework.data.couchbase.core.mapping.Document;\n\n@Document\npublic class User {\n\n @Id\n private String id;\n\n @Field\n private String firstname;\n\n @Field\n private String lastname;\n\n public User(String id, String firstname, String lastname) {\n this.id = id;\n this.firstname = firstname;\n this.lastname = lastname;\n }\n\n public String getId() {\n return id;\n }\n\n public String getFirstname() {\n return firstname;\n }\n\n public String getLastname() {\n return lastname;\n }\n}\n\n----\n====\n\nCouchbase Server supports automatic expiration for documents.\nThe library implements support for it through the `@Document` annotation.\nYou can set a `expiry` value which translates to the number of seconds until the document gets removed automatically.\nIf you want to make it expire in 10 seconds after mutation, set it like `@Document(expiry = 10)`.\nAlternatively, you can configure the expiry using Spring's property support and the `expiryExpression` parameter, to allow for dynamically changing the expiry value.\nFor example: `@Document(expiryExpression = \"${valid.document.expiry}\")`.\nThe property must be resolvable to an int value and the two approaches cannot be mixed.\n\nIf you want a different representation of the field name inside the document in contrast to the field name used in your entity, you can set a different name on the `@Field` annotation.\nFor example if you want to keep your documents small you can set the firstname field to `@Field(\"fname\")`.\nIn the JSON document, you'll see `{\"fname\": \"..\"}` instead of `{\"firstname\": \"..\"}`.\n\nThe `@Id` annotation needs to be present because every document in Couchbase needs a unique key.\nThis key needs to be any string with a length of maximum 250 characters.\nFeel free to use whatever fits your use case, be it a UUID, an email address or anything else.\n\nWrites to Couchbase-Server buckets can optionally be assigned durability requirements; which instruct Couchbase Server to update the specified document on multiple nodes in memory and/or disk locations across the cluster; before considering the write to be committed.\nDefault durability requirements can also be configured through the `@Document` or `@Durability` annotations.\nFor example: `@Document(durabilityLevel = DurabilityLevel.MAJORITY)` will force mutations to be replicated to a majority of the Data Service nodes. Both of the annotations support expression based durability level assignment via `durabilityExpression` attribute (Note SPEL is not supported).\n[[datatypes]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/entity.adoc", "title": "entity", "heading": "Documents and Fields", "heading_level": 2, "file_order": 7, "section_index": 1, "content_hash": "7670aded5bab3cef8f52ba2c47f89ab897d823f624ae11eb89e932e921acc5ab", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/entity.adoc"}}
{"id": "sha256:5738d1ad7ef1a11c751344638d06d710943b9877ca33fd9002a2f876b1f55ce5", "content": "The storage format of choice is JSON. It is great, but like many data representations it allows less datatypes than you could express in Java directly.\nTherefore, for all non-primitive types some form of conversion to and from supported types needs to happen.\n\nFor the following entity field types, you don't need to add special handling:\n\n[cols=\"2\",options=\"header\"]\n.Primitive Types\n|===\n| Java Type\n| JSON Representation\n\n| string\n| string\n\n| boolean\n| boolean\n\n| byte\n| number\n\n| short\n| number\n\n| int\n| number\n\n| long\n| number\n\n| float\n| number\n\n| double\n| number\n\n| null\n| Ignored on write\n|===\n\nSince JSON supports objects (\"maps\") and lists, `Map` and `List` types can be converted naturally.\nIf they only contain primitive field types from the last paragraph, you don't need to add special handling too.\nHere is an example:\n\n.A Document with Map and List\n====\n[source,java]\n----\n\n@Document\npublic class User {\n\n @Id\n private String id;\n\n @Field\n private List<String> firstnames;\n\n @Field\n private Map<String, Integer> childrenAges;\n\n public User(String id, List<String> firstnames, Map<String, Integer> childrenAges) {\n this.id = id;\n this.firstnames = firstnames;\n this.childrenAges = childrenAges;\n }\n\n}\n----\n====\n\nStoring a user with some sample data could look like this as a JSON representation:\n\n.A Document with Map and List - JSON\n====\n[source,json]\n----\n\n{\n \"_class\": \"foo.User\",\n \"childrenAges\": {\n \"Alice\": 10,\n \"Bob\": 5\n },\n \"firstnames\": [\n \"Foo\",\n \"Bar\",\n \"Baz\"\n ]\n}\n----\n====\n\nYou don't need to break everything down to primitive types and Lists/Maps all the time.\nOf course, you can also compose other objects out of those primitive values.\nLet's modify the last example so that we want to store a `List` of `Children`:\n\n.A Document with composed objects\n====\n[source,java]\n----\n@Document\npublic class User {\n\n @Id\n private String id;\n\n @Field\n private List<String> firstnames;\n\n @Field\n private List<Child> children;\n\n public User(String id, List<String> firstnames, List<Child> children) {\n this.id = id;\n this.firstnames = firstnames;\n this.children = children;\n }\n\n static class Child {\n private String name;\n private int age;\n\n Child(String name, int age) {\n this.name = name;\n this.age = age;\n }\n\n }\n\n}\n----\n====\n\nA populated object can look like:\n\n.A Document with composed objects - JSON\n====\n[source,json]\n----\n\n{\n \"_class\": \"foo.User\",\n \"children\": [\n {\n \"age\": 4,\n \"name\": \"Alice\"\n },\n {\n \"age\": 3,\n \"name\": \"Bob\"\n }\n ],\n \"firstnames\": [\n \"Foo\",\n \"Bar\",\n \"Baz\"\n ]\n}\n----\n====\n\nMost of the time, you also need to store a temporal value like a `Date`.\nSince it can't be stored directly in JSON, a conversion needs to happen.\nThe library implements default converters for `Date`, `Calendar` and JodaTime types (if on the classpath).\nAll of those are represented by default in the document as a unix timestamp (number).\nYou can always override the default behavior with custom converters as shown later.\nHere is an example:\n\n.A Document with Date and Calendar\n====\n[source,java]\n----\n@Document\npublic class BlogPost {\n\n @Id\n private String id;\n\n @Field\n private Date created;\n\n @Field\n private Calendar updated;\n\n @Field\n private String title;\n\n public BlogPost(String id, Date created, Calendar updated, String title) {\n this.id = id;\n this.created = created;\n this.updated = updated;\n this.title = title;\n }\n\n}\n----\n====\n\nA populated object can look like:\n\n.A Document with Date and Calendar - JSON\n====\n[source,json]\n----\n{\n \"title\": \"a blog post title\",\n \"_class\": \"foo.BlogPost\",\n \"updated\": 1394610843,\n \"created\": 1394610843897\n}\n----\n====\n\nOptionally, Date can be converted to and from ISO-8601 compliant strings by setting system property `org.springframework.data.couchbase.useISOStringConverterForDate` to true.\nIf you want to override a converter or implement your own one, this is also possible.\nThe library implements the general Spring Converter pattern.\nYou can plug in custom converters on bean creation time in your configuration.\nHere's how you can configure it (in your overridden `AbstractCouchbaseConfiguration`):\n\n.Custom Converters\n====\n[source,java]\n----\n@Override\npublic CustomConversions customConversions() {\n return new CustomConversions(Arrays.asList(FooToBarConverter.INSTANCE, BarToFooConverter.INSTANCE));\n}\n\n@WritingConverter\npublic static enum FooToBarConverter implements Converter<Foo, Bar> {\n INSTANCE;\n\n @Override\n public Bar convert(Foo source) {\n return /* do your conversion here */;\n }\n\n}\n\n@ReadingConverter\npublic static enum BarToFooConverter implements Converter<Bar, Foo> {\n INSTANCE;\n\n @Override\n public Foo convert(Bar source) {\n return /* do your conversion here */;\n }\n\n}\n----\n====\n\nThere are a few things to keep in mind with custom conversions:\n\n* To make it unambiguous, always use the `@WritingConverter` and `@ReadingConverter` annotations on your converters.\nEspecially if you are dealing with primitive type conversions, this will help to reduce possible wrong conversions.\n* If you implement a writing converter, make sure to decode into primitive types, maps and lists only.\nIf you need more complex object types, use the `CouchbaseDocument` and `CouchbaseList` types, which are also understood by the underlying translation engine.\nYour best bet is to stick with as simple as possible conversions.\n* Always put more special converters before generic converters to avoid the case where the wrong converter gets executed.\n* For dates, reading converters should be able to read from any `Number` (not just `Long`).\nThis is required for N1QL support.\n\n[[version]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/entity.adoc", "title": "entity", "heading": "Datatypes and Converters", "heading_level": 2, "file_order": 7, "section_index": 2, "content_hash": "5738d1ad7ef1a11c751344638d06d710943b9877ca33fd9002a2f876b1f55ce5", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/entity.adoc"}}
{"id": "sha256:37e1a734f6224f795d34905086f6f468cba6884f1aafee826359e6124b08e745", "content": "In certain situations you may want to ensure that you are not overwriting another users changes when you perform a mutation operation on a document. For this you have three choices: Transactions (since Couchbase 6.5), pessimistic concurrency (locking) or optimistic concurrency.\n\nOptimistic concurrency tends to provide better performance than pessimistic concurrency or transactions, because no actual locks are held on the data and no extra information is stored about the operation (no transaction log).\n\nTo implement optimistic locking, Couchbase uses a CAS (compare and swap) approach. When a document is mutated, the CAS value also changes.\nThe CAS is opaque to the client, the only thing you need to know is that it changes when the content or a meta information changes too.\n\nIn other datastores, similar behavior can be achieved through an arbitrary version field with a incrementing counter.\nSince Couchbase supports this in a much better fashion, it is easy to implement.\nIf you want automatic optimistic locking support, all you need to do is add a `@Version` annotation on a long field like this:\n\n.A Document with optimistic locking.\n====\n[source,java]\n----\n@Document\npublic class User {\n\n @Version\n private long version;\n\n // constructor, getters, setters...\n}\n----\n====\n\nIf you load a document through the template or repository, the version field will be automatically populated with the current CAS value.\nIt is important to note that you shouldn't access the field or even change it on your own.\nOnce you save the document back, it will either succeed or fail with a `OptimisticLockingFailureException`.\nIf you get such an exception, the further approach depends on what you want to achieve application wise.\nYou should either retry the complete load-update-write cycle or propagate the error to the upper layers for proper handling.\n\n[[validation]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/entity.adoc", "title": "entity", "heading": "Optimistic Locking", "heading_level": 2, "file_order": 7, "section_index": 3, "content_hash": "37e1a734f6224f795d34905086f6f468cba6884f1aafee826359e6124b08e745", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/entity.adoc"}}
{"id": "sha256:50cd4095c046b7507e19713bda70e45ddc16f6546f64a177c777cd002828c4c0", "content": "The library supports JSR 303 validation, which is based on annotations directly in your entities.\nOf course you can add all kinds of validation in your service layer, but this way its nicely coupled to your actual entities.\n\nTo make it work, you need to include two additional dependencies.\nJSR 303 and a library that implements it, like the one supported by hibernate:\n\n.Validation dependencies\n====\n[source,xml]\n----\n<dependency>\n <groupId>javax.validation</groupId>\n <artifactId>validation-api</artifactId>\n</dependency>\n<dependency>\n <groupId>org.hibernate</groupId>\n <artifactId>hibernate-validator</artifactId>\n</dependency>\n----\n====\n\nNow you need to add two beans to your configuration:\n\n.Validation beans\n====\n[source,java]\n----\n@Bean\npublic LocalValidatorFactoryBean validator() {\n return new LocalValidatorFactoryBean();\n}\n\n@Bean\npublic ValidatingCouchbaseEventListener validationEventListener() {\n return new ValidatingCouchbaseEventListener(validator());\n}\n----\n====\n\nNow you can annotate your fields with JSR303 annotations.\nIf a validation on `save()` fails, a `ConstraintViolationException` is thrown.\n\n.Sample Validation Annotation\n====\n[source,java]\n----\n@Size(min = 10)\n@Field\nprivate String name;\n----\n====\n\n[[auditing]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/entity.adoc", "title": "entity", "heading": "Validation", "heading_level": 2, "file_order": 7, "section_index": 4, "content_hash": "50cd4095c046b7507e19713bda70e45ddc16f6546f64a177c777cd002828c4c0", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/entity.adoc"}}
{"id": "sha256:e776f72fa47a4afe1c147b650464a36e6a529bbdded02d7ee31462c8a4426e19", "content": "Entities can be automatically audited (tracing which user created the object, updated the object, and at what times) through Spring Data auditing mechanisms.\n\nFirst, note that only entities that have a `@Version` annotated field can be audited for creation (otherwise the framework will interpret a creation as an update).\n\nAuditing works by annotating fields with `@CreatedBy`, `@CreatedDate`, `@LastModifiedBy` and `@LastModifiedDate`.\nThe framework will automatically inject the correct values on those fields when persisting the entity.\nThe xxxDate annotations must be put on a `Date` field (or compatible, eg. jodatime classes) while the xxxBy annotations can be put on fields of any class `T` (albeit both fields must be of the same type).\n\nTo configure auditing, first you need to have an auditor aware bean in the context.\nSaid bean must be of type `AuditorAware<T>` (allowing to produce a value that can be stored in the xxxBy fields of type `T` we saw earlier).\nSecondly, you must activate auditing in your `@Configuration` class by using the `@EnableCouchbaseAuditing` annotation.\n\nHere is an example:\n\n.Sample Auditing Entity\n====\n[source,java]\n----\n@Document\npublic class AuditedItem {\n\n @Id\n private final String id;\n\n private String value;\n\n @CreatedBy\n private String creator;\n\n @LastModifiedBy\n private String lastModifiedBy;\n\n @LastModifiedDate\n private Date lastModification;\n\n @CreatedDate\n private Date creationDate;\n\n @Version\n private long version;\n\n //..omitted constructor/getters/setters/...\n}\n----\n====\n\nNotice both `@CreatedBy` and `@LastModifiedBy` are both put on a `String` field, so our `AuditorAware` must work with `String`.\n\n.Sample AuditorAware implementation\n====\n[source,java]\n----\npublic class NaiveAuditorAware implements AuditorAware<String> {\n\n private String auditor = \"auditor\";\n\n @Override\n public String getCurrentAuditor() {\n return auditor;\n }\n\n public void setAuditor(String auditor) {\n this.auditor = auditor;\n }\n}\n----\n====\n\nTo tie all that together, we use the java configuration both to declare an AuditorAware bean and to activate auditing:\n\n.Sample Auditing Configuration\n====\n[source,java]\n----\n@Configuration\n@EnableCouchbaseAuditing //this activates auditing\npublic class AuditConfiguration extends AbstractCouchbaseConfiguration {\n\n //... a few abstract methods omitted here\n\n // this creates the auditor aware bean that will feed the annotations\n @Bean\n public NaiveAuditorAware testAuditorAware() {\n return new NaiveAuditorAware();\n }\n----\n====", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/entity.adoc", "title": "entity", "heading": "Auditing", "heading_level": 2, "file_order": 7, "section_index": 5, "content_hash": "e776f72fa47a4afe1c147b650464a36e6a529bbdded02d7ee31462c8a4426e19", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/entity.adoc"}}
{"id": "sha256:9f3c77bf1eb53cd8c461537df3076883eabc54044ee55a1b03a3d40124a80b93", "content": "[[couchbase.fieldlevelencryption]]\n\nCouchbase supports https://docs.couchbase.com/java-sdk/current/howtos/encrypting-using-sdk.html[Field Level Encryption]. This section documents how to use it with Spring Data Couchbase.\n\n[[requirements]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/fieldlevelencryption.adoc", "title": "fieldlevelencryption", "heading": "fieldlevelencryption", "heading_level": 1, "file_order": 8, "section_index": 0, "content_hash": "9f3c77bf1eb53cd8c461537df3076883eabc54044ee55a1b03a3d40124a80b93", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/fieldlevelencryption.adoc"}}
{"id": "sha256:70f1b0fc17698ee4994e0f278b0012606f3a417a46a22ea01661ad9b99f0040e", "content": "- Spring Data Couchbase 5.0.0-RC1 or above.\n\n[[overview]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/fieldlevelencryption.adoc", "title": "fieldlevelencryption", "heading": "Requirements", "heading_level": 2, "file_order": 8, "section_index": 1, "content_hash": "70f1b0fc17698ee4994e0f278b0012606f3a417a46a22ea01661ad9b99f0040e", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/fieldlevelencryption.adoc"}}
{"id": "sha256:cd61b80b8b064029d49c746161e3c273661ad624b3526010a35c1cfc0429b297", "content": "Fields annotated with com.couchbase.client.java.encryption.annotation.Encrypted (@Encrypted) will be automatically encrypted on write and decrypted on read. Unencrypted fields can be migrated to encrypted by specifying @Encrypted(migration = Encrypted.Migration.FROM_UNENCRYPTED).\n\n[[getting-started-configuration]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/fieldlevelencryption.adoc", "title": "fieldlevelencryption", "heading": "Overview", "heading_level": 2, "file_order": 8, "section_index": 2, "content_hash": "cd61b80b8b064029d49c746161e3c273661ad624b3526010a35c1cfc0429b297", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/fieldlevelencryption.adoc"}}
{"id": "sha256:ff962ccd0906d6d8cae884b0c592dc0b30fbf0072ee3261431ec9bf4275ac1fc", "content": "[[dependencies]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/fieldlevelencryption.adoc", "title": "fieldlevelencryption", "heading": "Getting Started & Configuration", "heading_level": 2, "file_order": 8, "section_index": 3, "content_hash": "ff962ccd0906d6d8cae884b0c592dc0b30fbf0072ee3261431ec9bf4275ac1fc", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/fieldlevelencryption.adoc"}}
{"id": "sha256:20f825fa3fa9b4b291b4df330634e7b67e53a0dd44ea7e887039f9bcfccce778", "content": "Field Level Encryption is available with the dependency ( see https://docs.couchbase.com/java-sdk/current/howtos/encrypting-using-sdk.html[Field Level Encryption] )\n```\n <groupId>com.couchbase.client</groupId>\n <artifactId>couchbase-encryption</artifactId>\n```\nHashiCorp Vault Transit integration requires https://docs.spring.io/spring-vault/docs/current/reference/html[Spring Vault]\n```\n <groupId>org.springframework.vault</groupId>\n <artifactId>spring-vault-core</artifactId>\n```\n[[providing-a-cryptomanager]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/fieldlevelencryption.adoc", "title": "fieldlevelencryption", "heading": "Dependencies", "heading_level": 3, "file_order": 8, "section_index": 4, "content_hash": "20f825fa3fa9b4b291b4df330634e7b67e53a0dd44ea7e887039f9bcfccce778", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/fieldlevelencryption.adoc"}}
{"id": "sha256:4a897569b7b86b559c2cd358aabfd361d9c662824fb46dd76f84f34f62882b3c", "content": "A CryptoManager needs to be provided by overriding the cryptoManager() method in AbstractCouchbaseConfiguration. This CryptoManager will be used by Spring Data Couchbase and also by Couchbase Java SDK direct calls made from a CouchbaseClientFactory.\n\n```\n@Override\nprotected CryptoManager cryptoManager() {\n KeyStore javaKeyStore = KeyStore.getInstance(\"MyKeyStoreType\");\n FileInputStream fis = new java.io.FileInputStream(\"keyStoreName\");\n char[] password = { 'a', 'b', 'c' };\n javaKeyStore.load(fis, password);\n Keyring keyring = new KeyStoreKeyring(javaKeyStore, keyName -> \"swordfish\");\n\n // AES-256 authenticated with HMAC SHA-512. Requires a 64-byte key.\n AeadAes256CbcHmacSha512Provider provider = AeadAes256CbcHmacSha512Provider.builder().keyring(keyring).build();\n\n CryptoManager cryptoManager = DefaultCryptoManager.builder().decrypter(provider.decrypter())\n .defaultEncrypter(provider.encrypterForKey(\"myKey\")).build();\n return cryptoManager;\n}\n```\n\n[[defining-a-field-as-encrypted-]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/fieldlevelencryption.adoc", "title": "fieldlevelencryption", "heading": "Providing a CryptoManager", "heading_level": 3, "file_order": 8, "section_index": 5, "content_hash": "4a897569b7b86b559c2cd358aabfd361d9c662824fb46dd76f84f34f62882b3c", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/fieldlevelencryption.adoc"}}
{"id": "sha256:0e7043117683adf019dc4485f7c38845f897adc1538b909ad01230657fc679ae", "content": "1. @Encrypted defines a field as encrypted.\n2. @Encrypted(migration = Encrypted.Migration.FROM_UNENCRYPTED) defines a field that may or may not be encrypted when read. It will be encrypted when written.\n3. @Encrypted(encrypter = \"<encrypterAlias>\") specifies the alias of the encrypter to use for encryption. Note this is not the algorithm, but the name specified when adding the encrypter to the CryptoManager.\n\n[[example]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/fieldlevelencryption.adoc", "title": "fieldlevelencryption", "heading": "Defining a Field as Encrypted.", "heading_level": 3, "file_order": 8, "section_index": 6, "content_hash": "0e7043117683adf019dc4485f7c38845f897adc1538b909ad01230657fc679ae", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/fieldlevelencryption.adoc"}}
{"id": "sha256:b3077272a1a2e2c56d649843a1d32f1b742f8deceb7389ee403c45cff70e63a4", "content": ".AbstractCouchbaseConfiguration\n====\n[source,java]\n----\n@Configuration\n@EnableCouchbaseRepositories(\"<parent-dir-of-repository-interfaces>\")\n@EnableReactiveCouchbaseRepositories(\"<parent-dir-of-repository-interfaces>\")\nstatic class Config extends AbstractCouchbaseConfiguration {\n\n // Usual Setup\n @Override public String getConnectionString() { /* ... */ }\n @Override public String getUserName() { /* ... */ }\n @Override public String getPassword() { /* ... */ }\n @Override public String getBucketName() { /* ... */ }\n\n /* provide a cryptoManager */\n @Override\n protected CryptoManager cryptoManager() {\n KeyStore javaKeyStore = KeyStore.getInstance(\"MyKeyStoreType\");\n FileInputStream fis = new java.io.FileInputStream(\"keyStoreName\");\n char[] password = { 'a', 'b', 'c' };\n javaKeyStore.load(fis, password);\n Keyring keyring = new KeyStoreKeyring(javaKeyStore, keyName -> \"swordfish\");\n\n // AES-256 authenticated with HMAC SHA-512. Requires a 64-byte key.\n AeadAes256CbcHmacSha512Provider provider = AeadAes256CbcHmacSha512Provider.builder().keyring(keyring).build();\n\n CryptoManager cryptoManager = DefaultCryptoManager.builder().decrypter(provider.decrypter())\n .defaultEncrypter(provider.encrypterForKey(\"myKey\")).build();\n return cryptoManager;\n }\n\n}\n----\n====\n.The Annotation in the Document\n====\n[source,java]\n----\n@Document\npublic class AddressWithEncStreet extends Address {\n\n private @Encrypted String encStreet;\n .\n .\n----\n====\n.Usage in Code\n====\n[source,java]\n----\nAddressWithEncStreet address = new AddressWithEncStreet(); // plaintext address with encrypted street\naddress.setCity(\"Santa Clara\");\naddress.setEncStreet(\"Olcott Street\");\naddressEncryptedRepository.save(address);\n----\n====\n.Resulting Document\n====\n[source,json]\n----\n{\n \"_class\": \"AddressWithEncStreet\",\n \"city\": \"Santa Clara\",\n \"encrypted$encStreet\": {\n \"alg\": \"AEAD_AES_256_CBC_HMAC_SHA512\",\n \"ciphertext\": \"A/tJALmtixTxqj77ZUcUgMklIt3372DKD7l5FvbCzHNJMplbgQEv0RgSbxIfiRNr+uW2H7cokkcCW/F5YnQoXA==\",\n \"kid\": \"myKey\"\n }\n}\n----\n====", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/fieldlevelencryption.adoc", "title": "fieldlevelencryption", "heading": "Example", "heading_level": 3, "file_order": 8, "section_index": 7, "content_hash": "b3077272a1a2e2c56d649843a1d32f1b742f8deceb7389ee403c45cff70e63a4", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/fieldlevelencryption.adoc"}}
{"id": "sha256:118b9b44c824fe791a0e63f265c0c683e6cb1dbcdfc7c71d6ebf726e9210f12c", "content": "[[couchbase.reactiverepository]]\n\n[[couchbase.reactiverepository.intro]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/reactiverepository.adoc", "title": "reactiverepository", "heading": "reactiverepository", "heading_level": 1, "file_order": 9, "section_index": 0, "content_hash": "118b9b44c824fe791a0e63f265c0c683e6cb1dbcdfc7c71d6ebf726e9210f12c", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/reactiverepository.adoc"}}
{"id": "sha256:9efc53a4d0ed483d8d05787f5a1874739eeb7b0fa982973b61ada0261e63056e", "content": "This chapter describes the reactive repository support for couchbase.\nThis builds on the core repository support explained in xref:couchbase/repository.adoc[Couchbase repositories].\nSo make sure youve got a sound understanding of the basic concepts explained there.\n\n[[couchbase.reactiverepository.libraries]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/reactiverepository.adoc", "title": "reactiverepository", "heading": "Introduction", "heading_level": 2, "file_order": 9, "section_index": 1, "content_hash": "9efc53a4d0ed483d8d05787f5a1874739eeb7b0fa982973b61ada0261e63056e", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/reactiverepository.adoc"}}
{"id": "sha256:75c10efa53b8ac0ca060582d4c9c223c14866de3111797bb1d7d56a2d59abac5", "content": "The Couchbase Java SDK 3.x moved from RxJava to Reactor, so it blends in very nicely with the reactive spring ecosystem.\n\nReactive Couchbase repositories provide project Reactor wrapper types and can be used by simply extending from one of the library-specific repository interfaces:\n\n * ReactiveCrudRepository\n * ReactiveSortingRepository\n\n[[couchbase.reactiverepository.usage]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/reactiverepository.adoc", "title": "reactiverepository", "heading": "Reactive Composition Libraries", "heading_level": 2, "file_order": 9, "section_index": 2, "content_hash": "75c10efa53b8ac0ca060582d4c9c223c14866de3111797bb1d7d56a2d59abac5", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/reactiverepository.adoc"}}
{"id": "sha256:d770682819f0986a0507d4295fab44def540b89500080a5fa27f545ede617ad7", "content": "Let's create a simple entity to start with:\n\n.Sample Person entity\n====\n[source,java]\n----\npublic class Person {\n\n @Id\n private String id;\n private String firstname;\n private String lastname;\n private Address address;\n\n //  getters and setters omitted\n}\n----\n====\n\nA corresponding repository implementation may look like this:\n\n.Basic repository interface to persist Person entities\n====\n[source]\n----\npublic interface ReactivePersonRepository extends ReactiveSortingRepository<Person, Long> {\n\n Flux<Person> findByFirstname(String firstname);\n\n Flux<Person> findByFirstname(Publisher<String> firstname);\n\n Flux<Person> findByFirstnameOrderByLastname(String firstname, Pageable pageable);\n\n Mono<Person> findByFirstnameAndLastname(String firstname, String lastname);\n}\n----\n====\n\nFor JavaConfig use the `@EnableReactiveCouchbaseRepositories` annotation.\nThe annotation carries the very same attributes like the namespace element.\nIf no base package is configured the infrastructure will scan the package of the annotated configuration class.\n\nAlso note that if you are using it in a spring boot setup you likely can omit the annotation since it is autoconfigured for you.\n\n.JavaConfig for repositories\n====\n[source,java]\n----\n@Configuration\n@EnableReactiveCouchbaseRepositories\nclass ApplicationConfig extends AbstractCouchbaseConfiguration {\n\t// ... (see configuration for details)\n}\n----\n====\n\nAs our domain repository extends `ReactiveSortingRepository` it provides you with CRUD operations as well as methods for sorted access to the entities.\nWorking with the repository instance is just a matter of dependency injecting it into a client.\n\n.Sorted access to Person entities\n====\n[source,java]\n----\npublic class PersonRepositoryTests {\n\n @Autowired\n ReactivePersonRepository repository;\n\n @Test\n public void sortsElementsCorrectly() {\n Flux<Person> persons = repository.findAll(Sort.by(new Order(ASC, \"lastname\")));\n assertNotNull(perons);\n }\n}\n----\n====\n\n[[couchbase.reactiverepository.querying]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/reactiverepository.adoc", "title": "reactiverepository", "heading": "Usage", "heading_level": 2, "file_order": 9, "section_index": 3, "content_hash": "d770682819f0986a0507d4295fab44def540b89500080a5fa27f545ede617ad7", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/reactiverepository.adoc"}}
{"id": "sha256:2530ab3264381d387050c80ca91f2e588dfad57f4cd853a49470a19a72b22c91", "content": "Spring Data's Reactive Couchbase comes with full querying support already provided by the blocking xref:couchbase/repository.adoc#couchbase.repository.querying[Repositories and Querying]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/reactiverepository.adoc", "title": "reactiverepository", "heading": "Repositories and Querying", "heading_level": 2, "file_order": 9, "section_index": 4, "content_hash": "2530ab3264381d387050c80ca91f2e588dfad57f4cd853a49470a19a72b22c91", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/reactiverepository.adoc"}}
{"id": "sha256:94668e1ed5ea0c0681de59a2ad533f50650c6480ef34bcd406206695a951c641", "content": "[[couchbase.repository]]\n\nThe goal of Spring Data repository abstraction is to significantly reduce the amount of boilerplate code required to implement data access layers for various persistence stores.\n\nBy default, operations are backed by Key/Value if they are single-document operations and the ID is known.\nFor all other operations by default N1QL queries are generated, and as a result proper indexes must be created for performant data access.\n\nNote that you can tune the consistency you want for your queries (see xref:couchbase/repository.adoc#couchbase.repository.consistency[Querying with consistency]) and have different repositories backed by different buckets (see <<couchbase.repository.multibucket>>)\n\n[[couchbase.repository.configuration]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/repository.adoc", "title": "repository", "heading": "repository", "heading_level": 1, "file_order": 10, "section_index": 0, "content_hash": "94668e1ed5ea0c0681de59a2ad533f50650c6480ef34bcd406206695a951c641", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/repository.adoc"}}
{"id": "sha256:daf462dc3fc3ec974b4f9bde9785e5bef3d9480a18c7a04b42e62efa71ebed9d", "content": "While support for repositories is always present, you need to enable them in general or for a specific namespace.\nIf you extend `AbstractCouchbaseConfiguration`, just use the `@EnableCouchbaseRepositories` annotation.\nIt provides lots of possible options to narrow or customize the search path, one of the most common ones is `basePackages`.\n\nAlso note that if you are running inside spring boot, the autoconfig support already sets up the annotation for you so you only need to use it if you want to override the defaults.\n\n.Annotation-Based Repository Setup\n====\n[source,java]\n----\n@Configuration\n@EnableCouchbaseRepositories(basePackages = {\"com.couchbase.example.repos\"})\npublic class Config extends AbstractCouchbaseConfiguration {\n //...\n}\n----\n====\n\nAn advanced usage is described in <<couchbase.repository.multibucket>>.\n\n[[couchbase.repository.configuration.dsl]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/repository.adoc", "title": "repository", "heading": "Configuration", "heading_level": 2, "file_order": 10, "section_index": 1, "content_hash": "daf462dc3fc3ec974b4f9bde9785e5bef3d9480a18c7a04b42e62efa71ebed9d", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/repository.adoc"}}
{"id": "sha256:47fd8f233d0404afbdc6dac7ada2fa0d287456f9c156864ba03c0657347c566d", "content": "Spring Data Couchbase supports QueryDSL for building type-safe queries. To enable code generation, setting `CouchbaseAnnotationProcessor` as an annotation processor is required.\nAdditionally, the runtime needs querydsl-apt to enable QueryDSL on repositories.\n\n.Maven Configuration Example\n====\n[source,xml]\n----\n . existing depdendencies including those required for spring-data-couchbase\n .\n .\n <dependency>\n <groupId>com.querydsl</groupId>\n <artifactId>querydsl-apt</artifactId>\n <version>${querydslVersion}</version>\n </dependency>\n</dependencies>\n\n<build>\n <plugins>\n <plugin>\n <groupId>org.apache.maven.plugins</groupId>\n <artifactId>maven-compiler-plugin</artifactId>\n <executions>\n <execution>\n <id>annotation-processing</id>\n <phase>generate-sources</phase>\n <goals>\n <goal>compile</goal>\n </goals>\n <configuration>\n <proc>only</proc>\n <annotationProcessors>\n <annotationProcessor>org.springframework.data.couchbase.repository.support.CouchbaseAnnotationProcessor</annotationProcessor>\n </annotationProcessors>\n <generatedTestSourcesDirectory>target/generated-sources</generatedTestSourcesDirectory>\n <compilerArgs>\n <arg>-Aquerydsl.logInfo=true</arg>\n </compilerArgs>\n </configuration>\n </execution>\n </executions>\n </plugin>\n </plugins>\n</build>\n\n----\n====\n\n.Gradle Configuration Example\n====\n[source,groovy,indent=0,subs=\"verbatim,quotes\",role=\"secondary\"]\n----\ndependencies {\n annotationProcessor 'com.querydsl:querydsl-apt:${querydslVersion}'\n annotationProcessor 'org.springframework.data:spring-data-couchbase'\n testAnnotationProcessor 'com.querydsl:querydsl-apt:${querydslVersion}'\n testAnnotationProcessor 'org.springframework.data:spring-data-couchbase'\n}\ntasks.withType(JavaCompile).configureEach {\n options.compilerArgs += [\n \"-processor\",\n \"org.springframework.data.couchbase.repository.support.CouchbaseAnnotationProcessor\"]\n}\n----\n====\n\n[[couchbase.repository.usage]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/repository.adoc", "title": "repository", "heading": "QueryDSL Configuration", "heading_level": 3, "file_order": 10, "section_index": 2, "content_hash": "47fd8f233d0404afbdc6dac7ada2fa0d287456f9c156864ba03c0657347c566d", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/repository.adoc"}}
{"id": "sha256:143283e5bdcbe2e9fcd81fd0bd96553b4f6ce8a9b517e1efcb738abaaec89339", "content": "In the simplest case, your repository will extend the `CrudRepository<T, String>`, where T is the entity that you want to expose.\nLet's look at a repository for a UserInfo:\n\n.A UserInfo repository\n====\n[source,java]\n----\nimport org.springframework.data.repository.CrudRepository;\n\npublic interface UserRepository extends CrudRepository<UserInfo, String> {\n}\n----\n====\n\nPlease note that this is just an interface and not an actual class.\nIn the background, when your context gets initialized, actual implementations for your repository descriptions get created and you can access them through regular beans.\nThis means you will save lots of boilerplate code while still exposing full CRUD semantics to your service layer and application.\n\nNow, let's imagine we `@Autowire` the `UserRepository` to a class that makes use of it.\nWhat methods do we have available?\n\n[cols=\"2\",options=\"header\"]\n.Exposed methods on the UserRepository\n|===\n| Method\n| Description\n\n| UserInfo save(UserInfo entity)\n| Save the given entity.\n\n| Iterable<UserInfo> save(Iterable<UserInfo> entity)\n| Save the list of entities.\n\n| UserInfo findOne(String id)\n| Find a entity by its unique id.\n\n| boolean exists(String id)\n| Check if a given entity exists by its unique id.\n\n| Iterable<UserInfo> findAll()\n| Find all entities by this type in the bucket.\n\n| Iterable<UserInfo> findAll(Iterable<String> ids)\n| Find all entities by this type and the given list of ids.\n\n| long count()\n| Count the number of entities in the bucket.\n\n| void delete(String id)\n| Delete the entity by its id.\n\n| void delete(UserInfo entity)\n| Delete the entity.\n\n| void delete(Iterable<UserInfo> entities)\n| Delete all given entities.\n\n| void deleteAll()\n| Delete all entities by type in the bucket.\n|===\n\nNow that's awesome!\nJust by defining an interface we get full CRUD functionality on top of our managed entity.\n\nWhile the exposed methods provide you with a great variety of access patterns, very often you need to define custom ones.\nYou can do this by adding method declarations to your interface, which will be automatically resolved to requests in the background, as we'll see in the next sections.\n\n[[couchbase.repository.querying]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/repository.adoc", "title": "repository", "heading": "Usage", "heading_level": 2, "file_order": 10, "section_index": 3, "content_hash": "143283e5bdcbe2e9fcd81fd0bd96553b4f6ce8a9b517e1efcb738abaaec89339", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/repository.adoc"}}
{"id": "sha256:fc5a56627a772528f6e7c1caccaea4f81b7a608d62d9358a46c49e5bcb140386", "content": "[[couchbase.repository.n1ql]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/repository.adoc", "title": "repository", "heading": "Repositories and Querying", "heading_level": 2, "file_order": 10, "section_index": 4, "content_hash": "fc5a56627a772528f6e7c1caccaea4f81b7a608d62d9358a46c49e5bcb140386", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/repository.adoc"}}
{"id": "sha256:5a6b40bb3874b814a5cc3331c343d4f45ea739bb831061044fa723c383b470d8", "content": "Prerequisite is to have created a PRIMARY INDEX on the bucket where the entities will be stored.\n\nHere is an example:\n\n.An extended UserInfo repository with N1QL queries\n====\n[source,java]\n----\npublic interface UserRepository extends CrudRepository<UserInfo, String> {\n\n @Query(\"#{#n1ql.selectEntity} WHERE role = 'admin' AND #{#n1ql.filter}\")\n List<UserInfo> findAllAdmins();\n\n List<UserInfo> findByFirstname(String fname);\n}\n----\n====\n\nHere we see two N1QL-backed ways of querying.\n\nThe first method uses the `Query` annotation to provide a N1QL statement inline.\nSpEL (Spring Expression Language) is supported by surrounding SpEL expression blocks between `#{` and `}`.\nA few N1QL-specific values are provided through SpEL:\n\n- `#n1ql.selectEntity` allows to easily make sure the statement will select all the fields necessary to build the full entity (including document ID and CAS value).\n- `#n1ql.filter` in the WHERE clause adds a criteria matching the entity type with the field that Spring Data uses to store type information.\n- `#n1ql.bucket` will be replaced by the name of the bucket the entity is stored in, escaped in backticks.\n- `#n1ql.scope` will be replaced by the name of the scope the entity is stored in, escaped in backticks.\n- `#n1ql.collection` will be replaced by the name of the collection the entity is stored in, escaped in backticks.\n- `#n1ql.fields` will be replaced by the list of fields (eg. for a SELECT clause) necessary to reconstruct the entity.\n- `#n1ql.delete` will be replaced by the `delete from` statement.\n- `#n1ql.returning` will be replaced by returning clause needed for reconstructing entity.\n\nIMPORTANT: We recommend that you always use the `selectEntity` SpEL and a WHERE clause with a `filter` SpEL (since otherwise your query could be impacted by entities from other repositories).\n\nString-based queries support parametrized queries.\nYou can either use positional placeholders like \"`$1`\", in which case each of the method parameters will map, in order, to `$1`, `$2`, `$3`... Alternatively, you can use named placeholders using the \"`$someString`\" syntax.\nMethod parameters will be matched with their corresponding placeholder using the parameter's name, which can be overridden by annotating each parameter (except a `Pageable` or `Sort`) with `@Param` (eg. `@Param(\"someString\")`).\nYou cannot mix the two approaches in your query and will get an `IllegalArgumentException` if you do.\n\nNote that you can mix N1QL placeholders and SpEL. N1QL placeholders will still consider all method parameters, so be sure to use the correct index like in the example below:\n\n.An inline query that mixes SpEL and N1QL placeholders\n====\n[source,java]\n----\n@Query(\"#{#n1ql.selectEntity} WHERE #{#n1ql.filter} AND #{[0]} = $2\")\npublic List<User> findUsersByDynamicCriteria(String criteriaField, Object criteriaValue)\n----\n====\n\nThis allows you to generate queries that would work similarly to eg. `AND name = \"someName\"` or `AND age = 3`, with a single method declaration.\n\nYou can also do single projections in your N1QL queries (provided it selects only one field and returns only one result, usually an aggregation like `COUNT`, `AVG`, `MAX`...).\nSuch projection would have a simple return type like `long`, `boolean` or `String`.\nThis is *NOT* intended for projections to DTOs.\n\nAnother example: +\n`#{#n1ql.selectEntity} WHERE #{#n1ql.filter} AND test = $1` +\nis equivalent to +\n`SELECT #{#n1ql.fields} FROM #{#n1ql.collection} WHERE #{#n1ql.filter} AND test = $1`\n\n.A practical application of SpEL with Spring Security\n****\nSpEL can be useful when you want to do a query depending on data injected by other Spring components, like Spring Security.\nHere is what you need to do to extend the SpEL context to get access to such external data.\n\nFirst, you need to implement an `EvaluationContextExtension` (use the support class as below):\n\n[source,java]\n----\nclass SecurityEvaluationContextExtension extends EvaluationContextExtensionSupport {\n\n @Override\n public String getExtensionId() {\n return \"security\";\n }\n\n @Override\n public SecurityExpressionRoot getRootObject() {\n Authentication authentication = SecurityContextHolder.getContext().getAuthentication();\n return new SecurityExpressionRoot(authentication) {};\n }\n}\n----\n\nThen all you need to do for Spring Data Couchbase to be able to access associated SpEL values is to declare a corresponding bean in your configuration:\n\n[source,java]\n----\n@Bean\nEvaluationContextExtension securityExtension() {\n return new SecurityEvaluationContextExtension();\n}\n----\n\nThis could be useful to craft a query according to the role of the connected user for instance:\n\n[source,java]\n----\n@Query(\"#{#n1ql.selectEntity} WHERE #{#n1ql.filter} AND \" +\n\"role = '?#{hasRole('ROLE_ADMIN') ? 'public_admin' : 'admin'}'\")\nList<UserInfo> findAllAdmins(); //only ROLE_ADMIN users will see hidden admins\n----\n\nDelete query example:\n\n[source,java]\n----\n@Query(\"#{#n1ql.delete} WHERE #{#n1ql.filter} AND \" +\n\"username = $1 #{#n1ql.returning}\")\nUserInfo removeUser(String username);\n----\n\n****\n\nThe second method uses Spring-Data's query derivation mechanism to build a N1QL query from the method name and parameters.\nThis will produce a query looking like this: `SELECT ... FROM ... WHERE firstName = \"valueOfFnameAtRuntime\"`.\nYou can combine these criteria, even do a count with a name like `countByFirstname` or a limit with a name like `findFirst3ByLastname`...\n\nNOTE: Actually the generated N1QL query will also contain an additional N1QL criteria in order to only select documents that match the repository's entity class.\n\nMost Spring-Data keywords are supported:\n.Supported keywords inside @Query (N1QL) method names\n\n[options = \"header,autowidth\"]\n|===============\n|Keyword|Sample|N1QL WHERE clause snippet\n|`And`|`findByLastnameAndFirstname`|`lastName = a AND firstName = b`\n|`Or`|`findByLastnameOrFirstname`|`lastName = a OR firstName = b`\n|`Is,Equals`|`findByField`,`findByFieldEquals`|`field = a`\n|`IsNot,Not`|`findByFieldIsNot`|`field != a`\n|`Between`|`findByFieldBetween`|`field BETWEEN a AND b`\n|`IsLessThan,LessThan,IsBefore,Before`|`findByFieldIsLessThan`,`findByFieldBefore`|`field < a`\n|`IsLessThanEqual,LessThanEqual`|`findByFieldIsLessThanEqual`|`field <= a`\n|`IsGreaterThan,GreaterThan,IsAfter,After`|`findByFieldIsGreaterThan`,`findByFieldAfter`|`field > a`\n|`IsGreaterThanEqual,GreaterThanEqual`|`findByFieldGreaterThanEqual`|`field >= a`\n|`IsNull`|`findByFieldIsNull`|`field IS NULL`\n|`IsNotNull,NotNull`|`findByFieldIsNotNull`|`field IS NOT NULL`\n|`IsLike,Like`|`findByFieldLike`|`field LIKE \"a\"` - a should be a String containing % and _ (matching n and 1 characters)\n|`IsNotLike,NotLike`|`findByFieldNotLike`|`field NOT LIKE \"a\"` - a should be a String containing % and _ (matching n and 1 characters)\n|`IsStartingWith,StartingWith,StartsWith`|`findByFieldStartingWith`|`field LIKE \"a%\"` - a should be a String prefix\n|`IsEndingWith,EndingWith,EndsWith`|`findByFieldEndingWith`|`field LIKE \"%a\"` - a should be a String suffix\n|`IsContaining,Containing,Contains`|`findByFieldContains`|`field LIKE \"%a%\"` - a should be a String\n|`IsNotContaining,NotContaining,NotContains`|`findByFieldNotContaining`|`field NOT LIKE \"%a%\"` - a should be a String\n|`IsIn,In`|`findByFieldIn`|`field IN array` - note that the next parameter value (or its children if a collection/array) should be compatible for storage in a `JsonArray`)\n|`IsNotIn,NotIn`|`findByFieldNotIn`|`field NOT IN array` - note that the next parameter value (or its children if a collection/array) should be compatible for storage in a `JsonArray`)\n|`IsTrue,True`|`findByFieldIsTrue`|`field = TRUE`\n|`IsFalse,False`|`findByFieldFalse`|`field = FALSE`\n|`MatchesRegex,Matches,Regex`|`findByFieldMatches`|`REGEXP_LIKE(field, \"a\")` - note that the ignoreCase is ignored here, a is a regular expression in String form\n|`Exists`|`findByFieldExists`|`field IS NOT MISSING` - used to verify that the JSON contains this attribute\n|`OrderBy`|`findByFieldOrderByLastnameDesc`|`field = a ORDER BY lastname DESC`\n|`IgnoreCase`|`findByFieldIgnoreCase`|`LOWER(field) = LOWER(\"a\")` - a must be a String\n|===============\n\nYou can use both counting queries and <<repositories.limit-query-result>> features with this approach.\n\nWith N1QL, another possible interface for the repository is the `PagingAndSortingRepository` one (which extends `CrudRepository`).\nIt adds two methods:\n\n[cols=\"2\",options=\"header\"]\n.Exposed methods on the PagingAndSortingRepository\n|===\n| Method\n| Description\n\n| Iterable<T> findAll(Sort sort);\n| Allows to retrieve all relevant entities while sorting on one of their attributes.\n\n| Page<T> findAll(Pageable pageable);\n| Allows to retrieve your entities in pages. The returned `Page` allows to easily get the next page's `Pageable` as well as the list of items. For the first call, use `new PageRequest(0, pageSize)` as Pageable.\n|===\n\nTIP: You can also use `Page` and `Slice` as method return types as well with a N1QL backed repository.\n\nNOTE: If pageable and sort parameters are used with inline queries, there should not be any order by, limit or offset clause in the inline query itself otherwise the server would reject the query as malformed.\n\n[[couchbase.repository.indexing]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/repository.adoc", "title": "repository", "heading": "N1QL based querying", "heading_level": 3, "file_order": 10, "section_index": 5, "content_hash": "5a6b40bb3874b814a5cc3331c343d4f45ea739bb831061044fa723c383b470d8", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/repository.adoc"}}
{"id": "sha256:5fde24e54da8bded3174671c312e049430b9e9afda702174a9261f5aabf660e9", "content": "By default, it is expected that the user creates and manages optimal indexes for their queries. Especially in the early stages of development, it can come in handy to automatically create indexes to get going quickly.\n\nFor N1QL, the following annotations are provided which need to be attached to the entity (either on the class or the field):\n\n - `@QueryIndexed`: Placed on a field to signal that this field should be part of the index\n - `@CompositeQueryIndex`: Placed on the class to signal that an index on more than one field (composite) should be created.\n - `@CompositeQueryIndexes`: If more than one `CompositeQueryIndex` should be created, this annotation will take a list of them.\n\nFor example, this is how you define a composite index on an entity:\n\n.Composite index on two fields with ordering\n====\n[source,java]\n----\n@Document\n@CompositeQueryIndex(fields = {\"id\", \"name desc\"})\npublic class Airline {\n @Id\n String id;\n\n\t@QueryIndexed\n\tString name;\n\n\t@PersistenceConstructor\n\tpublic Airline(String id, String name) {\n this.id = id;\n\t}\n\n\tpublic String getId() {\n return id;\n\t}\n\n\tpublic String getName() {\n return name;\n\t}\n\n}\n----\n====\n\nBy default, index creation is disabled. If you want to enable it you need to override it on the configuration:\n\n.Enable auto index creation\n====\n[source,java]\n----\n@Override\nprotected boolean autoIndexCreation() {\n return true;\n}\n----\n====\n\n[[couchbase.repository.consistency]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/repository.adoc", "title": "repository", "heading": "Automatic Index Management", "heading_level": 3, "file_order": 10, "section_index": 6, "content_hash": "5fde24e54da8bded3174671c312e049430b9e9afda702174a9261f5aabf660e9", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/repository.adoc"}}
{"id": "sha256:6b8f492dea5a091d5f5584a30295d360000c7525d405ac9bce180ff28a432e4d", "content": "By default repository queries that use N1QL use the `NOT_BOUNDED` scan consistency. This means that results return quickly, but the data from the index may not yet contain data from previously written operations (called eventual consistency). If you need \"ready your own write\" semantics for a query, you need to use the `@ScanConsistency` annotation. Here is an example:\n\n.Using a different scan consistency\n====\n[source,java]\n----\n@Repository\npublic interface AirportRepository extends PagingAndSortingRepository<Airport, String> {\n\n\t@Override\n\t@ScanConsistency(query = QueryScanConsistency.REQUEST_PLUS)\n\tIterable<Airport> findAll();\n\n}\n----\n====\n\n[[couchbase.repository.dto-projections]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/repository.adoc", "title": "repository", "heading": "Querying with consistency", "heading_level": 3, "file_order": 10, "section_index": 7, "content_hash": "6b8f492dea5a091d5f5584a30295d360000c7525d405ac9bce180ff28a432e4d", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/repository.adoc"}}
{"id": "sha256:60de092947212e926dafc73d07527db9c5cfe19fddb9d4b6f52d26f83ab241da", "content": "Spring Data Repositories usually return the domain model when using query methods.\nHowever, sometimes, you may need to alter the view of that model for various reasons.\nIn this section, you will learn how to define projections to serve up simplified and reduced views of resources.\n\nLook at the following domain model:\n\n[source,java]\n----\n@Entity\npublic class Person {\n\n @Id @GeneratedValue\n private Long id;\n private String firstName, lastName;\n\n @OneToOne\n private Address address;\n \n}\n\n@Entity\npublic class Address {\n\n @Id @GeneratedValue\n private Long id;\n private String street, state, country;\n\n \n}\n----\n\nThis `Person` has several attributes:\n\n* `id` is the primary key\n* `firstName` and `lastName` are data attributes\n* `address` is a link to another domain object\n\nNow assume we create a corresponding repository as follows:\n\n[source,java]\n----\ninterface PersonRepository extends CrudRepository<Person, Long> {\n\n Person findPersonByFirstName(String firstName);\n}\n----\n\nSpring Data will return the domain object including all of its attributes.\nThere are two options just to retrieve the `address` attribute.\nOne option is to define a repository for `Address` objects like this:\n\n[source,java]\n----\ninterface AddressRepository extends CrudRepository<Address, Long> {}\n----\n\nIn this situation, using `PersonRepository` will still return the whole `Person` object.\nUsing `AddressRepository` will return just the `Address`.\n\nHowever, what if you do not want to expose `address` details at all?\nYou can offer the consumer of your repository service an alternative by defining one or more projections.\n\n.Simple Projection\n====\n[source,java]\n----\ninterface NoAddresses { <1>\n\n String getFirstName(); <2>\n\n String getLastName(); <3>\n}\n----\n\nThis projection has the following details:\n\n<1> A plain Java interface making it declarative.\n<2> Export the `firstName`.\n<3> Export the `lastName`.\n====\n\nThe `NoAddresses` projection only has getters for `firstName` and `lastName` meaning that it will not serve up any address information.\nThe query method definition returns in this case `NoAdresses` instead of `Person`.\n\n[source,java]\n----\ninterface PersonRepository extends CrudRepository<Person, Long> {\n\n NoAddresses findByFirstName(String firstName);\n}\n----\n\nProjections declare a contract between the underlying type and the method signatures related to the exposed properties.\nHence it is required to name getter methods according to the property name of the underlying type.\nIf the underlying property is named `firstName`, then the getter method must be named `getFirstName` otherwise Spring Data is not able to look up the source property.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/repository.adoc", "title": "repository", "heading": "DTO Projections", "heading_level": 3, "file_order": 10, "section_index": 8, "content_hash": "60de092947212e926dafc73d07527db9c5cfe19fddb9d4b6f52d26f83ab241da", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/repository.adoc"}}
{"id": "sha256:4540d02802879a001aa14e08a3bd7ebf4ec1475b6ded3b1bf7f7ecf72faab058", "content": "[[couchbase.template]]\n\nThe template provides lower level access to the underlying database and also serves as the foundation for repositories.\nAny time a repository is too high-level for you needs chances are good that the templates will serve you well. Note that\nyou can always drop into the SDK directly through the beans exposed on the `AbstractCouchbaseConfiguration`.\n\n[[template.ops]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/template.adoc", "title": "template", "heading": "template", "heading_level": 1, "file_order": 11, "section_index": 0, "content_hash": "4540d02802879a001aa14e08a3bd7ebf4ec1475b6ded3b1bf7f7ecf72faab058", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/template.adoc"}}
{"id": "sha256:96b1c4fcca79ea46afb8917ead78494cefc2fd518a09cb52e2fc7de79582e856", "content": "The template can be accessed through the `couchbaseTemplate` and `reactiveCouchbaseTemplate` beans out of your context.\nOnce you've got a reference to it, you can run all kinds of operations against it.\nOther than through a repository, in a template you need to always specify the target entity type which you want to get converted.\n\nThe templates use a fluent-style API which allows you to chain in optional operators as needed. As an example, here is\nhow you store a user and then find it again by its ID:\n\n.Fluent template access\n====\n[source,java]\n----\nUser user = new User(UUID.randomUUID().toString(), \"firstname\", \"lastname\");\n\ncouchbaseTemplate.upsertById(User.class).one(user);\n\nUser found = couchbaseTemplate.findById(User.class).one(user.getId());\n----\n====\n\nIf you wanted to use a custom (by default durability options from the `@Document` annotation will be used) durability requirement for the `upsert` operation you can chain it in:\n\n.Upsert with durability\n====\n[source,java]\n----\nUser modified = couchbaseTemplate\n .upsertById(User.class)\n .withDurability(DurabilityLevel.MAJORITY)\n .one(user);\n----\n====\n\nIn a similar fashion, you can perform a N1QL operation:\n\n.N1QL query on the template\n====\n[source,java]\n----\nfinal List<User> foundUsers = couchbaseTemplate\n .findByQuery(User.class)\n .consistentWith(QueryScanConsistency.REQUEST_PLUS)\n .all();\n----\n====\n\n[[template.sub-document-ops]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/template.adoc", "title": "template", "heading": "Supported operations", "heading_level": 2, "file_order": 11, "section_index": 1, "content_hash": "96b1c4fcca79ea46afb8917ead78494cefc2fd518a09cb52e2fc7de79582e856", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/template.adoc"}}
{"id": "sha256:862ac414787ef89486086210deea396c4b3183ed642b0b1461575bf91dd93fab", "content": "Couchbase supports https://docs.couchbase.com/java-sdk/current/howtos/subdocument-operations.html[Sub-Document Operations]. This section documents how to use it with Spring Data Couchbase.\n\nSub-Document operations may be quicker and more network-efficient than full-document operations such as upsert or replace because they only transmit the accessed sections of the document over the network.\n\nSub-Document operations are also atomic, in that if one Sub-Document mutation fails then all will, allowing safe modifications to documents with built-in concurrency control.\n\nCurrently Spring Data Couchbase supports only sub document mutations (remove, upsert, replace and insert).\n\nMutation operations modify one or more paths in the document. The simplest of these operations is upsert, which, similar to the fulldoc-level upsert, will either modify the value of an existing path or create it if it does not exist:\n\nFollowing example will upsert the city field on the address of the user, without trasfering any additional user document data.\n\n.MutateIn upsert on the template\n====\n[source,java]\n----\nUser user = new User();\nuser.setId(ID);\nuser.setAddress(address);\ncouchbaseTemplate.mutateInById(User.class)\n .withUpsertPaths(\"address.city\")\n .one(user);\n----\n====\n\n[[template.sub-document-ops-multi]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/template.adoc", "title": "template", "heading": "Sub-Document Operations", "heading_level": 2, "file_order": 11, "section_index": 2, "content_hash": "862ac414787ef89486086210deea396c4b3183ed642b0b1461575bf91dd93fab", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/template.adoc"}}
{"id": "sha256:e77503abd1375c314668ba0bcbe35c03da9cb03f0df7a3aeed0afbdcbf3c97bf", "content": "Multiple Sub-Document operations can be executed at once on the same document, allowing you to modify several Sub-Documents at once. When multiple operations are submitted within the context of a single mutateIn command, the server will execute all the operations with the same version of the document.\n\nTo execute several mutation operations the method chaining can be used.\n\n.MutateIn Multiple Operations\n====\n[source,java]\n----\ncouchbaseTemplate.mutateInById(User.class)\n .withInsertPaths(\"roles\", \"subuser.firstname\")\n .withRemovePaths(\"address.city\")\n .withUpsertPaths(\"firstname\")\n .withReplacePaths(\"address.street\")\n .one(user);\n----\n====\n\n[[template.sub-document-cas]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/template.adoc", "title": "template", "heading": "Executing Multiple Sub-Document Operations", "heading_level": 3, "file_order": 11, "section_index": 3, "content_hash": "e77503abd1375c314668ba0bcbe35c03da9cb03f0df7a3aeed0afbdcbf3c97bf", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/template.adoc"}}
{"id": "sha256:646ba8b180bd465505c634ae747a21f45be0fdccae2db7e991a01d7f3ed65e54", "content": "Concurrent Sub-Document operations on different parts of a document will not conflict so by default the CAS value will be not be supplied when executing the mutations.\nIf CAS is required then it can be provided like this:\n\n.MutateIn With CAS\n====\n[source,java]\n----\nUser user = new User();\nuser.setId(ID);\nuser.setVersion(cas);\nuser.setAddress(address);\ncouchbaseTemplate.mutateInById(User.class)\n .withUpsertPaths(\"address.city\")\n .withCasProvided()\n .one(user);\n----\n====\n\n[[exception-translation]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/template.adoc", "title": "template", "heading": "Concurrent Modifications", "heading_level": 3, "file_order": 11, "section_index": 4, "content_hash": "646ba8b180bd465505c634ae747a21f45be0fdccae2db7e991a01d7f3ed65e54", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/template.adoc"}}
{"id": "sha256:bc50f45e0cda8d46372cf33788579d6e0dcf8ec605df91bff3cad8aa97d590c7", "content": "The Spring Framework provides exception translation for a wide variety of database and mapping technologies.\nThis has traditionally been for JDBC and JPA.\nSpring Data Couchbase extends this feature to Couchbase by providing an implementation of the `org.springframework.dao.support.PersistenceExceptionTranslator` interface.\n\nThe motivation behind mapping to Spring's {spring-framework-docs}/data-access/dao.html#dao-exceptions[consistent data access exception hierarchy]\nis to let you write portable and descriptive exception handling code without resorting to coding against and handling specific Couchbase exceptions.\nAll of Spring's data access exceptions are inherited from the\n`DataAccessException` class, so you can be sure that you can catch all database-related exceptions within a single try-catch block.\n\n`ReactiveCouchbase` propagates exceptions as early as possible.\nExceptions that occur during the processing of the reactive sequence are emitted as error signals.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/template.adoc", "title": "template", "heading": "Exception Translation", "heading_level": 2, "file_order": 11, "section_index": 5, "content_hash": "bc50f45e0cda8d46372cf33788579d6e0dcf8ec605df91bff3cad8aa97d590c7", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/template.adoc"}}
{"id": "sha256:8b174c217b280b2faeae45531e657ae5d39700a6b3f03f4eebc8a7d5e72dd1a8", "content": "[[couchbase.transactions]]\n\nCouchbase supports https://docs.couchbase.com/server/current/learn/data/transactions.html[Distributed Transactions]. This section documents how to use it with Spring Data Couchbase.\n\n[[requirements]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/transactions.adoc", "title": "transactions", "heading": "transactions", "heading_level": 1, "file_order": 12, "section_index": 0, "content_hash": "8b174c217b280b2faeae45531e657ae5d39700a6b3f03f4eebc8a7d5e72dd1a8", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/transactions.adoc"}}
{"id": "sha256:b970efcdf7d5693759393c1aa79dad4460548f9c6d16bcec82e2afa74d961508", "content": "- Couchbase Server 6.6.1 or above.\n - Spring Data Couchbase 5.0.0-M5 or above.\n - NTP should be configured so nodes of the Couchbase cluster are in sync with time. The time being out of sync will not cause incorrect behavior, but can impact metadata cleanup.\n - The entity class must have an `@Version Long` property to hold the CAS value of the document.\n\n[[overview]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/transactions.adoc", "title": "transactions", "heading": "Requirements", "heading_level": 2, "file_order": 12, "section_index": 1, "content_hash": "b970efcdf7d5693759393c1aa79dad4460548f9c6d16bcec82e2afa74d961508", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/transactions.adoc"}}
{"id": "sha256:c10dcee2504714c8157a1b5458a9965ed0d0ec0e7084fda2dd10ac6eeae2d698", "content": "The Spring Data Couchbase template operations insert, find, replace and delete and repository methods that use those calls can participate in a Couchbase Transaction. They can be executed in a transaction by using the @Transactional annotation, the CouchbaseTransactionalOperator, or in the lambda of a Couchbase Transaction.\n\n[[getting-started-configuration]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/transactions.adoc", "title": "transactions", "heading": "Overview", "heading_level": 2, "file_order": 12, "section_index": 2, "content_hash": "c10dcee2504714c8157a1b5458a9965ed0d0ec0e7084fda2dd10ac6eeae2d698", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/transactions.adoc"}}
{"id": "sha256:96b4a44f988b8696150939698d3d1ebaea8e28329cbf4d10a5c620beb6b65bc7", "content": "Couchbase Transactions are normally leveraged with a method annotated with @Transactional.\nThe @Transactional operator is implemented with the CouchbaseTransactionManager which is supplied as a bean in the AbstractCouchbaseConfiguration.\nCouchbase Transactions can be used without defining a service class by using CouchbaseTransactionOperator which is also supplied as a bean in AbtractCouchbaseConfiguration.\nCouchbase Transactions can also be used directly using Spring Data Couchbase operations within a lambda https://docs.couchbase.com/server/current/learn/data/transactions.html#using-transactions[Using Transactions]\n\n[[transactions-with-transactional]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/transactions.adoc", "title": "transactions", "heading": "Getting Started & Configuration", "heading_level": 2, "file_order": 12, "section_index": 3, "content_hash": "96b4a44f988b8696150939698d3d1ebaea8e28329cbf4d10a5c620beb6b65bc7", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/transactions.adoc"}}
{"id": "sha256:4b4f0bee78953ca051ca21baca555d967d24e8a49cfc0304dad592b6dd682228", "content": "@Transactional defines as transactional a method or all methods on a class.\n\nWhen this annotation is declared at the class level, it applies as a default\nto all methods of the declaring class and its subclasses.\n\n[[-attribute-semantics]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/transactions.adoc", "title": "transactions", "heading": "Transactions with @Transactional", "heading_level": 2, "file_order": 12, "section_index": 4, "content_hash": "4b4f0bee78953ca051ca21baca555d967d24e8a49cfc0304dad592b6dd682228", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/transactions.adoc"}}
{"id": "sha256:78ea57516792644bb471a69f556720fe332931d5a604204d7b73d4493b443bd1", "content": "In this release, the Couchbase Transactions ignores the rollback attributes.\nThe transaction isolation level is read-committed;\n\n.Transaction Configuration and Use by @Transactional\n====\n.The Configuration\n[source,java]\n----\n@Configuration\n@EnableCouchbaseRepositories(\"<parent-dir-of-repository-interfaces>\")\n@EnableReactiveCouchbaseRepositories(\"<parent-dir-of-repository-interfaces>\")\n@EnableTransactionManagement // <1>\nstatic class Config extends AbstractCouchbaseConfiguration {\n\n // Usual Setup\n @Override public String getConnectionString() { /* ... */ }\n @Override public String getUserName() { /* ... */ }\n @Override public String getPassword() { /* ... */ }\n @Override public String getBucketName() { /* ... */ }\n\n // Customization of transaction behavior is via the configureEnvironment() method\n @Override protected void configureEnvironment(final Builder builder) {\n builder.transactionsConfig(\n TransactionsConfig.builder().timeout(Duration.ofSeconds(30)));\n }\n}\n----\n.The Transactional Service Class\nNote that the body of @Transactional methods can be re-executed if the transaction fails.\nIt is imperative that everthing in the method body be idempotent.\n[source,java]\n----\nimport reactor.core.publisher.Mono;\nimport reactor.core.publisher.Flux;\n\nimport org.springframework.stereotype.Service;\nimport org.springframework.transaction.annotation.Transactional;\n\nfinal CouchbaseOperations personOperations;\nfinal ReactiveCouchbaseOperations reactivePersonOperations;\n\n@Service // <2>\npublic class PersonService {\n\n final CouchbaseOperations operations;\n final ReactiveCouchbaseOperations reactiveOperations;\n\n public PersonService(CouchbaseOperations ops, ReactiveCouchbaseOperations reactiveOps) {\n operations = ops;\n reactiveOperations = reactiveOps;\n }\n\n // no annotation results in this method being executed not in a transaction\n public Person save(Person p) {\n return operations.save(p);\n }\n\n @Transactional\n public Person changeFirstName(String id, String newFirstName) {\n Person p = operations.findById(Person.class).one(id); // <3>\n return operations.replaceById(Person.class).one(p.withFirstName(newFirstName);\n }\n\n @Transactional\n public Mono<Person> reactiveChangeFirstName(String id, String newFirstName) {\n return personOperationsRx.findById(Person.class).one(person.id())\n .flatMap(p -> personOperationsRx.replaceById(Person.class).one(p.withFirstName(newFirstName)));\n }\n\n}\n----\n[source,java]\n.Using the @Transactional Service.\n----\n@Autowired PersonService personService; // <4>\n\nPerson walterWhite = new Person( \"Walter\", \"White\");\nPerson p = personService.save(walterWhite); // this is not a transactional method\n...\nPerson renamedPerson = personService.changeFirstName(walterWhite.getId(), \"Ricky\"); // <5>\n----\nFunctioning of the @Transactional method annotation requires\n[start=1]\n. the configuration class to be annotated with @EnableTransactionManagement;\n. the service object with the annotated methods must be annotated with @Service;\n. the body of the method is executed in a transaction.\n. the service object with the annotated methods must be obtained via @Autowired.\n. the call to the method must be made from a different class than service because calling an annotated\nmethod from the same class will not invoke the Method Interceptor that does the transaction processing.\n====\n\n[[transactions-with-couchbasetransactionaloperator]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/transactions.adoc", "title": "transactions", "heading": "Attribute Semantics", "heading_level": 3, "file_order": 12, "section_index": 5, "content_hash": "78ea57516792644bb471a69f556720fe332931d5a604204d7b73d4493b443bd1", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/transactions.adoc"}}
{"id": "sha256:6cf4d2390fb1339f3786843118a860cb988276d65a6b218ca42c5103eebcf6e4", "content": "CouchbaseTransactionalOperator can be used to construct a transaction in-line without creating a service class that uses @Transactional.\nCouchbaseTransactionalOperator is available as a bean and can be instantiated with @Autowired.\nIf creating one explicitly, it must be created with CouchbaseTransactionalOperator.create(manager) (NOT TransactionalOperator.create(manager)).\n\n.Transaction Access Using TransactionalOperator.execute()\n====\n[source,java]\n----\n@Autowired TransactionalOperator txOperator;\n@Autowired ReactiveCouchbaseTemplate reactiveCouchbaseTemplate;\n\nFlux<Person> result = txOperator.execute((ctx) ->\n reactiveCouchbaseTemplate.findById(Person.class).one(person.id())\n .flatMap(p -> reactiveCouchbaseTemplate.replaceById(Person.class).one(p.withFirstName(\"Walt\")))\n );\n----\n====\n\n[[transactions-directly-with-the-sdk]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/transactions.adoc", "title": "transactions", "heading": "Transactions with CouchbaseTransactionalOperator", "heading_level": 2, "file_order": 12, "section_index": 6, "content_hash": "6cf4d2390fb1339f3786843118a860cb988276d65a6b218ca42c5103eebcf6e4", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/transactions.adoc"}}
{"id": "sha256:2bc9ba26a46619bd78be74d57517d1e3c85c32b7096505f38ac9709a13dd484a", "content": "Spring Data Couchbase works seamlessly with the Couchbase Java SDK for transaction processing. Spring Data Couchbase operations that\ncan be executed in a transaction will work directly within the lambda of a transactions().run() without involving any of the Spring\nTransactions mechanisms. This is the most straight-forward way to leverage Couchbase Transactions in Spring Data Couchbase.\n\nPlease see the https://docs.couchbase.com/java-sdk/current/howtos/distributed-acid-transactions-from-the-sdk.html[Reference Documentation]\n\n.Transaction Access - Blocking\n====\n[source,java]\n----\n@Autowired CouchbaseTemplate couchbaseTemplate;\n\nTransactionResult result = couchbaseTemplate.getCouchbaseClientFactory().getCluster().transactions().run(ctx -> {\n Person p = couchbaseTemplate.findById(Person.class).one(personId);\n couchbaseTemplate.replaceById(Person.class).one(p.withFirstName(\"Walt\"));\n});\n----\n====\n\n.Transaction Access - Reactive\n====\n[source,java]\n----\n@Autowired ReactiveCouchbaseTemplate reactiveCouchbaseTemplate;\n\nMono<TransactionResult> result = reactiveCouchbaseTemplate.getCouchbaseClientFactory().getCluster().reactive().transactions()\n .run(ctx ->\n reactiveCouchbaseTemplate.findById(Person.class).one(personId)\n .flatMap(p -> reactiveCouchbaseTemplate.replaceById(Person.class).one(p.withFirstName(\"Walt\")))\n );\n----\n====", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase/transactions.adoc", "title": "transactions", "heading": "Transactions Directly with the SDK", "heading_level": 2, "file_order": 12, "section_index": 7, "content_hash": "2bc9ba26a46619bd78be74d57517d1e3c85c32b7096505f38ac9709a13dd484a", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase/transactions.adoc"}}
{"id": "sha256:bf70b2c53d47d0f7e503d4a94f68e5c920deec3d3d8403e443d585ad4f177d61", "content": "include::{commons}@data-commons::page$repositories/core-concepts.adoc[]\n\n[[couchbase.entity-persistence.state-detection-strategies]]\ninclude::{commons}@data-commons::page$is-new-state-detection.adoc[leveloffset=+1]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/repositories/core-concepts.adoc", "title": "core-concepts", "heading": "core-concepts", "heading_level": 1, "file_order": 13, "section_index": 0, "content_hash": "bf70b2c53d47d0f7e503d4a94f68e5c920deec3d3d8403e443d585ad4f177d61", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/repositories/core-concepts.adoc"}}
{"id": "sha256:81e019ce75dee61eea59094a236a3871f4c9af62f0fcd3a5c7a87af4b30030f9", "content": "include::{commons}@data-commons::page$repositories/core-domain-events.adoc[]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/repositories/core-domain-events.adoc", "title": "core-domain-events", "heading": "core-domain-events", "heading_level": 1, "file_order": 14, "section_index": 0, "content_hash": "81e019ce75dee61eea59094a236a3871f4c9af62f0fcd3a5c7a87af4b30030f9", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/repositories/core-domain-events.adoc"}}
{"id": "sha256:64aa7d024c0d4411af2a39c72ec3db2ed9b849e1a6db2f27c6bebd29fb12b71b", "content": "include::{commons}@data-commons::page$repositories/core-extensions.adoc[]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/repositories/core-extensions.adoc", "title": "core-extensions", "heading": "core-extensions", "heading_level": 1, "file_order": 15, "section_index": 0, "content_hash": "64aa7d024c0d4411af2a39c72ec3db2ed9b849e1a6db2f27c6bebd29fb12b71b", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/repositories/core-extensions.adoc"}}
{"id": "sha256:bac28174cb786cac49ffd811dcd631b892f0813fc0fc9743e93def55346e1e58", "content": "include::{commons}@data-commons::page$repositories/create-instances.adoc[]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/repositories/create-instances.adoc", "title": "create-instances", "heading": "create-instances", "heading_level": 1, "file_order": 16, "section_index": 0, "content_hash": "bac28174cb786cac49ffd811dcd631b892f0813fc0fc9743e93def55346e1e58", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/repositories/create-instances.adoc"}}
{"id": "sha256:bcf8fe4d0728082fd278624d23223ff29157e4fb465061471d2d50f2f401bc0d", "content": "include::{commons}@data-commons::page$repositories/custom-implementations.adoc[]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/repositories/custom-implementations.adoc", "title": "custom-implementations", "heading": "custom-implementations", "heading_level": 1, "file_order": 17, "section_index": 0, "content_hash": "bcf8fe4d0728082fd278624d23223ff29157e4fb465061471d2d50f2f401bc0d", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/repositories/custom-implementations.adoc"}}
{"id": "sha256:661a93bfb9c9780b8bb205b092562b371e697955026e3abea11cc0abb0a3fc20", "content": "include::{commons}@data-commons::page$repositories/definition.adoc[]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/repositories/definition.adoc", "title": "definition", "heading": "definition", "heading_level": 1, "file_order": 18, "section_index": 0, "content_hash": "661a93bfb9c9780b8bb205b092562b371e697955026e3abea11cc0abb0a3fc20", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/repositories/definition.adoc"}}
{"id": "sha256:8ca895bfddcd8ee24e8f9d5197f423b2399d74f11d14249d9f906762f4b72806", "content": "include::{commons}@data-commons::page$repositories/null-handling.adoc[]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/repositories/null-handling.adoc", "title": "null-handling", "heading": "null-handling", "heading_level": 1, "file_order": 19, "section_index": 0, "content_hash": "8ca895bfddcd8ee24e8f9d5197f423b2399d74f11d14249d9f906762f4b72806", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/repositories/null-handling.adoc"}}
{"id": "sha256:b142a68ffd3baadcd7ab94a76e2096bd729711f18f8ebb8b3cc5651939c2be8a", "content": "include::{commons}@data-commons::page$repositories/projections.adoc[]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/repositories/projections.adoc", "title": "projections", "heading": "projections", "heading_level": 1, "file_order": 20, "section_index": 0, "content_hash": "b142a68ffd3baadcd7ab94a76e2096bd729711f18f8ebb8b3cc5651939c2be8a", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/repositories/projections.adoc"}}
{"id": "sha256:7e953260056fa458d00ccd6d3916965e33c635a0e5a9c1068e6d4c915b4642be", "content": "include::{commons}@data-commons::page$repositories/query-keywords-reference.adoc[]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/repositories/query-keywords-reference.adoc", "title": "query-keywords-reference", "heading": "query-keywords-reference", "heading_level": 1, "file_order": 21, "section_index": 0, "content_hash": "7e953260056fa458d00ccd6d3916965e33c635a0e5a9c1068e6d4c915b4642be", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/repositories/query-keywords-reference.adoc"}}
{"id": "sha256:2931a4be98bc609c2eb349faa7f3ea7d07742930fa4e31487a2957e5874e0633", "content": "include::{commons}@data-commons::page$repositories/query-methods-details.adoc[]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/repositories/query-methods-details.adoc", "title": "query-methods-details", "heading": "query-methods-details", "heading_level": 1, "file_order": 22, "section_index": 0, "content_hash": "2931a4be98bc609c2eb349faa7f3ea7d07742930fa4e31487a2957e5874e0633", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/repositories/query-methods-details.adoc"}}
{"id": "sha256:8586bea837d1b2b190fc36059384044b5c88fe73a8012f0e6782feb992f85865", "content": "include::{commons}@data-commons::page$repositories/query-return-types-reference.adoc[]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/repositories/query-return-types-reference.adoc", "title": "query-return-types-reference", "heading": "query-return-types-reference", "heading_level": 1, "file_order": 23, "section_index": 0, "content_hash": "8586bea837d1b2b190fc36059384044b5c88fe73a8012f0e6782feb992f85865", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/repositories/query-return-types-reference.adoc"}}
{"id": "sha256:586cfbb1a0554d34665ac5b1bb592b9214e355fcd64a46838d511e0f0bca19a6", "content": "[[couchbase.core]]\n\nSpring Data support for Couchbase contains a wide range of features:\n\n* Spring configuration support with xref:couchbase/configuration.adoc[Java-based `@Configuration` classes].\n* The xref:couchbase/template.adoc[`CouchbaseTemplate` and `ReactiveCouchbaseTemplate`] helper classes that provide object mapping between Couchbase collections and POJOs.\n* xref:couchbase/template.adoc#exception-translation[Exception translation] into Spring's portable {spring-framework-docs}/data-access/dao.html#dao-exceptions[data-access.html#dao-exceptions][Data Access Exception Hierarchy].\n* Feature rich object mapping integrated with _Spring's_ {spring-framework-docs}/core/validation/convert.html[Conversion Service].\n* Annotation-based mapping metadata that is extensible to support other metadata formats.\n* Automatic implementation of xref:repositories.adoc[imperative and reactive `Repository` interfaces] including support for xref:repositories/custom-implementations.adoc[custom query methods].\n\nFor most data-oriented tasks, you can use the `[Reactive]CouchbaseTemplate` or the `Repository` support, both of which use the rich object-mapping functionality.\nSpring Data Couchbase uses consistent naming conventions on objects in various APIs to those found in the Couchbase Java SDK so that they are familiar and so that you can map your existing knowledge onto the Spring APIs.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/couchbase.adoc", "title": "couchbase", "heading": "couchbase", "heading_level": 1, "file_order": 24, "section_index": 0, "content_hash": "586cfbb1a0554d34665ac5b1bb592b9214e355fcd64a46838d511e0f0bca19a6", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/couchbase.adoc"}}
{"id": "sha256:3f89dd95ca3002aedd7dd8fd67e895d21618f52e99e85b4a3e0e1daecf608114", "content": "[[spring-data-couchbase-reference-documentation]]\n\n_Spring Data Couchbase provides repository support for the Couchbase database.\nIt eases development of applications with a consistent programming model that need to access Couchbase data sources._\n\n[horizontal]\nxref:couchbase.adoc[Couchbase] :: Couchbase support and connectivity\nxref:repositories.adoc[Repositories] :: Couchbase Repositories\nxref:commons/migrating.adoc[Migration] :: Migration Guides\nhttps://github.com/spring-projects/spring-data-commons/wiki[Wiki] :: What's New, Upgrade Notes, Supported Versions, additional cross-version information.\n\nMichael Nitschinger, Oliver Gierke, Simon Basle, Michael Reiche, Tigran Babloyan\n\n(C) 2014-{copyright-year} The original author(s)\n\nCopies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/index.adoc", "title": "index", "heading": "index", "heading_level": 1, "file_order": 25, "section_index": 0, "content_hash": "3f89dd95ca3002aedd7dd8fd67e895d21618f52e99e85b4a3e0e1daecf608114", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/index.adoc"}}
{"id": "sha256:3f90f3f03b56e1db0b4f4f0c811ab6f00ea278af1523d7d9b43b4f866c88fca3", "content": "[[couchbase.repositories]]\n\nThis chapter explains the basic foundations of Spring Data repositories and Couchbase specifics.\nBefore continuing to the Couchbase specifics, make sure you have a sound understanding of the basic concepts.\n\nThe goal of the Spring Data repository abstraction is to significantly reduce the amount of boilerplate code required to implement data access layers for various persistence stores.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-data-couchbase", "path": "antora/modules/ROOT/pages/repositories.adoc", "title": "repositories", "heading": "repositories", "heading_level": 1, "file_order": 26, "section_index": 0, "content_hash": "3f90f3f03b56e1db0b4f4f0c811ab6f00ea278af1523d7d9b43b4f866c88fca3", "source_url": "https://github.com/spring-projects/spring-data-couchbase/blob/77eab73d031640506c3fd1aa14b7d196d0fe19a5/src/main/antora/modules/ROOT/pages/repositories.adoc"}}
