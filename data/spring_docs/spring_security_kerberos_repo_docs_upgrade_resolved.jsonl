{"id": "sha256:b0e5e53f86be7f628564f2a321bb3a5913d5e65c6b646f99832dcece38c545d4", "content": "[[appendices]]\n\n[appendix]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-security-kerberos", "path": "spring-security-kerberos-docs/modules/ROOT/pages/appendix.adoc", "title": "appendix", "heading": "appendix", "heading_level": 1, "file_order": 0, "section_index": 0, "content_hash": "b0e5e53f86be7f628564f2a321bb3a5913d5e65c6b646f99832dcece38c545d4", "source_url": "https://github.com/spring-projects/spring-security-kerberos/blob/1bf6e7fe8540cf0223d5e88560c683471bd4e447/spring-security-kerberos-docs/modules/ROOT/pages/appendix.adoc"}}
{"id": "sha256:8773c7f8f9d5396005256b5cb21cfe77dfac4fc2948d67f387cfc4ead8b25cb5", "content": "Dummy UserDetailsService used in samples because we don't have a real\nuser source.\n\n[source,java,indent=0]\n----\npublic class DummyUserDetailsService implements UserDetailsService {\n\n    @Override\n    public UserDetails loadUserByUsername(String username)\n            throws UsernameNotFoundException {\n        return new User(username, \"notUsed\", true, true, true, true,\n                AuthorityUtils.createAuthorityList(\"ROLE_USER\"));\n    }\n\n}\n----\n\n[appendix]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-security-kerberos", "path": "spring-security-kerberos-docs/modules/ROOT/pages/appendix.adoc", "title": "appendix", "heading": "Material Used in this Document", "heading_level": 2, "file_order": 0, "section_index": 1, "content_hash": "8773c7f8f9d5396005256b5cb21cfe77dfac4fc2948d67f387cfc4ead8b25cb5", "source_url": "https://github.com/spring-projects/spring-security-kerberos/blob/1bf6e7fe8540cf0223d5e88560c683471bd4e447/spring-security-kerberos-docs/modules/ROOT/pages/appendix.adoc"}}
{"id": "sha256:a502ca6cefb9257b252c7031e21e671196b8ad26f7881616342b737326ed6850", "content": "In any authentication process there are usually a three parties\ninvolved.\n\nimage:drawio-kerb-cc1.png[]\n\nFirst is a `client` which sometimes is a client computer but in most\nof the scenarios it is the actual user sitting on a computer and\ntrying to access resources. Then there is the `resource` user is trying\nto access. In this example it is a web server.\n\nThen there is a `Key Distribution Center` or `KDC`. In a case of\nWindows environment this would be a `Domain Controller`. `KDC` is the\none which really brings everything together and thus is the most\ncritical component in your environment. Because of this it is also\nconsidered as a single point of failure.\n\nInitially when `Kerberos` environment is setup and domain user\nprincipals created into a database, encryption keys are also\ncreated. These encryption keys are based on shared secrets(i.e. user\npassword) and actual passwords are never kept in a clear text.\nEffectively `KDC` has its own key and other keys for domain users.\n\nInterestingly there is no communication between a `resource` and a\n`KDC` during the authentication process.\n\nimage:drawio-kerb-cc2.png[]\n\nWhen client wants to authenticate itself with a `resource` it first\nneeds to communicate with a `KDC`. `Client` will craft a special package\nwhich contains encrypted and unencrypted parts. Unencrypted part\ncontains i.e. information about a user and encrypted part other\ninformation which is part of a protocol. `Client` will encrypt package\ndata with its own key.\n\nWhen `KDC` receives this authentication package from a client it\nchecks who this `client` claims to be from an unencrypted part and based\non that information it uses `client` decryption key it already have in\nits database. If this decryption is succesfull `KDC` knows that this\n`client` is the one it claims to be.\n\nWhat KDC returns to a client is a ticket called `Ticket Granting\nTicket` which is signed by a KDC's own private key. Later when\n`client` sends back this ticket it can try to decrypt it and if that\noperation is succesfull it knows that it was a ticket it itself\noriginally signed and gave to a `client`.\n\nimage:drawio-kerb-cc3.png[]\n\nWhen client wants to get a ticket which it can use to authenticate\nwith a service, `TGT` is sent to `KDC` which then signs a service ticket\nwith service's own key. This a moment when a trust between\n`client` and `service` is created. This service ticket contains data\nwhich only `service` itself is able to decrypt.\n\nimage:drawio-kerb-cc4.png[]\n\nWhen `client` is authenticating with a service it sends previously\nreceived service ticket to a service which then thinks that I don't\nknow anything about this guy but he gave me an authentication ticket.\nWhat `service` can do next is try to decrypt that ticket and if that\noperation is succesfull it knows that only other party who knows my\ncredentials is the `KDC` and because I trust him I can also trust that\nthis client is a one he claims to be.\n\n[appendix]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-security-kerberos", "path": "spring-security-kerberos-docs/modules/ROOT/pages/appendix.adoc", "title": "appendix", "heading": "Crash Course to Kerberos", "heading_level": 2, "file_order": 0, "section_index": 2, "content_hash": "a502ca6cefb9257b252c7031e21e671196b8ad26f7881616342b737326ed6850", "source_url": "https://github.com/spring-projects/spring-security-kerberos/blob/1bf6e7fe8540cf0223d5e88560c683471bd4e447/spring-security-kerberos-docs/modules/ROOT/pages/appendix.adoc"}}
{"id": "sha256:b9c148371e9029743ce84688584e86d1d960bd2544c6ed267fa719faae069f3b", "content": "Doing a production setup of Kerberos environment is out of scope of\nthis document but this appendix provides some help to get you\nstarted for setting up needed components for development.\n\n[[setupmitkerberos]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-security-kerberos", "path": "spring-security-kerberos-docs/modules/ROOT/pages/appendix.adoc", "title": "appendix", "heading": "Setup Kerberos Environments", "heading_level": 2, "file_order": 0, "section_index": 3, "content_hash": "b9c148371e9029743ce84688584e86d1d960bd2544c6ed267fa719faae069f3b", "source_url": "https://github.com/spring-projects/spring-security-kerberos/blob/1bf6e7fe8540cf0223d5e88560c683471bd4e447/spring-security-kerberos-docs/modules/ROOT/pages/appendix.adoc"}}
{"id": "sha256:e8068ce472a9bd1b7859954a4ce74b57583cde6f274f688104af780a9b451ec2", "content": "First action is to setup a new realm and a database.\n\n[source,text,indent=0]\n----\n# kdb5_util create -s -r EXAMPLE.ORG\nLoading random data\nInitializing database '/var/lib/krb5kdc/principal' for realm 'EXAMPLE.ORG',\nmaster key name 'K/M@EXAMPLE.ORG'\nYou will be prompted for the database Master Password.\nIt is important that you NOT FORGET this password.\nEnter KDC database master key:\nRe-enter KDC database master key to verify:\n----\n\n`kadmin` command can be used to administer Kerberos environment but\nyou can't yet use it because there are no admin users in a database.\n\n[source,text,indent=0]\n----\nroot@neo:/etc/krb5kdc# kadmin\nAuthenticating as principal root/admin@EXAMPLE.ORG with password.\nkadmin: Client not found in Kerberos database while initializing\nkadmin interface\n----\n\nLets use `kadmin.local` command to create one.\n\n[source,text,indent=0]\n----\nroot@neo:/etc/krb5kdc# kadmin.local\nAuthenticating as principal root/admin@EXAMPLE.ORG with password.\n\nkadmin.local: listprincs\nK/M@EXAMPLE.ORG\nkadmin/admin@EXAMPLE.ORG\nkadmin/changepw@EXAMPLE.ORG\nkadmin/cypher@EXAMPLE.ORG\nkrbtgt/EXAMPLE.ORG@EXAMPLE.ORG\n\nkadmin.local: addprinc root/admin@EXAMPLE.ORG\nWARNING: no policy specified for root/admin@EXAMPLE.ORG; defaulting to\nno policy\nEnter password for principal \"root/admin@EXAMPLE.ORG\":\nRe-enter password for principal \"root/admin@EXAMPLE.ORG\":\nPrincipal \"root/admin@EXAMPLE.ORG\" created.\n----\n\nThen enable admins by modifying `kadm5.acl` file and restart Kerberos\nservices.\n\n[source,text,indent=0]\n----\n# cat /etc/krb5kdc/kadm5.acl\n# This file Is the access control list for krb5 administration.\n*/admin *\n----\n\nNow you can use `kadmin` with previously created `root/admin`\nprincipal. Lets create our first user `user1`.\n\n[source,text,indent=0]\n----\nkadmin: addprinc user1\nWARNING: no policy specified for user1@EXAMPLE.ORG; defaulting to no\npolicy\nEnter password for principal \"user1@EXAMPLE.ORG\":\nRe-enter password for principal \"user1@EXAMPLE.ORG\":\nPrincipal \"user1@EXAMPLE.ORG\" created.\n----\n\nLets create our second user `user2` and export a keytab file.\n\n[source,text,indent=0]\n----\nkadmin: addprinc user2\nWARNING: no policy specified for user2@EXAMPLE.ORG; defaulting to no\npolicy\nEnter password for principal \"user2@EXAMPLE.ORG\":\nRe-enter password for principal \"user2@EXAMPLE.ORG\":\nPrincipal \"user2@EXAMPLE.ORG\" created.\n\nkadmin: ktadd -k /tmp/user2.keytab user2@EXAMPLE.ORG\nEntry for principal user2@EXAMPLE.ORG with kvno 2, encryption type aes256-cts-hmac-sha1-96 added to keytab WRFILE:/tmp/user2.keytab.\nEntry for principal user2@EXAMPLE.ORG with kvno 2, encryption type arcfour-hmac added to keytab WRFILE:/tmp/user2.keytab.\nEntry for principal user2@EXAMPLE.ORG with kvno 2, encryption type des3-cbc-sha1 added to keytab WRFILE:/tmp/user2.keytab.\nEntry for principal user2@EXAMPLE.ORG with kvno 2, encryption type des-cbc-crc added to keytab WRFILE:/tmp/user2.keytab.\n----\n\nLets create a service ticket for tomcat and export credentials to a\nkeytab file named `tomcat.keytab`.\n\n[source,text,indent=0]\n----\nkadmin: addprinc -randkey HTTP/neo.example.org@EXAMPLE.ORG\nWARNING: no policy specified for HTTP/neo.example.org@EXAMPLE.ORG;\ndefaulting to no policy\nPrincipal \"HTTP/neo.example.org@EXAMPLE.ORG\" created.\n\nkadmin: ktadd -k /tmp/tomcat.keytab HTTP/neo.example.org@EXAMPLE.ORG\nEntry for principal HTTP/neo.example.org@EXAMPLE.ORG with kvno 2, encryption type aes256-cts-hmac-sha1-96 added to keytab WRFILE:/tmp/tomcat2.keytab.\nEntry for principal HTTP/neo.example.org@EXAMPLE.ORG with kvno 2, encryption type arcfour-hmac added to keytab WRFILE:/tmp/tomcat2.keytab.\nEntry for principal HTTP/neo.example.org@EXAMPLE.ORG with kvno 2, encryption type des3-cbc-sha1 added to keytab WRFILE:/tmp/tomcat2.keytab.\nEntry for principal HTTP/neo.example.org@EXAMPLE.ORG with kvno 2, encryption type des-cbc-crc added to keytab WRFILE:/tmp/tomcat2.keytab.\n----\n\n[[setupwinkerberos]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-security-kerberos", "path": "spring-security-kerberos-docs/modules/ROOT/pages/appendix.adoc", "title": "appendix", "heading": "Setup MIT Kerberos", "heading_level": 3, "file_order": 0, "section_index": 4, "content_hash": "e8068ce472a9bd1b7859954a4ce74b57583cde6f274f688104af780a9b451ec2", "source_url": "https://github.com/spring-projects/spring-security-kerberos/blob/1bf6e7fe8540cf0223d5e88560c683471bd4e447/spring-security-kerberos-docs/modules/ROOT/pages/appendix.adoc"}}
{"id": "sha256:a97816d7a1b048f4342966e93c672cb0737c6e47a0d24742d657ad41c1fc54f3", "content": "This was tested using `Windows Server 2012 R2`\n\n[TIP]\n====\nInternet is full of good articles and videos how to setup Windows AD\nbut these two are quite usefull\nhttp://www.rackspace.com/knowledge_center/article/installing-active-directory-on-windows-server-2012[Rackspace] and\nhttp://social.technet.microsoft.com/wiki/contents/articles/12370.windows-server-2012-set-up-your-first-domain-controller-step-by-step.aspx[Microsoft\nTechnet].\n====\n\n- Normal domain controller and active directory setup was done.\n- Used dns domain `example.org` and windows domain `EXAMPLE`.\n- I created various domain users like `user1`, `user2`, `user3`,\n `tomcat` and set passwords to `Password#`.\n\nI eventually also added all ip's of my vm's to AD's dns server for\nthat not to cause any trouble.\n\n[source,text]\n----\nName: WIN-EKBO0EQ7TS7.example.org\nAddress: 172.16.101.135\n\nName: win8vm.example.org\nAddress: 172.16.101.136\n\nName: neo.example.org\nAddress: 172.16.101.1\n----\n\nService Principal Name(SPN) needs to be setup with `HTTP` and a\nserver name `neo.example.org` where tomcat servlet container is run. This\nis used with `tomcat` domain user and its `keytab` is then used as a\nservice credential.\n\n[source,text]\n----\nPS C:\\> setspn -A HTTP/neo.example.org tomcat\n----\n\nI exported keytab file which is copied to linux server running tomcat.\n\n[source,text]\n----\nPS C:\\> ktpass /out c:\\tomcat.keytab /mapuser tomcat@EXAMPLE.ORG /princ HTTP/neo.example.org@EXAMPLE.ORG /pass Password# /ptype KRB5_NT_PRINCIPAL /crypto All\n Targeting domain controller: WIN-EKBO0EQ7TS7.example.org\n Using legacy password setting method\n Successfully mapped HTTP/neo.example.org to tomcat.\n----\n\n[appendix]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-security-kerberos", "path": "spring-security-kerberos-docs/modules/ROOT/pages/appendix.adoc", "title": "appendix", "heading": "Setup Windows Domain Controller", "heading_level": 3, "file_order": 0, "section_index": 5, "content_hash": "a97816d7a1b048f4342966e93c672cb0737c6e47a0d24742d657ad41c1fc54f3", "source_url": "https://github.com/spring-projects/spring-security-kerberos/blob/1bf6e7fe8540cf0223d5e88560c683471bd4e447/spring-security-kerberos-docs/modules/ROOT/pages/appendix.adoc"}}
{"id": "sha256:edf056caf0e8674d99d7f0de611a9399d466e3e7589114143ee10640540a3b85", "content": "This appendix provides generic information about troubleshooting\nerrors and problems.\n\n[IMPORTANT]\n====\nIf you think environment and configuration is correctly setup, do\ndouble check and ask other person to check possible obvious mistakes\nor typos. Kerberos setup is generally very brittle and it is not\nalways very easy to debug where the problem lies.\n====\n\n.Cannot find key of appropriate type to decrypt\n\n[source,text]\n----\nGSSException: Failure unspecified at GSS-API level (Mechanism level:\nInvalid argument (400) - Cannot find key of appropriate type to\ndecrypt AP REP - RC4 with HMAC)\n----\n\nIf you see abore error indicating missing key type, this will happen\nwith two different use cases. Firstly your JVM may not support\nappropriate encryption type or it is disabled in your `krb5.conf`\nfile.\n\n[source,text]\n----\ndefault_tkt_enctypes = rc4-hmac\ndefault_tgs_enctypes = rc4-hmac\n----\n\nSecond case is less obvious and hard to track because it will lead\ninto same error. This specific `GSSException` is throws also if you\nsimply don't have a required encryption key which then may be caused\nby a misconfiguration in your kerberos server or a simply typo in your\nprincipal.\n\n.Using wrong kerberos configuration\n\n{zwsp} +\n\nIn most system all commands and libraries will search kerberos\nconfiguration either from a default locations or special locations\nlike JDKs. It's easy to get mixed up especially if working from unix\nsystems, which already may have default settings to work with MIT\nkerberos, towards Windows domains.\n\nThis is a specific example what happens with `ldapsearch` trying to\nquery Windows AD using kerberos authentication.\n\n[source,text]\n----\n$ ldapsearch -H ldap://WIN-EKBO0EQ7TS7.example.org -b \"dc=example,dc=org\"\nSASL/GSSAPI authentication started\nldap_sasl_interactive_bind_s: Local error (-2)\n additional info: SASL(-1): generic failure: GSSAPI Error:\n Unspecified GSS failure. Minor code may provide more information\n (No Kerberos credentials available)\n----\n\nWell that doesn't look good and is a simple indication that I don't\nhave a valid kerberos tickets as shown below.\n\n[source,text]\n----\n$ klist\nklist: Credentials cache file '/tmp/krb5cc_1000' not found\n----\n\nWe already have a keytab file we exported from Windows AD to be used\nwith tomcat running on Linux. Lets try to use that to authenticate\nwith Windows AD.\n\nYou can have a dedicated config file which usually can be used with\nnative Linux commands and JVMs via system propertys.\n\n[source,text]\n----\n$ cat krb5.ini\n[libdefaults]\ndefault_realm = EXAMPLE.ORG\ndefault_keytab_name = /tmp/tomcat.keytab\nforwardable=true\n\n[realms]\nEXAMPLE.ORG = {\n kdc = WIN-EKBO0EQ7TS7.example.org:88\n}\n\n[domain_realm]\nexample.org=EXAMPLE.ORG\n.example.org=EXAMPLE.ORG\n----\n\nLets use that config and a keytab to get initial credentials.\n\n[source,text]\n----\n$ env KRB5_CONFIG=/path/to/krb5.ini kinit -kt tomcat.keytab HTTP/neo.example.org@EXAMPLE.ORG\n\n$ klist\nTicket cache: FILE:/tmp/krb5cc_1000\nDefault principal: HTTP/neo.example.org@EXAMPLE.ORG\n\nValid starting Expires Service principal\n26/03/15 09:04:37 26/03/15 19:04:37 krbtgt/EXAMPLE.ORG@EXAMPLE.ORG\n renew until 27/03/15 09:04:37\n----\n\nLets see what happens if we now try to do a simple query against\nWindows AD.\n\n[source,text]\n----\n$ ldapsearch -H ldap://WIN-EKBO0EQ7TS7.example.org -b \"dc=example,dc=org\"\nSASL/GSSAPI authentication started\nldap_sasl_interactive_bind_s: Local error (-2)\n additional info: SASL(-1): generic failure: GSSAPI Error:\n Unspecified GSS failure. Minor code may provide more information\n (KDC returned error string: PROCESS_TGS)\n----\n\nThis may be simply because `ldapsearch` is getting confused and simply\nusing wrong configuration. You can tell `ldapsearch` to use a\ndifferent configuration via `KRB5_CONFIG` env variable just like we\ndid with `kinit`. You can also use `KRB5_TRACE=/dev/stderr` to get\nmore verbose output of what native libraries are doing.\n\n[source,text]\n----\n$ env KRB5_CONFIG=/path/to/krb5.ini ldapsearch -H ldap://WIN-EKBO0EQ7TS7.example.org -b \"dc=example,dc=org\"\n\n$ klist\nTicket cache: FILE:/tmp/krb5cc_1000\nDefault principal: HTTP/neo.example.org@EXAMPLE.ORG\n\nValid starting Expires Service principal\n26/03/15 09:11:03 26/03/15 19:11:03 krbtgt/EXAMPLE.ORG@EXAMPLE.ORG\n renew until 27/03/15 09:11:03\n 26/03/15 09:11:44 26/03/15 19:11:03\n ldap/win-ekbo0eq7ts7.example.org@EXAMPLE.ORG\n renew until 27/03/15 09:11:03\n----\n\nAbove you can see what happened if query was successful by looking\nkerberos tickets. Now you can experiment with further query commands\ni.e. if you working with `KerberosLdapContextSource`.\n\n[source,text]\n----\n$ ldapsearch -H ldap://WIN-EKBO0EQ7TS7.example.org \\\n-b \"dc=example,dc=org\" \\\n\"(| (userPrincipalName=user2@EXAMPLE.ORG)\n(sAMAccountName=user2@EXAMPLE.ORG))\" \\\ndn\n\n...\n# test user, example.org\ndn: CN=test user,DC=example,DC=org\n----\n\n[appendix]\n[[browserspnegoconfig]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-security-kerberos", "path": "spring-security-kerberos-docs/modules/ROOT/pages/appendix.adoc", "title": "appendix", "heading": "Troubleshooting", "heading_level": 2, "file_order": 0, "section_index": 6, "content_hash": "edf056caf0e8674d99d7f0de611a9399d466e3e7589114143ee10640540a3b85", "source_url": "https://github.com/spring-projects/spring-security-kerberos/blob/1bf6e7fe8540cf0223d5e88560c683471bd4e447/spring-security-kerberos-docs/modules/ROOT/pages/appendix.adoc"}}
{"id": "sha256:edc5f4df32e3eccf825ce165851fce0ee0450029ed3d15222b98b66477bb03e8", "content": "Complete following steps to ensure that your Firefox browser is\nenabled to perform Spnego authentication.\n\n- Open Firefox.\n- At address field, type *about:config*.\n- In filter/search, type *negotiate*.\n- Parameter *network.negotiate-auth.trusted-uris* may be set to\n default *https://* which doesn't work for you. Generally speaking\n this parameter has to replaced with the server address if Kerberos\n delegation is required.\n- It is recommended to use `https` for all communication.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-security-kerberos", "path": "spring-security-kerberos-docs/modules/ROOT/pages/appendix.adoc", "title": "appendix", "heading": "Firefox", "heading_level": 3, "file_order": 0, "section_index": 7, "content_hash": "edc5f4df32e3eccf825ce165851fce0ee0450029ed3d15222b98b66477bb03e8", "source_url": "https://github.com/spring-projects/spring-security-kerberos/blob/1bf6e7fe8540cf0223d5e88560c683471bd4e447/spring-security-kerberos-docs/modules/ROOT/pages/appendix.adoc"}}
{"id": "sha256:a52b963cbd61514393c7b5594c4d11d809ccb6d34803d0e3f6df42a1db6360ea", "content": "With Google Chrome you generally need to set command-line parameters\norder to white list servers with Chrome will negotiate.\n\n- on Windows machines (clients): Chrome shares the configuration with\n Internet Explorer so if all changes were applied to IE (as described\n in E.3), nothing has to be passed via command-line parameters.\n- on Linux/Mac OS machines (clients): the command-line parameter\n `--auth-negotiate-delegate-whitelist` should only used if Kerberos\n delegation is required (otherwise do not set this parameter).\n- It is recommended to use `https` for all communication.\n\n[source,text]\n----\n--auth-server-whitelist=\"*.example.com\"\n--auth-negotiate-delegate-whitelist=\"*.example.com\"\n----\n\nYou can see which policies are enable by typing *chrome://policy/*\ninto Chrome's address bar.\n\nWith Linux Chrome will also read policy files from\n`/etc/opt/chrome/policies/managed` directory.\n\n.mypolicy.json\n[source,json]\n----\n{\n \"AuthServerWhitelist\" : \"*.example.org\",\n \"AuthNegotiateDelegateWhitelist\" : \"*.example.org\",\n \"DisableAuthNegotiateCnameLookup\" : true,\n \"EnableAuthNegotiatePort\" : true\n}\n----", "metadata": {"source_type": "repo_asciidoc", "project": "spring-security-kerberos", "path": "spring-security-kerberos-docs/modules/ROOT/pages/appendix.adoc", "title": "appendix", "heading": "Chrome", "heading_level": 3, "file_order": 0, "section_index": 8, "content_hash": "a52b963cbd61514393c7b5594c4d11d809ccb6d34803d0e3f6df42a1db6360ea", "source_url": "https://github.com/spring-projects/spring-security-kerberos/blob/1bf6e7fe8540cf0223d5e88560c683471bd4e447/spring-security-kerberos-docs/modules/ROOT/pages/appendix.adoc"}}
{"id": "sha256:353b9f0fad607280c8ed2024240e126911e724197db073c97de9b34241da5258", "content": "Complete following steps to ensure that your Internet Explorer browser\nis enabled to perform Spnego authentication.\n\n- Open Internet Explorer.\n- Click *Tools > Intenet Options > Security* tab.\n- In *Local intranet* section make sure your server is trusted by i.e.\n adding it into a list.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-security-kerberos", "path": "spring-security-kerberos-docs/modules/ROOT/pages/appendix.adoc", "title": "appendix", "heading": "Internet Explorer", "heading_level": 3, "file_order": 0, "section_index": 9, "content_hash": "353b9f0fad607280c8ed2024240e126911e724197db073c97de9b34241da5258", "source_url": "https://github.com/spring-projects/spring-security-kerberos/blob/1bf6e7fe8540cf0223d5e88560c683471bd4e447/spring-security-kerberos-docs/modules/ROOT/pages/appendix.adoc"}}
{"id": "sha256:09ca56f3b3937d63384fd131e8647e63bea64e05ad5aa91b291736a5e71d8f17", "content": "Spring Security Kerberos is an extension of Spring Security for\napplication developers to Kerberos concepts with Spring.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-security-kerberos", "path": "spring-security-kerberos-docs/modules/ROOT/pages/index.adoc", "title": "Spring Security Kerberos", "heading": "Spring Security Kerberos", "heading_level": 1, "file_order": 1, "section_index": 0, "content_hash": "09ca56f3b3937d63384fd131e8647e63bea64e05ad5aa91b291736a5e71d8f17", "source_url": "https://github.com/spring-projects/spring-security-kerberos/blob/1bf6e7fe8540cf0223d5e88560c683471bd4e447/spring-security-kerberos-docs/modules/ROOT/pages/index.adoc"}}
{"id": "sha256:8c0df48e44b0aca3f22917558e87a1c793a852f925fb34528ccd0d31193de8b4", "content": "[[introduction]]\n\nSpring Security Kerberos {version} is built and tested with JDK 17,\nSpring Security {spring-security-version} and Spring Framework {spring-version}.", "metadata": {"source_type": "repo_asciidoc", "project": "spring-security-kerberos", "path": "spring-security-kerberos-docs/modules/ROOT/pages/introduction.adoc", "title": "introduction", "heading": "introduction", "heading_level": 1, "file_order": 2, "section_index": 0, "content_hash": "8c0df48e44b0aca3f22917558e87a1c793a852f925fb34528ccd0d31193de8b4", "source_url": "https://github.com/spring-projects/spring-security-kerberos/blob/1bf6e7fe8540cf0223d5e88560c683471bd4e447/spring-security-kerberos-docs/modules/ROOT/pages/introduction.adoc"}}
{"id": "sha256:bf089271a01ae576b4e67d6aace88863a5982f8e49ca85d2ea137b7ecc4e066a", "content": "[[springsecuritykerberossamples]]\n\nThis part of the reference documentation is introducing samples\nprojects. Samples can be compiled manually by building main\ndistribution from\nhttps://github.com/spring-projects/spring-security-kerberos.\n\n[IMPORTANT]\n====\nIf you run sample as is it will not work until a correct configuration\nis applied. See notes below for specific samples.\n====\n\n<<samples-sec-server-win-auth>> sample for Windows environment\n\n<<samples-sec-server-client-auth>> sample using server side authenticator\n\n<<samples-sec-server-spnego-form-auth>> sample using ticket validation\nwith spnego and form\n\n<<samples-sec-client-rest-template>> sample for KerberosRestTemplate\n\n[[samples-sec-server-win-auth]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-security-kerberos", "path": "spring-security-kerberos-docs/modules/ROOT/pages/samples.adoc", "title": "samples", "heading": "samples", "heading_level": 1, "file_order": 3, "section_index": 0, "content_hash": "bf089271a01ae576b4e67d6aace88863a5982f8e49ca85d2ea137b7ecc4e066a", "source_url": "https://github.com/spring-projects/spring-security-kerberos/blob/1bf6e7fe8540cf0223d5e88560c683471bd4e447/spring-security-kerberos-docs/modules/ROOT/pages/samples.adoc"}}
{"id": "sha256:fa6fa11f9182aba6256bbc18b17cb663b385d2d8aa3b3ef9adc4a5c643e93028", "content": "Goals of this sample:\n\n- In windows environment, User will be able to logon to application\n with Windows Active directory Credential which has been entered\n during log on to windows. There should not be any ask for\n userid/password credentials.\n- In non-windows environment, User will be presented with a screen\n to provide Active directory credentials.\n\n[source,yaml,indent=0]\n----\nserver:\n port: 8080\n app:\n ad-domain: EXAMPLE.ORG\n ad-server: ldap://WIN-EKBO0EQ7TS7.example.org/\n service-principal: HTTP/neo.example.org@EXAMPLE.ORG\n keytab-location: /tmp/tomcat.keytab\n ldap-search-base: dc=example,dc=org\n ldap-search-filter: \"(| (userPrincipalName={0}) (sAMAccountName={0}))\"\n----\nIn above you can see the default configuration for this sample. You\ncan override these settings using a normal Spring Boot tricks like\nusing command-line options or custom `application.yml` file.\n\nRun a server.\n[source,text,subs=\"attributes\"]\n----\n$ java -jar sec-server-win-auth-{version}.jar\n----\n\n[IMPORTANT]\n====\nYou may need to use custom kerberos config with Linux either by using\n`-Djava.security.krb5.conf=/path/to/krb5.ini` or\n`GlobalSunJaasKerberosConfig` bean.\n====\n\n[NOTE]\n====\nSee xref:appendix.adoc#setupwinkerberos[Setup Windows Domain Controller]\nfor more instructions how to work with windows kerberos environment.\n====\n\nLogin to `Windows 8.1` using domain credentials and access sample\n\nimage:ie1.png[]\nimage:ie2.png[]\n\nAccess sample application from a non windows vm and use domain\ncredentials manually.\n\nimage:ff1.png[]\nimage:ff2.png[]\nimage:ff3.png[]\n\n[[samples-sec-server-client-auth]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-security-kerberos", "path": "spring-security-kerberos-docs/modules/ROOT/pages/samples.adoc", "title": "samples", "heading": "Security Server Windows Auth Sample", "heading_level": 2, "file_order": 3, "section_index": 1, "content_hash": "fa6fa11f9182aba6256bbc18b17cb663b385d2d8aa3b3ef9adc4a5c643e93028", "source_url": "https://github.com/spring-projects/spring-security-kerberos/blob/1bf6e7fe8540cf0223d5e88560c683471bd4e447/spring-security-kerberos-docs/modules/ROOT/pages/samples.adoc"}}
{"id": "sha256:44b6c234edc7abfcbfe9ef2e5905292d15e869d2cfbc8c26cbd82685ae14bee2", "content": "This sample demonstrates how server is able to authenticate user\nagainst kerberos environment using his credentials passed in via a\nform login.\n\nRun a server.\n[source,text,subs=\"attributes\"]\n----\n$ java -jar sec-server-client-auth-{version}.jar\n----\n\n[source,yaml,indent=0]\n----\nserver:\n port: 8080\n----\n\n[[samples-sec-server-spnego-form-auth]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-security-kerberos", "path": "spring-security-kerberos-docs/modules/ROOT/pages/samples.adoc", "title": "samples", "heading": "Security Server Side Auth Sample", "heading_level": 2, "file_order": 3, "section_index": 2, "content_hash": "44b6c234edc7abfcbfe9ef2e5905292d15e869d2cfbc8c26cbd82685ae14bee2", "source_url": "https://github.com/spring-projects/spring-security-kerberos/blob/1bf6e7fe8540cf0223d5e88560c683471bd4e447/spring-security-kerberos-docs/modules/ROOT/pages/samples.adoc"}}
{"id": "sha256:f68c93b874eb7a762a0040af3978f12ed87b876ef1670659a6a2f0a1f77eb80f", "content": "This sample demonstrates how a server can be configured to accept a\nSpnego based negotiation from a browser while still being able to fall\nback to a form based authentication.\n\nUsing a `user1` principal xref:appendix.adoc#setupmitkerberos[Setup MIT Kerberos],\ndo a kerberos login manually using credentials.\n[source,text]\n----\n$ kinit user1\nPassword for user1@EXAMPLE.ORG:\n\n$ klist\nTicket cache: FILE:/tmp/krb5cc_1000\nDefault principal: user1@EXAMPLE.ORG\n\nValid starting Expires Service principal\n10/03/15 17:18:45 11/03/15 03:18:45 krbtgt/EXAMPLE.ORG@EXAMPLE.ORG\n renew until 11/03/15 17:18:40\n----\n\nor using a keytab file.\n\n[source,text]\n----\n$ kinit -kt user2.keytab user1\n\n$ klist\nTicket cache: FILE:/tmp/krb5cc_1000\nDefault principal: user2@EXAMPLE.ORG\n\nValid starting Expires Service principal\n10/03/15 17:25:03 11/03/15 03:25:03 krbtgt/EXAMPLE.ORG@EXAMPLE.ORG\n renew until 11/03/15 17:25:03\n----\n\nRun a server.\n[source,text,subs=\"attributes\"]\n----\n$ java -jar sec-server-spnego-form-auth-{version}.jar\n----\n\nNow you should be able to open your browser and let it do Spnego\nauthentication with existing ticket.\n\n[NOTE]\n====\nSee xref:appendix.adoc#browserspnegoconfig[Configure Browsers for Spnego Negotiation]\nfor more instructions for configuring browsers to use Spnego.\n====\n\n[source,yaml,indent=0]\n----\nserver:\n port: 8080\napp:\n service-principal: HTTP/neo.example.org@EXAMPLE.ORG\n keytab-location: /tmp/tomcat.keytab\n----\n\n[[samples-sec-client-rest-template]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-security-kerberos", "path": "spring-security-kerberos-docs/modules/ROOT/pages/samples.adoc", "title": "samples", "heading": "Security Server Spnego and Form Auth Sample", "heading_level": 2, "file_order": 3, "section_index": 3, "content_hash": "f68c93b874eb7a762a0040af3978f12ed87b876ef1670659a6a2f0a1f77eb80f", "source_url": "https://github.com/spring-projects/spring-security-kerberos/blob/1bf6e7fe8540cf0223d5e88560c683471bd4e447/spring-security-kerberos-docs/modules/ROOT/pages/samples.adoc"}}
{"id": "sha256:eab42dad3490b98d81a6ffed9a68f8d88c8a05ad70ffaefa750b2b003d7ac424", "content": "This is a sample using a Spring RestTemplate to access Kerberos\nprotected resource. You can use this together with\n<<samples-sec-server-spnego-form-auth>>.\n\nDefault application is configured as shown below.\n[source,yaml,indent=0]\n----\napp:\n user-principal: user2@EXAMPLE.ORG\n keytab-location: /tmp/user2.keytab\n access-url: http://neo.example.org:8080/hello\n----\n\nUsing a `user1` principal xref:appendix.adoc#setupmitkerberos[Setup MIT Kerberos],\ndo a kerberos login manually using credentials.\n[source,text,subs=\"attributes\"]\n----\n$ java -jar sec-client-rest-template-{version}.jar --app.user-principal --app.keytab-location\n----\n\n[NOTE]\n====\nIn above we simply set `app.user-principal` and `app.keytab-location`\nto empty values which disables a use of keytab file.\n====\n\nIf operation is succesfull you should see below output with `user1@EXAMPLE.ORG`.\n[source,text]\n----\n<html xmlns=\"http://www.w3.org/1999/xhtml\"\n xmlns:sec=\"http://www.thymeleaf.org/thymeleaf-extras-springsecurity3\">\n <head>\n <title>Spring Security Kerberos Example</title>\n </head>\n <body>\n <h1>Hello user1@EXAMPLE.ORG!</h1>\n </body>\n</html>\n----\n\nOr use a `user2` with a keytab file.\n[source,text,subs=\"attributes\"]\n----\n$ java -jar sec-client-rest-template-{version}.jar\n----\n\nIf operation is succesfull you should see below output with `user2@EXAMPLE.ORG`.\n[source,text]\n----\n<html xmlns=\"http://www.w3.org/1999/xhtml\"\n xmlns:sec=\"http://www.thymeleaf.org/thymeleaf-extras-springsecurity3\">\n <head>\n <title>Spring Security Kerberos Example</title>\n </head>\n <body>\n <h1>Hello user2@EXAMPLE.ORG!</h1>\n </body>\n</html>\n----", "metadata": {"source_type": "repo_asciidoc", "project": "spring-security-kerberos", "path": "spring-security-kerberos-docs/modules/ROOT/pages/samples.adoc", "title": "samples", "heading": "Security Client KerberosRestTemplate Sample", "heading_level": 2, "file_order": 3, "section_index": 4, "content_hash": "eab42dad3490b98d81a6ffed9a68f8d88c8a05ad70ffaefa750b2b003d7ac424", "source_url": "https://github.com/spring-projects/spring-security-kerberos/blob/1bf6e7fe8540cf0223d5e88560c683471bd4e447/spring-security-kerberos-docs/modules/ROOT/pages/samples.adoc"}}
{"id": "sha256:ba88e08aa17f60828be5de2ce186937867d57fcc83e99aba53930c15825c0153", "content": "[[springsecuritykerberos]]\n\nThis part of the reference documentation explains the core functionality\nthat Spring Security Kerberos provides to any Spring based application.\n\n<<ssk-authprovider>> describes the authentication provider support.\n\n<<ssk-spnego>> describes the spnego negotiate support.\n\n<<ssk-resttemplate>> describes the RestTemplate support.\n\n[[ssk-authprovider]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-security-kerberos", "path": "spring-security-kerberos-docs/modules/ROOT/pages/ssk.adoc", "title": "ssk", "heading": "ssk", "heading_level": 1, "file_order": 4, "section_index": 0, "content_hash": "ba88e08aa17f60828be5de2ce186937867d57fcc83e99aba53930c15825c0153", "source_url": "https://github.com/spring-projects/spring-security-kerberos/blob/1bf6e7fe8540cf0223d5e88560c683471bd4e447/spring-security-kerberos-docs/modules/ROOT/pages/ssk.adoc"}}
{"id": "sha256:0864a01ad57a4b5d13370d134a972c0a25a5c076d4b13df365e89a2e41bc3230", "content": "Provider configuration using JavaConfig.\n\n[source,java,indent=0]\n----\n@Configuration\n@EnableWebSecurity\npublic class WebSecurityConfig {\n\n\t@Value(\"${app.service-principal}\")\n\tprivate String servicePrincipal;\n\n\t@Value(\"${app.keytab-location}\")\n\tprivate String keytabLocation;\n\n\t@Bean\n\tpublic SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n\t\tKerberosAuthenticationProvider kerberosAuthenticationProvider = kerberosAuthenticationProvider();\n\t\tKerberosServiceAuthenticationProvider kerberosServiceAuthenticationProvider = kerberosServiceAuthenticationProvider();\n\t\tProviderManager providerManager = new ProviderManager(kerberosAuthenticationProvider,\n\t\t\t\tkerberosServiceAuthenticationProvider);\n\n\t\thttp\n\t\t\t.authorizeHttpRequests((authz) -> authz\n\t\t\t\t.requestMatchers(\"/\", \"/home\").permitAll()\n\t\t\t\t.anyRequest().authenticated()\n\t\t\t)\n\t\t\t.exceptionHandling()\n\t\t\t\t.authenticationEntryPoint(spnegoEntryPoint())\n\t\t\t\t.and()\n\t\t\t.formLogin()\n\t\t\t\t.loginPage(\"/login\").permitAll()\n\t\t\t\t.and()\n\t\t\t.logout()\n\t\t\t\t.permitAll()\n\t\t\t\t.and()\n\t\t\t.authenticationProvider(kerberosAuthenticationProvider())\n\t\t\t.authenticationProvider(kerberosServiceAuthenticationProvider())\n\t\t\t.addFilterBefore(spnegoAuthenticationProcessingFilter(providerManager),\n\t\t\t\t\tBasicAuthenticationFilter.class);\n\t\t\treturn http.build();\n\t}\n\n\t@Bean\n\tpublic KerberosAuthenticationProvider kerberosAuthenticationProvider() {\n\t\tKerberosAuthenticationProvider provider = new KerberosAuthenticationProvider();\n\t\tSunJaasKerberosClient client = new SunJaasKerberosClient();\n\t\tclient.setDebug(true);\n\t\tprovider.setKerberosClient(client);\n\t\tprovider.setUserDetailsService(dummyUserDetailsService());\n\t\treturn provider;\n\t}\n\n\t@Bean\n\tpublic SpnegoEntryPoint spnegoEntryPoint() {\n\t\treturn new SpnegoEntryPoint(\"/login\");\n\t}\n\n\tpublic SpnegoAuthenticationProcessingFilter spnegoAuthenticationProcessingFilter(\n\t\t\tAuthenticationManager authenticationManager) {\n\t\tSpnegoAuthenticationProcessingFilter filter = new SpnegoAuthenticationProcessingFilter();\n\t\tfilter.setAuthenticationManager(authenticationManager);\n\t\treturn filter;\n\t}\n\n\t@Bean\n\tpublic KerberosServiceAuthenticationProvider kerberosServiceAuthenticationProvider() {\n\t\tKerberosServiceAuthenticationProvider provider = new KerberosServiceAuthenticationProvider();\n\t\tprovider.setTicketValidator(sunJaasKerberosTicketValidator());\n\t\tprovider.setUserDetailsService(dummyUserDetailsService());\n\t\treturn provider;\n\t}\n\n\t@Bean\n\tpublic SunJaasKerberosTicketValidator sunJaasKerberosTicketValidator() {\n\t\tSunJaasKerberosTicketValidator ticketValidator = new SunJaasKerberosTicketValidator();\n\t\tticketValidator.setServicePrincipal(servicePrincipal);\n\t\tticketValidator.setKeyTabLocation(new FileSystemResource(keytabLocation));\n\t\tticketValidator.setDebug(true);\n\t\treturn ticketValidator;\n\t}\n\n\t@Bean\n\tpublic DummyUserDetailsService dummyUserDetailsService() {\n\t\treturn new DummyUserDetailsService();\n\t}\n}\n----\n\n[[ssk-spnego]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-security-kerberos", "path": "spring-security-kerberos-docs/modules/ROOT/pages/ssk.adoc", "title": "ssk", "heading": "Authentication Provider", "heading_level": 2, "file_order": 4, "section_index": 1, "content_hash": "0864a01ad57a4b5d13370d134a972c0a25a5c076d4b13df365e89a2e41bc3230", "source_url": "https://github.com/spring-projects/spring-security-kerberos/blob/1bf6e7fe8540cf0223d5e88560c683471bd4e447/spring-security-kerberos-docs/modules/ROOT/pages/ssk.adoc"}}
{"id": "sha256:fc717a3ef03a0e33f648a0480f7c7216f12db8bda7c581b5d32721c0c68ac4c8", "content": "Spnego configuration using JavaConfig.\n\n[source,java,indent=0]\n----\n@Configuration\n@EnableWebSecurity\npublic class WebSecurityConfig {\n\n\t@Value(\"${app.ad-domain}\")\n\tprivate String adDomain;\n\n\t@Value(\"${app.ad-server}\")\n\tprivate String adServer;\n\n\t@Value(\"${app.service-principal}\")\n\tprivate String servicePrincipal;\n\n\t@Value(\"${app.keytab-location}\")\n\tprivate String keytabLocation;\n\n\t@Value(\"${app.ldap-search-base}\")\n\tprivate String ldapSearchBase;\n\n\t@Value(\"${app.ldap-search-filter}\")\n\tprivate String ldapSearchFilter;\n\n\t@Bean\n\tpublic SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n\t\tKerberosServiceAuthenticationProvider kerberosServiceAuthenticationProvider = kerberosServiceAuthenticationProvider();\n\t\tActiveDirectoryLdapAuthenticationProvider activeDirectoryLdapAuthenticationProvider = activeDirectoryLdapAuthenticationProvider();\n\t\tProviderManager providerManager = new ProviderManager(kerberosServiceAuthenticationProvider,\n\t\t\t\tactiveDirectoryLdapAuthenticationProvider);\n\n\t\thttp\n\t\t\t.authorizeHttpRequests((authz) -> authz\n\t\t\t\t.requestMatchers(\"/\", \"/home\").permitAll()\n\t\t\t\t.anyRequest().authenticated()\n\t\t\t)\n\t\t\t.exceptionHandling()\n\t\t\t\t.authenticationEntryPoint(spnegoEntryPoint())\n\t\t\t\t.and()\n\t\t\t.formLogin()\n\t\t\t\t.loginPage(\"/login\").permitAll()\n\t\t\t\t.and()\n\t\t\t.logout()\n\t\t\t\t.permitAll()\n\t\t\t\t.and()\n\t\t\t.authenticationProvider(activeDirectoryLdapAuthenticationProvider())\n\t\t\t.authenticationProvider(kerberosServiceAuthenticationProvider())\n\t\t\t.addFilterBefore(spnegoAuthenticationProcessingFilter(providerManager),\n\t\t\t\tBasicAuthenticationFilter.class);\n\n\t\treturn http.build();\n\t}\n\n\t@Bean\n\tpublic ActiveDirectoryLdapAuthenticationProvider activeDirectoryLdapAuthenticationProvider() {\n\t\treturn new ActiveDirectoryLdapAuthenticationProvider(adDomain, adServer);\n\t}\n\n\t@Bean\n\tpublic SpnegoEntryPoint spnegoEntryPoint() {\n\t\treturn new SpnegoEntryPoint(\"/login\");\n\t}\n\n\tpublic SpnegoAuthenticationProcessingFilter spnegoAuthenticationProcessingFilter(\n\t\t\tAuthenticationManager authenticationManager) {\n\t\tSpnegoAuthenticationProcessingFilter filter = new SpnegoAuthenticationProcessingFilter();\n\t\tfilter.setAuthenticationManager(authenticationManager);\n\t\treturn filter;\n\t}\n\n\tpublic KerberosServiceAuthenticationProvider kerberosServiceAuthenticationProvider() throws Exception {\n\t\tKerberosServiceAuthenticationProvider provider = new KerberosServiceAuthenticationProvider();\n\t\tprovider.setTicketValidator(sunJaasKerberosTicketValidator());\n\t\tprovider.setUserDetailsService(ldapUserDetailsService());\n\t\treturn provider;\n\t}\n\n\t@Bean\n\tpublic SunJaasKerberosTicketValidator sunJaasKerberosTicketValidator() {\n\t\tSunJaasKerberosTicketValidator ticketValidator = new SunJaasKerberosTicketValidator();\n\t\tticketValidator.setServicePrincipal(servicePrincipal);\n\t\tticketValidator.setKeyTabLocation(new FileSystemResource(keytabLocation));\n\t\tticketValidator.setDebug(true);\n\t\treturn ticketValidator;\n\t}\n\n\t@Bean\n\tpublic KerberosLdapContextSource kerberosLdapContextSource() throws Exception {\n\t\tKerberosLdapContextSource contextSource = new KerberosLdapContextSource(adServer);\n\t\tcontextSource.setLoginConfig(loginConfig());\n\t\treturn contextSource;\n\t}\n\n\tpublic SunJaasKrb5LoginConfig loginConfig() throws Exception {\n\t\tSunJaasKrb5LoginConfig loginConfig = new SunJaasKrb5LoginConfig();\n\t\tloginConfig.setKeyTabLocation(new FileSystemResource(keytabLocation));\n\t\tloginConfig.setServicePrincipal(servicePrincipal);\n\t\tloginConfig.setDebug(true);\n\t\tloginConfig.setIsInitiator(true);\n\t\tloginConfig.afterPropertiesSet();\n\t\treturn loginConfig;\n\t}\n\n\t@Bean\n\tpublic LdapUserDetailsService ldapUserDetailsService() throws Exception {\n\t\tFilterBasedLdapUserSearch userSearch =\n\t\t\t\tnew FilterBasedLdapUserSearch(ldapSearchBase, ldapSearchFilter, kerberosLdapContextSource());\n\t\tLdapUserDetailsService service =\n\t\t\t\tnew LdapUserDetailsService(userSearch, new ActiveDirectoryLdapAuthoritiesPopulator());\n\t\tservice.setUserDetailsMapper(new LdapUserDetailsMapper());\n\t\treturn service;\n\t}\n}\n----\n\n[[ssk-resttemplate]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-security-kerberos", "path": "spring-security-kerberos-docs/modules/ROOT/pages/ssk.adoc", "title": "ssk", "heading": "Spnego Negotiate", "heading_level": 2, "file_order": 4, "section_index": 2, "content_hash": "fc717a3ef03a0e33f648a0480f7c7216f12db8bda7c581b5d32721c0c68ac4c8", "source_url": "https://github.com/spring-projects/spring-security-kerberos/blob/1bf6e7fe8540cf0223d5e88560c683471bd4e447/spring-security-kerberos-docs/modules/ROOT/pages/ssk.adoc"}}
{"id": "sha256:0c0d884e8c05b24c67951c4fce8a1d656220b864e0b6220c353bc6e0fdc89452", "content": "If there is a need to access Kerberos protected web resources\nprogrammatically we have `KerberosRestTemplate` which extends\n`RestTemplate` and does necessary login actions prior to delegating to\nactual RestTemplate methods. You basically have few options to\nconfigure this template.\n\n- Leave keyTabLocation and userPrincipal empty if you want to\n use cached ticket.\n- Use keyTabLocation and userPrincipal if you want to use\n keytab file.\n- Use loginOptions if you want to customise Krb5LoginModule options.\n- Use a customised httpClient.\n\nWith ticket cache.\n[source,java,indent=0]\n----\n    public void doWithTicketCache() {\n        KerberosRestTemplate restTemplate =\n                new KerberosRestTemplate();\n        restTemplate.getForObject(\"http://neo.example.org:8080/hello\", String.class);\n    }\n----\n\nWith keytab file.\n[source,java,indent=0]\n----\n    public void doWithKeytabFile() {\n        KerberosRestTemplate restTemplate =\n                new KerberosRestTemplate(\"/tmp/user2.keytab\", \"user2@EXAMPLE.ORG\");\n        restTemplate.getForObject(\"http://neo.example.org:8080/hello\", String.class);\n    }\n----\n\n[[ssk-kerberosldap]]", "metadata": {"source_type": "repo_asciidoc", "project": "spring-security-kerberos", "path": "spring-security-kerberos-docs/modules/ROOT/pages/ssk.adoc", "title": "ssk", "heading": "Using KerberosRestTemplate", "heading_level": 2, "file_order": 4, "section_index": 3, "content_hash": "0c0d884e8c05b24c67951c4fce8a1d656220b864e0b6220c353bc6e0fdc89452", "source_url": "https://github.com/spring-projects/spring-security-kerberos/blob/1bf6e7fe8540cf0223d5e88560c683471bd4e447/spring-security-kerberos-docs/modules/ROOT/pages/ssk.adoc"}}
{"id": "sha256:675f75685d65540d8d7a03c2cc5a1bf7758e175c27c2770d62872074d9a39e72", "content": "With most of your samples we're using `DummyUserDetailsService`\nbecause there is not necessarily need to query a real user details\nonce kerberos authentication is successful and we can use kerberos\nprincipal info to create that dummy user. However there is a way to\naccess kerberized LDAP services in a say way and query user details\nfrom there.\n\n`KerberosLdapContextSource` can be used to bind into LDAP via kerberos\nwhich is at least proven to work well with Windows AD services.\n\n[source,java,indent=0]\n----\n\t@Value(\"${app.ad-server}\")\n\tprivate String adServer;\n\n\t@Value(\"${app.service-principal}\")\n\tprivate String servicePrincipal;\n\n\t@Value(\"${app.keytab-location}\")\n\tprivate String keytabLocation;\n\n\t@Value(\"${app.ldap-search-base}\")\n\tprivate String ldapSearchBase;\n\n\t@Value(\"${app.ldap-search-filter}\")\n\tprivate String ldapSearchFilter;\n\n\t@Bean\n\tpublic KerberosLdapContextSource kerberosLdapContextSource() {\n\t\tKerberosLdapContextSource contextSource = new KerberosLdapContextSource(adServer);\n\t\tSunJaasKrb5LoginConfig loginConfig = new SunJaasKrb5LoginConfig();\n\t\tloginConfig.setKeyTabLocation(new FileSystemResource(keytabLocation));\n\t\tloginConfig.setServicePrincipal(servicePrincipal);\n\t\tloginConfig.setDebug(true);\n\t\tloginConfig.setIsInitiator(true);\n\t\tcontextSource.setLoginConfig(loginConfig);\n\t\treturn contextSource;\n\t}\n\n\t@Bean\n\tpublic LdapUserDetailsService ldapUserDetailsService() {\n\t\tFilterBasedLdapUserSearch userSearch =\n\t\t\t\tnew FilterBasedLdapUserSearch(ldapSearchBase, ldapSearchFilter, kerberosLdapContextSource());\n\t\tLdapUserDetailsService service = new LdapUserDetailsService(userSearch);\n\t\tservice.setUserDetailsMapper(new LdapUserDetailsMapper());\n\t\treturn service;\n\t}\n----\n\n[TIP]\n====\nSample xref:samples.adoc#samples-sec-server-win-auth[Security Server Windows Auth Sample]\nis currently configured to query user details from AD if authentication happen via kerberos.\n====", "metadata": {"source_type": "repo_asciidoc", "project": "spring-security-kerberos", "path": "spring-security-kerberos-docs/modules/ROOT/pages/ssk.adoc", "title": "ssk", "heading": "Authentication with LDAP Services", "heading_level": 2, "file_order": 4, "section_index": 4, "content_hash": "675f75685d65540d8d7a03c2cc5a1bf7758e175c27c2770d62872074d9a39e72", "source_url": "https://github.com/spring-projects/spring-security-kerberos/blob/1bf6e7fe8540cf0223d5e88560c683471bd4e447/spring-security-kerberos-docs/modules/ROOT/pages/ssk.adoc"}}
